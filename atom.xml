<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冯凯&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zixujing.github.io/"/>
  <updated>2019-02-13T14:19:58.508Z</updated>
  <id>https://zixujing.github.io/</id>
  
  <author>
    <name>冯_凯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>时间同步与tomcat自启动</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E4%B8%8Etomcat%E8%87%AA%E5%90%AF%E5%8A%A8/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/时间同步与tomcat自启动/</id>
    <published>2019-02-12T21:00:00.000Z</published>
    <updated>2019-02-13T14:19:58.508Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>时间同步与tomcat自启动<br><a id="more"></a></p></blockquote><h2 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h2><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line">server 10.24.70.72 iburst</span><br></pre></td></tr></table></figure><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop chronyd</span><br><span class="line">systemctl start chronyd</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources</span><br></pre></td></tr></table></figure><h2 id="tomcat自启动"><a href="#tomcat自启动" class="headerlink" title="tomcat自启动"></a>tomcat自启动</h2><h3 id="添加变量到setenv-sh（没有的话在bin目录新建一个）中-catalina-sh会调用"><a href="#添加变量到setenv-sh（没有的话在bin目录新建一个）中-catalina-sh会调用" class="headerlink" title="添加变量到setenv.sh（没有的话在bin目录新建一个）中,catalina.sh会调用"></a>添加变量到setenv.sh（没有的话在bin目录新建一个）中,catalina.sh会调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/apache-tomcat-8.5.35/bin/setenv.sh</span><br><span class="line">JAVA_HOME=/opt/jdk1.8.0_144</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">CATALINA_PID=&quot;$CATALINA_BASE/tomcat8_hcpt.pid&quot;</span><br></pre></td></tr></table></figure><h3 id="设置启动脚本"><a href="#设置启动脚本" class="headerlink" title="设置启动脚本"></a>设置启动脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/tomcat8_hcpt.service</span><br><span class="line">#/usr/lib/systemd/system/tomcat8_hcpt.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Tomcat8</span><br><span class="line">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/local/apache-tomcat-8.5.35/tomcat8_hcpt.pid</span><br><span class="line">ExecStart=/usr/local/apache-tomcat-8.5.35/bin/startup.sh</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable tomcat8_hcpt</span><br><span class="line">systemctl start tomcat8_hcpt</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;时间同步与tomcat自启动&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>keepalived监控切换功能</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/keepalived%E7%9B%91%E6%8E%A7%E5%88%87%E6%8D%A2%E5%8A%9F%E8%83%BD/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/keepalived监控切换功能/</id>
    <published>2019-02-12T19:00:00.000Z</published>
    <updated>2019-02-13T12:16:09.989Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>keepalived监控切换功能<br><a id="more"></a></p></blockquote><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">tar -cvf all.repo.tar *</span><br><span class="line">rm -fr *.repo</span><br><span class="line">vi cdiso.repo</span><br><span class="line"></span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///root/c7</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">#把iso挂载到/root/c7目录下</span><br><span class="line">mkdir /root/c7</span><br><span class="line">mount -o loop CentOS-7-x86_64-DVD-1611.iso /root/c7</span><br></pre></td></tr></table></figure><h2 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install keepalived</span><br><span class="line">keepalived -v</span><br><span class="line">systemctl enable keepalived</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br></pre></td></tr></table></figure><h2 id="nginx监控脚本"><a href="#nginx监控脚本" class="headerlink" title="nginx监控脚本"></a>nginx监控脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/keepalived/</span><br><span class="line">vi check_nginx.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">counter=$(ps -C nginx --no-heading | wc -l)</span><br><span class="line">if [ &quot;$&#123;counter&#125;&quot; = &quot;0&quot; ]; then</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    exit0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">chmod +x check_nginx.sh</span><br></pre></td></tr></table></figure><h2 id="keepalived-conf-配置"><a href="#keepalived-conf-配置" class="headerlink" title="keepalived.conf 配置"></a>keepalived.conf 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">cp keepalived.conf keepalived.conf.bak</span><br><span class="line">vi keepalived.conf</span><br><span class="line">##主节点的配置</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">    script &quot;/etc/keepalived/check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -5</span><br><span class="line">    fall 1</span><br><span class="line">    rise 1</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.24.70.251</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##从节点的配置</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">    script &quot;/etc/keepalived/check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -5</span><br><span class="line">    fall 3</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.24.70.251</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="启动keepalived"><a href="#启动keepalived" class="headerlink" title="启动keepalived"></a>启动keepalived</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable keepalived</span><br><span class="line">systemctl start keepalived</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;keepalived监控切换功能&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>nginx1.14.2 安装配置文档</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/nginx1.14.2%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/nginx1.14.2 安装配置文档/</id>
    <published>2019-02-12T17:00:00.000Z</published>
    <updated>2019-02-13T08:13:58.006Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx安装配置文档<br><a id="more"></a></p></blockquote><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#cd /etc/yum.repos.d/</span><br><span class="line">#tar -cvf all.repo.tar *</span><br><span class="line">#rm -fr *.repo</span><br><span class="line">#vi cdiso.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///root/c7</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">#把iso挂载到/root/c7目录下</span><br><span class="line">#mkdir /root/c7</span><br><span class="line">#mount -o loop 系统iso文件.iso /root/c7</span><br></pre></td></tr></table></figure><h2 id="基本环境配置"><a href="#基本环境配置" class="headerlink" title="基本环境配置"></a>基本环境配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#yum install gcc pcre-devel zlib-devel openssl-devel</span><br><span class="line">#systemctl stop firewalld</span><br><span class="line">#systemctl disable firewalld</span><br><span class="line">#groupadd nginx</span><br><span class="line">#useradd nginx -g nginx -s /sbin/nologin -M</span><br><span class="line">#vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#./configure \</span><br><span class="line">--prefix=/usr/local/nginx \</span><br><span class="line">--sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx.lock \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-openssl=</span><br><span class="line">#make</span><br><span class="line">#make install</span><br></pre></td></tr></table></figure><h2 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h2><ul><li><p>编辑文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vi /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure></li><li><p>文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#/usr/lib/systemd/system/nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">ExecReload=/usr/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/sbin/nginx -s stop</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul><li><p>编辑配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>编辑文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line">pid        /var/log/nginx/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  65535;</span><br><span class="line">    use epoll;</span><br><span class="line">    multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    tcp_nodelay    on;</span><br><span class="line">    </span><br><span class="line">    server_tokens off;</span><br><span class="line">    </span><br><span class="line">    open_file_cache max=65535 inactive=20s;</span><br><span class="line">    open_file_cache_valid 30s;</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">    </span><br><span class="line">    client_header_buffer_size 4k;</span><br><span class="line">    large_client_header_buffers 4 32k;</span><br><span class="line">    client_header_timeout 15;</span><br><span class="line">    client_body_timeout 15;</span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    </span><br><span class="line">    client_body_temp_path /usr/local/nginx/body_temp 1 2;</span><br><span class="line">    </span><br><span class="line">    reset_timedout_connection on;</span><br><span class="line">    send_timeout 30;</span><br><span class="line">    </span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length 1k;</span><br><span class="line">    gzip_buffers 4 16k;</span><br><span class="line">    gzip_http_version 1.0;</span><br><span class="line">    gzip_comp_level 2;</span><br><span class="line">    gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    </span><br><span class="line">    upstream hch80&#123;</span><br><span class="line">        server 10.24.70.81:80;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream hch18080&#123;</span><br><span class="line">        server 10.24.70.82:18080;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  10.24.70.74;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://hch80;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line">            proxy_temp_path /usr/local/nginx/proxy_temp80 1 2;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       18080;</span><br><span class="line">        server_name  10.24.70.74;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://hch18080;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line">            proxy_temp_path /usr/local/nginx/proxy_temp18080 1 2;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;nginx安装配置文档&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>nginx随笔</title>
    <link href="https://zixujing.github.io/2019/02/11/linux/linux%E5%B7%A5%E5%85%B7/nginx%E9%9A%8F%E7%AC%94/"/>
    <id>https://zixujing.github.io/2019/02/11/linux/linux工具/nginx随笔/</id>
    <published>2019-02-10T17:00:00.000Z</published>
    <updated>2019-02-12T17:57:36.050Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx笔记<br><a id="more"></a></p></blockquote><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="tcp握手"><a href="#tcp握手" class="headerlink" title="tcp握手"></a>tcp握手</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/30193702-7287165c73e7440382207309e07fcbb5.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/30193703-330b281cddc5439f99eb027ac1c9627c.png" alt=""></p><h3 id="tcp-cork"><a href="#tcp-cork" class="headerlink" title="tcp_cork"></a>tcp_cork</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/image013.png" alt=""></p><h2 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h2><h3 id="读取文件并socket传输的普通过程"><a href="#读取文件并socket传输的普通过程" class="headerlink" title="读取文件并socket传输的普通过程"></a>读取文件并socket传输的普通过程</h3><ol start="0"><li>read(file,tmp_buf, len);<br>write(socket,tmp_buf, len);</li><li>系统调用 read()产生一个上下文切换，从 user mode 切换到 kernel mode，然后 DMA 执行拷贝，把文件数据从硬盘读到一个 kernel buffer 里。</li><li>数据从 kernel buffer拷贝到 user buffer，然后系统调用 read() 返回，这时又产生一个上下文切换，从kernel mode 切换到 user mode。</li><li>系统调用write()产生一个上下文切换，从 user mode切换到 kernel mode，然后把步骤2读到 user buffer的数据拷贝到 kernel buffer，不过这次是个不同的 kernel buffer，这个 buffer和 socket相关联。</li><li>系统调用 write()返回，产生一个上下文切换，从 kernel mode 切换到 user mode ，然后 DMA 从 kernel buffer拷贝数据到协议栈。<h3 id="sendfile的协议栈传输过程"><a href="#sendfile的协议栈传输过程" class="headerlink" title="sendfile的协议栈传输过程"></a>sendfile的协议栈传输过程</h3></li><li>sendfile(socket,file, len);</li><li>系统调用sendfile()通过 DMA把硬盘数据拷贝到 kernel buffer，然后数据被 kernel直接拷贝到另外一个与 socket相关的 kernel buffer。这里没有 user mode和 kernel mode之间的切换，在 kernel中直接完成了从一个 buffer到另一个 buffer的拷贝。</li><li>DMA 把数据从 kernelbuffer 直接拷贝给协议栈，没有切换，也不需要数据从 user mode 拷贝到 kernel mode，因为数据就在 kernel 里。<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3>sendfile 是将 in_fd 的内容发送到 out_fd 。而 in_fd 不能是 socket ， 也就是只能文件句柄。 所以当 Nginx 是一个静态文件服务器的时候，开启 SENDFILE 配置项能大大提高 Nginx 的性能。 但是当 Nginx 是作为一个反向代理来使用的时候，SENDFILE 则没什么用了，因为 Nginx 是反向代理的时候。 in_fd 就不是文件句柄而是 socket，此时就不符合 sendfile 函数的参数要求了。</li></ol><h2 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h2><ol><li>当一个新连接到达时，如果激活了accept_mutex，那么多个Worker将以串行方式来处理，其中有一个Worker会被唤醒，其他的Worker继续保持休眠状态；如果没有激活accept_mutex，那么所有的Worker都会被唤醒，不过只有一个Worker能获取新连接，其它的Worker会重新进入休眠状态，这就是「惊群问题」。</li><li>OS may wake all processes waiting on accept() and select(), this is called thundering herd problem. This is a problem if you have a lot of workers as in Apache (hundreds and more), but this insensible if you have just several workers as nginx usually has. Therefore turning accept_mutex off is as scheduling incoming connection by OS via select/kqueue/epoll/etc (but not accept()).</li></ol><h2 id="multi-accept"><a href="#multi-accept" class="headerlink" title="multi_accept"></a>multi_accept</h2><ol><li>在Nginx获得有新连接的通知之后,接受尽可能多的连接。</li></ol><h2 id="tcp-nopush"><a href="#tcp-nopush" class="headerlink" title="tcp_nopush"></a>tcp_nopush</h2><p>Enables or disables the use of the TCP_NOPUSH socket option on FreeBSD) or the TCP_CORK socket option on Linux. The options are enabled only when sendfile is used. Enabling the option allows</p><ul><li>sending the response header and the beginning of a file in one packet, on Linux and FreeBSD 4.*;</li><li>sending a file in full packets.</li><li>在nginx中，tcp_nopush配置与tcp_nodelay“互斥”。它可以配置一次发送数据包的大小。也就是说，数据包累积到一定大小后就发送。</li><li>在nginx中tcp_nopush必须和sendfile配合使用。</li></ul><h2 id="tcp-nodelay"><a href="#tcp-nodelay" class="headerlink" title="tcp_nodelay"></a>tcp_nodelay</h2><p>这个选项的作用就是禁用 Nagle’s Algorithm，默认开启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#nagle algorithm</span><br><span class="line">if there is new data to send</span><br><span class="line">  if the window size &gt;= MSS and available data is &gt;= MSS</span><br><span class="line">    send complete MSS segment now</span><br><span class="line">  else</span><br><span class="line">    if there is unconfirmed data still in the pipe</span><br><span class="line">      enqueue data in the buffer until an acknowledge is received</span><br><span class="line">    else</span><br><span class="line">      send data immediately</span><br><span class="line">    end if</span><br><span class="line">  end if</span><br><span class="line">end if</span><br></pre></td></tr></table></figure></p><p>  可以看到，当待发送的数据比 MSS 小的时候（外层的 else 分支），还要再判断 时候还有未确认的数据。只有当管道里还有未确认数据的时候才会进入缓冲区， 等待 Ack。<br>  所以发送端发送的第一个 write 是不会被缓冲起来，而是立刻发送的（进入内层 的else 分支），这时接收端收到对应的数据，但它还期待更多数据才进行处理， 所以不会往回发送数据，因此也没机会把 Ack 给带回去，根据Delayed Ack 机制， 这个 Ack 会被 Hold 住。这时发送端发送第二个包，而队列里还有未确认的数据 包，所以进入了内层 if 的 then 分支，这个 packet 会被缓冲起来。此时，发 送端在等待接收端的 Ack；接收端则在 Delay 这个 Ack，所以都在等待，直到接 收端 Deplayed Ack 超时（40ms），此 Ack 被发送回去，发送端缓冲的这个 packet 才会被真正送到接收端，从而继续下去。<br>  再看我上面的 strace 记录也能发现端倪，因为设计的一些不足，我没能做到把 短小的 HTTP Body 连同 HTTP Headers 一起发送出去，而是分开成两次调用实 现的，之后进入 epoll_wait 等待下一个 Request 被发送过来（相当于阻塞模 型里直接 read）。正好是 write-write-read 的模式。<br>  那么 write-read-write-read 会不会出问题呢？维基百科上的解释是不会。</p><h2 id="Delayed-Ack-机制"><a href="#Delayed-Ack-机制" class="headerlink" title="Delayed Ack 机制"></a>Delayed Ack 机制</h2><h2 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h2><p>  这个参数不是tcp的keepalive，是程序的keepalive，处理完业务后会等待一段时间再关闭连接.</p><h2 id="net-ipv4-tcp-tw-recycle"><a href="#net-ipv4-tcp-tw-recycle" class="headerlink" title="net.ipv4.tcp_tw_recycle"></a>net.ipv4.tcp_tw_recycle</h2><p>  net.ipv4.tcp_tw_recycle = {0|1} 是否启用timewait快速回收；注意：开启此功能在NAT环境下可能会出现严重的问题：因为TCP有一种行为，它可以缓存每个连接最新的时间戳，后续请求中如果时间戳小于缓存中的时间戳，即被视为无效并丢弃相应的请求报文；Linux是否启用这种行为取决于tcp_timestamp和tcp_tw_recycle，而前一个参数默认是启用的，所以启用后面的参数就会激活此功能； 因此，如果是NAT环境，安全起见，应该禁用tcp_tw_recycle。另一种解决方案：把tcp_timestamps设置为0，tcp_tw_recycle设置为1并不会如想象中奏效，因为一旦关闭了tcp_timestamps，那么即便打开了tcp_tw_recycle，后面的参数也没有效果。此时降低net.ipv4.tcp_max_tw_buckets的值就可以显著降低tw连接的数量了。对客户端和服务器同时起作用。</p><h2 id="net-ipv4-tcp-tw-reuse"><a href="#net-ipv4-tcp-tw-reuse" class="headerlink" title="net.ipv4.tcp_tw_reuse"></a>net.ipv4.tcp_tw_reuse</h2><p>net.ipv4.tcp_tw_reuse = {0|1} 是否开启tw重用，即是否允许将TIME-WAIT sockets 用于新的TCP连接，就是数据结构不会收，只更改一下ip和port就继续使用。 只对客户端起作用，开启后客户端在1s内回收。</p><h2 id="somaxconn"><a href="#somaxconn" class="headerlink" title="somaxconn"></a>somaxconn</h2><p>  定义了系统中每一个端口最大的监听队列的长度,这是个全局的参数,默认值为128，对于一个经常处理新连接的高负载 web服务环境来说，默认的 128 太小了。大多数环境这个值建议增加到 1024 或者更多。大的侦听队列对防止拒绝服务 DoS 攻击也会有所帮助。</p><h2 id="net-core-netdev-max-backlog-262144"><a href="#net-core-netdev-max-backlog-262144" class="headerlink" title="net.core.netdev_max_backlog = 262144"></a>net.core.netdev_max_backlog = 262144</h2><p>  每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。</p><h2 id="net-ipv4-tcp-max-syn-backlog-262144"><a href="#net-ipv4-tcp-max-syn-backlog-262144" class="headerlink" title="net.ipv4.tcp_max_syn_backlog = 262144"></a>net.ipv4.tcp_max_syn_backlog = 262144</h2><p>  这个参数标示TCP三次握手建立阶段接受SYN请求队列的最大长度，默认为1024，将其设置得大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux不至于丢失客户端发起的连接请求。</p><h2 id="MTU-MSS"><a href="#MTU-MSS" class="headerlink" title="MTU MSS"></a>MTU MSS</h2><h3 id="MTU-Maxitum-Transmission-Unit-最大传输单元"><a href="#MTU-Maxitum-Transmission-Unit-最大传输单元" class="headerlink" title="MTU: Maxitum Transmission Unit 最大传输单元"></a>MTU: Maxitum Transmission Unit 最大传输单元</h3><h3 id="MSS-Maxitum-Segment-Size-最大分段大小"><a href="#MSS-Maxitum-Segment-Size-最大分段大小" class="headerlink" title="MSS: Maxitum Segment Size 最大分段大小"></a>MSS: Maxitum Segment Size 最大分段大小</h3><p>  MSS就是TCP数据包每次能够传输的最大数据分段。为了达到最佳的传输效能TCP协议在建立连接的时候通常要协商双方的MSS值，这个值TCP协议在实现的时候往往用MTU值代替（需要减去IP数据包包头的大小20Bytes和TCP数据段的包头20Bytes）, 通讯双方会根据双方提供的MSS值得最小值确定为这次连接的最大MSS值。而一般以太网MTU都为1500, 所以在以太网中, 往往TCP MSS为1460。</p><h2 id="滑动窗口与内核缓冲区的关系"><a href="#滑动窗口与内核缓冲区的关系" class="headerlink" title="滑动窗口与内核缓冲区的关系"></a>滑动窗口与内核缓冲区的关系</h2><ul><li>net.ipv4.tcp_rmem:这个参数定义了TCP接收缓冲（用于TCP接收滑动窗口）的最小值、默认值、最大值</li><li>net.ipv4.tcp_wmem:这个参数定义了TCP发送缓冲（用于TCP发送滑动窗口）的最小值、默认值、最大值</li><li>netdev_max_backlog：当网卡接收数据包的速度大于内核处理的速度时，会有一个队列保存这些数据包。这个参数表示队列的最大值</li><li>rmem_default：这个参数表示内核套接字接收缓存区默认的大小</li><li>wmem_default：这个参数表示内核套接字发送缓存区默认的大小</li><li>rmem_max：这个参数表示内核套接字接收缓存区最大的大小</li><li><p>rmem_max：这个参数表示内核套接字接收缓存区最大的大小<br>对于发送数据来说，应用程序将数据拷贝到各自TCP发送缓冲区内（也就是发送滑动窗口），然后系统的所有TCP套接字上发送缓冲区（也就是发送滑动窗口）内的数据都将数据拷贝到内核发送缓冲区内，然后内核将内核缓冲区的数据经过网卡发送出去。</p><p>  TCP的发送/接受缓冲区（也就是发送/接受滑动窗口），是针对某一个具体的TCP连接来说的，每一个TCP连接都会有相应的滑动窗口，但是内核的发送/接受缓冲区是针对整个系统的，里面存放着整个系统的所有TCP连接的接收/发送的数据。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;nginx笔记&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>zabbix安装</title>
    <link href="https://zixujing.github.io/2019/01/30/linux/linux%E5%B7%A5%E5%85%B7/centos7+zabbix4.0source/"/>
    <id>https://zixujing.github.io/2019/01/30/linux/linux工具/centos7+zabbix4.0source/</id>
    <published>2019-01-29T17:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.379Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>zabbix源码方式安装<br><a id="more"></a></p></blockquote><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul><li><a href="https://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/4.0.3/zabbix-4.0.3.tar.gz/download" target="_blank" rel="noopener">下载zabbix源码</a></li><li><p>上传zabbix源码到目标机器后执行下面命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf zabbix-4.0.1.tar.gz</span><br><span class="line">[root@master ~]# groupadd zabbix</span><br><span class="line">[root@master ~]# useradd -g zabbix zabbix</span><br></pre></td></tr></table></figure></li><li><p>配置数据库【安装mysql数据库略】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql -uroot -p&lt;password&gt;</span><br><span class="line">MYSQL&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">MYSQL&gt; grant all privileges on zabbix.* to &apos;zabbix&apos;@&apos;localhost&apos; identified by &apos;zabbix&apos;;</span><br><span class="line">MYSQL&gt; quit;</span><br><span class="line">[root@master ~]# cd zabbix-4.0.1/database/mysql/</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; schema.sql</span><br><span class="line">[root@master mysql]# #stop here if you are creating database for Zabbix proxy</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; images.sql</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; data.sql</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装server"><a href="#安装server" class="headerlink" title="安装server"></a>安装server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ./configure --enable-server --enable-agent --with-mysql=/usr/local/mysql/bin/mysql_config --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2</span><br><span class="line">[root@master ~]# make install</span><br><span class="line">[root@master ~]# #启动服务：zabbix_server</span><br><span class="line">[root@master ~]# su - zabbix</span><br><span class="line">[zabbix@master ~]# zabbix_agentd</span><br></pre></td></tr></table></figure><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ul><li><p>configure: error: LIBXML2 library not found </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install libxml2-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Invalid Net-SNMP directory - unable to find net-snmp-config</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install net-snmp-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Unable to use libevent (libevent check failed)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install libevent-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Curl library not found </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install curl-devel</span><br></pre></td></tr></table></figure></li><li><p>zabbix_server: error while loading shared libraries: libmysqlclient.so.20:<br>cannot open shared object file: No such file or<br>directory<br>===========》</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ln -s /usr/local/mysql/lib/libmysqlclient.so.20 /usr/lib64/mysql/libmysqlclient.so.20</span><br><span class="line">[root@master ~]# ldconfig</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装配置web"><a href="#安装配置web" class="headerlink" title="安装配置web"></a>安装配置web</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install httpd</span><br><span class="line">[root@master ~]# mkdir /var/www/html/zabbix</span><br><span class="line">[root@master ~]# cd zabbix-4.0.1/frontends/php</span><br><span class="line">[root@master php]# cp -a . /var/www/html/zabbix</span><br><span class="line">[root@master php]# systemctl start httpd</span><br><span class="line">[root@master php]# systemctl enable httpd</span><br><span class="line">[root@master php]# yum install php php-mysql</span><br></pre></td></tr></table></figure><p>打开URL<a href="http://ip/zabbix/setup.php" target="_blank" rel="noopener">http://ip/zabbix/setup.php</a><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/82372470ffa120dd2b39885d612a8c0c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/ef64285fe2b51d57b48e84d2cfd5831f.png" alt=""><br>按照提示处理依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install php-ldap</span><br><span class="line">[root@master ~]# yum install php-gd</span><br><span class="line">[root@master ~]# yum install php-xmlreader</span><br><span class="line">[root@master ~]# yum install php-mbstring</span><br><span class="line">[root@master ~]# yum install php-bcmath</span><br><span class="line">#修改php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 32M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/266ddc2c9f4edfcfdc418868cb6f0c2e.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/eadf734873ebbb6ab31991418842d30a.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/588b045598dc5f4117b9e37ea0be5bc6.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/29e1fa333ef65708c055cfba81bdcf8c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/fe3f959eaed4507ab43f55b7f729a8f3.png" alt=""><br>cd /var/www/html/zabbix/conf<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/fe80eae3c35590b107a86a97a6e3f0b6.png" alt=""></p><h2 id="Zabbix-agent安装"><a href="#Zabbix-agent安装" class="headerlink" title="Zabbix-agent安装"></a>Zabbix-agent安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -xzvf zabbix-4.0.1.tar.gz</span><br><span class="line">[root@master zabbix-4.0.1]# cd zabbix-4.0.1/</span><br><span class="line">[root@master zabbix-4.0.1]# ./configure --enable-agent</span><br><span class="line">[root@master zabbix-4.0.1]# make install</span><br><span class="line">[root@master zabbix-4.0.1]# vi /usr/local/etc/zabbix_agentd.conf #配置</span><br><span class="line">[root@master zabbix-4.0.1]# groupadd zabbix</span><br><span class="line">[root@master zabbix-4.0.1]# useradd -g zabbix zabbix</span><br><span class="line">[root@master zabbix-4.0.1]# zabbix_agentd</span><br></pre></td></tr></table></figure><h2 id="选择中文语言"><a href="#选择中文语言" class="headerlink" title="选择中文语言"></a>选择中文语言</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/6d0cfe4bdaeba69974aa556bbb2d6ab5.png" alt=""></p><h2 id="Zabbix中文监控服务器图形图表显示乱码处理"><a href="#Zabbix中文监控服务器图形图表显示乱码处理" class="headerlink" title="Zabbix中文监控服务器图形图表显示乱码处理"></a>Zabbix中文监控服务器图形图表显示乱码处理</h2><p>复制下图中的字体到linux中的zabbix中<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/b228cea352906b5c030e113e8d39d20d.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/7be29779af4f6ce40bba758a1bcb083c.png" alt=""><br>并做如下修改<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/bb2180500d7b1001bcb81854b9f9ec6e.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;zabbix源码方式安装&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>ORACLE 数据生成器 Data Generator</title>
    <link href="https://zixujing.github.io/2019/01/29/db/oracle/ORACLE-%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E5%99%A8-Data-Generator/"/>
    <id>https://zixujing.github.io/2019/01/29/db/oracle/ORACLE-数据生成器-Data-Generator/</id>
    <published>2019-01-28T18:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.362Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ORACLE生成测试数据</p></blockquote><a id="more"></a><ul><li><p>在psql的工具菜单下找到数据生成器：Data Generator<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190129/1548743024766.png" alt=""></p></li><li><p>psql有一些帮助信息<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190129/1548743314201.png" alt=""></p></li><li><p>例子</p></li></ul><ol><li>SQL(sys_guid())：guid</li><li>List(1,2,3,4,5,6,7,8,9,10,11,12)：从list中随机选数据</li><li>SQL(sysdate-dbms_random.value(1,180))：半年内时间生成</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ORACLE生成测试数据&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>ogg 几个命令</title>
    <link href="https://zixujing.github.io/2019/01/26/ogg/ogg%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/"/>
    <id>https://zixujing.github.io/2019/01/26/ogg/ogg几个命令/</id>
    <published>2019-01-26T08:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.387Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ogg相关的几个命令<br><a id="more"></a></p></blockquote><h2 id="查询相关"><a href="#查询相关" class="headerlink" title="查询相关"></a>查询相关</h2><ol><li><p>info all</p><ul><li>作用：查看整体的运行情况</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 5&gt; info all</span><br><span class="line">Program     Status      Group       Lag at Chkpt  Time Since Chkpt</span><br><span class="line">MANAGER     RUNNING                                           </span><br><span class="line">EXTRACT     RUNNING     DMP2        842:45:01     00:00:09    </span><br><span class="line">EXTRACT     RUNNING     EXT1        841:19:24     00:00:04    </span><br><span class="line">EXTRACT     RUNNING     EXT2        529:12:40     00:00:00</span><br></pre></td></tr></table></figure></li></ul></li><li><p>view params process</p><ul><li>作用：查看进程的参数设置</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 6&gt; view params EXT1</span><br><span class="line">extract ext1</span><br><span class="line">userid ggate@gavinprod, password oracle</span><br><span class="line">rmthost odellprod.com, mgrport 7809</span><br><span class="line">rmttrail /opt/oracle/ggate/dirdat/lt</span><br><span class="line">ddl include mapped objname sender.*;</span><br><span class="line">table sender.*;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process</p><ul><li>作用：查看进程的信息性，包括进程的状态、Checkpoint信息、延时等</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 7&gt; info EXT1</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       529:05:45 (updated 00:00:02 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-06 04:27:03  Seqno 24, RBA 18464196</span><br><span class="line">                     SCN 0.1440415 (1440415)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process detail</p><ul><li>作用：查看更加详细的信息，包括所使用的trail文件、参数文件、报告文件、警告文件的位置</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 8&gt; info EXT1 detail</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       431:32:57 (updated 00:00:04 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-10 06:00:18  Seqno 31, RBA 40079092</span><br><span class="line">                     SCN 0.1553661 (1553661)</span><br><span class="line">  Target Extract Trails:</span><br><span class="line">  Remote Trail Name                                Seqno        RBA     Max MB</span><br><span class="line">  /opt/oracle/ggate/dirdat/lt                          1       1105        100</span><br><span class="line">  Extract Source                          Begin             End             </span><br><span class="line">  /opt/oracle/flash_recovery_area/GAVINPROD/archivelog/2015_01_10/o1_mf_1_31_bc2d3p27_.arc  2014-12-24 04:12  2015-01-10 06:00</span><br><span class="line">  /opt/oracle/oradata/gavinprod/redo01.log  2014-12-24 00:23  2014-12-24 04:12</span><br><span class="line">  Not Available                           * Initialized *   2014-12-24 00:23</span><br><span class="line">Current directory    /opt/oracle/ggate</span><br><span class="line">Report file          /opt/oracle/ggate/dirrpt/EXT1.rpt</span><br><span class="line">Parameter file       /opt/oracle/ggate/dirprm/ext1.prm</span><br><span class="line">Checkpoint file      /opt/oracle/ggate/dirchk/EXT1.cpe</span><br><span class="line">Process file         /opt/oracle/ggate/dirpcs/EXT1.pce</span><br><span class="line">Stdout file          /opt/oracle/ggate/dirout/EXT1.out</span><br><span class="line">Error log            /opt/oracle/ggate/ggserr.log</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process showch</p><ul><li>作用：查看详细的关于checkpoint的细心你想，用于查询GoldenGate进行处理过的事物记录<br>Extract进程的Recovery checkpoing，他标识源数据最早的未被处理事物，可以查到该事物的redo log位于哪个日志文件以及该日志文件的序列号，所有序列号比它大得日志文件都需保留</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 9&gt; info EXT1 showch</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       00:00:00 (updated 00:00:06 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-28 05:33:32  Seqno 42, RBA 2548736</span><br><span class="line">                     SCN 0.1750257 (1750257)</span><br><span class="line">Current Checkpoint Detail:</span><br><span class="line">Read Checkpoint #1</span><br><span class="line">  Oracle Redo Log</span><br><span class="line">  Startup Checkpoint (starting position in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 19</span><br><span class="line">    RBA: 37158416</span><br><span class="line">    Timestamp: 2014-12-24 04:12:21.000000</span><br><span class="line">    SCN: 0.1341390 (1341390)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo01.log</span><br><span class="line">  Recovery Checkpoint (position of oldest unprocessed transaction in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 42</span><br><span class="line">    RBA: 2504208</span><br><span class="line">    Timestamp: 2015-01-28 05:33:32.000000</span><br><span class="line">    SCN: 0.1750256 (1750256)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo03.log</span><br><span class="line">  Current Checkpoint (position of last record read in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 42</span><br><span class="line">    RBA: 2548736</span><br><span class="line">    Timestamp: 2015-01-28 05:33:32.000000</span><br><span class="line">    SCN: 0.1750257 (1750257)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo03.log</span><br><span class="line">Write Checkpoint #1</span><br><span class="line">  GGS Log Trail</span><br><span class="line">  Current Checkpoint (current write position):</span><br><span class="line">    Sequence #: 1</span><br><span class="line">    RBA: 1105</span><br><span class="line">    Timestamp: 2015-01-28 05:33:46.462178</span><br><span class="line">    Extract Trail: /opt/oracle/ggate/dirdat/lt</span><br><span class="line">CSN state information:</span><br><span class="line">  CRC: A4-7E-18-EE</span><br><span class="line">  Latest CSN: 1749736</span><br><span class="line">  Latest TXN: 7.29.894</span><br><span class="line">  Latest CSN of finished TXNs: 1749736</span><br><span class="line">  Completed TXNs: 7.29.894</span><br><span class="line">Header:</span><br><span class="line">  Version = 2</span><br><span class="line">  Record Source = A</span><br><span class="line">  Type = 10</span><br><span class="line">  # Input Checkpoints = 1</span><br><span class="line">  # Output Checkpoints = 1</span><br><span class="line">File Information:</span><br><span class="line">  Block Size = 2048</span><br><span class="line">  Max Blocks = 100</span><br><span class="line">  Record Length = 2048</span><br><span class="line">  Current Offset = 0</span><br><span class="line">Configuration:</span><br><span class="line">  Data Source = 3</span><br><span class="line">  Transaction Integrity = 1</span><br><span class="line">  Task Type = 0</span><br><span class="line">Status:</span><br><span class="line">  Start Time = 2015-01-28 05:31:39</span><br><span class="line">  Last Update Time = 2015-01-28 05:33:46</span><br><span class="line">  Stop Status = A</span><br><span class="line">  Last Result = 400</span><br></pre></td></tr></table></figure></li></ul></li><li><p>lag process</p><ul><li>作用：查看详细的延时信息</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 10&gt; lag EXT1</span><br><span class="line">Sending GETLAG request to EXTRACT EXT1 ...</span><br><span class="line">Last record lag: 23 seconds.</span><br><span class="line">At EOF, no more records to process.</span><br></pre></td></tr></table></figure></li></ul></li><li><p>stats</p><ul><li>作用：查看进程处理的记录数</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 13&gt; stats EXT1, total</span><br><span class="line">Sending STATS request to EXTRACT EXT1 ...</span><br><span class="line">Start of Statistics at 2015-01-28 05:37:59.</span><br><span class="line">DDL replication statistics (for all trails):</span><br><span class="line">*** Total statistics since extract started     ***</span><br><span class="line">        Operations                                      2899.00</span><br><span class="line">        Mapped operations                                  0.00</span><br><span class="line">        Unmapped operations                             2809.00</span><br><span class="line">        Other operations                                  90.00</span><br><span class="line">        Excluded operations                             2899.00</span><br><span class="line">Output to /opt/oracle/ggate/dirdat/lt:</span><br><span class="line">Extracting from GGATE.GGS_MARKER to GGATE.GGS_MARKER:</span><br><span class="line">*** Total statistics since 2015-01-28 05:31:45 ***</span><br><span class="line">        No database operations have been performed.</span><br><span class="line">End of Statistics.</span><br></pre></td></tr></table></figure></li></ul></li><li><p>view report process</p><ul><li>作用：查看对应的报告文件</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 11&gt; view report EXT1</span><br><span class="line">/***********************************************************************</span><br><span class="line">                 Oracle GoldenGate Capture for Oracle</span><br><span class="line">    Version 11.2.1.0.1 OGGCORE_11.2.1.0.1_PLATFORMS_120423.0230_FBO</span><br><span class="line">   Linux, x64, 64bit (optimized), Oracle 11g on Apr 23 2012 08:42:16</span><br><span class="line">Copyright (C) 1995, 2012, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">                    Starting at 2015-01-28 05:31:33</span><br><span class="line">/***********************************************************************</span><br><span class="line">Operating System Version:</span><br><span class="line">Linux</span><br><span class="line">Version #1 SMP Mon Nov 12 02:14:55 EST 2007, Release 2.6.18-53.el5</span><br><span class="line">Node: gavinprod.com</span><br><span class="line">Machine: x86_64</span><br><span class="line">                         soft limit   hard limit</span><br><span class="line">Address Space Size   :    unlimited    unlimited</span><br><span class="line">Heap Size            :    unlimited    unlimited</span><br><span class="line">File Size            :    unlimited    unlimited</span><br><span class="line">CPU Time             :    unlimited    unlimited</span><br><span class="line">Process id: 5097</span><br><span class="line">Description:</span><br><span class="line">/***********************************************************************</span><br><span class="line">**            Running with the following parameters                  **</span><br><span class="line">/***********************************************************************</span><br><span class="line">2015-01-28 05:31:33  INFO    OGG-03035  Operating system character set identified as UTF-8. Locale: en_US, LC_ALL:.</span><br><span class="line">extract ext1</span><br><span class="line">userid ggate@gavinprod, password ******</span><br><span class="line">2015-01-28 05:31:35  INFO    OGG-03500  WARNING: NLS_LANG environment variable does not match database character set, or not set.</span><br><span class="line">Using database character set value of AL32UTF8.</span><br><span class="line">rmthost odellprod.com, mgrport 7809</span><br><span class="line">rmttrail /opt/oracle/ggate/dirdat/lt</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>9 view ggsevt</p><ul><li>作用：查看日志</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 14&gt; view ggsevt</span><br><span class="line">2014-09-10 01:26:35  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): edit params mgr.</span><br><span class="line">2014-09-10 01:27:16  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): edit params mgr.</span><br><span class="line">2014-09-10 01:27:27  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): start manager.</span><br><span class="line">2014-09-10 01:27:28  INFO    OGG-00983  Oracle GoldenGate Manager for Oracle, mgr.prm:  Manager started (port 7809).</span><br><span class="line">2014-09-10 01:27:40  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): add extract ext1  tranlog, begin now.</span><br><span class="line">2014-09-10 01:29:24  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): add exttrail2014-09-10 02:24:03</span><br><span class="line">2014-09-10 02:24:03  INFO    OGG-00983  Oracle GoldenGate Manager for Oracle, mgr.prm:  Manager started (port 7809).</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): start EXT1.</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00963  Oracle GoldenGate Manager for Oracle, mgr.prm:  Command received from GGSCI on host gavinprod.com</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00975  Oracle GoldenGate Manager for Oracle, mgr.prm:  EXTRACT EXT1 starting.</span><br><span class="line">2014-09-10 02:24:08  INFO    OGG-00992  Oracle GoldenGate Capture for Oracle, ext1.prm:  EXTRACT EXT1 starting.</span><br><span class="line">2014-09-10 02:24:08  INFO    OGG-03035  Oracle GoldenGate Capture for Oracle, ext1.prm:  Operating system character set identified as UTF-8.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01635  Oracle GoldenGate Capture for Oracle, ext1.prm:  BOUNDED RECOVERY: reset to initial or altered checkpoint.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01815  Oracle GoldenGate Capture for Oracle, ext1.prm:  Virtual Memory Facilities for: BR</span><br><span class="line">    anon alloc: mmap(MAP_ANON)  anon free: munmap</span><br><span class="line">    file alloc: mmap(MAP_SHARED)  file free: munmap</span><br><span class="line">    target directories:</span><br><span class="line">    /opt/oracle/ggate/BR/EXT1.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01815  Oracle GoldenGate Capture for Oracle, ext1.prm:  Virtual Memory Facilities for: COM</span><br><span class="line">    anon alloc: mmap(MAP_ANON)  anon free: munmap</span><br><span class="line">    file alloc: mmap(MAP_SHARED)  file free: munmap</span><br><span class="line">    target directories:</span><br><span class="line">    /opt/oracle/ggate/dirtmp.</span><br><span class="line">2014-09-10 02:24:20  WARNING OGG-01423  Oracle GoldenGate Capture for Oracle, ext1.prm:  No valid default archive log destination directory found</span><br></pre></td></tr></table></figure></li></ul><h2 id="extract相关"><a href="#extract相关" class="headerlink" title="extract相关"></a>extract相关</h2><ol><li><p>修改rba,checkpoint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter EXT_ALO,extseqno 17,extrba 9194144,thread 1</span><br><span class="line">alter EXT_ALO,extseqno 10,extrba 5740032,thread 2</span><br></pre></td></tr></table></figure></li><li><p>修改recovery checkpoint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter EXT_ALO,ioextseqno 17,ioextrba 9193488,thread 1</span><br><span class="line">alter  EXT_ALO,ioextseqno 10,ioextrba 5739536,thread 2</span><br></pre></td></tr></table></figure></li><li><p>info extract cust_ext, detail</p><blockquote><p>抽取进程的详细信息</p></blockquote></li></ol><ol start="4"><li>info extract ext*, showch  <blockquote><p>抽取进程的检查点信息,注意checkpoint和recovery checkpoint</p></blockquote></li></ol><ol start="5"><li><p>INFO TRANDATA user_name.table_names</p><blockquote><p>表的补充日志</p></blockquote></li><li><p>常用添加extract命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; add extract ext1, tranlog, begin now</span><br><span class="line">ggsci&gt; add extract ext1, tranlog, begin now, threads 4</span><br><span class="line">ggsci&gt; add extract ext1, tranlog, begin now, passive</span><br><span class="line">ggsci&gt; add extract ext1, extseqno 111, begin now</span><br><span class="line">ggsci&gt; add extract ext1, extrba 567890, begin 2012-02-02 12:00:00</span><br><span class="line">ggsci&gt; add extract ext1, sourceistable</span><br><span class="line">ggsci&gt; add extract ext1, exttrailsource /oracle/gg11/dirdat/hr   --data pump</span><br><span class="line">ggsci&gt; add extract ext1, vam                        -- VAM - Vendor Access Module</span><br><span class="line">ggsci&gt; add extract ext1, vamtrailsource /ogg/dirdat/vt</span><br><span class="line">ggsci&gt; add extract ext1, rmthost host123, mgrport 7810, rmtname fin</span><br></pre></td></tr></table></figure></li><li><p>status</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; STATUS MANAGER    -- To determine whether or not the Manager process is running</span><br><span class="line">ggsci&gt; STATUS EXTRACT group_name [, TASKS | ALLPROCESSES]   -- To determine whether or not Extract is running</span><br><span class="line">ggsci&gt; status extract extr_hr</span><br><span class="line">ggsci&gt; status extract ext*, tasks</span><br><span class="line">ggsci&gt; status extract *ext*, allprocesses</span><br><span class="line">ggsci&gt; STATUS REPLICAT group_name [, TASKS | ALLPROCESSES]  -- To determine whether or not Replicat is running</span><br><span class="line">ggsci&gt; status replicat emp_rep</span><br><span class="line">ggsci&gt; status replicat cust_rep, allprocesses</span><br><span class="line">ggsci&gt; STATUS ER group_wildcard_specification   -- To check the status of multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; status er *EX*</span><br><span class="line">Reading Program Database management system Vacuum Pump The Word Find email address free</span><br><span class="line">ggsci&gt; STATS EXTRACT group_name [, statistic] [, TABLE table] [, TOTALSONLY table_specification] [, REPORTFETCH | NOREPORTFETCH] [, REPORTRATE HR|MIN|SEC] [, ... ]  -- To display statistics for one or more Extract group</span><br><span class="line">ggsci&gt; stats ext_hr</span><br><span class="line">ggsci&gt; stats extract ext</span><br><span class="line">ggsci&gt; stats extract ext2 reportrate sec</span><br><span class="line">ggsci&gt; stats extract fin, total, daily</span><br><span class="line">ggsci&gt; stats extract fin, total, hourly, table acct, reportrate min, reset, reportfetch</span><br></pre></td></tr></table></figure></li><li><p>send</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; SEND MANAGER [CHILDSTATUS [DEBUG]] [GETPORTINFO [DETAIL]] [GETPURGEOLDEXTRACTS]   -- To retrieve the status of the active Manager process or to retrieve dynamic port information as configured in the Manager parameter file</span><br><span class="line">ggsci&gt; send manager childstatus</span><br><span class="line">ggsci&gt; send manager childstatus debug</span><br><span class="line">ggsci&gt; send manager getportinfo</span><br><span class="line">ggsci&gt; send manager getportinfo detail</span><br><span class="line">ggsci&gt; send manager getpurgeoldextracts</span><br><span class="line">ggsci&gt; SEND EXTRACT group_name,</span><br><span class="line">&#123; CACHEMGR &#123;CACHESTATS | CACHEQUEUES | CACHEPOOL&#125; | FORCESTOP | FORCETRANS id [THREAD n] [FORCE] | GETLAG | GETTCPSTATS | LOGEND | REPORT | ROLLOVER | SHOWTRANS [id] [THREAD n] [COUNT n] [DURATION duration_unit] [TABULAR] [FILE file_name [DETAIL]] | SKIPTRANS id [THREAD n] [FORCE] | STATUS | STOP | TLTRACE &#123;DEBUG | OFF | level&#125; [SIZELIMIT size] [DDLINCLUDE | DDL[ONLY]] [FILE] file_name | TRACE[2] &#123;tracefile | OFF&#125; | TRACEINIT | TRANLOGOPTIONS &#123;PURGEORPHANEDTRANSACTIONS | NOPURGEORPHANEDTRANSACTIONS&#125; | TRANLOGOPTIONS TRANSCLEANUPFREQUENCY minutes | VAMMESSAGE &quot;Teradata_command&quot; | VAMMESSAGE &#123;ARSTATS | INCLUDELIST [filter] | EXCLUDELIST [filter]&#125; | VAMMESSAGE OPENTRANS</span><br><span class="line">&#125;     -- To communicate with a running Extract process</span><br><span class="line">Teradata_command = &#123;&quot;control:terminate&quot; | &quot;control:suspend&quot; | &quot;control:resume&quot; | &quot;control:copy database.table&quot;</span><br><span class="line">ggsci&gt; send extract exthr status</span><br><span class="line">ggsci&gt; send extract extr, getlag</span><br><span class="line">ggsci&gt; send extract group_name tltrace file file_name ddlinclude</span><br><span class="line">ggsci&gt; send extract fin, rollover</span><br><span class="line">ggsci&gt; send extract fin  stop</span><br><span class="line">ggsci&gt; send extract fin, vammessage control:suspend</span><br><span class="line">ggsci&gt; send extract fin, tranlogoptions transcleanupfrequency 15</span><br><span class="line">ggsci&gt; send extract fin, showtrans count 10</span><br><span class="line">ggsci&gt; send extract fin, skiptrans 5.17.27634 thread 2</span><br></pre></td></tr></table></figure></li><li><p>alter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ALTER EXTRACT group_name [, ADD_EXTRACT_attribute] [, THREAD number] [, ETROLLOVER]  -- To change the attributes of an Extract group, To increment a trail to the next file in the sequence</span><br><span class="line">ggsci&gt; alter extract fin, begin 2012-02-16</span><br><span class="line">ggsci&gt; alter extract fin, etrollover</span><br><span class="line">ggsci&gt; alter extract fin, extseqno 26, extrba 338</span><br><span class="line">ggsci&gt; alter extract accounts, thread 4, begin 2012-03-09</span><br><span class="line">ggsci&gt; alter extract sales, lsn 1234:123:1</span><br></pre></td></tr></table></figure></li><li><p>lag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; LAG EXTRACT group_name    -- To determine a true lag time between Extract and the datasource</span><br><span class="line">ggsci&gt; lag extract ext*</span><br><span class="line">ggsci&gt; lag extract *</span><br></pre></td></tr></table></figure></li></ol><h2 id="replicat相关"><a href="#replicat相关" class="headerlink" title="replicat相关"></a>replicat相关</h2><ol><li>send rep2, NOHANDLECOLLISIONS<blockquote><p>send 命令动态取消HANDLECOLLISIONS</p></blockquote></li></ol><ol start="2"><li><p>info replicat fin, showch</p><blockquote><p>复制进程的检查点信息</p></blockquote></li><li><p>info replicat emp_rep, detail</p><blockquote><p>复制进程的相应信息</p></blockquote></li><li><p>info checkpointtable gg_owner.chkpt_table</p><blockquote><p>检查点表信息</p></blockquote></li><li><p>常用添加replicat进程命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; add replicat repl, exttrail C:\OGG10G\dirdat\lt</span><br><span class="line">ggsci&gt; add replicat repl, exttrail /oracle/gg11/dirdat/lt, checkpointtable gg_owner.checkpoint</span><br><span class="line">ggsci&gt; add replicat initload, specialrun</span><br><span class="line">ggsci&gt; add replicat repl, exttrail /oracle/gg11/dirdat/lt, nodbcheckpoint</span><br></pre></td></tr></table></figure></li><li><p>stats</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; STATS REPLICAT group_name [, statistic] [, TABLE table] [, TOTALSONLY table_specification] [, REPORTDETAIL | NOREPORTDETAIL] [, REPORTRATE HR|MIN|SEC] [, ... ]   -- To display statistics for one or more Replicat groups</span><br><span class="line">ggsci&gt; stats rep_hr</span><br><span class="line">ggsci&gt; stats replicat fin, total, table acct, reportrate hr, reset, noreportdetail</span><br><span class="line">ggsci&gt; STATS ER group_wildcard_specification   -- To get statistics on multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; stats er ext*</span><br></pre></td></tr></table></figure></li><li><p>send</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; SEND REPLICAT group_name,</span><br><span class="line">&#123; FORCESTOP | GETLAG | HANDLECOLLISIONS [table_specification] | NOHANDLECOLLISIONS [table_specification] | REPORT [HANDLECOLLISIONS [table_specification]] | STATUS | STOP | TRACE[2] [DDLINCLUDE | DDL[ONLY]] [FILE] file_name | TRACE[2] OFF | TRACEINIT</span><br><span class="line">&#125;    -- To communicate with a starting or running Replicat process</span><br><span class="line">ggsci&gt; send replicat fin, handlecollisions</span><br><span class="line">ggsci&gt; send replicat fin, report handlecollisions fin_*</span><br><span class="line">ggsci&gt; send replicat fin, getlag</span><br><span class="line">ggsci&gt; SEND ER group_wildcard_specification   -- To send instructions to multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; send er *ext</span><br></pre></td></tr></table></figure></li><li><p>lag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; LAG REPLICAT group_name   -- To determine a true lag time between Replicat and the trail</span><br><span class="line">ggsci&gt; lag replicat myrepl</span><br><span class="line">ggsci&gt; lag replicat *</span><br></pre></td></tr></table></figure></li></ol><h2 id="trail相关"><a href="#trail相关" class="headerlink" title="trail相关"></a>trail相关</h2><ol><li><p>INFO EXTTRAIL trail_name</p></li><li><p>info exttrail e:\ogg\dirdat\ex</p><blockquote><p>本地trail文件信息</p></blockquote></li><li><p>INFO RMTTRAIL trail_name</p></li><li><p>info rmttrail d:\ogg\dirdat\ex</p><blockquote><p>远程trail文件信息</p></blockquote></li><li><p>常用添加trail 命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ADD EXTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n] [, SEQNO n]   -- To create a trail for online processing on local system</span><br><span class="line">ggsci&gt; add exttrail /oracle/gg11/dirdat/lt, extract s_extr</span><br><span class="line">ggsci&gt; add exttrail C:\OGG10G\dirdat\et, extract emp_ext</span><br><span class="line">ggsci&gt; add exttrail c:\ogg\dirdat\fi, extract fin, megabytes 30</span><br><span class="line">ggsci&gt; ADD RMTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n] [, SEQNO n]   -- To create a trail for online processing on remote system</span><br><span class="line">ggsci&gt; add rmttrail C:\OGG10G\dirdat\hr, extract extr</span><br><span class="line">ggsci&gt; add rmttrail /u01/app/oracle/ogg/dirdat/ms, extract msextr</span><br><span class="line">ggsci&gt; add rmttrail /u01/app/oracle/ogg/dirdat/my, extract mysql, megabytes 50</span><br></pre></td></tr></table></figure></li><li><p>alter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ALTER EXTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n]   -- To change the attributes of a trail (on the local system)</span><br><span class="line">ggsci&gt; alter exttrail c:\ogg\dirdat\aa, extract fin, megabytes 30</span><br><span class="line">ggsci&gt; ALTER RMTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n]   -- To change the attributes of a trail (on a remote system)</span><br><span class="line">ggsci&gt; alter rmttrail c:\ogg\dirdat\et, extract fin, megabytes 25</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ogg相关的几个命令&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>ogg安装和搭建文档</title>
    <link href="https://zixujing.github.io/2019/01/26/ogg/ogg%E5%AE%89%E8%A3%85%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/01/26/ogg/ogg安装搭建文档/</id>
    <published>2019-01-26T07:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.410Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ogg的安装和搭建内容<br><a id="more"></a></p></blockquote><h2 id="安装ogg软件"><a href="#安装ogg软件" class="headerlink" title="安装ogg软件"></a>安装ogg软件</h2><h3 id="建立ogg软件目录"><a href="#建立ogg软件目录" class="headerlink" title="建立ogg软件目录"></a>建立ogg软件目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# su - oracle</span><br><span class="line">[oracle@localhost ~]$ cd /home/oracle/app/oracle</span><br><span class="line">[oracle@localhost oracle]$ mkdir ogg</span><br></pre></td></tr></table></figure><h3 id="复制ogg软件到目标机器"><a href="#复制ogg软件到目标机器" class="headerlink" title="复制ogg软件到目标机器"></a>复制ogg软件到目标机器</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/0ca089f3b044e3c8ebb70034da8241ae.png" alt=""></p><h3 id="解压软件"><a href="#解压软件" class="headerlink" title="解压软件"></a>解压软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[oracle@localhost ogg]$ pwd</span><br><span class="line">/home/oracle/app/oracle/ogg</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip</span><br><span class="line">[oracle@localhost ogg]$ unzip 122022_fbo_ggs_Linux_x64_shiphome.zip</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip fbo_ggs_Linux_x64_shiphome</span><br><span class="line">OGG-12.2.0.2-README.txt OGGCORE_12.2.0.2.2.pdf</span><br><span class="line">[oracle@localhost ogg]$ rm OGG-12.2.0.2-README.txt OGGCORE_12.2.0.2.2.pdf</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip fbo_ggs_Linux_x64_shiphome</span><br></pre></td></tr></table></figure><h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><p>打开xmanager进入目标机器，进入目录/home/oracle/app/oracle/ogg/fbo_ggs_Linux_x64_shiphome/Disk1，运行runInstaller安装。</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/ea6f4191a1a752f66325ef8c42d9234f.png" alt=""></p><p>选择oracle11g点击下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/86a029775b233dbe7736680f356b2b26.png" alt=""></p><p>配置后点击下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/4cbb6ad0cc6267e4e094f2ffbed24fdf.png" alt=""></p><p>点击安装</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/f8f50b7ce0b573926a6daf82dce0d169.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/d4c1a6fbbcab268440c924304cf36667.png" alt=""></p><h2 id="主从库初始化设置"><a href="#主从库初始化设置" class="headerlink" title="主从库初始化设置"></a>主从库初始化设置</h2><blockquote><p>如果从库不做其他数据库的主库，那么supplemental log只需要在主库添加即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[oracle@localhost ~]$ sqlplus / as sysdba</span><br><span class="line">SQL*Plus: Release 11.2.0.1.0 Production on Thu Jul 5 12:40:45 2018</span><br><span class="line">Copyright (c) 1982, 2009, Oracle. All rights reserved.</span><br><span class="line">Connected to:</span><br><span class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</span><br><span class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area 784998400 bytes</span><br><span class="line">Fixed Size 2217464 bytes</span><br><span class="line">Variable Size 486541832 bytes</span><br><span class="line">Database Buffers 293601280 bytes</span><br><span class="line">Redo Buffers 2637824 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; alter database add supplemental log data;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; create user ogg identified by ogg;</span><br><span class="line">User created.</span><br><span class="line">SQL&gt; grant connect,resource to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant execute on utl_file to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant select any dictionary,select any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant alter any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant flashback any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant execute on DBMS_FLASHBACK to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant dba to ogg;</span><br><span class="line">Grant succeeded.</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>注意：如果想简单的设置ogg的权限，那么ogg用户只赋dba权限既可。</p></blockquote><h3 id="数据源（主库）设置"><a href="#数据源（主库）设置" class="headerlink" title="数据源（主库）设置"></a>数据源（主库）设置</h3><blockquote><p>进入ogg即运行ggsci命令执行（执行./ggsci）：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&gt; dblogin userid ogg password ogg</span><br><span class="line">&gt; add trandata smartecap_numone.tb*</span><br><span class="line">&gt; create subdirs</span><br><span class="line">&gt; edit params ./GLOBALS</span><br><span class="line">_DISABLEFIX21427144 --远程访问</span><br><span class="line">&gt; edit params mgr</span><br><span class="line">PORT 7809</span><br><span class="line">DYNAMICPORTLIST 7810-7818,7820-7830 --远程访问端口</span><br><span class="line">ACCESSRULE,PROG *,IPADDR *,ALLOW --远程访问</span><br><span class="line">PURGEOLDEXTRACTS ./dirdat/st, USECHECKPOINTS, MINKEEPDAYS 7</span><br><span class="line">&gt;add trandata smartecap_numone.tb*</span><br><span class="line">&gt;info trandata smartecap_numone.tb* #查看是否设置传输数据成功</span><br><span class="line">&gt;add extract exts,tranlog ,begin now</span><br><span class="line">&gt;info all #查看所有进程</span><br><span class="line">&gt;add exttrail ./dirdat/st,extract exts,megabytes 1024</span><br><span class="line">&gt; edit params exts</span><br><span class="line">EXTRACT exts</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">DISCARDFILE ./dirrpt/exts.dsc,APPEND,MEGABYTES 1024</span><br><span class="line">DBOPTIONS ALLOWUNUSEDCOLUMN</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 350s</span><br><span class="line">EXTTRAIL ./dirdat/st</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">TRANLOGOPTIONS CONVERTUCS2CLOBS</span><br><span class="line">IGNOREDELETES</span><br><span class="line">TABLE smartecap_numone.tb*;</span><br><span class="line">&gt; add extract dpend,exttrailsource ./dirdat/st</span><br><span class="line">&gt; add rmttrail /home/oracle/app/ogg/dirdat/st ,extract dpend</span><br><span class="line">&gt; edit params dpend</span><br><span class="line">EXTRACT dpend</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">PASSTHRU</span><br><span class="line">RMTHOST 176.100.13.245, MGRPORT 7809, compress</span><br><span class="line">RMTTRAIL /home/oracle/app/ogg/dirdat/st</span><br><span class="line">TABLE smartecap_numone.tb*;</span><br></pre></td></tr></table></figure><h3 id="目标端（从库）设置"><a href="#目标端（从库）设置" class="headerlink" title="目标端（从库）设置"></a>目标端（从库）设置</h3><blockquote><p>进入ogg即运行ggsci命令执行（执行./ggsci）：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;create subdirs</span><br><span class="line">&gt;dblogin userid ogg,password ogg</span><br><span class="line">&gt;add checkpointtable ogg.checkpoint</span><br><span class="line">&gt;add replicat repnd,exttrail ./dirdat/st,checkpointtable ogg.checkpoint</span><br><span class="line">&gt;edit param repnd</span><br><span class="line">REPLICAT repnd</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">--HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ddloptions report</span><br><span class="line">MAP smartecap_numone.*, TARGET smartecap_numone.*;</span><br></pre></td></tr></table></figure><h2 id="备份主库的ddl语句并还原到从库"><a href="#备份主库的ddl语句并还原到从库" class="headerlink" title="备份主库的ddl语句并还原到从库"></a>备份主库的ddl语句并还原到从库</h2><h3 id="ddl导出"><a href="#ddl导出" class="headerlink" title="ddl导出"></a>ddl导出</h3><p>可以使用工具导出ddl语句，这里使用toad，步骤如下：</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/6e777cb404cf6fa7e640f554689d89f7.png" alt=""></p><p>选择add并点击load rows</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/01fafae08aefbb91886abe825a6927a9.png" alt=""></p><p>选择需要导出的表</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/40a3af35b6908b0fac6ff857573bc523.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/611d6128ae38b1c8dec4a8cf8e4ebcd3.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/4d4972afeb3828141c27690e2d0c8a39.png" alt=""></p><p>选择存储文件并点击导出</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/2f71c61b36f0f3454ae859f7107bc21e.png" alt=""></p><h3 id="在从库创建用户并恢复主库的ddl"><a href="#在从库创建用户并恢复主库的ddl" class="headerlink" title="在从库创建用户并恢复主库的ddl"></a>在从库创建用户并恢复主库的ddl</h3><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;CREATE USER SMARTECAP_NUMONE_XJ IDENTIFIED BY &lt;password&gt; ACCOUNT UNLOCK;</span><br><span class="line">&gt;GRANT CONNECT TO SMARTECAP_NUMONE_XJ;</span><br><span class="line">&gt;GRANT DBA TO SMARTECAP_NUMONE_XJ;</span><br><span class="line">&gt;GRANT RESOURCE TO SMARTECAP_NUMONE_XJ;</span><br></pre></td></tr></table></figure><h4 id="恢复ddl语句"><a href="#恢复ddl语句" class="headerlink" title="恢复ddl语句"></a>恢复ddl语句</h4><blockquote><p>使用toad登录从库的用户SMARTECAP_NUMONE_XJ，执行主库导出的ddl文件。</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/befe2282482863424bc057d4237441a0.png" alt=""></p><h2 id="通过toad工具使主从数据同步，并同步"><a href="#通过toad工具使主从数据同步，并同步" class="headerlink" title="通过toad工具使主从数据同步，并同步"></a>通过toad工具使主从数据同步，并同步</h2><blockquote><p>在从库创建主库的dblink</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database link &quot;source&quot;</span><br><span class="line">connect to SMARTECAP_NUMONE_XJ</span><br><span class="line">identified by &quot;123456&quot;</span><br><span class="line">using &apos;192.168.106.174:1521/orcl&apos;;</span><br></pre></td></tr></table></figure><blockquote><p>然后每张表都依次执行如下sql语句。为保证数据的一致性在导数过程中（ogg未同步前停止所有主库的应用）</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/7162ca279063e1ed5b5c623ab7cca4c6.png" alt=""></p><h2 id="ogg启动"><a href="#ogg启动" class="headerlink" title="ogg启动"></a>ogg启动</h2><h3 id="首先在从库ggsci中执行"><a href="#首先在从库ggsci中执行" class="headerlink" title="首先在从库ggsci中执行"></a>首先在从库ggsci中执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (localhost.localdomain) 1&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT STOPPED REPND 00:00:00 01:25:26</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 2&gt; start repnd</span><br><span class="line"></span><br><span class="line">Sending START request to MANAGER ...</span><br><span class="line">REPLICAT REPND starting</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 3&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT STARTING REPND 00:00:00 01:25:32</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 6&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT RUNNING REPND 00:00:00 00:00:05</span><br></pre></td></tr></table></figure><h3 id="然后在主库ggsci中执行"><a href="#然后在主库ggsci中执行" class="headerlink" title="然后在主库ggsci中执行"></a>然后在主库ggsci中执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (oracle.domain) 23&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">EXTRACT RUNNING DPEND 00:00:00 00:00:06</span><br><span class="line">EXTRACT ABENDED DPENDD 00:00:00 01:25:16</span><br><span class="line">EXTRACT RUNNING EXTS 00:00:00 00:00:00</span><br><span class="line"></span><br><span class="line">GGSCI (oracle.domain) 24&gt; start dpendd</span><br><span class="line"></span><br><span class="line">Sending START request to MANAGER ...</span><br><span class="line">EXTRACT DPENDD starting</span><br><span class="line"></span><br><span class="line">GGSCI (oracle.domain) 25&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">EXTRACT RUNNING DPEND 00:00:00 00:00:02</span><br><span class="line">EXTRACT RUNNING DPENDD 00:00:00 01:25:22</span><br><span class="line">EXTRACT RUNNING EXTS 00:00:00 00:00:06</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ogg的安装和搭建内容&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>Mysql安装手册</title>
    <link href="https://zixujing.github.io/2019/01/26/db/mysql/mysql%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/"/>
    <id>https://zixujing.github.io/2019/01/26/db/mysql/mysql安装相关内容/</id>
    <published>2019-01-25T18:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.358Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql 安装相关的内容</p></blockquote><a id="more"></a><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><p>选择绿色安装。数据库版本是5.7.22。</p><h2 id="主机系统环境"><a href="#主机系统环境" class="headerlink" title="主机系统环境"></a>主机系统环境</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/91fdb214232ced7ed657aa473462337c.png" alt=""></p><h2 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt; groupadd mysql</span><br><span class="line">$&gt; useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure><h2 id="数据库软件准备"><a href="#数据库软件准备" class="headerlink" title="数据库软件准备"></a>数据库软件准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&gt; tar -xzvf mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">$&gt; mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql</span><br><span class="line">$&gt; chown mysql:mysql -R /usr/local/mysql</span><br><span class="line">#数据目录创建，建议新挂一个磁盘到/opt下，然后在opt下创建data目录专门存储mysql数据</span><br><span class="line">$&gt;mkdir /opt/data</span><br><span class="line">$&gt;chown -R mysql:mysql /opt/data</span><br></pre></td></tr></table></figure><h2 id="设置PATH路径"><a href="#设置PATH路径" class="headerlink" title="设置PATH路径"></a>设置PATH路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt;vi ~/.bash_profile</span><br></pre></td></tr></table></figure><p>设置如下图：</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/2bb12b141f9ac28ff39b1248f537e1ff.png" alt=""></p><p>保存后source生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; source ~/.bash_profile</span><br></pre></td></tr></table></figure></p><h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt; cd /usr/local/mysql/bin</span><br><span class="line">$&gt; ./mysqld --initialize --user=mysql --basedir=/usr/local/mysql/ --datadir=/opt/data/</span><br></pre></td></tr></table></figure><blockquote><p>记住初始密码（ZBy%#Uh45%gj），如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/10648641329e44faf01eb00e182c6646.png" alt=""></p></blockquote><h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&gt;vi /etc/my.cnf</span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置如下</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql/</span><br><span class="line">datadir = /opt/data/</span><br><span class="line">character-set-server = utf8</span><br><span class="line">pid-file=/opt/data/mysqld.pid</span><br><span class="line">back_log=1024</span><br><span class="line">wait_timeout=1800</span><br><span class="line">max_connections=3200</span><br><span class="line">max_user_connections=800</span><br><span class="line">innodb_thread_concurrency=4</span><br><span class="line">skip-name-resolve #在5.7.18安装是使用此参数会有问题，不能</span><br><span class="line">innodb_buffer_pool_size=100M</span><br><span class="line">innodb_log_buffer_size=20M</span><br><span class="line">read_buffer_size=10M</span><br><span class="line">sort_buffer_size=10M</span><br><span class="line">read_rnd_buffer_size=10M</span><br><span class="line">server-id=100</span><br><span class="line">log-bin = master</span><br><span class="line">max_allowed_packet=20M </span><br><span class="line">lower_case_table_names=1</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure><h2 id="配置解释"><a href="#配置解释" class="headerlink" title="配置解释"></a>配置解释</h2><ol><li><p>back_log=1024</p><blockquote><p>back_log的值指出在mysql暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。也就是说，如果mysql的连接数据达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。</p></blockquote></li><li><p>wait_timeout=1800</p><blockquote><p>mysql连接闲置超过此设定值的时间后将会被强行关闭，单位是秒。</p></blockquote></li><li><p>max_connections=3200</p><blockquote><p>指mysql的最大连接数，如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量，当然这是建立在机器能支撑的情况下，因为如果连接数越多，介于mysql会为每个连接提供连接缓冲区，就会开销越多的内存，所以要适当调整该值，不能盲目提高设值。</p></blockquote></li><li><p>max_user_connections=800</p><blockquote><p>指每个数据库用户的最大连接。针对某一个账号的所有客户端并行连接到mysql服务的最大并行连接数。简单说是指同一个账号能够同时连接到mysql服务的最大连接数。设置为0表示不限制。</p></blockquote></li><li><p>innodb_thread_concurrency=CPU核数*2</p><blockquote><p>此值应设为CPU核数的2倍。</p></blockquote></li><li><p>skip-name-resolve</p><blockquote><p>禁止mysql对外部连接进行DNS解析，使用这一选项可以消除mysql进行DNS解析的时间。</p></blockquote></li><li><p>innodb_buffer_pool_size&lt;=服务器内存*0.7</p><blockquote><p>用于缓存索引和数据的内存大小。</p></blockquote></li><li><p>innodb_log_buffer_size=20M</p><blockquote><p>InnoDB存储引擎的事务日志所使用的缓冲区。</p></blockquote></li><li><p>read_buffer_size=10M</p><blockquote><p>  这个值代表读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区。</p></blockquote></li><li><p>sort_buffer_size=10M</p><blockquote><p>执行排序使用的缓冲大小。</p></blockquote></li><li><p>read_rnd_buffer_size=10M</p><blockquote><p>随机读缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，mysql会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。</p></blockquote></li><li><p>binlog=日志名字</p><blockquote><p>mysql的二进制日志是mysql最重要的日志，它记录了所有的DDL和DML语句，以事件形式记录，还包含语句所执行的消耗的时间，mysql的二进制日志是事务安全型的。</p></blockquote></li></ol><h2 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">$&gt;service mysqld start</span><br></pre></td></tr></table></figure><h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt;mysql_secure_installation</span><br></pre></td></tr></table></figure><blockquote><p>图中划红线的是修改密码部分，旧密码是初始化数据库时生成的随机密码。</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c35978840d79c90476c7e0fbaafb3170.png" alt=""></p><h2 id="centos7配置开机启动"><a href="#centos7配置开机启动" class="headerlink" title="centos7配置开机启动"></a>centos7配置开机启动</h2><h2 id="配置文件创建"><a href="#配置文件创建" class="headerlink" title="配置文件创建"></a>配置文件创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# touch /usr/lib/systemd/system/mysqld.service</span><br><span class="line">[root@localhost ~]# cd /usr/lib/systemd/system</span><br><span class="line">#编辑上一步创建的mysqld.service文件，加入如下内容:</span><br><span class="line">[root@localhost system]# vi mysqld.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line">ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf</span><br><span class="line">LimitNOFILE = 5000</span><br></pre></td></tr></table></figure><blockquote><p>备注:ExecStart=/usr/local/mysql/bin/mysqld(此处请对应修改为mysql程序所在的路径)</p></blockquote><h2 id="启动mysql-1"><a href="#启动mysql-1" class="headerlink" title="启动mysql"></a>启动mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost system]# systemctl enable mysqld</span><br><span class="line">[root@localhost system]# systemctl start mysqld</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql 安装相关的内容&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Oracle安装文档</title>
    <link href="https://zixujing.github.io/2019/01/26/db/oracle/oracle%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3_centos7.5_11.2.0.4/"/>
    <id>https://zixujing.github.io/2019/01/26/db/oracle/oracle安装文档_centos7.5_11.2.0.4/</id>
    <published>2019-01-25T17:00:00.000Z</published>
    <updated>2019-01-31T03:05:58.765Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>oracle11.2.0.4 + centos 7.5安装文档</p></blockquote><a id="more"></a><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><p>Oracle版本是11.2.0.4</p><h2 id="主机系统环境"><a href="#主机系统环境" class="headerlink" title="主机系统环境"></a>主机系统环境</h2><h3 id="示例环境"><a href="#示例环境" class="headerlink" title="示例环境"></a>示例环境</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/38af0a72d5fb814cd7c8715c819ed9cf.png" alt=""></p><h3 id="修改系统标识"><a href="#修改系统标识" class="headerlink" title="修改系统标识"></a>修改系统标识</h3><p><code>$&gt; echo &quot;Red Hat Enterprise Linux Server release 7.0 (Maipo)&quot; &gt;/etc/redhat-release</code></p><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><p><code>$&gt; hostnamectl set-hostname oracle-server</code></p><h3 id="修改系统内核参数"><a href="#修改系统内核参数" class="headerlink" title="修改系统内核参数"></a>修改系统内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$&gt; echo &quot;</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">#单位是页</span><br><span class="line">kernel.shmall = 7864320</span><br><span class="line">kernel.shmmax = 132212254720</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">#semaphores: semmsl, semmns, semopm, semmni</span><br><span class="line">#SEMMSL==&gt;processes+10 SEMMNS===&gt;SEMMNI*SEMMSL SEMOPM====&gt;系统调用允许的信号量最大个数至少100</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.core.rmem_default=262144</span><br><span class="line">net.core.rmem_max=16777216</span><br><span class="line">net.core.wmem_default=262144</span><br><span class="line">net.core.wmem_max=16777216</span><br><span class="line">net.core.somaxconn=4096</span><br><span class="line">net.core.netdev_max_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_syn_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_tw_buckets=10000</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 3600</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">vm.swappiness = 0</span><br><span class="line">vm.panic_on_oom = 1</span><br><span class="line">kernel.randomize_va_space=0&quot; &gt;&gt;/etc/sysctl.conf</span><br><span class="line">$&gt; sysctl –p</span><br></pre></td></tr></table></figure><h3 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt;echo &quot;# Oracle-Server</span><br><span class="line">192.168.106.111 oracle-server</span><br><span class="line">&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="修改操作系统资源限制"><a href="#修改操作系统资源限制" class="headerlink" title="修改操作系统资源限制"></a>修改操作系统资源限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$&gt;echo &quot;#ORACLE</span><br><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 4096</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">$&gt;echo &quot;session required pam_limits.so&quot; &gt;&gt; /etc/pam.d/login</span><br><span class="line">$&gt;#如果存在文件/etc/security/limits.d/20-nproc.conf那么做如下修改</span><br><span class="line">$&gt;vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line">#把下面这句</span><br><span class="line">* soft nproc 1024</span><br><span class="line">#修改为</span><br><span class="line">* - nproc 16384</span><br></pre></td></tr></table></figure><h3 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&gt;groupadd -g 54321 oinstall</span><br><span class="line">$&gt;groupadd -g 54322 dba</span><br><span class="line">$&gt;groupadd -g 54323 oper</span><br><span class="line">$&gt;useradd -u 54322 -g oinstall -G dba,oper oracle</span><br><span class="line">$&gt;passwd oracle</span><br></pre></td></tr></table></figure><h3 id="修改oracle用户环境变量"><a href="#修改oracle用户环境变量" class="headerlink" title="修改oracle用户环境变量"></a>修改oracle用户环境变量</h3><blockquote><p>在/home/oracle/.bash_profile末尾添加</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#Oracle Settings</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=$TMP</span><br><span class="line">export ORACLE_HOSTNAME=oracle-server</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE /db11204</span><br><span class="line">export ORACLE_SID=ORCL</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br></pre></td></tr></table></figure><h3 id="创建目录及授权"><a href="#创建目录及授权" class="headerlink" title="创建目录及授权"></a>创建目录及授权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&gt;mkdir -p /u01/app/oracle</span><br><span class="line">$&gt;mkdir -p /u01/app/oracle/db11204</span><br><span class="line">$&gt;chown oracle:oinstall /u01/app</span><br><span class="line">$&gt;chown -R oracle:oinstall /u01/app/oracle</span><br><span class="line">$&gt;chmod -R 0775 /u01</span><br></pre></td></tr></table></figure><h3 id="安装oracle所需的软件环境"><a href="#安装oracle所需的软件环境" class="headerlink" title="安装oracle所需的软件环境"></a>安装oracle所需的软件环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$&gt;rpm -Uvh compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh ksh-20120801-137.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh unixODBC-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh unixODBC-devel-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh zlib-devel-1.2.7-17.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh elfutils-libelf-devel-0.170-4.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh libXmu-1.1.2-2.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh libXaw-1.0.13-4.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh xterm-295-3.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh perl-Switch-2.16-7.el7.noarch.rpm</span><br></pre></td></tr></table></figure><blockquote><p>注意：上面是本文档环境实际执行的，如果linux操作系统有出入，则有两种方式获取安装包，其一，去系统安装盘中寻找对应版本的软件，其二，用yum下载，例如ksh-20120801-137.el7.x86_64.rpm可以在linux中执行yum<br>–y install ksh即可。</p></blockquote><h3 id="设置selinux并使之生效"><a href="#设置selinux并使之生效" class="headerlink" title="设置selinux并使之生效"></a>设置selinux并使之生效</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;sed -i &apos;/SELINUX=enforcing/s/enforcing/permissive/g&apos; /etc/selinux/config</span><br><span class="line">$&gt;setenforce Permissive</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙并取消开机启动"><a href="#关闭防火墙并取消开机启动" class="headerlink" title="关闭防火墙并取消开机启动"></a>关闭防火墙并取消开机启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;systemctl stop firewalld</span><br><span class="line">$&gt;systemctl disable firewalld</span><br></pre></td></tr></table></figure><h3 id="设置NTP时钟"><a href="#设置NTP时钟" class="headerlink" title="设置NTP时钟"></a>设置NTP时钟</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt;systemctl stop ntpd</span><br><span class="line">$&gt;systemctl disable ntpd</span><br><span class="line">$&gt;mv /etc/ntp.conf /etc/ntp.conf.orig</span><br></pre></td></tr></table></figure><h2 id="Oracle安装"><a href="#Oracle安装" class="headerlink" title="Oracle安装"></a>Oracle安装</h2><p>执行./runInstaller</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8648eb24e32f99e7aca5c7f07caf5ff1.png" alt=""></p><p>选择不更新，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c1ac5f05f5335f3cae0c348b5a417ca4.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/be2e87a8b94516b5a3114cd7890ade8c.png" alt=""></p><p>选择仅安装软件，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/729535785378935c8224af2949e32774.png" alt=""></p><p>选择单实例，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/a1666c25e1f4215d4d19864283df33f6.png" alt=""></p><p>默认，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8f17a8f328d71efddb948a86193d06b9.png" alt=""></p><p>选择企业版，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/52b0d90f783e0876fadd16a9373b0d9c.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/ea1b2d772c9ccf3219e74f46540b2619.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/dcb93cdf3f63ab7dcd04e48075d004d4.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/51c3acaa721259649fa9d3bc8f228895.png" alt=""></p><blockquote><p>说明：因为文档中安装的是64位oracle，所以上图依赖环境中如果检测到有32位软件未按照时，可以忽略。除了上面说的，还有其他依赖检查失败，并且安装步骤是按照本文档执行的，那么需要联系DBA解决这个问题。</p></blockquote><p>选择忽略所有，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8bfbfe52895fd7b808fb59832a777d31.png" alt=""></p><p>完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e9776a1b1aafc7341dc648d82e0ea4fd.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/bb76efedbef27d89c3f01fb08b347605.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e1abef691028b5f6c1a0a1e3512b0341.png" alt=""></p><p>用root账户执行上面脚本，点完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/03ca5ef7c40f221da405b247c57c8ffb.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/34374713818d831761b03cc720598b56.png" alt=""></p><h2 id="Oracle监听配置"><a href="#Oracle监听配置" class="headerlink" title="Oracle监听配置"></a>Oracle监听配置</h2><p>执行netca</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c55ac08666992251a903f44b1656959d.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/520ce2bb9a399c6978966b0fa4506873.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/632cbdeeee59a7eae16860470d1b27f0.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/bfb4ea1200def1165037586694d8dc58.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/b8520c9225bf64b9f20193abb8801ca2.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d0a74ce6e52183e75dbe76ec8af358a1.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d8bbd22b2a716b62e6e93a77bfe2a3ca.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/f64f4eb3a1830778b7cc5aa8abd30813.png" alt=""></p><p>点完成</p><h2 id="Oracle数据库配置"><a href="#Oracle数据库配置" class="headerlink" title="Oracle数据库配置"></a>Oracle数据库配置</h2><p>执行dbca</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/add043123b071bb3dce44725f4e44704.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/90454c0fe8afbc3c4ec7c5591e8639e0.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/5b46bdce515dca7d38f4ba3683d6888a.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/b622361a804e02135b54467cf87a4381.png" alt=""></p><p>指定实例名，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/3cd232ed89eca28cbd404db1359f028a.png" alt=""></p><p>默认，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/1c37b26e3199013a9a43f7bc8e5b6d9d.png" alt=""></p><p>所有账号使用同一个密码，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/4c492b3fe795666bf5d19f5a66fdb108.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/1797408e37336a017e0df5d4190953a5.png" alt=""></p><p>默认下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e30d0d1e83e5ce99f7abe993bde841da.png" alt=""></p><p>闪回区至少设置10G，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/6cb0ee8cb2d924cd3213945e1bd7df1c.png" alt=""></p><p>默认下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/457c22f538bacf7760e2365799ff3f29.png" alt=""></p><p>内存设置40%</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/0dd008b83fd27b06efb85dda2563e42e.png" alt=""></p><p>进程设置1500</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/0856628e3c2f837ae1f20dbce08f51e6.png" alt=""></p><p>字符集选择AL32UTF8</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/12dc8ffd360557adacd1647a981b3528.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/928d07c37e387b4832990cfb05db24bd.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/781e7ad2cd7687fc9990fd28a5a4251e.png" alt=""></p><p>3个redo文件大小设置1G到10G之间，不确定的话，默认3个文档都设置为1G。下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8db707ab0be9692bce8e1a589fa3f74e.png" alt=""></p><p>完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d94f8d4f86c0abdc13483a255afbd371.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/47920725615af4f0f59157ea7127c75b.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e38ee84fcab229f25a0d4b1ccc6a47ef.png" alt=""></p><p>等待安装完成</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;oracle11.2.0.4 + centos 7.5安装文档&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>oracle 审计</title>
    <link href="https://zixujing.github.io/2019/01/22/db/oracle/oracle%20%E5%AE%A1%E8%AE%A1/"/>
    <id>https://zixujing.github.io/2019/01/22/db/oracle/oracle 审计/</id>
    <published>2019-01-21T17:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.366Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ORACLE审计<br><a id="more"></a></p></blockquote><h2 id="查看审计参数"><a href="#查看审计参数" class="headerlink" title="查看审计参数"></a>查看审计参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value from v$parameter where name=&apos;audit_trail&apos;;</span><br></pre></td></tr></table></figure><h2 id="停止审计create-session，并审计create-table，truncate-table-，alter-table等"><a href="#停止审计create-session，并审计create-table，truncate-table-，alter-table等" class="headerlink" title="停止审计create session，并审计create table，truncate table ，alter table等"></a>停止审计create session，并审计create table，truncate table ，alter table等</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">noaudit connect;</span><br><span class="line">audit table by access whenever successful;</span><br></pre></td></tr></table></figure><h2 id="审计对象"><a href="#审计对象" class="headerlink" title="审计对象"></a>审计对象</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">audit delete on table_name;</span><br></pre></td></tr></table></figure><h2 id="查看语句审计"><a href="#查看语句审计" class="headerlink" title="查看语句审计"></a>查看语句审计</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from sys.dba_stmt_audit_opts;</span><br></pre></td></tr></table></figure><h2 id="查看对象审计"><a href="#查看对象审计" class="headerlink" title="查看对象审计"></a>查看对象审计</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from dba_obj_audit_opts;</span><br></pre></td></tr></table></figure><h2 id="查看审计信息"><a href="#查看审计信息" class="headerlink" title="查看审计信息"></a>查看审计信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from DBA_AUDIT_OBJECT;</span><br><span class="line">select * from dba_audit_statement;</span><br><span class="line">select * from DBA_AUDIT_TRAIL;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ORACLE审计&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>再说隧道netsh/ssh/plink</title>
    <link href="https://zixujing.github.io/2019/01/17/linux/linux%E9%9A%A7%E9%81%93/%E5%86%8D%E8%AF%B4%E9%9A%A7%E9%81%93/"/>
    <id>https://zixujing.github.io/2019/01/17/linux/linux隧道/再说隧道/</id>
    <published>2019-01-16T17:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.383Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>命令是次要，重点了解过程</p></blockquote><a id="more"></a><h2 id="windows端口转发"><a href="#windows端口转发" class="headerlink" title="windows端口转发"></a>windows端口转发</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenaddress=localaddress listenport=localport connectaddress=destaddress connectport=destport</span><br></pre></td></tr></table></figure><blockquote><p>listenaddress – 等待连接的本地IP地址。<br>listenport – 本地侦听TCP端口。<br>connectaddress – 将传入连接重定向到本地或远程IP地址（或DNS名称）。<br>条件：请确保iphlpsvc（IP Helper）服务当前已在你的系统上运行。必须在为其创建端口转发规则的网络接口上启用IPv6支持。</p></blockquote><h2 id="linux-反向隧道"><a href="#linux-反向隧道" class="headerlink" title="linux 反向隧道"></a>linux 反向隧道</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -ngfNTR 1222:192.168.100.3:22 root@192.168.0.173 -o ServerAliveInterval=300</span><br><span class="line">ssh -ngfNTL 1222:localhost:22 root@192.168.0.173 -o ServerAliveInterval=300</span><br></pre></td></tr></table></figure><p><strong>-R理解：</strong>173机器开端口1222反向链接100.3<br><strong>-L理解：</strong>本机的1222端口正向链接173的22端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -ngfNTL 1222:127.0.0.1:22 root@192.168.11.97</span><br><span class="line">sh -ngfNTR 1222:127.0.0.1:22 root@192.168.11.97</span><br></pre></td></tr></table></figure><p><strong>-R理解：</strong>97机器开端口1222反向链接本地的22端口<br><strong>-L理解：</strong>本机的1222端口正向链接97的22端口<br><strong>正向反向</strong>：执行命令的机器（A）&lt;+=====+&gt;root@ip（B） 之间存在链接，其一：A监听的端口并转发到B，其二：A链接上B后，让B监听并转发给A则反向。</p><blockquote><p>-f 表示后台执行<br>-N 表示不执行任何命令<br>-R 建立反向隧道<br>1222 173机用来外面ssh的监听端口<br>-o ServerAliveInterval=300 的意思是让ssh client每300秒就给server发个心跳,以免链路被RST.<br>-f Requests ssh to go to background just before command execution. 让该命令后台运行 .<br>-n Redirects stdin from /dev/null (actually, prevents reading from stdin).<br>-N Do not execute a remote command. 不执行远程命令 .<br>-T Disable pseudo-tty allocation. 不占用 shell .<br>-g Allows remote hosts to connect to local forwarded ports.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;命令是次要，重点了解过程&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>oracle 导入导出文档</title>
    <link href="https://zixujing.github.io/2019/01/16/db/oracle/oracle_expdp_impdp/"/>
    <id>https://zixujing.github.io/2019/01/16/db/oracle/oracle_expdp_impdp/</id>
    <published>2019-01-15T18:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.370Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>oracle 数据泵导入导出</p></blockquote><a id="more"></a><h2 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h2><ul><li><p>首先建立directory，directory是存放备份文件的路径（导入导出都要建立,对应的C:/exp文件夹如果不存在，需要手工建立）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; connect sys/123456 as sysdba</span><br><span class="line">SQL&gt; create or replace directory expdir as 'C:/exp';</span><br><span class="line">SQL&gt; grant read,write on directory expdir to public;</span><br><span class="line"><span class="comment">#查看directory是否创建成功</span></span><br><span class="line">SQL&gt; select * from dba_directories;</span><br><span class="line">SQL&gt; commit;</span><br></pre></td></tr></table></figure></li><li><p>使用expdp命令导出某个用户的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expdp kliu_voi5/1234@orcl schemas=kliu_voi5 dumpfile=kliu_voi5.dmp directory=expdir</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>其中kliu_voi5/1234是用户名密码，orcl是oracle的sid。该命令完成后在c:\exp下会有kilu_voi5.dmp文件</p></blockquote><ul><li>如果只是要导出某些表，可以使用include<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expdp kliu_voi5/1234@orcl schemas=kliu_voi5 dumpfile=kliu_voi5.dmp directory=expdir include=table:\&quot;like \&apos;CT%\&apos;\&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><ul><li><p>首先建立directory</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; connect sys/123456 as sysdba</span><br><span class="line">SQL&gt; create or replace directory db_bak as &apos;d:/db_bak&apos;;</span><br><span class="line">SQL&gt; grant read,write on directory db_bak to public;</span><br><span class="line">SQL&gt; select * from dab_directories;</span><br><span class="line">SQL&gt; commit;</span><br></pre></td></tr></table></figure></li><li><p>如果是在新的oracle数据库里，需用重建同样的用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; connect sys/123456 as sysdba</span><br><span class="line">SQL&gt; create user kliu_voi5 identified by &quot;1234&quot;;</span><br><span class="line">SQL&gt; grant dba to kliu_voi5;</span><br><span class="line">SQL&gt; commit;</span><br></pre></td></tr></table></figure></li><li><p>使用impdp命令导入某个用户的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impdp kliu_voi5/1234@orcl directory=db_bak dumpfile=kliu_voi5.dmp full=y</span><br></pre></td></tr></table></figure></li></ul><h2 id="帮助使用方法"><a href="#帮助使用方法" class="headerlink" title="帮助使用方法"></a>帮助使用方法</h2><ul><li>导出命令打印帮助信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expdp help=y</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;oracle 数据泵导入导出&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>sqlserver 文件存储笔记</title>
    <link href="https://zixujing.github.io/2019/01/16/db/mssql/sqlserver%20%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%AC%94%E8%AE%B0/"/>
    <id>https://zixujing.github.io/2019/01/16/db/mssql/sqlserver 文件存储笔记/</id>
    <published>2019-01-15T17:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.349Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>sqlserver 笔记，文件存储相关<br><a id="more"></a></p></blockquote><h2 id="page页"><a href="#page页" class="headerlink" title="page页"></a>page页</h2><ul><li>每个页面8KB，连续的8个页面称为一个区extents。</li><li>统一区：8个页面均为一个对象所有。</li><li>混合区： 8个页面最多可被8个对象共享。<h2 id="lockres-physloc"><a href="#lockres-physloc" class="headerlink" title="%%lockres%% %%physloc%%"></a>%%lockres%% %%physloc%%</h2></li><li>lockres ： 锁</li><li>physloc ： 物理位置，64位的计算方式是，如0x0001000001000000则0x0000000100000100，前4为为槽号0x0000，中间4位为文件号0x0001，最后8位0x00000100是页号。</li><li>显示： 文件编号：页编号：页内位置</li></ul><h2 id="GAM页"><a href="#GAM页" class="headerlink" title="GAM页"></a>GAM页</h2><ul><li>全局分配映射(Global Allocation Map)，包含页头和一些其它开销外，还有8 000字节或者说64 000bit位可用，每个bit位代表一个区（8个page），0表示已使用，1表示自由区。</li></ul><h2 id="SGAM页"><a href="#SGAM页" class="headerlink" title="SGAM页"></a>SGAM页</h2><ul><li>共享全局分区，类似GAM一个bit表示一个区，不同的是，他的1表示混合区且有可用空间；0表示未使用或无可用空间。<strong>用来跟踪区的分配情况，描述哪些区是混合区并且至少有一个空闲的数据页</strong>。</li></ul><h2 id="系统page页"><a href="#系统page页" class="headerlink" title="系统page页"></a>系统page页</h2><ul><li>个GAM页面出现在第一个GAM页面(页码为2)以后的每511230个页面中（大约4G空间后），并且下一个SGAM页面出现在第一个SGAM页面(页码为3)以后的每511 230个页面中。</li><li>每一个数据库文件的页码为0的页面是文件头页面，并且每个文件仅有一页（文件头页面，页码为0）。</li><li>页码0是头文件页，页码1是页面自由空间页(Page Free Space，PFS)。</li></ul><table><thead><tr><th>第0页</th><th>第1页</th><th>第2页</th><th>第3页</th><th>第4页</th><th>第5页</th><th>第6页</th><th>第7页  </th></tr></thead><tbody><tr><td>m_type=15</td><td>m_type=11</td><td>m_type=8</td><td>m_type=9</td><td>m_type=0</td><td>m_type=0</td><td>m_type=16</td><td>m_type=17</td></tr><tr><td>头文件页</td><td>PFS页</td><td>GAM页</td><td>SGAM页</td><td>保留页</td><td>保留页</td><td>DCM页</td><td>BCM页</td></tr></tbody></table><ul><li>除了第9页为数据库的BOOT页以外，从第8页到第173页为SQLServer2008内部系统表的相关存储信息，然后从第174页到第279页为未分配页面。因为第一页从0开始，所以刚好280页，即和我们看到的数据库数据文件的大小完全相等。</li><li>见前文的运算，数据库大小：2.18 MB (2,293,760 字节)=2,293,760b/8kb=280个页面=35个区。</li></ul><table><thead><tr><th>第8页</th><th>第9页</th><th>第10页~第173页</th><th>第174~279页</th></tr></thead><tbody><tr><td>m_type=1</td><td>m_type=13</td><td>m_type in (1,2,10)</td><td>N/A</td></tr><tr><td>Data页</td><td>Boot页</td><td>主要为内部系统表相关信息</td><td>未分配</td></tr></tbody></table><h2 id="PFS"><a href="#PFS" class="headerlink" title="PFS"></a>PFS</h2><ul><li>用来跟踪页分配级别，存储当前数据文件里所有页分配及可用空间的信息，每一个数据文件的第2个数据页都是PFS，页号为1 。该页面中，每一个字节描述后面每一个数据页是否还有空间可以写记录，也就是一个PFS页是8k，约有8k个字节可以描述后续每个页面的使用情况，也就是一个PFS页，可以描述8k个数据页的使用情况，这就意味着单个PFS页能够存储约64M数据页的可用空间情况。所以，大约每隔64Mb，就会有一个新的PFS页。</li></ul><table><thead><tr><th>位置</th><th>含义</th></tr></thead><tbody><tr><td>bit 0-2</td><td>0x00 is empty;0x01 is 1 to 50% full;0x02 is 51 to 80% full;0x03 is 81 to 95% full;0x04 is 96 to 100% full;</td></tr><tr><td>bit 3</td><td>(0x08): 该数据页是否存在鬼影记录</td></tr><tr><td>bit 4</td><td>(0x10): 是否是IAM页</td></tr><tr><td>bit 5</td><td>(0x20): 是否是混合页</td></tr><tr><td>bit 6</td><td>(0x40): 是否已分配使用</td></tr><tr><td>Bit 7</td><td>保留，未使用，无实际含义</td></tr></tbody></table><h2 id="dbcc-ind"><a href="#dbcc-ind" class="headerlink" title="dbcc ind"></a>dbcc ind</h2><blockquote><p>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DBCC TRACEON(2588)</span><br><span class="line">DBCC HELP(&apos;ind&apos;)</span><br><span class="line">dbcc IND ( &#123; &apos;dbname&apos; | dbid &#125;, &#123; &apos;objname&apos; | objid &#125;, &#123; nonclustered indid | 1 | 0 | -1 | -2 &#125; [, partition_number] )</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>输出格式</p></blockquote><ul><li>-2：返回所有IAM页，基于管理行内数据页，行溢出数据页及大对象数据页的IAM页</li><li>-1：返回所有IAM页及数据页。</li><li>0：返回管理行内数据页的IAM页，行内数据页</li><li>1：返回聚集索引的数据页信息及IAM页信息（同-1）</li><li>2：返回第1个非聚集索引的数据页信息及IAM页信息</li><li>3：返回第2个非聚集索引的数据页信息及IAM页信息</li><li>…</li><li>n：返回第（n-1）个非聚集索引的数据页信息及IAM页信息（n&gt;1）</li></ul><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/608061-20170502183131101-852115051.png" alt=""></center><h2 id="dbcc-page"><a href="#dbcc-page" class="headerlink" title="dbcc page"></a>dbcc page</h2><blockquote><p>语法说明</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DBCC TRACEON(2588)</span><br><span class="line">DBCC HELP(&apos;PAGE&apos;)</span><br><span class="line">dbcc PAGE ( &#123;&apos;dbname&apos; | dbid&#125;, filenum, pagenum [, printopt=&#123;0|1|2|3&#125; ])</span><br></pre></td></tr></table></figure><blockquote><p>输出的格式有4种方式，不同方式，输出不一样。</p></blockquote><ul><li>0：输出可读形式的数据页页头数据</li><li>1：输出可读形式的数据页页头数据，并且还有槽位对应记录的十六进制内容</li><li>2：输出可读形式的数据页页头数据，输出整个数据页页头的十六进制数据，整一页的内容都显示，包括未使用的空间。</li><li>3：输出可读形式的数据页页头数据，并且包括记录中每个字段的可读形式，行溢出数据也会显示数据内容，但是大对象则不显示内容，而是说明其存储位置！所以选项3，也是输出内容最全面的。</li></ul><h2 id="IAM"><a href="#IAM" class="headerlink" title="IAM"></a>IAM</h2><blockquote><p>Sytem_internals_allocation_units表存放第一个数据页和第一个IAM页的指针。IAM按照数据页的顺序存放数据页的指针。数据页之间并无直接链接。</p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/882fba2bgab50aceb6a78&amp;690.png" alt=""></center><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT total_pages,used_pages,data_pages,</span><br><span class="line">       first_page,root_page,first_iam_page</span><br><span class="line">  FROM sys.system_internals_allocation_units</span><br><span class="line">WHERE container_id =&apos;72057594038779904&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;sqlserver 笔记，文件存储相关&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="sqlserver" scheme="https://zixujing.github.io/tags/sqlserver/"/>
    
  </entry>
  
  <entry>
    <title>sqlserver 2012内存管理</title>
    <link href="https://zixujing.github.io/2019/01/15/db/mssql/sqlserver%202012%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://zixujing.github.io/2019/01/15/db/mssql/sqlserver 2012内存管理/</id>
    <published>2019-01-14T17:00:00.000Z</published>
    <updated>2019-01-15T13:20:59.977Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management/" target="_blank" rel="noopener">原文地址：https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management</a><br><a id="more"></a></p></blockquote><h2 id="内存分配器的变化"><a href="#内存分配器的变化" class="headerlink" title="内存分配器的变化"></a>内存分配器的变化</h2><blockquote><p>SQL Server 2012以前的版本，比如SQL Server 2008 R2等，有<strong>single page allocator</strong>和<strong>multi page allocator</strong>。 也就是说， 如果申请的内存是8k以内的，就会有单页分配器分配，而大于8kb的内存请求，使用multi page 分配器来管理。所以，如果你运行DBCC MemoryStatus，你会发现这两个分配器分配的内存情况。</p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/6607.1.png" alt="dbcc memorystatus"></center><blockquote><p>如果你查询<strong>memory clerk</strong>，也会发现single pages 和multi pages 两列：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from sys.dm_os_memory_clerks</span><br></pre></td></tr></table></figure><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/4812.2.png" alt=""></center><blockquote><p>而2012里面就不一样了，你会发现single page 和multi page字样消失了，只剩下pages 字样：</p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/5482.3.png" alt=""></center><blockquote><p>而下面的语句的输出也是不一样的：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> sys.dm_os_memory_clerks</span><br></pre></td></tr></table></figure><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/2577.4.png" alt=""></center><blockquote><p>那么为什么会有这样的变化呢？原因就是SQL Server 2012里面不再有single page allocator 和multi page allocator，而是把它们统一起来了，叫做 any size page allocator。 下面的两张图可以看到这样的变化：</p></blockquote><pre><code>SQL Server 2008 R2：</code></pre><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/5074.5.png" alt=""></center><pre><code>SQL Server 2012：</code></pre><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/7041.6.png" alt=""></center><ul><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2012/ms175019&#40;v=sql.110&#41;" target="_blank" rel="noopener">参考:https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2012/ms175019(v=sql.110)</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原文地址：https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="sqlserver" scheme="https://zixujing.github.io/tags/sqlserver/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 内存管理</title>
    <link href="https://zixujing.github.io/2019/01/15/db/mysql/mysql%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://zixujing.github.io/2019/01/15/db/mysql/mysql内存管理/</id>
    <published>2019-01-14T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.060Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>分析mysql内存结构<br><a id="more"></a></p></blockquote><h2 id="内存结构图"><a href="#内存结构图" class="headerlink" title="内存结构图"></a>内存结构图</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/mysql%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.jpg" alt="mysql内存结构描述"></p><ol><li><p>全局缓存包括</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; global buffer(全局内存分配总和) =</span><br><span class="line">&gt; innodb_buffer_pool_size --InnoDB高速缓冲，行数据、索引缓冲，以及事务锁、自适应哈希等</span><br><span class="line">&gt; +innodb_additional_mem_pool_size  --InnoDB数据字典额外内存，缓存所有表数据字典</span><br><span class="line">&gt; +innodb_log_buffer_size -- InnoDB REDO日志缓冲，提高REDO日志写入效率</span><br><span class="line">&gt; +key_buffer_size -- MyISAM表索引高速缓冲，提高MyISAM表索引读写效率</span><br><span class="line">&gt; +query_cache_size --查询高速缓存，缓存查询结果，提高反复查询返回效率</span><br><span class="line">&gt; +thread_cache_size --Thread_Cache 中存放的最大连接线程数</span><br><span class="line">&gt; +table_cahce -- 表空间文件描述符缓存，提高数据表打开效率</span><br><span class="line">&gt; +table_definition_cache -- 表定义文件描述符缓存，提高数据表打开效率</span><br></pre></td></tr></table></figure></li><li><p>会话缓存包括</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; total_thread_buffers= max_connections*(</span><br><span class="line">&gt;  read_buffer_size-- 顺序读缓冲，提高顺序读效率</span><br><span class="line">&gt; +read_rnd_buffer_size-- 随机读缓冲，提高随机读效率</span><br><span class="line">&gt; +sort_buffer_size-- 排序缓冲，提高排序效率</span><br><span class="line">&gt; +join_buffer_size-- 表连接缓冲，提高表连接效率</span><br><span class="line">&gt; +binlog_cache_size-- 二进制日志缓冲，提高二进制日志写入效率</span><br><span class="line">&gt; +tmp_table_size -- 内存临时表，提高临时表存储效率</span><br><span class="line">&gt; +thread_stack-- 线程堆栈，暂时寄存SQL语句/存储过程</span><br><span class="line">&gt; +thread_cache_size-- 线程缓存，降低多次反复打开线程开销，模拟连接池</span><br><span class="line">&gt; )</span><br></pre></td></tr></table></figure></li></ol><h2 id="查看Mysql全局占用内存大小"><a href="#查看Mysql全局占用内存大小" class="headerlink" title="查看Mysql全局占用内存大小"></a>查看Mysql全局占用内存大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;select (@@innodb_buffer_pool_size+@@innodb_log_buffer_size+@@key_buffer_size)/1024/1024 as g_buffer;</span><br></pre></td></tr></table></figure><h2 id="performance-schema占用多少内存"><a href="#performance-schema占用多少内存" class="headerlink" title="performance_schema占用多少内存"></a>performance_schema占用多少内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SELECT SUBSTRING_INDEX(event_name,&apos;/&apos;,2) AS  </span><br><span class="line">         code_area, sys.format_bytes(SUM(current_alloc))  </span><br><span class="line">         AS current_alloc  </span><br><span class="line">         FROM sys.x$memory_global_by_current_bytes  </span><br><span class="line">         GROUP BY SUBSTRING_INDEX(event_name,&apos;/&apos;,2)  </span><br><span class="line">         ORDER BY SUM(current_alloc) DESC;</span><br></pre></td></tr></table></figure><h2 id="每个线程占用多少内存"><a href="#每个线程占用多少内存" class="headerlink" title="每个线程占用多少内存"></a>每个线程占用多少内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SELECT ( ( @@read_buffer_size  </span><br><span class="line">   + @@read_rnd_buffer_size  </span><br><span class="line">   + @@sort_buffer_size  </span><br><span class="line">   + @@join_buffer_size  </span><br><span class="line">   + @@binlog_cache_size  </span><br><span class="line">   + @@thread_stack  </span><br><span class="line">   + @@max_allowed_packet  </span><br><span class="line">   + @@net_buffer_length )  </span><br><span class="line">   ) / (1024*1024) AS MEMORY_MB;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;分析mysql内存结构&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ADAM采集器用户手册</title>
    <link href="https://zixujing.github.io/2019/01/14/db/postgresql/oracle_to_ppas/"/>
    <id>https://zixujing.github.io/2019/01/14/db/postgresql/oracle_to_ppas/</id>
    <published>2019-01-13T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.066Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ADAM采集器简介"><a href="#ADAM采集器简介" class="headerlink" title="ADAM采集器简介"></a>ADAM采集器简介</h2><p>  采集器是ADAM整个产品的非常关键的部分，采集的信息的正确性、完整性、及时有效性，直接影响整个迁移过程。<br><a id="more"></a></p><h2 id="主要步骤"><a href="#主要步骤" class="headerlink" title="主要步骤"></a>主要步骤</h2><ol><li>下载 ADAM 客户端<ul><li>登录阿里云,如果已有账号，可直接登录，否则请先注册后，在登录。</li><li>进入到 数据库和应用服务 ADAM 界面，目前产品处于公测阶段，可以先申请公测资格，免费使用该产品。</li><li>进入 ADAM 管理控制台， 在左侧导航栏中单击客户端下载。可以根据自己的运行环境，下载相应的客户端版本 Windows 64 位、 Linux 64 位，不要在32 位操作系统上运行以上版本。</li></ul></li><li>环境要求<ul><li>网络：需要可以连接到采集的数据库（通过tnsnames的方式进行采集）</li><li>机器：<ul><li>CPU: 2C+</li><li>内存： 8g+</li><li>磁盘空间： 20g+</li><li>网路带宽： 千兆网+</li></ul></li></ul></li><li>操作系统：<ul><li>CentOS6.x+， RedHat6.x+， Oracle Linux6.x+等</li><li>Windows XP， 7， 8， 10+， Windows Server 2003+等</li></ul></li><li><p>数据库环境：</p><ul><li><p>开启归档</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; archive log list</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line"><span class="comment">-- 启动数据库 mount 状态</span></span><br><span class="line">SQL&gt; startup mount</span><br><span class="line"><span class="comment">-- 打开归档</span></span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line"><span class="comment">-- 检查归档开启,Enabled 表示开启</span></span><br><span class="line">SQL&gt; archive log list;</span><br><span class="line"><span class="comment">-- 打开数据库</span></span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line"><span class="comment">-- 切换归档</span></span><br><span class="line">SQL&gt; alter system switch logfile</span><br></pre></td></tr></table></figure></li><li><p>开启最小补充日志</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查最小补充日志是否开启,NO 表示未开启</span></span><br><span class="line">SQL&gt; select supplemental_log_data_min from v$database;</span><br><span class="line"><span class="comment">-- 开启最小补充日志</span></span><br><span class="line">SQL&gt; alter database add supplemental log data;</span><br><span class="line"><span class="comment">-- 验证已经开启,YES 表示已经开启</span></span><br><span class="line">SQL&gt; select supplemental_log_data_min from v$database;</span><br></pre></td></tr></table></figure></li><li><p>创建采集账号</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建采集用户 eoa_user, 并设置密码为 eoaPASSW0RD</span></span><br><span class="line">SQL&gt; create user eoa_user identified by "eoaPASSW0RD" default tablespace users;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予查询权限</span></span><br><span class="line">SQL&gt; grant connect,resource,select_catalog_role,select any dictionary to eoa_user;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予执行 DBMS_LOGMNR 权限</span></span><br><span class="line"><span class="comment">-- (版本 10g 数据库需先执行: CREATE OR REPLACE PUBLIC SYNONYM dbms_logmnr FOR sys.dbms_logmnr)</span></span><br><span class="line">SQL&gt; grant execute on DBMS_LOGMNR to eoa_user;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予执行 DBMS_METADATA 权限，查询数据对象 DDL 语句</span></span><br><span class="line">SQL&gt; grant execute on dbms_metadata to eoa_user;</span><br><span class="line"><span class="comment">-- 为 eoa_user 用户赋予查询事务权限</span></span><br><span class="line">SQL&gt; grant select any transaction to eoa_user;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="采集数据"><a href="#采集数据" class="headerlink" title="采集数据"></a>采集数据</h2><ol><li><p>解压采集包:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf rainmeter-linux64.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> rainmeter</span></span><br></pre></td></tr></table></figure></li><li><p>采集方式：</p><ul><li><p>单次性采集<br>只采集一次全量数据，采集完进程就退出。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sh onekeyCollect.sh -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt;</span><br><span class="line">$#sh onekeyCollect.sh -h192.168.106.174 -ueoa_user -p eoaPASSW0RD -dorcl -P1521</span><br></pre></td></tr></table></figure></li><li><p>周期性采集（最好采集1周以上）</p><ul><li><p>第一次采集全量数据，后面定时增量收集 SQL 相关数据直到执行取消命令（ctrl +c）。 或者直接进行周期性采集（包含1次全量采集）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh asynCollect.sh -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt; -P&lt;port&gt;</span><br></pre></td></tr></table></figure></li><li><p>采集结果打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh asynExport[.sh|.bat] -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>清理采集账号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; drop user eoa_user cascade;</span><br></pre></td></tr></table></figure></li></ol><h2 id="上传采集数据包"><a href="#上传采集数据包" class="headerlink" title="上传采集数据包"></a>上传采集数据包</h2><ol><li>登录 阿里云 ADAM 控制台(<a href="https://rainbow-console.aliyun.com/studio.htm?spm=a2c4g.11186623.2.10.41c05d6egD44MV)，项目管理，新建项目" target="_blank" rel="noopener">https://rainbow-console.aliyun.com/studio.htm?spm=a2c4g.11186623.2.10.41c05d6egD44MV)，项目管理，新建项目</a>.</li><li>点击进入项目，上传数据包（数据包务必是 ZIP 压缩包）。点击分析。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ADAM采集器简介&quot;&gt;&lt;a href=&quot;#ADAM采集器简介&quot; class=&quot;headerlink&quot; title=&quot;ADAM采集器简介&quot;&gt;&lt;/a&gt;ADAM采集器简介&lt;/h2&gt;&lt;p&gt;  采集器是ADAM整个产品的非常关键的部分，采集的信息的正确性、完整性、及时有效性，直接影响整个迁移过程。&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Ogg-monitor--server-and-agent12.2.1-安装</title>
    <link href="https://zixujing.github.io/2019/01/11/ogg/Ogg-monitor--server-and-agent12.2.1-%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/01/11/ogg/Ogg-monitor--server-and-agent12.2.1-安装/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.073Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>监控ogg<br><a id="more"></a></p></blockquote><blockquote><p>文档下载</p></blockquote><table><thead><tr><th>文档名</th><th>下载  </th></tr></thead><tbody><tr><td>Ogg-monitor–server-and-agent12.2.1-安装.docx</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/Ogg-monitor--server-and-agent12.2.1-安装.docx" target="_blank" rel="noopener">点</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;监控ogg&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>Mysql主从搭建</title>
    <link href="https://zixujing.github.io/2019/01/11/db/mysql/mysql%E5%A4%8D%E5%88%B6%E6%90%AD%E5%BB%BA/"/>
    <id>https://zixujing.github.io/2019/01/11/db/mysql/mysql复制搭建/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.355Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql复制搭建过程<br><a id="more"></a></p></blockquote><h2 id="关键配置参数"><a href="#关键配置参数" class="headerlink" title="关键配置参数"></a>关键配置参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---master----</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=master-bin</span><br><span class="line">---slaver----</span><br><span class="line">server-id=2</span><br><span class="line">log-bin=slavera-bin</span><br><span class="line">log-slave-updates</span><br></pre></td></tr></table></figure><h2 id="备份master"><a href="#备份master" class="headerlink" title="备份master"></a>备份master</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">innobackupex --user=root --password=root --slaver-info</span><br><span class="line">--database=dataprocessno1_bigdata /root/bak</span><br></pre></td></tr></table></figure><h2 id="打包备份"><a href="#打包备份" class="headerlink" title="打包备份"></a>打包备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf bak.tar.gz bak</span><br></pre></td></tr></table></figure><h2 id="备份拷贝到目标机器"><a href="#备份拷贝到目标机器" class="headerlink" title="备份拷贝到目标机器"></a>备份拷贝到目标机器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp bak.tar.gz 192.168.106.174:/root/bak</span><br></pre></td></tr></table></figure><h2 id="Slaver还原"><a href="#Slaver还原" class="headerlink" title="Slaver还原"></a>Slaver还原</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf bak.tar.gz</span><br><span class="line">cd bak</span><br><span class="line">mv * ../</span><br><span class="line">innobackupex --user=root --apply-log /root/bak/2018-01-10_16-09-46</span><br><span class="line">innobackupex --user=root --copy-back /root/bak/2018-01-10_16-09-46</span><br><span class="line">chown mysql:mysql -R /usr/local/mysql/data</span><br></pre></td></tr></table></figure><h2 id="Master创建复制帐号"><a href="#Master创建复制帐号" class="headerlink" title="Master创建复制帐号"></a>Master创建复制帐号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to repl@&apos;192.168.106.%&apos; identified by</span><br><span class="line">&apos;repl&apos;;</span><br></pre></td></tr></table></figure><h2 id="启动slaver并指向master"><a href="#启动slaver并指向master" class="headerlink" title="启动slaver并指向master"></a>启动slaver并指向master</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle 2018-01-10_16-09-46]# cat xtrabackup_binlog_info</span><br><span class="line">master-bin.000001 154</span><br><span class="line">mysql&gt;change master to</span><br><span class="line">master_host=&apos;192.168.106.234&apos;,master_user=&apos;repl&apos;,master_password=&apos;repl&apos;,master_log_file=&apos;master-bin.000001&apos;,master_log_pos=154;</span><br><span class="line">mysql&gt;start slave;</span><br><span class="line">mysql&gt;show slave status\G</span><br><span class="line">Slave_IO_State: Waiting for master to send event</span><br><span class="line">Master_Host: 192.168.106.234</span><br><span class="line">Master_User: repl</span><br><span class="line">Master_Port: 3306</span><br><span class="line">Connect_Retry: 60</span><br><span class="line">Master_Log_File: master-bin.000001</span><br><span class="line">Read_Master_Log_Pos: 593</span><br><span class="line">Relay_Log_File: oracle-relay-bin.000002</span><br><span class="line">Relay_Log_Pos: 760</span><br><span class="line">Relay_Master_Log_File: master-bin.000001</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line">Replicate_Do_DB:</span><br><span class="line">Replicate_Ignore_DB:</span><br><span class="line">Replicate_Do_Table:</span><br><span class="line">Replicate_Ignore_Table:</span><br><span class="line">Replicate_Wild_Do_Table:</span><br><span class="line">Replicate_Wild_Ignore_Table:</span><br><span class="line">Last_Errno: 0</span><br><span class="line">Last_Error:</span><br><span class="line">Skip_Counter: 0</span><br><span class="line">Exec_Master_Log_Pos: 593</span><br><span class="line">Relay_Log_Space: 968</span><br><span class="line">Until_Condition: None</span><br><span class="line">Until_Log_File:</span><br><span class="line">Until_Log_Pos: 0</span><br><span class="line">Master_SSL_Allowed: No</span><br><span class="line">Master_SSL_CA_File:</span><br><span class="line">Master_SSL_CA_Path:</span><br><span class="line">Master_SSL_Cert:</span><br><span class="line">Master_SSL_Cipher:</span><br><span class="line">Master_SSL_Key:</span><br><span class="line">Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">Last_IO_Errno: 0</span><br><span class="line">Last_IO_Error:</span><br><span class="line">Last_SQL_Errno: 0</span><br><span class="line">Last_SQL_Error:</span><br><span class="line">Replicate_Ignore_Server_Ids:</span><br><span class="line">Master_Server_Id: 1</span><br><span class="line">Master_UUID: a34d437a-f5da-11e7-a514-000c298fe627</span><br><span class="line">Master_Info_File: /usr/local/mysql/data/master.info</span><br><span class="line">SQL_Delay: 0</span><br><span class="line">SQL_Remaining_Delay: NULL</span><br><span class="line">Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">Master_Retry_Count: 86400</span><br><span class="line">Master_Bind:</span><br><span class="line">Last_IO_Error_Timestamp:</span><br><span class="line">Last_SQL_Error_Timestamp:</span><br><span class="line">Master_SSL_Crl:</span><br><span class="line">Master_SSL_Crlpath:</span><br><span class="line">Retrieved_Gtid_Set:</span><br><span class="line">Executed_Gtid_Set:</span><br><span class="line">Auto_Position: 0</span><br><span class="line">Replicate_Rewrite_DB:</span><br><span class="line">Channel_Name:</span><br><span class="line">Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>检查Slave_IO_Running: Yes，Slave_SQL_Running: Yes证明搭建成功</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql复制搭建过程&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MSSQL for linux 安装</title>
    <link href="https://zixujing.github.io/2019/01/11/db/mssql/mssql_for_linux/"/>
    <id>https://zixujing.github.io/2019/01/11/db/mssql/mssql_for_linux/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.056Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://packages.microsoft.com/config/rhel/7/" target="_blank" rel="noopener">https://packages.microsoft.com/config/rhel/7/</a><br>mssql地址<br><a id="more"></a></p><ul><li>获取yum源</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# curl https://packages.microsoft.com/config/rhel/7/mssql-server-2017.repo &gt;/etc/yum.repos.d/mssql-server.repo</span><br></pre></td></tr></table></figure><ul><li>安装MSSQL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# yum install mssql-server</span><br><span class="line">[root@yth-test bin]# cd /opt/mssql/bin</span><br><span class="line">[root@yth-test bin]# ./mysql-conf setup</span><br></pre></td></tr></table></figure><ul><li>查看服务状态</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mssql</span><br></pre></td></tr></table></figure><ul><li>安装工具</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# curl https://packages.microsoft.com/config/rhel/7/prod.repo &gt; /etc/yum.repos.d/prod.repo</span><br><span class="line">[root@yth-test bin]# yum install mssql-tools</span><br><span class="line">[root@yth-test bin]# pwd</span><br><span class="line">/opt/mssql-tools/bin</span><br><span class="line">[root@yth-test bin]# ./sqlcmd -S localhost -U sa</span><br></pre></td></tr></table></figure><ul><li>win安装SSMS<blockquote><p><a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=8961" target="_blank" rel="noopener">https://www.microsoft.com/zh-cn/download/details.aspx?id=8961</a></p></blockquote></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://packages.microsoft.com/config/rhel/7/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://packages.microsoft.com/config/rhel/7/&lt;/a&gt;&lt;br&gt;mssql地址&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mssql" scheme="https://zixujing.github.io/tags/mssql/"/>
    
  </entry>
  
</feed>
