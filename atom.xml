<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冯凯&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zixujing.github.io/"/>
  <updated>2019-10-22T14:05:06.305Z</updated>
  <id>https://zixujing.github.io/</id>
  
  <author>
    <name>冯_凯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>switch+arp+链路聚合</title>
    <link href="https://zixujing.github.io/2019/10/22/switch/switch+arp+%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/"/>
    <id>https://zixujing.github.io/2019/10/22/switch/switch+arp+链路聚合/</id>
    <published>2019-10-22T15:00:00.000Z</published>
    <updated>2019-10-22T14:05:06.305Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>switch+arp+链路聚合</p></blockquote><a id="more"></a><h2 id="链路聚合"><a href="#链路聚合" class="headerlink" title="链路聚合"></a>链路聚合</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SA</span><br><span class="line">[SA] interface Eth-Trunk 1</span><br><span class="line">[SA-Eth-Trunk1]mode manual load-balance</span><br><span class="line">[SA-Eth-Trunk1]trunkport g 0/0/1 to 0/0/3</span><br><span class="line">[SA-Eth-Trunk1]quit</span><br><span class="line">[SA]vlan batch 10 20</span><br><span class="line">[SA]interface g 0/0/4</span><br><span class="line">[SA-GigabitEthernet0/0/4] port link-type access</span><br><span class="line">[SA-GigabitEthernet0/0/4] port default vlan 10</span><br><span class="line">[SA-GigabitEthernet0/0/4] quit</span><br><span class="line">[SA] interface g 0/0/5</span><br><span class="line">[SA-GigabitEthernet0/0/5] port link-type access</span><br><span class="line">[SA-GigabitEthernet0/0/5] port defalut vlan 20</span><br><span class="line">[SA-GigabitEthernet0/0/5] quit</span><br><span class="line">[SA] interface Eth-Trunk 1</span><br><span class="line">[SA-Eth-Trunk1]port link-type trunk</span><br><span class="line">[SA-Eth-Trunk1]port trunk allow-pass vlan 10 20</span><br><span class="line">[SA-Eth-Trunk1]load-balance src-dst-mac</span><br><span class="line">[SA-Eth-Trunk1]quit</span><br><span class="line">[SA] display eth-trunk 1</span><br><span class="line">[SA]port-group 1</span><br><span class="line">[SA-port-group-1]group-member g 0/0/1 to g 0/0/3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">switchb 配置同switcha</span><br></pre></td></tr></table></figure><h2 id="链路聚合LACP"><a href="#链路聚合LACP" class="headerlink" title="链路聚合LACP"></a>链路聚合LACP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;system-view</span><br><span class="line">Enter system view, return user view with Ctrl+Z.</span><br><span class="line">[Huawei]sysname SA</span><br><span class="line">[SA]interface eth-trunk 1</span><br><span class="line">[SA-Eth-Trunk1]mode lacp</span><br><span class="line">[SA-Eth-Trunk1]quit</span><br><span class="line">[SA]interface g 0/0/1</span><br><span class="line">[SA-GigabitEthernet0/0/1]eth-trunk 1</span><br><span class="line">[SA-GigabitEthernet0/0/1]quit</span><br><span class="line">[SA]interface g 0/0/2</span><br><span class="line">[SA-GigabitEthernet0/0/2]eth-trunk 1</span><br><span class="line">[SA-GigabitEthernet0/0/2]quit</span><br><span class="line">[SA]interface g 0/0/3</span><br><span class="line">[SA-GigabitEthernet0/0/3]eth-trunk 1</span><br><span class="line">[SA-GigabitEthernet0/0/3]quit</span><br><span class="line">[SA]lacp priority 100</span><br><span class="line">[SA]interface eth-trunk 1</span><br><span class="line">[SA-Eth-Trunk1]max active-linknumber 2</span><br><span class="line">[SA-Eth-Trunk1]quit</span><br><span class="line">[SA]interface g 0/0/1</span><br><span class="line">[SA-GigabitEthernet0/0/1]lacp priority 100</span><br><span class="line">[SA-GigabitEthernet0/0/1]quit</span><br><span class="line">[SA]interface g 0/0/2</span><br><span class="line">[SA-GigabitEthernet0/0/2]lacp priority 100</span><br><span class="line">[SA-GigabitEthernet0/0/2]quit</span><br><span class="line">[SB]dis eth-trunk 1</span><br><span class="line">Eth-Trunk1&apos;s state information is:</span><br><span class="line">Local:</span><br><span class="line">LAG ID: 1                   WorkingMode: STATIC                               </span><br><span class="line">Preempt Delay: Disabled     Hash arithmetic: According to SIP-XOR-DIP         </span><br><span class="line">System Priority: 32768      System ID: 4c1f-ccf4-4162                         </span><br><span class="line">Least Active-linknumber: 1  Max Active-linknumber: 2                          </span><br><span class="line">Operate status: up          Number Of Up Port In Trunk: 2                     </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ActorPortName          Status   PortType PortPri PortNo PortKey PortState Weight</span><br><span class="line">GigabitEthernet0/0/1   Selected 1000TG   100     2      401     10111100  1     </span><br><span class="line">GigabitEthernet0/0/2   Selected 1000TG   100     3      401     10111100  1     </span><br><span class="line">GigabitEthernet0/0/3   Unselect 1000TG   32768   4      401     10100000  1     </span><br><span class="line"></span><br><span class="line">Partner:</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ActorPortName          SysPri   SystemID        PortPri PortNo PortKey PortState</span><br><span class="line">GigabitEthernet0/0/1   100      4c1f-cce3-2653  100     2      401     10111100</span><br><span class="line">GigabitEthernet0/0/2   100      4c1f-cce3-2653  100     3      401     10111100</span><br><span class="line">GigabitEthernet0/0/3   100      4c1f-cce3-2653  32768   4      401     10100000</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">[SA]display eth-trunk 1</span><br><span class="line">Eth-Trunk1&apos;s state information is:</span><br><span class="line">Local:</span><br><span class="line">LAG ID: 1                   WorkingMode: STATIC                               </span><br><span class="line">Preempt Delay: Disabled     Hash arithmetic: According to SIP-XOR-DIP         </span><br><span class="line">System Priority: 100        System ID: 4c1f-cce3-2653                         </span><br><span class="line">Least Active-linknumber: 1  Max Active-linknumber: 2                          </span><br><span class="line">Operate status: up          Number Of Up Port In Trunk: 2                     </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ActorPortName          Status   PortType PortPri PortNo PortKey PortState Weight</span><br><span class="line">GigabitEthernet0/0/1   Selected 1000TG   100     2      401     10111100  1     </span><br><span class="line">GigabitEthernet0/0/2   Selected 1000TG   100     3      401     10111100  1     </span><br><span class="line">GigabitEthernet0/0/3   Unselect 1000TG   32768   4      401     10100000  1     </span><br><span class="line"></span><br><span class="line">Partner:</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ActorPortName          SysPri   SystemID        PortPri PortNo PortKey PortState</span><br><span class="line">GigabitEthernet0/0/1   32768    4c1f-ccf4-4162  100     2      401     10111100</span><br><span class="line">GigabitEthernet0/0/2   32768    4c1f-ccf4-4162  100     3      401     10111100</span><br><span class="line">GigabitEthernet0/0/3   32768    4c1f-ccf4-4162  32768   4      401     10100000</span><br></pre></td></tr></table></figure><h2 id="ARP配置三则"><a href="#ARP配置三则" class="headerlink" title="ARP配置三则"></a>ARP配置三则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">VLAN间</span><br><span class="line"></span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch</span><br><span class="line">[Switch] vlan batch 2</span><br><span class="line">[Switch] interface gigabitethernet 0/0/1</span><br><span class="line">[Switch-GigabitEthernet0/0/1] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/1] port default vlan 2</span><br><span class="line">[Switch-GigabitEthernet0/0/1] quit</span><br><span class="line">[Switch] interface gigabitethernet 0/0/2</span><br><span class="line">[Switch-GigabitEthernet0/0/2] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/2] port default vlan 2</span><br><span class="line">[Switch-GigabitEthernet0/0/2] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] vlan batch 3</span><br><span class="line">[Switch] interface gigabitethernet 0/0/3</span><br><span class="line">[Switch-GigabitEthernet0/0/3] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/3] port default vlan 3</span><br><span class="line">[Switch-GigabitEthernet0/0/3] quit</span><br><span class="line">[Switch] interface gigabitethernet 0/0/4</span><br><span class="line">[Switch-GigabitEthernet0/0/4] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/4] port default vlan 3</span><br><span class="line">[Switch-GigabitEthernet0/0/4] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] vlan 4</span><br><span class="line">[Switch-vlan4] aggregate-vlan</span><br><span class="line">[Switch-vlan4] access-vlan 2</span><br><span class="line">[Switch-vlan4] access-vlan 3</span><br><span class="line">[Switch-vlan4] quit</span><br><span class="line">[Switch] interface vlanif 4</span><br><span class="line">[Switch-Vlanif4] ip address 10.10.10.1 24</span><br><span class="line">[Switch-Vlanif4] arp-proxy inter-sub-vlan-proxy enable</span><br><span class="line">[Switch-Vlanif4] quit</span><br><span class="line">#配置Host_1的IP地址为10.10.10.2/24。</span><br><span class="line">#配置Host_2的IP地址为10.10.10.3/24。</span><br><span class="line">#配置Host_3的IP地址为10.10.10.4/24。</span><br><span class="line">#配置Host_4的IP地址为10.10.10.5/24。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] display arp interface vlanif 4</span><br><span class="line">IP ADDRESS      MAC ADDRESS     EXPIRE(M) TYPE        INTERFACE   VPN-INSTANCE                                                      </span><br><span class="line">                                          VLAN/CEVLAN                                                                               </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">10.10.10.1      101b-5441-5bf6            I -         Vlanif4                                                                     </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">Total:1         Dynamic:0       Static:0     Interface:1</span><br><span class="line"></span><br><span class="line">C:\Documents and Settings\Administrator&gt; ping 10.10.10.4</span><br><span class="line">Pinging 10.10.10.4 with 32 bytes of data:</span><br><span class="line">Reply from 10.10.10.4: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.4: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.4: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.4: bytes=32 time&lt;1ms TTL=128</span><br><span class="line"></span><br><span class="line">Ping statistics for 10.10.10.4:</span><br><span class="line">    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),</span><br><span class="line">Approximate round trip times in milli-seconds:</span><br><span class="line">    Minimum = 0ms, Maximum = 0ms, Average = 0ms</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VLAN内</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch</span><br><span class="line">[Switch] vlan batch 2</span><br><span class="line">[Switch] interface gigabitethernet 0/0/1</span><br><span class="line">[Switch-GigabitEthernet0/0/1] port-isolate enable</span><br><span class="line">[Switch-GigabitEthernet0/0/1] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/1] port default vlan 2</span><br><span class="line">[Switch-GigabitEthernet0/0/1] quit</span><br><span class="line">[Switch] interface gigabitethernet 0/0/2</span><br><span class="line">[Switch-GigabitEthernet0/0/2] port-isolate enable</span><br><span class="line">[Switch-GigabitEthernet0/0/2] port link-type access</span><br><span class="line">[Switch-GigabitEthernet0/0/2] port default vlan 2</span><br><span class="line">[Switch-GigabitEthernet0/0/2] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] vlan 3</span><br><span class="line">[Switch-vlan3] aggregate-vlan</span><br><span class="line">[Switch-vlan3] access-vlan 2</span><br><span class="line">[Switch-vlan3] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] interface vlanif 3</span><br><span class="line">[Switch-Vlanif3] ip address 10.10.10.1 24</span><br><span class="line">[Switch-Vlanif3] arp-proxy inner-sub-vlan-proxy enable</span><br><span class="line">[Switch-Vlanif3] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#配置Host_1的IP地址为10.10.10.3/24。</span><br><span class="line">#配置Host_2的IP地址为10.10.10.2/24。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Switch] display arp interface vlanif 3</span><br><span class="line">IP ADDRESS      MAC ADDRESS     EXPIRE(M) TYPE        INTERFACE   VPN-INSTANCE                                                      </span><br><span class="line">                                          VLAN/CEVLAN                                                                               </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">10.10.10.1      101b-5441-5bf6            I -         Vlanif3                                                                     </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">Total:1         Dynamic:0       Static:0     Interface:1  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Documents and Settings\Administrator&gt; ping 10.10.10.2</span><br><span class="line">Pinging 10.10.10.2 with 32 bytes of data:</span><br><span class="line">Reply from 10.10.10.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 10.10.10.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line"></span><br><span class="line">Ping statistics for 10.10.10.2:</span><br><span class="line">    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),</span><br><span class="line">Approximate round trip times in milli-seconds:</span><br><span class="line">    Minimum = 0ms, Maximum = 0ms, Average = 0ms</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">路由式 ， 路由可达，如果开启arp-proxy数据包就会送到三层去处理，子网掩码会在计算机系统中起作用，子网掩码需要仔细理解他只会限制自己的网卡的意思。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.创建VLAN，将接口加入VLAN，并配置接口的IP地址 </span><br><span class="line"></span><br><span class="line"># 配置Switch_1。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch_1</span><br><span class="line">[Switch_1] vlan batch 10</span><br><span class="line">[Switch_1] interface gigabitethernet 0/0/1</span><br><span class="line">[Switch_1-GigabitEthernet0/0/1] port link-type access</span><br><span class="line">[Switch_1-GigabitEthernet0/0/1] port default vlan 10</span><br><span class="line">[Switch_1-GigabitEthernet0/0/1] quit</span><br><span class="line">[Switch_1] interface vlanif 10</span><br><span class="line">[Switch_1-Vlanif10] ip address 172.16.1.1 24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 配置Switch_2。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname Switch_2</span><br><span class="line">[Switch_2] vlan batch 20</span><br><span class="line">[Switch_2] interface gigabitethernet 0/0/1</span><br><span class="line">[Switch_2-GigabitEthernet0/0/1] port link-type access</span><br><span class="line">[Switch_2-GigabitEthernet0/0/1] port default vlan 20</span><br><span class="line">[Switch_2-GigabitEthernet0/0/1] quit</span><br><span class="line">[Switch_2] interface vlanif 20</span><br><span class="line">[Switch_2-Vlanif20] ip address 172.16.2.1 24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.配置路由式Proxy ARP </span><br><span class="line"></span><br><span class="line"># 配置Switch_1。</span><br><span class="line">[Switch_1-Vlanif10] arp-proxy enable</span><br><span class="line">[Switch_1-Vlanif10] quit</span><br><span class="line"></span><br><span class="line"># 配置Switch_2。</span><br><span class="line">[Switch_2-Vlanif20] arp-proxy enable</span><br><span class="line">[Switch_2-Vlanif20] quit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.验证配置结果 </span><br><span class="line"></span><br><span class="line"># 在Switch_1上查看VLANIF10接口的ARP表项，可以看到VLANIF10接口的IP地址对应的MAC地址。</span><br><span class="line">[Switch_1] display arp interface vlanif 10</span><br><span class="line">IP ADDRESS      MAC ADDRESS     EXPIRE(M) TYPE        INTERFACE   VPN-INSTANCE                                                      </span><br><span class="line">                                          VLAN/CEVLAN                                                                               </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">172.16.1.1      101b-5441-5bf6            I -         Vlanif10                                                                     </span><br><span class="line">------------------------------------------------------------------------------                                                      </span><br><span class="line">Total:1         Dynamic:0       Static:0     Interface:1  </span><br><span class="line"></span><br><span class="line"># 在子公司A选取一台主机Host_1（IP地址：172.16.1.2/16，操作系统以Windows 7为例），在子公司B选取一台主机Host_2（IP地址：172.16.2.2/16）。在主机Host_1上Ping主机Host_2的IP地址，可以Ping通。</span><br><span class="line">C:\Documents and Settings\Administrator&gt; ping 172.16.2.2</span><br><span class="line">Pinging 172.16.2.2 with 32 bytes of data:</span><br><span class="line">Reply from 172.16.2.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 172.16.2.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 172.16.2.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line">Reply from 172.16.2.2: bytes=32 time&lt;1ms TTL=128</span><br><span class="line"></span><br><span class="line">Ping statistics for 172.16.2.2:</span><br><span class="line">    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),</span><br><span class="line">Approximate round trip times in milli-seconds:</span><br><span class="line">    Minimum = 0ms, Maximum = 0ms, Average = 0ms</span><br><span class="line"></span><br><span class="line"># 在Host_1上查看ARP表，可以看到主机Host_2的IP地址对应的MAC地址是Switch_1的VLANIF10接口的MAC地址，可见Host_1和Host_2之间是通过ARP代理实现互通的。</span><br><span class="line">C:\Documents and Settings\Administrator&gt; arp -a</span><br><span class="line">Interface: 172.16.1.2 --- 0xd</span><br><span class="line">  Internet Address      Physical Address      Type</span><br><span class="line">  172.16.2.2            101b-5441-5bf6        dynamic</span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;switch+arp+链路聚合&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="switch" scheme="https://zixujing.github.io/categories/switch/"/>
    
    
      <category term="5700" scheme="https://zixujing.github.io/tags/5700/"/>
    
  </entry>
  
  <entry>
    <title>QINQ配置</title>
    <link href="https://zixujing.github.io/2019/10/22/switch/qinq%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/10/22/switch/qinq配置/</id>
    <published>2019-10-22T14:00:00.000Z</published>
    <updated>2019-10-22T14:30:03.192Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>QINQ配置<br><a id="more"></a></p></blockquote><h2 id="配置基本QinQ"><a href="#配置基本QinQ" class="headerlink" title="配置基本QinQ"></a>配置基本QinQ</h2><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><ul><li><ol><li>创建VLAN </li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#在SwitchA上创建VLAN100和VLAN200。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 100 200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在SwitchB上创建VLAN100和VLAN200。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchB</span><br><span class="line">[SwitchB] vlan batch 100 200</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>配置接口类型为QinQ </li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#在SwitchA上配置接口GE1/0/1、GE1/0/2的类型为QinQ，GE1/0/1的外层tag为VLAN100，GE1/0/2的外层tag为VLAN200。SwitchB的配置与SwitchA类似，不再赘述。</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/1</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port link-type dot1q-tunnel //配置接口的链路类型为QinQ</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port default vlan 100</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/2</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] port link-type dot1q-tunnel //配置接口的链路类型为QinQ</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] port default vlan 200</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] quit</span><br></pre></td></tr></table></figure><ul><li><ol start="3"><li>配置Switch连接公网侧的接口 </li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#在SwitchA上配置接口GE1/0/3加入VLAN100和VLAN200。SwitchB的配置与SwitchA类似，不再赘述。</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/3</span><br><span class="line">[SwitchA-GigabitEthernet1/0/3] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet1/0/3] port trunk allow-pass vlan 100 200</span><br><span class="line">[SwitchA-GigabitEthernet1/0/3] quit</span><br></pre></td></tr></table></figure><ul><li><ol start="4"><li>配置外层VLAN tag的TPID值 </li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 在SwitchA上配置外层VLAN tag的TPID值为0x9100。</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/3</span><br><span class="line">[SwitchA-GigabitEthernet1/0/3] qinq protocol 9100 //配置QinQ外层VLAN tag的TPID值为0x9100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在SwitchB上配置外层VLAN tag的TPID值为0x9100。</span><br><span class="line">[SwitchB] interface gigabitethernet 1/0/3</span><br><span class="line">[SwitchB-GigabitEthernet1/0/3] qinq protocol 9100 //配置QinQ外层VLAN tag的TPID值为0x9100</span><br></pre></td></tr></table></figure><ul><li><ol start="5"><li>验证配置结果 </li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">从企业1一处分支内任意VLAN的一台PC ping企业1另外一处分支同一VLAN内的PC，如果可以ping通则表示企业1内部可以互相通信。</span><br><span class="line"></span><br><span class="line">从企业2一处分支内任意VLAN的一台PC ping企业2另外一处分支同一VLAN内的PC，如果可以ping通则表示企业2内部可以互相通信。</span><br><span class="line"></span><br><span class="line">从企业1一处分支内任意VLAN的一台PC ping企业2任意一处分支同一VLAN内的PC，如果不能ping通则表示企业1和企业2之间相互隔离</span><br></pre></td></tr></table></figure><h2 id="灵活QinQ"><a href="#灵活QinQ" class="headerlink" title="灵活QinQ"></a>灵活QinQ</h2><p>基于VLAN ID的灵活QinQ功能可实现接口在接收到数据帧后，依据帧中不同VLAN ID添加不同的外层VLAN Tag。</p><h3 id="操作步骤-1"><a href="#操作步骤-1" class="headerlink" title="操作步骤"></a>操作步骤</h3><ul><li>1.创建VLAN </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 在SwitchA上创建VLAN2、VLAN3，即叠加后的外层VLAN。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 2 3</span><br><span class="line"></span><br><span class="line"># 在SwitchB上创建VLAN2、VLAN3，即叠加后的外层VLAN。</span><br><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchB</span><br><span class="line">[SwitchB] vlan batch 2 3</span><br></pre></td></tr></table></figure><ul><li>2.在接口上配置灵活QinQ </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 说明： </span><br><span class="line"></span><br><span class="line">对于盒式交换机需要在接口下执行qinq vlan-translation enable命令，使能接口VLAN转换功能。</span><br><span class="line"></span><br><span class="line"># 配置SwitchA的接口GE1/0/1。</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/1</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port link-type hybrid</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port hybrid untagged vlan 2 3  //配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Untagged方式通过接口</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port vlan-stacking vlan 100 stack-vlan 2  //配置内部VLAN Tag为100，并添加外层VLAN Tag为2</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] port vlan-stacking vlan 300 stack-vlan 3  //配置内部VLAN Tag为300，并添加外层VLAN Tag为3</span><br><span class="line">[SwitchA-GigabitEthernet1/0/1] quit</span><br><span class="line"></span><br><span class="line"># 配置SwitchB的接口GE1/0/1。</span><br><span class="line">[SwitchB] interface gigabitethernet 1/0/1</span><br><span class="line">[SwitchB-GigabitEthernet1/0/1] port link-type hybrid</span><br><span class="line">[SwitchB-GigabitEthernet1/0/1] port hybrid untagged vlan 2 3  //配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Untagged方式通过接口</span><br><span class="line">[SwitchB-GigabitEthernet1/0/1] port vlan-stacking vlan 100 stack-vlan 2  //配置内部VLAN为100，并添加外层VLAN为2</span><br><span class="line">[SwitchB-GigabitEthernet1/0/1] port vlan-stacking vlan 300 stack-vlan 3  //配置内部VLAN为300，并添加外层VLAN为3</span><br><span class="line">[SwitchB-GigabitEthernet1/0/1] quit</span><br></pre></td></tr></table></figure><ul><li>3.配置其它接口 </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 在SwitchA上配置接口GE1/0/2加入VLAN2、VLAN3。</span><br><span class="line">[SwitchA] interface gigabitethernet 1/0/2</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] port trunk allow-pass vlan 2 3</span><br><span class="line">[SwitchA-GigabitEthernet1/0/2] quit</span><br><span class="line"></span><br><span class="line"># 在SwitchB上配置接口GE1/0/2加入VLAN2、VLAN3</span><br><span class="line">[SwitchB] interface gigabitethernet 1/0/2</span><br><span class="line">[SwitchB-GigabitEthernet1/0/2] port link-type trunk</span><br><span class="line">[SwitchB-GigabitEthernet1/0/2] port trunk allow-pass vlan 2 3</span><br><span class="line">[SwitchB-GigabitEthernet1/0/2] quit</span><br></pre></td></tr></table></figure><ul><li>4.验证配置结果 </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">如果SwitchA、SwitchB上配置正确，则：</span><br><span class="line"></span><br><span class="line">•PC上网用户可以通过运营商网络互相通信。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">•VoIP用户可以通过运营商网络互相通信。</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;QINQ配置&lt;br&gt;
    
    </summary>
    
      <category term="switch" scheme="https://zixujing.github.io/categories/switch/"/>
    
    
      <category term="5700" scheme="https://zixujing.github.io/tags/5700/"/>
    
  </entry>
  
  <entry>
    <title>交换机登录配置</title>
    <link href="https://zixujing.github.io/2019/10/22/switch/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/10/22/switch/交换机登录配置/</id>
    <published>2019-10-22T08:00:00.000Z</published>
    <updated>2019-10-22T14:05:06.309Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>交换机登录配置<br><a id="more"></a></p></blockquote><h2 id="添加console密码"><a href="#添加console密码" class="headerlink" title="添加console密码"></a>添加console密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] user-interface console 0</span><br><span class="line">[HUAWEI-ui-console0] authentication-mode aaa</span><br><span class="line">[HUAWEI-ui-console0] quit</span><br><span class="line">[HUAWEI] aaa</span><br><span class="line">[HUAWEI-aaa] local-user admin password simple admin@123</span><br><span class="line">[HUAWEI-aaa] local-user admin service-type terminal</span><br><span class="line">[Huawei-aaa] local-user admin privilege level 15</span><br></pre></td></tr></table></figure><h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI]command-privilege level rearrange  批量提升命令等级</span><br><span class="line">&lt;Huawei&gt;reset saved-configuration 出厂设置</span><br></pre></td></tr></table></figure><h2 id="telnet配置"><a href="#telnet配置" class="headerlink" title="telnet配置"></a>telnet配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Switch] telnet server enable    //使能Telnet功能。</span><br><span class="line">[Switch] user-interface vty 0 4    //进入VTY 0～VTY 4用户界面视图。</span><br><span class="line">[Switch-ui-vty0-4] user privilege level 15    //配置VTY 0～VTY 4的用户级别为15级。</span><br><span class="line">[Switch-ui-vty0-4] authentication-mode aaa    //配置VTY 0～VTY 4的用户认证方式为AAA认证。</span><br><span class="line">[Switch-ui-vty0-4] quit</span><br><span class="line">[Switch] aaa</span><br><span class="line">[Switch-aaa] local-user admin123 password irreversible-cipher Huawei@6789    //创建名为admin123的本地用户，设置其登录密码为Huawei@6789。V200R003之前的版本，不支持irreversible-cipher，仅支持cipher关键字。</span><br><span class="line">[Switch-aaa] local-user admin123 privilege level 15    //配置用户级别为15级。</span><br><span class="line">[Switch-aaa] local-user admin123 service-type telnet    //配置接入类型为telnet，即：Telnet用户。</span><br><span class="line">[Switch-aaa] quit</span><br></pre></td></tr></table></figure><h2 id="管理ip"><a href="#管理ip" class="headerlink" title="管理ip"></a>管理ip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Switch] vlan 10</span><br><span class="line">[Switch-vlan10]  interface vlanif 10    //配置VLANIF10作为管理接口。</span><br><span class="line">[Switch-Vlanif10] ip address 10.1.1.1 24</span><br><span class="line">[Switch-Vlanif10] quit</span><br><span class="line">[Switch] interface gigabitethernet 0/0/10    //GE0/0/10为使用Web网管登录Switch的PC与Switch相连的物理接口编号，请按照实际现网情况进行选择。</span><br><span class="line">[Switch-GigabitEthernet0/0/10] port link-type access    //配置接口类型为access。</span><br><span class="line">[Switch-GigabitEthernet0/0/10] port default vlan 10    //配置接口GE0/0/10加入VLAN 10。</span><br><span class="line">[Switch-GigabitEthernet0/0/10] quit</span><br></pre></td></tr></table></figure><h1 id="stelnet配置"><a href="#stelnet配置" class="headerlink" title="stelnet配置"></a>stelnet配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] aaa</span><br><span class="line">[Huawei-aaa] local-user admin password simple admin@123</span><br><span class="line">[HUAWEI-aaa] local-user admin service-type ssh</span><br><span class="line">[Huawei-aaa] local-user admin privilege level 15</span><br><span class="line"></span><br><span class="line">[Huawei]user-interface vty 0 4</span><br><span class="line">[Huawei-ui-vty0-4]user privilege level 15</span><br><span class="line">[Huawei-ui-vty0-4]authentication-mode aaa</span><br><span class="line">[Huawei-ui-vty0-4]protocol inbound ssh</span><br><span class="line">[Huawei-ui-vty0-4]shell</span><br><span class="line"></span><br><span class="line">[Huawei]ssh user admin authentication-type password</span><br><span class="line">[Huawei]ssh user admin service-type stelnet</span><br><span class="line"></span><br><span class="line">[Huawei]dis ssh server status</span><br><span class="line">[Huawei]stelnet server enable</span><br><span class="line">[Huawei]ssh client first-time enable 如果是在交换机上登录那么第一次执行这个，允许使用ssh client</span><br><span class="line">[Huawei]stelnet 127.0.0.1 </span><br><span class="line">而telnet是在&lt;Huawei&gt;telnet 127.0.0.1 下，注意两者的区别和目的</span><br><span class="line"></span><br><span class="line">[Huawei]vlan batch 10</span><br><span class="line">[Huawei]interface vlan 10</span><br><span class="line">[Huawei]ip address 192.168.1.1 24</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;交换机登录配置&lt;br&gt;
    
    </summary>
    
      <category term="switch" scheme="https://zixujing.github.io/categories/switch/"/>
    
    
      <category term="5700" scheme="https://zixujing.github.io/tags/5700/"/>
    
  </entry>
  
  <entry>
    <title>IP报文</title>
    <link href="https://zixujing.github.io/2019/10/15/linux/linux%E8%99%9A%E6%8B%9F%E5%8C%96/IP/"/>
    <id>https://zixujing.github.io/2019/10/15/linux/linux虚拟化/IP/</id>
    <published>2019-10-14T18:00:00.000Z</published>
    <updated>2019-10-22T14:05:06.300Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>IP报文</p></blockquote><a id="more"></a><h2 id="IP报文"><a href="#IP报文" class="headerlink" title="IP报文"></a>IP报文</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|**4*b***|***4b***|******8b********|**3b**|*******13b*********|</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">|*Version|**IHL***|*Type*of*Service|**********Total*Lengeth***|</span><br><span class="line">|*******Identification*************|Flags*|FragmentationOffset|</span><br><span class="line">|**Time*To*Live***|*Protocol*******|***Header*Checksum********|</span><br><span class="line">|*******************Source*Address****************************|</span><br><span class="line">|***********************Destionation*Address******************|</span><br><span class="line">|**********Options*************************|**Padding*********|</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">|****************data*****************************************|</span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><ul><li>0100 ipv4</li><li>0110 ipV6<h2 id="IHL-Internet-Header-Length-ip表头长度"><a href="#IHL-Internet-Header-Length-ip表头长度" class="headerlink" title="IHL(Internet Header Length ip表头长度)"></a>IHL(Internet Header Length ip表头长度)</h2></li><li>IHL最大是60（字节），IHL最小是20（字节）</li></ul><h2 id="Type-of-Service服务类型"><a href="#Type-of-Service服务类型" class="headerlink" title="Type of Service服务类型"></a>Type of Service服务类型</h2><ul><li>O:3位优先权字段(现已被忽略)</li><li>O:3位优先权字段(现已被忽略)</li><li>O:3位优先权字段(现已被忽略)</li><li>D：若为 0 表示一般延迟(delay)，若为 1 表示为低延迟；</li><li>T：若为 0 表示为一般传输量 (throughput)，若为 1 表示为高传输量；</li><li>R：若为 0 表示为一般可靠度(reliability)，若为 1 表示高可靠度。</li><li>M: 传输成本：0：普通，1：成本尽量小</li><li>O: 最后一位被保留，恒定为 0</li></ul><h2 id="Total-Length-总长度"><a href="#Total-Length-总长度" class="headerlink" title="Total Length(总长度)"></a>Total Length(总长度)</h2><ul><li>指这个IP 封包的总容量，包括表头与内容 (Data) 部分。最大可达 65535 bytes<h2 id="Identification-标识符"><a href="#Identification-标识符" class="headerlink" title="Identification(标识符)"></a>Identification(标识符)</h2></li><li>唯一的标识主机发送的报文。IP软件在储存器中维护一个计数器，每产生一个数据报，计数器就+1，并将此值赋值给标识字段。当数据报长度超过网络的MTU而必须分片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。</li></ul><h2 id="Flag-分片标志"><a href="#Flag-分片标志" class="headerlink" title="Flag(分片标志)"></a>Flag(分片标志)</h2><p>0： 不可用<br>D（DF）：若为 0 表示可以分片，若为 1 表示不可分片，不让路由器做分片处理。<br>M（MF）：若为 0 表示此 IP 为最后分片，若为 1 表示非最后分片。</p><h2 id="Fragment-Offset-片偏移"><a href="#Fragment-Offset-片偏移" class="headerlink" title="Fragment Offset(片偏移)"></a>Fragment Offset(片偏移)</h2><ul><li><p>较长的报文在分片之后，某片在原报文中的相对位置。片偏移以8字节为单位，这就是说除了最后一个分片，每个分片的长度是8字节的整数倍。</p><h2 id="Time-To-Live-生存周期"><a href="#Time-To-Live-生存周期" class="headerlink" title="Time To Live(生存周期)"></a>Time To Live(生存周期)</h2></li><li><p>表示这个 IP 封包的存活时间，范围为 0-255。当这个 IP 封包通过一个路由器时， TTL 就会减一，当 TTL 为 0 时，这个封包将会被直接丢弃。说实在的，要让 IP 封包通过 255 个路由器，还挺难的。</p><h2 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h2></li><li><p>通过协议号标识上层使用的是哪一层协议，常用的协议号有：TCP=6，UDP=17，ICMP=1，IGMP=2，IP=4，EGP=8，IPV6=41</p><h2 id="Header-Checksum"><a href="#Header-Checksum" class="headerlink" title="Header Checksum"></a>Header Checksum</h2></li><li><p>☻</p><h2 id="Source-Address"><a href="#Source-Address" class="headerlink" title="Source Address"></a>Source Address</h2></li><li><p>☻</p><h2 id="Destination-Adress"><a href="#Destination-Adress" class="headerlink" title="Destination Adress"></a>Destination Adress</h2></li><li><p>☻</p><h2 id="Options-其他参数"><a href="#Options-其他参数" class="headerlink" title="Options (其他参数)"></a>Options (其他参数)</h2></li><li><p>☻</p><h2 id="Padding-补齐项目"><a href="#Padding-补齐项目" class="headerlink" title="Padding(补齐项目)"></a>Padding(补齐项目)</h2></li><li><p>☻</p></li></ul><h2 id="ETHERTYPE"><a href="#ETHERTYPE" class="headerlink" title="ETHERTYPE"></a>ETHERTYPE</h2><ul><li>6B 源MAC</li><li>6B 目标MAC</li><li>2B 协议如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0x0000 - 0x05DC   IEEE 802.3 长度</span><br><span class="line">0x0101 – 0x01FF   实验</span><br><span class="line">0x0600   XEROX NS IDP</span><br><span class="line">0x0661   DLOG</span><br><span class="line">0x0800   网际协议（IP）</span><br><span class="line">0x0801   X.75 Internet</span><br><span class="line">0x0802   NBS Internet</span><br><span class="line">0x0803   ECMA Internet</span><br><span class="line">0x0804   Chaosnet</span><br><span class="line">0x0805   X.25 Level 3</span><br><span class="line">0x0806   地址解析协议（ARP ： Address Resolution Protocol）</span><br><span class="line">0x0808   帧中继 ARP （Frame Relay ARP） [RFC1701]</span><br><span class="line">0x6559   原始帧中继（Raw Frame Relay） [RFC1701]</span><br><span class="line">0x8035   动态 DARP （DRARP：Dynamic RARP）反向地址解析协议（RARP：Reverse Address Resolution Protocol）</span><br><span class="line">0x8037   Novell Netware IPX</span><br><span class="line">0x809B   EtherTalk</span><br><span class="line">0x80D5   IBM SNA Services over Ethernet</span><br><span class="line">0x80F3   AppleTalk 地址解析协议（AARP：AppleTalk Address Resolution Protocol）</span><br><span class="line">0x8100   以太网自动保护开关（EAPS：Ethernet Automatic Protection Switching）</span><br><span class="line">0x8137   因特网包交换（IPX：Internet Packet Exchange）</span><br><span class="line">0x814C   简单网络管理协议（SNMP：Simple Network Management Protocol）</span><br><span class="line">0x86DD   网际协议v6 （IPv6，Internet Protocol version 6）</span><br><span class="line">0x880B   点对点协议（PPP：Point-to-Point Protocol）</span><br><span class="line">0x880C   通用交换管理协议（GSMP：General Switch Management Protocol）</span><br><span class="line">0x8847   多协议标签交换（单播） MPLS：Multi-Protocol Label Switching &lt;unicast&gt;）</span><br><span class="line">0x8848   多协议标签交换（组播）（MPLS, Multi-Protocol Label Switching &lt;multicast&gt;）</span><br><span class="line">0x8863   以太网上的 PPP（发现阶段）（PPPoE：PPP Over Ethernet &lt;Discovery Stage&gt;）</span><br><span class="line">0x8864   以太网上的 PPP（PPP 会话阶段）（PPPoE，PPP Over Ethernet&lt;PPP Session Stage&gt;）</span><br><span class="line"></span><br><span class="line">0X888E   认证</span><br><span class="line">0X88C7   预认证</span><br><span class="line">0x88BB   轻量级访问点协议（LWAPP：Light Weight Access Point Protocol）</span><br><span class="line">0x88CC   链接层发现协议（LLDP：Link Layer Discovery Protocol）</span><br><span class="line">0x8E88   局域网上的 EAP（EAPOL：EAP over LAN）</span><br><span class="line">0x9000   配置测试协议（Loopback）</span><br><span class="line">0x9100   VLAN 标签协议标识符（VLAN Tag Protocol Identifier）</span><br><span class="line">0x9200   VLAN 标签协议标识符（VLAN Tag Protocol Identifier）</span><br><span class="line">0xFFFF   保留</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;IP报文&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="虚拟化" scheme="https://zixujing.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>mpp配置</title>
    <link href="https://zixujing.github.io/2019/10/11/db/postgresql/mpp%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/10/11/db/postgresql/mpp配置/</id>
    <published>2019-10-10T17:00:00.000Z</published>
    <updated>2019-10-11T05:58:37.317Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mpp配置</p></blockquote><a id="more"></a><h2 id="bireme"><a href="#bireme" class="headerlink" title="bireme"></a>bireme</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost etc]# pwd</span><br><span class="line">/opt/bireme-2.0.0-alpha-1/etc</span><br><span class="line">[root@localhost etc]# ls</span><br><span class="line">config.properties  config.properties.bak  debezium1.properties  kafka_client_jaas.conf  log4j2.xml  maxwell1.properties  mysql.propertie</span><br><span class="line">[root@localhost etc]# cat config.properties</span><br><span class="line"># target database where the data will sync into.</span><br><span class="line">target.url = jdbc:postgresql://10.24.70.135:5432/hchdata</span><br><span class="line">target.user = gpadmin</span><br><span class="line">target.passwd = gpadmin</span><br><span class="line"></span><br><span class="line"># data source name list, separated by comma.</span><br><span class="line">data_source = mysql</span><br><span class="line"></span><br><span class="line"># data source &quot;mysql1&quot; type</span><br><span class="line">mysql.type = maxwell</span><br><span class="line"># kafka server which maxwell write binlog into.</span><br><span class="line">mysql.kafka.server = 10.24.70.127:9092,10.24.70.128:9092,10.24.70.134:9092</span><br><span class="line"># kafka topic which maxwell write binlog into.</span><br><span class="line">mysql.kafka.topic = maxwell</span><br><span class="line"># kafka groupid used for consumer.</span><br><span class="line">mysql.kafka.groupid = bireme</span><br><span class="line">mysql.kafka.security.protocol=SASL_PLAINTEXT</span><br><span class="line">mysql.kafka.sasl.mechanism=PLAIN</span><br><span class="line"># data source &quot;debezium1&quot;</span><br><span class="line">#debezium1.type = debezium</span><br><span class="line"># kafka server which debezium write into.</span><br><span class="line">#debezium1.kafka.server = 127.0.0.1:9092 </span><br><span class="line"># kafka groupid used for consumer.</span><br><span class="line">#debezium1.kafka.groupid = bireme</span><br><span class="line"></span><br><span class="line"># number of threads used for pipeline to drive the porcess</span><br><span class="line">pipeline.thread_pool.size = 5</span><br><span class="line"></span><br><span class="line"># number of threads used to transform data source record into target format.</span><br><span class="line">transform.thread_pool.size = 10</span><br><span class="line"></span><br><span class="line"># number of threads used to generate load tasks.</span><br><span class="line">merge.thread_pool.size = 10</span><br><span class="line"># interval of generating a load task in milliseconds.</span><br><span class="line">merge.interval = 10000</span><br><span class="line"># max tuple size for a load task</span><br><span class="line">merge.batch.size = 50000</span><br><span class="line"></span><br><span class="line"># JDBC connection pool size of target database.</span><br><span class="line">loader.conn_pool.size = 10</span><br><span class="line"># queue size of task for each table which is waiting for load.</span><br><span class="line">loader.task_queue.size = 2</span><br><span class="line"></span><br><span class="line"># application performance monitor report type: &quot;none&quot;, &quot;console&quot;, &quot;jmx&quot;</span><br><span class="line">metrics.reporter=jmx</span><br><span class="line"># interval of console APM reporter.</span><br><span class="line">metrics.reporter.console.interval = 10</span><br><span class="line"></span><br><span class="line"># set the IP address for bireme state server.</span><br><span class="line">state.server.addr = 0.0.0.0</span><br><span class="line"># set the port for bireme state server.</span><br><span class="line">state.server.port = 8080</span><br><span class="line"></span><br><span class="line">[root@localhost etc]# cat mysql.properties </span><br><span class="line">infoveriplatform.tb_car_record=public.tb_car_record</span><br><span class="line">infoveriplatform.tb_control_car=public.tb_control_car</span><br><span class="line">infoveriplatform.tb_control_person=public.tb_control_person</span><br><span class="line">infoveriplatform.tb_key_car_record=public.tb_key_car_record</span><br><span class="line">infoveriplatform.tb_key_person_record=public.tb_key_person_record</span><br><span class="line">infoveriplatform.tb_person_record=public.tb_person_record</span><br><span class="line">infoveriplatform.tb_security_clearance=public.tb_security_clearance</span><br><span class="line">infoveriplatform.sys_dept=public.sys_dept</span><br><span class="line">infoveriplatform.tb_client_device=public.tb_client_device</span><br><span class="line">[root@localhost etc]# vi mysql.properties </span><br><span class="line">[root@localhost etc]# cat mysql.properties </span><br><span class="line">infoveriplatform.tb_car_record=public.tb_car_record</span><br><span class="line">infoveriplatform.tb_control_car=public.tb_control_car</span><br><span class="line">infoveriplatform.tb_control_person=public.tb_control_person</span><br><span class="line">infoveriplatform.tb_key_car_record=public.tb_key_car_record</span><br><span class="line">infoveriplatform.tb_key_person_record=public.tb_key_person_record</span><br><span class="line">infoveriplatform.tb_person_record=public.tb_person_record</span><br><span class="line">infoveriplatform.tb_security_clearance=public.tb_security_clearance</span><br><span class="line">infoveriplatform.sys_dept=public.sys_dept</span><br><span class="line">infoveriplatform.tb_client_device=public.tb_client_device</span><br><span class="line">infoveriplatform.tb_face_record=public.tb_face_record</span><br><span class="line">[root@localhost etc]# cat kafka_client_jaas.conf </span><br><span class="line">KafkaClient&#123;</span><br><span class="line">  org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">  username=&quot;admin&quot;</span><br><span class="line">  password=&quot;admin@123&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[root@localhost bireme-2.0.0-alpha-1]# cd bin</span><br><span class="line">[root@localhost bin]# ls</span><br><span class="line">bireme</span><br><span class="line">[root@localhost bin]# cat bireme </span><br><span class="line">#!/usr/bin/env bash</span><br><span class="line"># Copyright HashData. All Rights Reserved.</span><br><span class="line">NAME=&quot;bireme&quot;</span><br><span class="line">DESC=&quot;bireme service&quot;</span><br><span class="line">BINDIR=&quot;$(cd &quot;$(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;)&quot; &amp;&amp; pwd)&quot;</span><br><span class="line">TOPDIR=&quot;$(cd &quot;$(dirname &quot;$&#123;BINDIR&#125;&quot;)&quot; &amp;&amp; pwd)&quot;</span><br><span class="line"></span><br><span class="line">EXEC=&quot;$(which jsvc)&quot;</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;EXEC&#125;&quot; ]; then</span><br><span class="line">  echo &apos;command &quot;jsvc&quot; is not found.&apos; &gt;&amp;2</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$&#123;JAVA_HOME&#125;&quot; ]; then</span><br><span class="line">  echo &apos;&quot;JAVA_HOME&quot; is not set.&apos; &gt;&amp;2</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">CLASS_PATH=&quot;$&#123;TOPDIR&#125;/lib/*&quot;</span><br><span class="line"></span><br><span class="line">CLASS=&quot;cn.hashdata.bireme.Bireme&quot;</span><br><span class="line"></span><br><span class="line">CMD=$1</span><br><span class="line"></span><br><span class="line">shift</span><br><span class="line"></span><br><span class="line">ARGS=&quot;$*&quot;</span><br><span class="line">PID=&quot;/tmp/$NAME.pid&quot;</span><br><span class="line"></span><br><span class="line"># System.out writes to this file...</span><br><span class="line">LOG_OUT=&quot;$&#123;TOPDIR&#125;/logs/$NAME.out&quot;</span><br><span class="line"></span><br><span class="line"># System.err writes to this file...</span><br><span class="line">LOG_ERR=&quot;$&#123;TOPDIR&#125;/logs/$NAME.err&quot;</span><br><span class="line"></span><br><span class="line">HEAP_DUMP=&quot;$&#123;TOPDIR&#125;/logs/$NAME.heapdump&quot;</span><br><span class="line"></span><br><span class="line">LOG_GC=&quot;$&#123;TOPDIR&#125;/logs/$NAME.gc&quot;</span><br><span class="line"></span><br><span class="line"># See the following page for extensive details on setting</span><br><span class="line"># up the JVM to accept JMX remote management:</span><br><span class="line"># http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html</span><br><span class="line"># by default we allow local JMX connections</span><br><span class="line"></span><br><span class="line">println() &#123;</span><br><span class="line">  if [ &quot;$CMD&quot; = &quot;start&quot; ]</span><br><span class="line">  then</span><br><span class="line">    echo &quot;$1&quot; &gt;&amp;2</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$JXM_LOCALONLY&quot; ]</span><br><span class="line">then</span><br><span class="line">    JXM_LOCALONLY=false</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$JMX_DISABLE&quot; ] || [ &quot;$JMX_DISABLE&quot; = &apos;false&apos; ]</span><br><span class="line">then</span><br><span class="line">  println &quot;Bireme JMX enabled by default&quot; &gt;&amp;2</span><br><span class="line">  if [ -z &quot;$JMX_PORT&quot; ]</span><br><span class="line">  then</span><br><span class="line">    JMX=&quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=$JXM_LOCALONLY&quot;</span><br><span class="line">  else</span><br><span class="line">    if [ -z &quot;$JMX_AUTH&quot; ]</span><br><span class="line">    then</span><br><span class="line">      JMX_AUTH=false</span><br><span class="line">    fi</span><br><span class="line">    if [ -z &quot;$JMX_SSL&quot; ]</span><br><span class="line">    then</span><br><span class="line">      JMX_SSL=false</span><br><span class="line">    fi</span><br><span class="line">    if [ -z &quot;$JMX_LOG4J&quot; ]</span><br><span class="line">    then</span><br><span class="line">      JMX_LOG4J=true</span><br><span class="line">    fi</span><br><span class="line">    println &quot;Bireme remote JMX Port set to $JMX_PORT&quot; &gt;&amp;2</span><br><span class="line">    println &quot;Bireme remote JMX authenticate set to $JMX_AUTH&quot; &gt;&amp;2</span><br><span class="line">    println &quot;Bireme remote JMX ssl set to $JMX_SSL&quot; &gt;&amp;2</span><br><span class="line">    println &quot;Bireme remote JMX log4j set to $JMX_LOG4J&quot; &gt;&amp;2</span><br><span class="line">    JMX=&quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=$JMX_PORT -Dcom.sun.management.jmxremote.authenticate=$JMX_AUTH -Dcom.sun.management.jmxremote.ssl=$JMX_SSL -Dzookeeper.jmx.log4j.disable=$JMX_LOG4J&quot;</span><br><span class="line">  fi</span><br><span class="line">else</span><br><span class="line">    println &quot;JMX disabled by user request&quot; &gt;&amp;2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$MAX_HEAP&quot; ]</span><br><span class="line">then</span><br><span class="line">  println &quot;Bireme maximum heap size is $&#123;MAX_HEAP&#125;m&quot; &gt;&amp;2</span><br><span class="line">  HEAP=&quot;-Xmx$&#123;MAX_HEAP&#125;m&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jsvc_exec() &#123;</span><br><span class="line">  cd &quot;$&#123;TOPDIR&#125;&quot; || exit 1</span><br><span class="line">    &quot;$&#123;EXEC&#125;&quot; -cwd &quot;$&#123;TOPDIR&#125;&quot; -home &quot;$&#123;JAVA_HOME&#125;&quot; -cp &quot;$&#123;CLASS_PATH&#125;&quot; \</span><br><span class="line">    $&#123;JMX&#125; $&#123;HEAP&#125; \</span><br><span class="line">    -Dlog4j.configurationFile=$&#123;TOPDIR&#125;/etc/log4j2.xml \</span><br><span class="line">    -Djava.security.auth.login.config=/opt/bireme-2.0.0-alpha-1/etc/kafka_client_jaas.conf \</span><br><span class="line">    -XX:+UseG1GC -XX:+UseStringDeduplication \</span><br><span class="line">    -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$&#123;HEAP_DUMP&#125; \</span><br><span class="line">    -XX:-PrintGCDetails -XX:-PrintGCTimeStamps -XX:-UseGCLogFileRotation \</span><br><span class="line">    -XX:NumberOfGCLogFiles=2 -XX:GCLogFileSize=1024K -Xloggc:$&#123;LOG_GC&#125; \</span><br><span class="line">    -jvm server -wait 60 -outfile &quot;$&#123;LOG_OUT&#125;&quot; -errfile &quot;$&#123;LOG_ERR&#125;&quot; \</span><br><span class="line">    -pidfile &quot;$&#123;PID&#125;&quot; $1 &quot;$&#123;CLASS&#125;&quot; $&#123;ARGS&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$&#123;CMD&#125;&quot; in</span><br><span class="line">  start)</span><br><span class="line">    echo &quot;Starting the $DESC...&quot;</span><br><span class="line"></span><br><span class="line">    # Start the service</span><br><span class="line">    if ! jsvc_exec; then</span><br><span class="line">      echo &quot;Failed to start $DESC&quot;</span><br><span class="line">      exit 1</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo &quot;The $DESC has started.&quot;</span><br><span class="line">  ;;</span><br><span class="line">  stop)</span><br><span class="line">    if [ -f &quot;$PID&quot; ]; then</span><br><span class="line">      echo &quot;Stopping the $DESC...&quot;</span><br><span class="line"></span><br><span class="line">      # Stop the service</span><br><span class="line">      if ! jsvc_exec &quot;-stop&quot;; then</span><br><span class="line">        echo &quot;Failed to stop $DESC&quot;</span><br><span class="line">        exit 1</span><br><span class="line">      fi</span><br><span class="line"></span><br><span class="line">      echo &quot;The $DESC has stopped.&quot;</span><br><span class="line">    else</span><br><span class="line">      echo &quot;Daemon not running, no action taken&quot;</span><br><span class="line">      exit 1</span><br><span class="line">    fi</span><br><span class="line">  ;;</span><br><span class="line">  restart)</span><br><span class="line">    if [ -f &quot;$PID&quot; ]; then</span><br><span class="line">      echo &quot;Restarting the $DESC...&quot;</span><br><span class="line"></span><br><span class="line">      # Stop the service</span><br><span class="line">      jsvc_exec &quot;-stop&quot;</span><br><span class="line"></span><br><span class="line">      # Start the service</span><br><span class="line">      if ! jsvc_exec; then</span><br><span class="line">    echo &quot;Failed to start $DESC&quot;</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line"></span><br><span class="line">  echo &quot;The $DESC has restarted.&quot;</span><br><span class="line">    else</span><br><span class="line">      echo &quot;Daemon not running, no action taken&quot;</span><br><span class="line">      exit 1</span><br><span class="line">    fi</span><br><span class="line">      ;;</span><br><span class="line">  *)</span><br><span class="line">    echo &quot;Usage: $0 &#123;start|stop|restart&#125;&quot; &gt;&amp;2</span><br><span class="line">    exit 1</span><br><span class="line">  ;;</span><br><span class="line">esac</span><br><span class="line">[root@localhost bin]# pwd</span><br><span class="line">/opt/bireme-2.0.0-alpha-1/bin</span><br></pre></td></tr></table></figure><h2 id="maxwell"><a href="#maxwell" class="headerlink" title="maxwell"></a>maxwell</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost maxwell-1.22.1]# cat config</span><br><span class="line">user=maxwell</span><br><span class="line">password=maxwell</span><br><span class="line">host=10.24.70.85</span><br><span class="line">replication_host=10.24.70.25</span><br><span class="line">replication_user=maxwell</span><br><span class="line">replication_password=Maxwell@123</span><br><span class="line">include_dbs=inforveriplatform</span><br><span class="line">include_tables=tb_car_record,tb_control_car,tb_control_person,tb_person_record,tb_key_car_record,tb_key_person_record,tb_security_clearance,tb_client_device,sys_dept,tb_face_record</span><br><span class="line">producer=kafka</span><br><span class="line">kafka_topic=maxwell</span><br><span class="line">kafka.bootstrap.servers=10.24.70.127:9092,10.24.70.128:9092,10.24.70.134:9092</span><br><span class="line">kafka.security.protocol=SASL_PLAINTEXT</span><br><span class="line">kafka.sasl.mechanism=PLAIN</span><br><span class="line">kafka_partition_hash=murmur3</span><br><span class="line">producer_partition_by=primary_key</span><br><span class="line">[root@localhost maxwell-1.22.1]# pwd</span><br><span class="line">/opt/maxwell-1.22.1</span><br><span class="line"></span><br><span class="line">[root@localhost maxwell-1.22.1]# ls</span><br><span class="line">bin  config  config.md  config.properties.example  kafka_client_jaas.conf  kinesis-producer-library.properties.example  lib  LICENSE  log4j2.xml  logs  quickstart.md  README.md</span><br><span class="line">[root@localhost maxwell-1.22.1]# cat kafka_client_jaas.conf </span><br><span class="line">KafkaClient&#123;</span><br><span class="line">  org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">  username=&quot;admin&quot;</span><br><span class="line">  password=&quot;admin@123&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost maxwell-1.22.1]# cd bin</span><br><span class="line">[root@localhost bin]# ls</span><br><span class="line">maxwell  maxwell-benchmark  maxwell-bootstrap  maxwell-docker</span><br><span class="line">[root@localhost bin]# cat maxwell</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">base_dir=&quot;$(dirname &quot;$0&quot;)/..&quot;</span><br><span class="line">lib_dir=&quot;$base_dir/lib&quot;</span><br><span class="line">lib_dir_development=&quot;$base_dir/target/lib&quot;</span><br><span class="line">if [ ! -e &quot;$lib_dir&quot; -a -e &quot;$lib_dir_development&quot; ]; then</span><br><span class="line">lib_dir=&quot;$lib_dir_development&quot;</span><br><span class="line">CLASSPATH=&quot;$CLASSPATH:$base_dir/target/classes&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">CLASSPATH=&quot;$CLASSPATH:$lib_dir/*&quot;</span><br><span class="line"></span><br><span class="line">KAFKA_VERSION=&quot;1.0.0&quot;</span><br><span class="line"></span><br><span class="line">function use_kafka() &#123;</span><br><span class="line">wanted=&quot;$1&quot;</span><br><span class="line"># disambiguate versions into the latest,</span><br><span class="line"># e.g. asking for 0.10 means you want the</span><br><span class="line"># latest 0.10.x release</span><br><span class="line">case &quot;$wanted&quot; in</span><br><span class="line">0.11)</span><br><span class="line">KAFKA_VERSION=0.11.0.1</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">0.10)</span><br><span class="line">KAFKA_VERSION=0.10.2.1</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">*)</span><br><span class="line">KAFKA_VERSION=&quot;$wanted&quot;</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for key in &quot;$@&quot;</span><br><span class="line">do</span><br><span class="line">case &quot;$key&quot; in</span><br><span class="line">--kafka_version)</span><br><span class="line">use_kafka &quot;$2&quot;</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">--kafka_version=*)</span><br><span class="line">use_kafka &quot;$&#123;key#*=&#125;&quot;</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">        --daemon)</span><br><span class="line">DAEMON_MODE=&quot;true&quot;</span><br><span class="line">DAEMON_NAME=&quot;MaxwellDaemon&quot;</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ &quot;x$DAEMON_MODE&quot; = &quot;xtrue&quot; ]; then</span><br><span class="line">    # Log directory to use</span><br><span class="line">    if [ &quot;x$LOG_DIR&quot; = &quot;x&quot; ]; then</span><br><span class="line">        LOG_DIR=&quot;$base_dir/logs&quot;</span><br><span class="line">    fi</span><br><span class="line">    # Create logs directory</span><br><span class="line">    if [ ! -d &quot;$LOG_DIR&quot; ]; then</span><br><span class="line">        mkdir -p &quot;$LOG_DIR&quot;</span><br><span class="line">    fi</span><br><span class="line">    # Console output file when maxwell runs as a daemon</span><br><span class="line">    CONSOLE_OUTPUT_FILE=$LOG_DIR/$DAEMON_NAME.out</span><br><span class="line">    echo &quot;Redirecting STDOUT to $CONSOLE_OUTPUT_FILE&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">kafka_client_dir=&quot;$lib_dir/kafka-clients&quot;</span><br><span class="line">kafka_client_jar=&quot;$(ls -1 &quot;$kafka_client_dir/kafka-clients-$KAFKA_VERSION&quot;*.jar 2&gt;/dev/null || true)&quot;</span><br><span class="line">if [ -z &quot;$kafka_client_jar&quot; -o &quot;$(echo &quot;$kafka_client_jar&quot; | wc -l)&quot; -gt 1 ]; then</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$kafka_client_jar&quot; ]; then</span><br><span class="line">echo &quot;Error: No matches for kafka version: $KAFKA_VERSION&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;Error: Multiple matches for kafka version: $KAFKA_VERSION&quot;</span><br><span class="line">fi</span><br><span class="line">echo &quot;Supported versions:&quot;</span><br><span class="line">ls -1 &quot;$kafka_client_dir&quot; | sed -e &apos;s/^kafka-clients-/ - /&apos; -e &apos;s/\.jar$//&apos;</span><br><span class="line">exit 1</span><br><span class="line">else</span><br><span class="line">echo &quot;Using kafka version: $KAFKA_VERSION&quot;</span><br><span class="line">CLASSPATH=&quot;$CLASSPATH:$kafka_client_jar&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$JAVA_HOME&quot; ]; then</span><br><span class="line">JAVA=&quot;java&quot;</span><br><span class="line">else</span><br><span class="line">JAVA=&quot;$JAVA_HOME/bin/java&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">SASL_OPTS=&quot;-Djava.security.auth.login.config=/opt/maxwell-1.22.1/kafka_client_jaas.conf&quot;</span><br><span class="line"></span><br><span class="line"># Launch mode</span><br><span class="line">if [ &quot;x$DAEMON_MODE&quot; = &quot;xtrue&quot; ]; then</span><br><span class="line">    nohup $JAVA $JAVA_OPTS $SASL_OPTS -Dfile.encoding=UTF-8 -Dlog4j.shutdownCallbackRegistry=com.djdch.log4j.StaticShutdownCallbackRegistry -cp $CLASSPATH com.zendesk.maxwell.Maxwell &quot;$@&quot; &gt; &quot;$CONSOLE_OUTPUT_FILE&quot; 2&gt;&amp;1 &lt; /dev/null &amp;</span><br><span class="line">else</span><br><span class="line">    exec $JAVA $JAVA_OPTS $SASL_OPTS -Dfile.encoding=UTF-8 -Dlog4j.shutdownCallbackRegistry=com.djdch.log4j.StaticShutdownCallbackRegistry -cp $CLASSPATH com.zendesk.maxwell.Maxwell &quot;$@&quot;</span><br><span class="line">fi</span><br><span class="line">[root@localhost bin]#</span><br></pre></td></tr></table></figure><h2 id="mysql2pgsql-RDS-DBSYNC"><a href="#mysql2pgsql-RDS-DBSYNC" class="headerlink" title="mysql2pgsql(RDS_DBSYNC)"></a>mysql2pgsql(RDS_DBSYNC)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost soft]# pwd</span><br><span class="line">/opt/soft</span><br><span class="line">[root@localhost soft]# ls</span><br><span class="line">bireme-2.0.0-alpha-1.tar.gz  __MACOSX  maxwell-1.22.1.tar.gz  mysql2pgsql.bin.el7.20171213.zip</span><br><span class="line">[root@localhost soft]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost bin]# cat table_list.txt </span><br><span class="line">tb_face_record: select * from tb_face_record</span><br><span class="line">[root@localhost bin]# cat my.cfg</span><br><span class="line">[src.mysql]</span><br><span class="line">host = &quot;10.24.70.25&quot;</span><br><span class="line">port = &quot;3306&quot;</span><br><span class="line">user = &quot;root&quot;</span><br><span class="line">password = &quot;123456&quot;</span><br><span class="line">db = &quot;infoveriplatform&quot;</span><br><span class="line">encodingdir = &quot;share&quot;</span><br><span class="line">encoding = &quot;utf8&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[desc.pgsql]</span><br><span class="line">connect_string = &quot;host=10.24.70.135 dbname=hchdata port=5432 user=gpadmin password=gpadmin&quot;</span><br><span class="line">target_schema = &quot;public&quot;</span><br><span class="line">ignore_copy_error_count_each_table = &quot;0&quot;</span><br><span class="line"></span><br><span class="line">[root@localhost bin]# ./mysql2pgsql -l table_list.txt -j 10</span><br><span class="line">ignore copy error count 0 each table</span><br><span class="line">-- Adding table: tb_face_record</span><br><span class="line">Starting data sync</span><br><span class="line">Query to get source data for target table tb_face_record: select * from tb_face_record </span><br><span class="line">-- Reference DDL to create the target table:</span><br><span class="line">CREATE TABLE tb_face_record (id int8, img_id text, sbid text, checkevent_id text, sfzh text, tpdz text, tpscdz text, picture_upload int4, is_upload int4, create_time timestamp, temp1 text, temp2 text, temp3 text, temp4 text, checkpoint_id text, inspector_id text, inspector_name text, company_name text, name text, key_person int4, feature_id text, score float4, is_deal int4, tpmc text) with (APPENDONLY=true, ORIENTATION=column, COMPRESSTYPE=zlib, COMPRESSLEVEL=1, BLOCKSIZE=1048576, OIDS=false) DISTRIBUTED BY (&lt;distribution key&gt;) PARTITION BY RANGE (&lt;partition key&gt;) (START (date &apos;&lt;YYYY-MM-DD&gt;&apos;) INCLUSIVE END (date &apos;&lt;YYYY-MM-DD&gt;&apos;) EXCLUSIVE EVERY (INTERVAL &apos;&lt;1 month&gt;&apos; ));</span><br><span class="line"></span><br><span class="line">thread 6 migrate task 0 table infoveriplatform.tb_face_record 5386127 rows complete, time cost 30393.893 ms</span><br><span class="line">Number of rows migrated: 5386127 (number of source tables&apos; rows: 5386127) </span><br><span class="line">Data sync time cost 30481.859 ms</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mpp配置&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>k8s 集群安装</title>
    <link href="https://zixujing.github.io/2019/10/10/linux/linux%E8%99%9A%E6%8B%9F%E5%8C%96/k8s%20%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/10/10/linux/linux虚拟化/k8s 集群安装/</id>
    <published>2019-10-09T18:00:00.000Z</published>
    <updated>2019-10-11T05:52:59.455Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>k8s 集群安装</p></blockquote><a id="more"></a><h2 id="服务端安装-v1-16-0"><a href="#服务端安装-v1-16-0" class="headerlink" title="服务端安装 v1.16.0"></a>服务端安装 v1.16.0</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# tar -xzvf kubernetes-server-linux-amd64.tar.gz </span><br><span class="line">##拷贝server bin下的文件到相应的目录</span><br><span class="line"></span><br><span class="line">API-SERVER</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /usr/lib/systemd/system/kube-apiserver.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=etcd.service</span><br><span class="line">Wants=etcd.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/root/fk/conf/apiserver</span><br><span class="line">ExecStart=/root/fk/bin/kube-apiserver $KUBE_API_ARGS</span><br><span class="line">Restart=on-failure</span><br><span class="line">Type=notify</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /root/fk/conf/apiserver</span><br><span class="line">KUBE_API_ARGS=&quot;--etcd-servers=http://127.0.0.1:2379 --insecure-bind-address=0.0.0.0 --insecure-port=9090 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class="line"></span><br><span class="line">KUBE_CONTROLLER_MANAGER</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /usr/lib/systemd/system/kube-controller-manager.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=kube-apiserver.service</span><br><span class="line">Wants=kube-apiserver.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/root/fk/conf/controller-manager</span><br><span class="line">ExecStart=/root/fk/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /root/fk/conf/controller-manager</span><br><span class="line">KUBE_CONTROLLER_MANAGER_ARGS=&quot;--master=http://127.0.0.1:9090 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KUBE-SCHEDULER</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /usr/lib/systemd/system/kube-scheduler.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=kube-apiserver.service</span><br><span class="line">Wants=kube-apiserver.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/root/fk/conf/scheduler</span><br><span class="line">ExecStart=/root/fk/bin/kube-scheduler $KUBE_SCHEDULER_ARGS</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /root/fk/conf/scheduler</span><br><span class="line">KUBE_SCHEDULER_ARGS=&quot;--master=http://127.0.0.1:9090 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br></pre></td></tr></table></figure><h2 id="node端安装"><a href="#node端安装" class="headerlink" title="node端安装"></a>node端安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">KUBELET</span><br><span class="line"></span><br><span class="line">##创建kubletconfig</span><br><span class="line">kubectl config set-cluster kubernetes   --server=http://127.0.0.1:9090  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-context default  --cluster=kubernetes  --user=kubelet-bootstrap  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /usr/lib/systemd/system/kubelet.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet Server</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=docker.service</span><br><span class="line">Wants=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/var/lib/kubelet</span><br><span class="line">EnvironmentFile=/root/fk/conf/kubelet</span><br><span class="line">ExecStart=/root/fk/bin/kubelet $KUBELET_ARGS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /root/fk/conf/kubelet</span><br><span class="line">KUBELET_ARGS=&quot;--kubeconfig=/root/fk/conf/bootstrap.kubeconfig --hostname-override=172.17.9.158 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# makdir /var/lib/kubelet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KUBE-PROXY</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /usr/lib/systemd/system/kube-proxy.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kube-Proxy Server</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=network.service</span><br><span class="line">Wants=network.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/root/fk/conf/proxy</span><br><span class="line">ExecStart=/root/fk/bin/kube-proxy $KUBE_PROXY_ARGS</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# vi /root/fk/conf/proxy</span><br><span class="line">KUBE_PROXY_ARGS=&quot;--master=http://127.0.0.1:9090 --hostname-override=172.17.9.158 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br></pre></td></tr></table></figure><h2 id="flannel组件"><a href="#flannel组件" class="headerlink" title="flannel组件"></a>flannel组件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# yum install flannel</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# vi /etc/sysconfig/flanneld</span><br><span class="line"># Flanneld configuration options</span><br><span class="line"></span><br><span class="line"># etcd url location.  Point this to the server where etcd runs</span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=&quot;http://127.0.0.1:2379&quot;</span><br><span class="line"></span><br><span class="line"># etcd config key.  This is the configuration key that flannel queries</span><br><span class="line"># For address range assignment</span><br><span class="line">FLANNEL_ETCD_PREFIX=&quot;/etc/kubernetes/network&quot;</span><br><span class="line"></span><br><span class="line"># Any additional options that you want to pass</span><br><span class="line">#FLANNEL_OPTIONS=&quot;&quot;</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# etcdctl set /etc/kubernetes/network/config &apos;&#123;&quot;Network&quot;: &quot;172.20.0.0/16&quot;&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart flanneld.service </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# find / -name mk-docker-opts.sh</span><br><span class="line">/usr/libexec/flannel/mk-docker-opts.sh</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# /usr/libexec/flannel/mk-docker-opts.sh -i</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# cat /run/flannel/subnet.env </span><br><span class="line">FLANNEL_NETWORK=172.20.0.0/16</span><br><span class="line">FLANNEL_SUBNET=172.20.90.1/24</span><br><span class="line">FLANNEL_MTU=1472</span><br><span class="line">FLANNEL_IPMASQ=false</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# ifconfig docker0 172.20.90.1/24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# kubectl -s http://localhost:9090 get componentstatus</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# kubectl -s http://localhost:9090 get node</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz log]# kubectl -s http://localhost:9090 cluster-info</span><br></pre></td></tr></table></figure><h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# cat redis-master-controller.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ReplicationController</span><br><span class="line">metadata:</span><br><span class="line"> name: redis-master</span><br><span class="line"> labels:</span><br><span class="line">  name: redis-master</span><br><span class="line">spec:</span><br><span class="line"> replicas: 1</span><br><span class="line"> selector:</span><br><span class="line">  name: redis-master</span><br><span class="line"> template:</span><br><span class="line">  metadata:</span><br><span class="line">   labels:</span><br><span class="line">    name: redis-master</span><br><span class="line">  spec:</span><br><span class="line">   containers:</span><br><span class="line">   - name: master</span><br><span class="line">     image: redis</span><br><span class="line">     ports:</span><br><span class="line">     - containerPort: 6379</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# kubectl -s http://localhost:9090 create -f redis-master-controller.yaml </span><br><span class="line"></span><br><span class="line">解决</span><br><span class="line">No API token found for service account &quot;default&quot;, retry after the token is automatically created and added to the service account</span><br><span class="line">openssl genrsa -out /root/fk/conf/serviceaccount.key 2048</span><br><span class="line">vi /root/fk/conf/apiserver</span><br><span class="line">加入</span><br><span class="line">--service-account-key-file=/root/fk/conf/serviceaccount.key</span><br><span class="line"></span><br><span class="line">vi /root/fk/conf/controller-manager</span><br><span class="line">加入</span><br><span class="line">--service-account-private-key-file=/root/fk/conf/serviceaccount.key</span><br><span class="line"></span><br><span class="line">systemctl restart etcd kube-apiserver kube-controller-manager kube-scheduler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# kubectl -s http://localhost:9090 create -f hello-world-pod.yaml </span><br><span class="line">pod/hello-world created</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz fk]# kubectl -s http://localhost:9090 get pod hello-world</span><br><span class="line">NAME          READY   STATUS              RESTARTS   AGE</span><br><span class="line">hello-world   0/1     ContainerCreating   0          25s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">错误解决</span><br><span class="line">failed pulling image &quot;k8s.gcr.io/pause:3.1&quot;: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</span><br><span class="line"></span><br><span class="line">docker tag docker.io/mirrorgooglecontainers/pause:3.1 k8s.gcr.io/pause:3.1</span><br><span class="line">docker pull mirrorgooglecontainers/pause:3.1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;k8s 集群安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="虚拟化" scheme="https://zixujing.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>etcd 集群安装</title>
    <link href="https://zixujing.github.io/2019/10/10/db/etcd/etcd%20%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/10/10/db/etcd/etcd 集群安装/</id>
    <published>2019-10-09T18:00:00.000Z</published>
    <updated>2019-10-10T03:35:05.244Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>etcd 集群安装</p></blockquote><a id="more"></a><h2 id="ETCD-v3-4-1下载"><a href="#ETCD-v3-4-1下载" class="headerlink" title="ETCD v3.4.1下载"></a>ETCD v3.4.1下载</h2><p><a href="https://github.com/etcd-io/etcd/releases" target="_blank" rel="noopener">https://github.com/etcd-io/etcd/releases</a></p><h2 id="单机安装"><a href="#单机安装" class="headerlink" title="单机安装"></a>单机安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# tar zxf etcd-v3.4.1-linux-amd64.tar.gz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# mv etcd-v3.4.1-linux-amd64/etcd*  /usr/bin</span><br><span class="line">##直接启动</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# etcd</span><br><span class="line">##服务启动</span><br><span class="line">[vagrant@localhost etcd]$ vi /usr/lib/systemd/system/etcd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">WorkingDirectory=/var/lib/etcd/</span><br><span class="line">EnvironmentFile=-/etc/etcd/etcd.conf</span><br><span class="line">User=etcd</span><br><span class="line"># set GOMAXPROCS to number of processors</span><br><span class="line">ExecStart=/usr/bin/etcd</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">vagrant@localhost etcd]$ vi /etc/etcd/etcd.conf</span><br><span class="line"></span><br><span class="line"># [member]</span><br><span class="line">ETCD_NAME=default</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">#ETCD_WAL_DIR=&quot;&quot;</span><br><span class="line">#ETCD_SNAPSHOT_COUNT=&quot;10000&quot;</span><br><span class="line">#ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;</span><br><span class="line">#ETCD_ELECTION_TIMEOUT=&quot;1000&quot;</span><br><span class="line">#ETCD_LISTEN_PEER_URLS=&quot;http://localhost:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://127.0.0.1:2379&quot;</span><br><span class="line">#ETCD_MAX_SNAPSHOTS=&quot;5&quot;</span><br><span class="line">#ETCD_MAX_WALS=&quot;5&quot;</span><br><span class="line">#ETCD_CORS=&quot;&quot;</span><br><span class="line">#</span><br><span class="line">#[cluster]</span><br><span class="line">#ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://localhost:2380&quot;</span><br><span class="line"># if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name,i.e. &quot;test=http://...&quot;</span><br><span class="line">#ETCD_INITIAL_CLUSTER=&quot;default=http://localhost:2380&quot;</span><br><span class="line">#ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line">#ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://127.0.0.1:2379&quot;</span><br><span class="line">#ETCD_DISCOVERY=&quot;&quot;</span><br><span class="line">#ETCD_DISCOVERY_SRV=&quot;&quot;</span><br><span class="line">#ETCD_DISCOVERY_FALLBACK=&quot;proxy&quot;</span><br><span class="line">#ETCD_DISCOVERY_PROXY=&quot;&quot;</span><br><span class="line">#</span><br><span class="line">#[proxy]</span><br><span class="line">#ETCD_PROXY=&quot;off&quot;</span><br><span class="line">#ETCD_PROXY_FAILURE_WAIT=&quot;5000&quot;</span><br><span class="line">#ETCD_PROXY_REFRESH_INTERVAL=&quot;30000&quot;</span><br><span class="line">#ETCD_PROXY_DIAL_TIMEOUT=&quot;1000&quot;</span><br><span class="line">#ETCD_PROXY_WRITE_TIMEOUT=&quot;5000&quot;</span><br><span class="line">#ETCD_PROXY_READ_TIMEOUT=&quot;0&quot;</span><br><span class="line">#</span><br><span class="line">#[security]</span><br><span class="line">#ETCD_CERT_FILE=&quot;&quot;</span><br><span class="line">#ETCD_KEY_FILE=&quot;&quot;</span><br><span class="line">#ETCD_CLIENT_CERT_AUTH=&quot;false&quot;</span><br><span class="line">#ETCD_TRUSTED_CA_FILE=&quot;&quot;</span><br><span class="line">#ETCD_PEER_CERT_FILE=&quot;&quot;</span><br><span class="line">#ETCD_PEER_KEY_FILE=&quot;&quot;</span><br><span class="line">#ETCD_PEER_CLIENT_CERT_AUTH=&quot;false&quot;</span><br><span class="line">#ETCD_PEER_TRUSTED_CA_FILE=&quot;&quot;</span><br><span class="line">#</span><br><span class="line">#[logging]</span><br><span class="line">#ETCD_DEBUG=&quot;false&quot;</span><br><span class="line"># examples for -log-package-levels etcdserver=WARNING,security=DEBUG</span><br><span class="line">#ETCD_LOG_PACKAGE_LEVELS=&quot;&quot;</span><br></pre></td></tr></table></figure><h2 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# tar zxf etcd-v3.4.1-linux-amd64.tar.gz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# mv etcd-v3.4.1-linux-amd64/etcd*  /usr/bin</span><br><span class="line">##直接启动</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# etcd --name infra1 --listen-client-urls http://127.0.0.1:2379 --advertise-client-urls http://127.0.0.1:2379 --listen-peer-urls http://127.0.0.1:12380 --initial-advertise-peer-urls http://127.0.0.1:12380 --initial-cluster-token etcd-cluster-1 --initial-cluster &apos;infra1=http://127.0.0.1:12380,infra2=http://127.0.0.1:22380,infra3=http://127.0.0.1:32380&apos; --initial-cluster-state new --enable-pprof</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]#  etcd --name infra2 --listen-client-urls http://127.0.0.1:22379 --advertise-client-urls http://127.0.0.1:22379 --listen-peer-urls http://127.0.0.1:22380 --initial-advertise-peer-urls http://127.0.0.1:22380 --initial-cluster-token etcd-cluster-1 --initial-cluster &apos;infra1=http://127.0.0.1:12380,infra2=http://127.0.0.1:22380,infra3=http://127.0.0.1:32380&apos; --initial-cluster-state new --enable-pprof</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]#  etcd --name infra3 --listen-client-urls http://127.0.0.1:32379 --advertise-client-urls http://127.0.0.1:32379 --listen-peer-urls http://127.0.0.1:32380 --initial-advertise-peer-urls http://127.0.0.1:32380 --initial-cluster-token etcd-cluster-1 --initial-cluster &apos;infra1=http://127.0.0.1:12380,infra2=http://127.0.0.1:22380,infra3=http://127.0.0.1:32380&apos; --initial-cluster-state new --enable-pprof</span><br><span class="line"></span><br><span class="line">##服务启动</span><br><span class="line">[vagrant@localhost etcd]$ vi /usr/lib/systemd/system/etcd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">WorkingDirectory=/var/lib/etcd/</span><br><span class="line">EnvironmentFile=-/etc/etcd/etcd.conf</span><br><span class="line">User=etcd</span><br><span class="line"># set GOMAXPROCS to number of processors</span><br><span class="line">ExecStart=/usr/bin/etcd</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[vagrant@localhost etcd]$ vi /etc/etcd/etcd.conf</span><br><span class="line"></span><br><span class="line">[member]</span><br><span class="line"></span><br><span class="line">ETCD_NAME=&quot;k8s_master_ip_name&quot; #范例：etcd1</span><br><span class="line">ETCD_DATA_DIR=&quot;/work/etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;http://k8s_master_ip:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://127.0.0.1:2379,http://k8s_master_ip:2379&quot;</span><br><span class="line">[cluster]</span><br><span class="line"></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://k8s_master_ip:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;k8s_master_ip_name=http://k8s_master_ip:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://k8s_master_ip:2379&quot;</span><br><span class="line"></span><br><span class="line">[vagrant@localhost etcd]$ etcdctl --write-out=table --endpoints=localhost:2379 member list</span><br><span class="line">[vagrant@localhost etcd]$ etcdctl --write-out=table --endpoints=localhost:2379 enpoint status</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;etcd 集群安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="etcd" scheme="https://zixujing.github.io/tags/etcd/"/>
    
  </entry>
  
  <entry>
    <title>harbor安装</title>
    <link href="https://zixujing.github.io/2019/09/30/linux/linux%E5%B7%A5%E5%85%B7/harbor%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/09/30/linux/linux工具/harbor安装/</id>
    <published>2019-09-29T17:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.963Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>harbor安装</p></blockquote><a id="more"></a><h2 id="harbor安装"><a href="#harbor安装" class="headerlink" title="harbor安装"></a>harbor安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">##先安装docker和docker-compose</span><br><span class="line">[root@sdw3 ~]# wget https://github.com/vmware/harbor/releases/download/v1.2.0/harbor-offline-installer-v1.2.0.tgz</span><br><span class="line">[root@sdw3 ~]# tar -zxf harbor-offline-installer-v1.2.0.tgz  -C /usr/local/</span><br><span class="line">[root@sdw3 ~]# cd /usr/local/harbor/</span><br><span class="line">[root@sdw3 ~]# vim /usr/local/harbor/harbor.cfg</span><br><span class="line">hostname = rgs.unixfbi.com</span><br><span class="line">#邮箱配置</span><br><span class="line">email_server = smtp.qq.com</span><br><span class="line">email_server_port = 25</span><br><span class="line">email_username = unixfbi@unixfbi.com</span><br><span class="line">email_password =12345678</span><br><span class="line">email_from = UnixFBI &lt;unixfbi@unixfbi.com&gt;</span><br><span class="line">email_ssl = false</span><br><span class="line">#禁止用户注册</span><br><span class="line">self_registration = off</span><br><span class="line">#设置只有管理员可以创建项目</span><br><span class="line">project_creation_restriction = adminonly</span><br><span class="line">[root@sdw3 ~]# /usr/local/harbor/install.sh</span><br></pre></td></tr></table></figure><h2 id="启动compose"><a href="#启动compose" class="headerlink" title="启动compose"></a>启动compose</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">启动Harbor</span><br><span class="line"># docker-compose start</span><br><span class="line">停止Harbor</span><br><span class="line"># docker-comose stop</span><br><span class="line">重启Harbor</span><br><span class="line"># docker-compose restart</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在浏览器输入rgs.unixfbi.com，因为我配置的域名为rgs.unixfbi.com。请大家根据自己的配置情况输入访问的域名；</span><br><span class="line">默认账号密码： admin / Harbor12345 登录后修改密码</span><br></pre></td></tr></table></figure><h2 id="上传下载镜像"><a href="#上传下载镜像" class="headerlink" title="上传下载镜像"></a>上传下载镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@sdw3 ~]# vim /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd --insecure-registry rgs.unixfbi.com</span><br><span class="line">[root@sdw3 ~]# systemctl  restart docker</span><br><span class="line">[root@sdw3 ~]# docker login rgs.unixfbi.com</span><br><span class="line">[root@sdw3 ~]# docker push rgs.unixfbi.com/library/centos7.1:0.1</span><br><span class="line">创建Dockerfile</span><br><span class="line"># vim Dockerfile </span><br><span class="line">FROM centos:centos7.1.1503</span><br><span class="line">ENV TZ &quot;Asia/Shanghai&quot;</span><br><span class="line">创建镜像</span><br><span class="line"># docker build -t rgs.unixfbi.com/library/centos7.1:0.1 .</span><br><span class="line">把镜像push到Harbor</span><br><span class="line"># docker login rgs.unixfbi.com</span><br><span class="line"># docker push rgs.unixfbi.com/library/centos7.1:0.1</span><br><span class="line">如果不是自己创建的镜像，记得先执行 docker tags 给镜像做tag</span><br><span class="line">例如：</span><br><span class="line"># docker pull busybox</span><br><span class="line"># docker tag busybox:latest rgs.unixfbi.com/library/busybox:latest</span><br><span class="line"># docker push rgs.unixfbi.com/library/busybox:latest</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;harbor安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="linux" scheme="https://zixujing.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>BI相关工具总结</title>
    <link href="https://zixujing.github.io/2019/09/25/linux/linux%E5%B7%A5%E5%85%B7/BI%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/09/25/linux/linux工具/BI相关工具总结/</id>
    <published>2019-09-24T17:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>BI相关工具总结<br><a id="more"></a></p></blockquote><h2 id="BI相关工具总结"><a href="#BI相关工具总结" class="headerlink" title="BI相关工具总结"></a>BI相关工具总结</h2><h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><h4 id="superset"><a href="#superset" class="headerlink" title="superset"></a>superset</h4><p>略</p><h4 id="metabase"><a href="#metabase" class="headerlink" title="metabase"></a>metabase</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@controller fk]# wget https://downloads.metabase.com/v0.33.3/metabase.jar</span><br><span class="line">[root@controller fk]# java -jar metabase.jar</span><br></pre></td></tr></table></figure><h4 id="redash"><a href="#redash" class="headerlink" title="redash"></a>redash</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM_38_115_centos redash]# vi docker-compose.production.yml</span><br><span class="line"># This is an example configuration for Docker Compose. Make sure to atleast update</span><br><span class="line"># the cookie secret &amp; postgres database password.</span><br><span class="line">#</span><br><span class="line"># Some other recommendations:</span><br><span class="line"># 1. To persist Postgres data, assign it a volume host location.</span><br><span class="line"># 2. Split the worker service to adhoc workers and scheduled queries workers.</span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  server:</span><br><span class="line">    image: redash/redash:latest</span><br><span class="line">    command: server</span><br><span class="line">    depends_on:</span><br><span class="line">      - postgres</span><br><span class="line">      - redis</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    environment:</span><br><span class="line">      PYTHONUNBUFFERED: 0</span><br><span class="line">      REDASH_LOG_LEVEL: &quot;INFO&quot;</span><br><span class="line">      REDASH_REDIS_URL: &quot;redis://redis:6379/0&quot;</span><br><span class="line">      REDASH_DATABASE_URL: &quot;postgresql://postgres@postgres/postgres&quot;</span><br><span class="line">      REDASH_COOKIE_SECRET: &quot;Q422k6vaXUk8&quot;</span><br><span class="line">      REDASH_WEB_WORKERS: 4      </span><br><span class="line">    restart: always</span><br><span class="line">  worker:</span><br><span class="line">    image: redash/redash:latest</span><br><span class="line">    command: scheduler</span><br><span class="line">    environment:</span><br><span class="line">      PYTHONUNBUFFERED: 0</span><br><span class="line">      REDASH_LOG_LEVEL: &quot;INFO&quot;</span><br><span class="line">      REDASH_REDIS_URL: &quot;redis://redis:6379/0&quot;</span><br><span class="line">      REDASH_DATABASE_URL: &quot;postgresql://postgres@postgres/postgres&quot;</span><br><span class="line">      QUEUES: &quot;queries,scheduled_queries,celery&quot;</span><br><span class="line">      WORKERS_COUNT: 2</span><br><span class="line">    restart: always</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:3.0-alpine</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;6379:6379&quot;</span><br><span class="line">    volumes: </span><br><span class="line">      - ./data/redis_data:/data</span><br><span class="line">    restart: always</span><br><span class="line">  postgres:</span><br><span class="line">    image: postgres:9.5.6-alpine</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;5432:5432&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data/postgresql_data:/var/lib/postgresql/data</span><br><span class="line">    restart: always</span><br><span class="line">  nginx:</span><br><span class="line">    image: redash/nginx:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;88:80&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - server</span><br><span class="line">    links:</span><br><span class="line">      - server:redash</span><br><span class="line">    restart: always</span><br><span class="line">[root@VM_38_115_centos redash]# docker-compose -f docker-compose.production.yml run --rm server create_db</span><br><span class="line">[root@VM_38_115_centos redash]# docker-compose -f docker-compose.production.yml up</span><br></pre></td></tr></table></figure><h4 id="zeppelin"><a href="#zeppelin" class="headerlink" title="zeppelin"></a>zeppelin</h4><p>大数据</p><h4 id="sqlpad"><a href="#sqlpad" class="headerlink" title="sqlpad"></a>sqlpad</h4><p>略</p><h4 id="cboard"><a href="#cboard" class="headerlink" title="cboard"></a>cboard</h4><p>国产的<br><a href="https://peter_zhang921.gitee.io/cboard_docsify/#/" target="_blank" rel="noopener">https://peter_zhang921.gitee.io/cboard_docsify/#/</a></p><h4 id="FineBI"><a href="#FineBI" class="headerlink" title="FineBI"></a>FineBI</h4><p>finebi   <a href="https://help.finebi.com/" target="_blank" rel="noopener">https://help.finebi.com/</a><br>finereport   <a href="https://help.finereport.com/" target="_blank" rel="noopener">https://help.finereport.com/</a></p><p>试用码：dbe8992a-085c130cf-2278-d0857c2db051</p><h3 id="web报表技术-java"><a href="#web报表技术-java" class="headerlink" title="web报表技术(java)"></a>web报表技术(java)</h3><ul><li>jfreechart</li><li>cewolf</li><li>jcharts</li><li>ireport</li><li>jasperreports</li><li>jfreereport</li><li>openreport</li><li>birt</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;BI相关工具总结&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>rttys和rtty离线安装使用</title>
    <link href="https://zixujing.github.io/2019/09/23/linux/linux%E5%B7%A5%E5%85%B7/rttys%E5%92%8Crtty%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>https://zixujing.github.io/2019/09/23/linux/linux工具/rttys和rtty离线安装使用/</id>
    <published>2019-09-22T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.964Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>rttys和rtty离线安装使用<br><a id="more"></a></p></blockquote><h2 id="rttys离线安装说明"><a href="#rttys离线安装说明" class="headerlink" title="rttys离线安装说明"></a>rttys离线安装说明</h2><blockquote><p><a href="https://github.com/zhaojh329/rttys/releases下载合适的rttys" target="_blank" rel="noopener">https://github.com/zhaojh329/rttys/releases下载合适的rttys</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@sdw3 ~]# tar -xzvf rttys-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><h3 id="查看支持哪些命令行参数"><a href="#查看支持哪些命令行参数" class="headerlink" title="查看支持哪些命令行参数"></a>查看支持哪些命令行参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./rttys -h</span><br><span class="line">Usage of ./rttys:</span><br><span class="line">  -addr string</span><br><span class="line">        address to listen (default &quot;:5912&quot;)</span><br><span class="line">  -conf string</span><br><span class="line">        config file to load (default &quot;./rttys.conf&quot;)</span><br><span class="line">  -gen-token</span><br><span class="line">        generate token</span><br><span class="line">  -ssl-cert string</span><br><span class="line">        certFile Path (default &quot;./rttys.crt&quot;)</span><br><span class="line">  -ssl-key string</span><br><span class="line">        keyFile Path (default &quot;./rttys.key&quot;)</span><br><span class="line">  -token string</span><br><span class="line">        token to use</span><br></pre></td></tr></table></figure><h3 id="以root用户运行-使用系统用户名和密码"><a href="#以root用户运行-使用系统用户名和密码" class="headerlink" title="以root用户运行(使用系统用户名和密码)"></a>以root用户运行(使用系统用户名和密码)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo ./rttys</span><br></pre></td></tr></table></figure><h3 id="以普通用户运行-用户名和密码来自配置文件"><a href="#以普通用户运行-用户名和密码来自配置文件" class="headerlink" title="以普通用户运行(用户名和密码来自配置文件)"></a>以普通用户运行(用户名和密码来自配置文件)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rttys</span><br></pre></td></tr></table></figure><h3 id="如何在后台运行模式下查看日志"><a href="#如何在后台运行模式下查看日志" class="headerlink" title="如何在后台运行模式下查看日志"></a>如何在后台运行模式下查看日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/rttys.log</span><br></pre></td></tr></table></figure><h3 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./rttys -gen-token</span><br><span class="line">Please set a password:******</span><br><span class="line">Your token is: 34762d07637276694b938d23f10d7164</span><br><span class="line"></span><br><span class="line">./rttys -token 34762d07637276694b938d23f10d7164</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><blockquote><p>帐号密码为服务器帐号密码</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://192.168.106.237:5912</span><br></pre></td></tr></table></figure><h2 id="rtty离线安装使用"><a href="#rtty离线安装使用" class="headerlink" title="rtty离线安装使用"></a>rtty离线安装使用</h2><h3 id="客户端依赖"><a href="#客户端依赖" class="headerlink" title="客户端依赖"></a>客户端依赖</h3><ul><li>libev 高性能的事件循环库</li><li>libuwsc 一个轻量的针对嵌入式Linux的基于libev的WebSocket客户端C库。</li><li>mbedtls(polarssl)、CyaSSl(wolfssl)或者openssl 如果你需要支持SSL</li></ul><blockquote><p>离线安装例子<br>libev：地址=》<a href="https://src.fedoraproject.org/repo/pkgs/libev/libev-4.27.tar.gz/sha512/18fbac15c3a24b2efcd547d98d423fe59a1684cd3afe7ff25a3da54d8df3e11f351df455657d830df93366853f74d584f6e47a7c9ffaba84aa586957bf39ea82/libev-4.27.tar.gz：./configure" target="_blank" rel="noopener">https://src.fedoraproject.org/repo/pkgs/libev/libev-4.27.tar.gz/sha512/18fbac15c3a24b2efcd547d98d423fe59a1684cd3afe7ff25a3da54d8df3e11f351df455657d830df93366853f74d584f6e47a7c9ffaba84aa586957bf39ea82/libev-4.27.tar.gz：./configure</a> &amp;&amp; make &amp;&amp; makeinstall<br>libywsc: 再下面的sh中通过git下载后编译安装<br>openssl：使用yum安装，搭建本地yum源即可安装</p></blockquote><h3 id="安装rtty"><a href="#安装rtty" class="headerlink" title="安装rtty"></a>安装rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/zhaojh329/rtty/master/tools/install.sh | sudo bash</span><br></pre></td></tr></table></figure><blockquote><p>install.sh说明</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">LSB_ID=</span><br><span class="line">INSTALL=</span><br><span class="line">REMOVE=</span><br><span class="line">UPDATE=</span><br><span class="line">PKG_LIBEV=&quot;libev-dev&quot;</span><br><span class="line">PKG_SSL=&quot;libssl-dev&quot;</span><br><span class="line">show_distribution() &#123;</span><br><span class="line"></span><br><span class="line">       local pretty_name=&quot;&quot;</span><br><span class="line">       if [ -f /etc/os-release ];</span><br><span class="line">       then</span><br><span class="line">               . /etc/os-release</span><br><span class="line">               pretty_name=&quot;$PRETTY_NAME&quot;</span><br><span class="line">               LSB_ID=&quot;$(echo &quot;$ID&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)&quot;</span><br><span class="line">       elif [ -f /etc/redhat-release ];</span><br><span class="line">       then</span><br><span class="line">               pretty_name=$(cat /etc/redhat-release)</span><br><span class="line">               LSB_ID=&quot;$(echo &quot;$pretty_name&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)&quot;</span><br><span class="line">               echo &quot;$LSB_ID&quot; | grep centos &gt; /dev/null &amp;&amp; LSB_ID=centos</span><br><span class="line">       fi</span><br><span class="line">       LSB_ID=$(echo &quot;$LSB_ID&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)</span><br><span class="line">       echo &quot;Platform: $pretty_name&quot;</span><br><span class="line">&#125;</span><br><span class="line">check_cmd() &#123;</span><br><span class="line">       which $1 &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">detect_pkg_tool() &#123;</span><br><span class="line">       check_cmd apt &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;apt update -q&quot;</span><br><span class="line">               INSTALL=&quot;apt install -y&quot;</span><br><span class="line">               REMOVE=&quot;apt remove -y&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd apt-get &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;apt-get update -q&quot;</span><br><span class="line">               INSTALL=&quot;apt-get install -y&quot;</span><br><span class="line">               REMOVE=&quot;apt-get remove -y&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd yum &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;yum update -yq&quot;</span><br><span class="line">               INSTALL=&quot;yum install -y&quot;</span><br><span class="line">               REMOVE=&quot;yum &quot;</span><br><span class="line">               PKG_LIBEV=&quot;libev-devel&quot;</span><br><span class="line">               PKG_SSL=&quot;openssl-devel&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd pacman &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;pacman -Sy --noprogressbar&quot;</span><br><span class="line">               INSTALL=&quot;pacman -S --noconfirm --noprogressbar&quot;</span><br><span class="line">               REMOVE=&quot;pacman -R --noconfirm --noprogressbar&quot;</span><br><span class="line">               PKG_LIBEV=&quot;libev&quot;</span><br><span class="line">               PKG_SSL=&quot;openssl&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       return 1</span><br><span class="line">&#125;</span><br><span class="line">check_tool() &#123;</span><br><span class="line">       local tool=$1</span><br><span class="line"></span><br><span class="line">       check_cmd $tool || $INSTALL $tool</span><br><span class="line">&#125;</span><br><span class="line">show_distribution</span><br><span class="line">detect_pkg_tool || &#123;</span><br><span class="line">       echo &quot;Your platform is not supported by this installer script.&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line">#$UPDATE</span><br><span class="line">[ &quot;$LSB_ID&quot; = &quot;centos&quot; ] &amp;&amp; $INSTALL epel-release</span><br><span class="line">check_tool pkg-config</span><br><span class="line">check_tool gcc</span><br><span class="line">check_tool make</span><br><span class="line">check_tool cmake</span><br><span class="line">check_tool git</span><br><span class="line">$INSTALL $PKG_LIBEV</span><br><span class="line">$INSTALL $PKG_SSL</span><br><span class="line">rm -rf /tmp/rtty-build</span><br><span class="line">mkdir /tmp/rtty-build</span><br><span class="line">pushd /tmp/rtty-build</span><br><span class="line">git clone --recursive https://github.com/zhaojh329/libuwsc.git || &#123;</span><br><span class="line">       echo &quot;Clone libuwsc failed&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line">sleep 2</span><br><span class="line">git clone https://github.com/zhaojh329/rtty.git || &#123;</span><br><span class="line">       echo &quot;Clone rtty failed&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line"># libuwsc</span><br><span class="line">rm -f /usr/local/lib/libuwsc.*</span><br><span class="line">cd libuwsc &amp;&amp; cmake . &amp;&amp; make install &amp;&amp; cd -</span><br><span class="line">[ $? -eq 0 ] || exit 1</span><br><span class="line"># rtty</span><br><span class="line">cd rtty &amp;&amp; cmake . &amp;&amp; make install</span><br><span class="line">[ $? -eq 0 ] || exit 1</span><br><span class="line">popd</span><br><span class="line">rm -rf /tmp/rtty-build</span><br><span class="line">ldconfig</span><br><span class="line">case &quot;$LSB_ID&quot; in</span><br><span class="line">       centos|arch)</span><br><span class="line">               echo &quot;/usr/local/lib&quot; &gt; /etc/ld.so.conf.d/rtty</span><br><span class="line">               ldconfig -f /etc/ld.so.conf.d/rtty</span><br><span class="line">       ;;</span><br><span class="line">esac</span><br><span class="line">rtty -V</span><br></pre></td></tr></table></figure><h3 id="查看命令行选项rtty"><a href="#查看命令行选项rtty" class="headerlink" title="查看命令行选项rtty"></a>查看命令行选项rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Usage: rtty [option]</span><br><span class="line">  -i ifname    # Network interface name - Using the MAC address of</span><br><span class="line">                     the interface as the device ID</span><br><span class="line">  -I id        # Set an ID for the device(Maximum 63 bytes, valid character:letters</span><br><span class="line">                     and numbers and underlines and short lines) - If set,</span><br><span class="line">                     it will cover the MAC address(if you have specify the ifname)</span><br><span class="line">  -h host      # Server host</span><br><span class="line">  -p port      # Server port(Default is 5912)</span><br><span class="line">  -a           # Auto reconnect to the server</span><br><span class="line">  -v           # verbose</span><br><span class="line">  -d           # Adding a description to the device(Maximum 126 bytes)</span><br><span class="line">  -s           # SSL on</span><br><span class="line">  -k keepalive # keep alive in seconds for this client. Defaults to 5</span><br><span class="line">  -V           # Show version</span><br><span class="line">  -D           # Run in the background</span><br><span class="line">  -t token     # Authorization token</span><br></pre></td></tr></table></figure><h3 id="运行RTTY-将下面的参数替换为你自己的参数-rtty"><a href="#运行RTTY-将下面的参数替换为你自己的参数-rtty" class="headerlink" title="运行RTTY(将下面的参数替换为你自己的参数)rtty"></a>运行RTTY(将下面的参数替换为你自己的参数)rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rtty -I &apos;My-device-ID&apos; -h &apos;your-server&apos; -p 5912 -a -v -s -d &apos;My Device Description&apos;</span><br><span class="line">实例，不能用root登录可以用其他帐号登录</span><br><span class="line">rtty -I &quot;237&quot; -h 192.168.106.237 -p 5912 -s</span><br></pre></td></tr></table></figure><h3 id="如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty"><a href="#如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty" class="headerlink" title="如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty"></a>如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-t 34762d07637276694b938d23f10d7164</span><br></pre></td></tr></table></figure><h2 id="如何让root能够登录"><a href="#如何让root能够登录" class="headerlink" title="如何让root能够登录"></a>如何让root能够登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">加入如下配置</span><br><span class="line"></span><br><span class="line">[root@sdw3 ~]# vi /etc/securetty</span><br><span class="line"></span><br><span class="line">pts/0</span><br><span class="line">pts/1</span><br><span class="line">pts/2</span><br><span class="line">[root@sdw3 ~]# cd /etc/pam.d</span><br><span class="line">[root@sdw3 pam.d]# cat login </span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so</span><br><span class="line">auth       substack     system-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      system-auth</span><br><span class="line">password   include      system-auth</span><br><span class="line"># pam_selinux.so close should be the first session rule</span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    optional     pam_console.so</span><br><span class="line"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span><br><span class="line">session    required     pam_selinux.so open</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      system-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line">-session   optional     pam_ck_connector.so</span><br><span class="line">[root@sdw3 pam.d]# cat sshd </span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth       required     pam_sepermit.so</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line"># Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-auth      optional     pam_reauthorize.so prepare</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      password-auth</span><br><span class="line">password   include      password-auth</span><br><span class="line"># pam_selinux.so close should be the first session rule</span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span><br><span class="line">session    required     pam_selinux.so open env_params</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      password-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line"># Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-session   optional     pam_reauthorize.so prepare</span><br><span class="line">[root@sdw3 pam.d]# cat system-auth</span><br><span class="line">#%PAM-1.0</span><br><span class="line"># This file is auto-generated.</span><br><span class="line"># User changes will be destroyed the next time authconfig is run.</span><br><span class="line">auth        required      pam_env.so</span><br><span class="line">auth        sufficient    pam_unix.so nullok try_first_pass</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &lt;= 1000 quiet_success</span><br><span class="line">auth        required      pam_deny.so</span><br><span class="line"></span><br><span class="line">account     required      pam_unix.so</span><br><span class="line">account     sufficient    pam_localuser.so</span><br><span class="line">account     sufficient    pam_succeed_if.so uid &lt; 1000 quiet</span><br><span class="line">account     required      pam_permit.so</span><br><span class="line"></span><br><span class="line">password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=</span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">password    required      pam_deny.so</span><br><span class="line"></span><br><span class="line">session     optional      pam_keyinit.so revoke</span><br><span class="line">session     required      pam_limits.so</span><br><span class="line">-session     optional      pam_systemd.so</span><br><span class="line">session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid</span><br><span class="line">session     required      pam_unix.so</span><br><span class="line">[root@sdw3 pam.d]# </span><br><span class="line">修改==》</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &gt;= 1000 quiet_success</span><br><span class="line">为==》</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &lt;= 1000 quiet_success</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;rttys和rtty离线安装使用&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat总结</title>
    <link href="https://zixujing.github.io/2019/09/22/linux/linux%E5%B7%A5%E5%85%B7/Tomcat%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/09/22/linux/linux工具/Tomcat总结/</id>
    <published>2019-09-21T18:00:00.000Z</published>
    <updated>2019-09-22T03:52:29.304Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Tomcat总结<br><a id="more"></a></p></blockquote><h2 id="Tomcat-调优的技巧"><a href="#Tomcat-调优的技巧" class="headerlink" title="Tomcat 调优的技巧"></a>Tomcat 调优的技巧</h2><ol><li><p>Tomcat的自身调优</p><blockquote><p>采用动静分离节约 Tomcat 的性能<br>调整 Tomcat 的线程池<br>调整 Tomcat 的连接器<br>修改 Tomcat 的运行模式<br>禁用 AJP 连接器</p></blockquote></li><li><p>JVM的调优</p><blockquote><p>调优Jvm内存</p></blockquote></li></ol><h3 id="Tomcat-自身调优"><a href="#Tomcat-自身调优" class="headerlink" title="Tomcat 自身调优"></a>Tomcat 自身调优</h3><ol><li>采用动静分离<blockquote><p>静态资源如果让 Tomcat 处理的话 Tomcat 的性能会被损耗很多，所以我们一般都是采用：Nginx+Tomcat 实现动静分离，让 Tomcat 只负责 jsp 文件的解析工作，Nginx 实现静态资源的访问。</p></blockquote></li><li>调优 Tomcat 线程池<br>打开tomcat的serve.xml，配置Executor，相关参数说明如下。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Executor </span><br><span class="line">  name=&quot;tomcatThreadPool&quot;</span><br><span class="line">  namePrefix=&quot;catalina-exec-&quot;</span><br><span class="line">  maxThreads=&quot;500&quot;</span><br><span class="line">  minSpareThreads=&quot;20&quot;</span><br><span class="line">  maxIdleTime=&quot;60000&quot;</span><br></pre></td></tr></table></figure><ul><li>name：给执行器（线程池）起一个名字；</li><li>namePrefix：指定线程池中的每一个线程的 name 前缀；</li><li>maxThreads：线程池中最大的线程数量，假设请求的数量超过了 750，这将不是意味着将 maxThreads 属性值设置为 750，它的最好解决方案是使用「Tomcat集群」。也就是说，如果有 1000 请求，两个 * Tomcat 实例设置 maxThreads = 500，而不在单 Tomcat 实例的情况下设置 maxThreads=1000。</li><li>minSpareThreads：线程池中允许空闲的线程数量（多余的线程都杀死）；</li><li>maxIdLeTime：一个线程空闲多久算是一个空闲线程；</li></ul><ol start="3"><li>调优 Tomcat 的连接器 </li></ol><p>打开 Tomcat 的 serve.xml，配置 Connector，参数说明如下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector</span><br><span class="line">  executor=&quot;tomcatThreadPool&quot;</span><br><span class="line">  prot=&quot;8014&quot;</span><br><span class="line">  protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">  connectionTimeout=&quot;20000&quot;</span><br><span class="line">  enableLookups=&quot;false&quot;</span><br><span class="line">  URIEncoding=&quot;UTF-8&quot;</span><br></pre></td></tr></table></figure><p>executor：指定这个连接器所使用的执行器（线程池）,如下；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector</span><br><span class="line">  executor=&quot;tomcatThreadPool&quot;</span><br><span class="line">  prot=&quot;8014&quot;</span><br><span class="line">  protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">  connectionTimeout=&quot;20000&quot;</span><br><span class="line">  enableLookups=&quot;false&quot;</span><br><span class="line">  URIEncoding=&quot;UTF-8&quot;/&gt;</span><br><span class="line">&lt;Executor </span><br><span class="line">  name=&quot;tomcatThreadPool&quot;</span><br><span class="line">  namePrefix=&quot;catalina-exec-&quot;</span><br><span class="line">  maxThreads=&quot;500&quot;</span><br><span class="line">  minSpareThreads=&quot;20&quot;</span><br><span class="line">  maxIdleTime=&quot;60000&quot;/&gt;</span><br></pre></td></tr></table></figure></p><ul><li>enableLookups=false：关闭 DNS 解析，减少性能损耗；</li><li>minProcessors：服务器启动时创建的最少线程数；</li><li>maxProcessors：最大可以创建的线程数；</li><li>acceptCount=1000：线程池中的线程都被占用，允许放到队列中的请求数；</li><li>maxThreads=3000：最大线程数；</li><li>minSpareThreads=20：最小空闲线程数，这里是一直会运行的线程；</li><li>与压缩有关系的配置：如果已经对代码进行了动静分离，静态页面和图片等数据就不需要 Tomcat 处理了，那么也就不需要配置在 Tomcat 中配置压缩了；</li><li>一个完整的配置如下。</li></ul><p><connector port="8080" protocol="HTTP/1.1" connectiontimeout="20000" ##="" 20s="" redirectport="443" maxthreads="3000" minsparethreads="20" acceptcount="1000" enablelookups="false" server="None" uriencoding="UTF-8"></connector></p><ol start="4"><li>通过修改 Tomcat 的运行模式</li></ol><blockquote><p><strong>BIO</strong><br>Tomcat8 以下版本，默认使用的就是 BIO「阻塞式IO)」模式。<br>对于每一个请求都要创建一个线程来进行处理，不适合高并发。<br><strong>NIO</strong><br>Tomcat8 以上版本，默认使用的就是NIO模式「非阻塞式 IO」。</p></blockquote><blockquote><p><strong>APR</strong><br>全称 Apache Portable Runtime，是Tomcat生产环境运行的首选方式，如果操作系统未安装 APR 或者 APR 路径未指到 Tomcat 默认可识别的路径，则 APR 模式无法启动，自动切换启动 NIO 模式。所以必须要安装 APR 和 Native，直接启动就支持 APR，APR是从操作系统级别解决异步 IO 问题，APR 的本质就是使用 JNI 技术调用操作系统底层的 IO 接口，所以需要提前安装所需要的依赖</p></blockquote><ol start="5"><li>禁用 AJP 连接器<br>AJP的全称 Apache JServer Protocol，使用 Nginx+Tomca t的架构，所以用不着 AJP 协议，所以把AJP连接器禁用。<br>注释掉：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot;/&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="JVM-调优"><a href="#JVM-调优" class="headerlink" title="JVM 调优"></a>JVM 调优</h3><p>Tomcat 是运行在 JVM 上的，所以对 JVM 的调优也是非常有必要的。<br>找到 catalina.sh；<br>添加；<br>参数设置；<br>JAVA_OPTS=”-Djava.awt.headless=true -Dfile.encoding=UTF-8-server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XXermSize=512m -XX:MaxPermSize=512m -XX:+DisableExplicitGC”<br>调整堆大小的的目的是最小化垃圾收集的时间，以在特定的时间内最大化处理客户的请求。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Tomcat总结&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>mysql自动备份脚本</title>
    <link href="https://zixujing.github.io/2019/09/18/linux/linux%E5%B7%A5%E5%85%B7/mysql%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/"/>
    <id>https://zixujing.github.io/2019/09/18/linux/linux工具/mysql备份脚本/</id>
    <published>2019-09-17T21:00:00.000Z</published>
    <updated>2019-09-22T03:53:17.002Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql自动备份脚本<br><a id="more"></a></p></blockquote><h3 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /home/bak_data</span><br><span class="line">[root@localhost ~]# mkdir /home/bak_data/log</span><br><span class="line">[root@localhost ~]# vi bak_mysql.sh</span><br><span class="line">#! /bin/bash</span><br><span class="line"># name fengk</span><br><span class="line">USER=root</span><br><span class="line">PASSWORD=P@ssW0rd</span><br><span class="line">DATABASE1=infoveriplatform_zhuozhou</span><br><span class="line">BACKUP_DIR=/home/bak_data</span><br><span class="line">LOGFILE=/home/bak_data/log/bak_data.log</span><br><span class="line">DATE=`date +%Y%m%d-%H%M -d -3minute`</span><br><span class="line">DUMPFILE1=$DATE-$&#123;DATABASE1&#125;.sql</span><br><span class="line">ARCHIVE1=$DUMPFILE1.gz</span><br><span class="line">KEEPTIME=1</span><br><span class="line">if [ ! -d $BACKUP_DIR ];</span><br><span class="line">then</span><br><span class="line">mkdir -p &quot;$BACKUP_DIR&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -e &quot;\n&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;BACKUP DATE:$DATE&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line"></span><br><span class="line">cd $BACKUP_DIR</span><br><span class="line">/home/mysql/bin/mysqldump --triggers --routines --events -h127.0.0.1 -P3306 -u$USER -p$PASSWORD --databases $DATABASE1 | gzip &gt; $ARCHIVE1</span><br><span class="line"></span><br><span class="line">if [[ $? == 0 ]];then</span><br><span class="line">DELFILE=`find $BACKUP_DIR -type f -mtime +$&#123;KEEPTIME&#125; -exec rm -fr &#123;&#125; \;`</span><br><span class="line">echo &quot;delete expire file &quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line">fi</span><br><span class="line">[root@localhost ~]# chmod +x bak_mysql.sh</span><br></pre></td></tr></table></figure><h3 id="设置定时任务"><a href="#设置定时任务" class="headerlink" title="设置定时任务"></a>设置定时任务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/corntab</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"># For details see man 4 crontabs</span><br><span class="line"></span><br><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59)</span><br><span class="line"># |  .------------- hour (0 - 23)</span><br><span class="line"># |  |  .---------- day of month (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name  command to be executed</span><br><span class="line">  30 00 *  *  * root  /root/bak_mysql.sh</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# systemctl restart crond</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql自动备份脚本&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>docker安装与随笔</title>
    <link href="https://zixujing.github.io/2019/09/17/linux/linux%E8%99%9A%E6%8B%9F%E5%8C%96/docker%E5%AE%89%E8%A3%85%E4%B8%8E%E9%9A%8F%E7%AC%94/"/>
    <id>https://zixujing.github.io/2019/09/17/linux/linux虚拟化/docker安装与随笔/</id>
    <published>2019-09-16T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.963Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>docker安装与随笔<br><a id="more"></a></p></blockquote><h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>  <a href="https://docs.docker.com/install/linux/docker-ce/binaries/#install-static-binaries" target="_blank" rel="noopener">参照连接</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# tar -xzvf docker-19.03.0.tgz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# cd docker</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# mv * /usr/bin/</span><br><span class="line">如果不是默认path目录，那么请用systemctl show-environment/set-environment</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# vi .bash_profile</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# source .bash_profile</span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# vi /usr/lib/systemd/system/docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/docker</span><br><span class="line"># the default is not to use systemd for cgroups because the delegate issues still</span><br><span class="line"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="line"># for containers run by docker</span><br><span class="line">ExecStart=/usr/local/docker/dockerd</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"># Uncomment TasksMax if your systemd version supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">#TasksMax=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class="line">Delegate=yes</span><br><span class="line"># kill only the docker process, not all processes in the cgroup</span><br><span class="line">KillMode=process</span><br><span class="line"># restart the docker process if it exits prematurely</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# systemctl daemon-reload</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="docker-compose-安装"><a href="#docker-compose-安装" class="headerlink" title="docker-compose 安装"></a>docker-compose 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="dockerfile-制作镜像"><a href="#dockerfile-制作镜像" class="headerlink" title="dockerfile 制作镜像"></a>dockerfile 制作镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# pwd</span><br><span class="line">/root/mk</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# cat Dockerfile </span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER fengk</span><br><span class="line"></span><br><span class="line">ENV DATA_PATH /data</span><br><span class="line">ENV MYSQL_PASSWORD 123456</span><br><span class="line">ENV PATH /usr/local/mysql/bin:$PATH</span><br><span class="line">VOLUME [$DATA_PATH]</span><br><span class="line"></span><br><span class="line">COPY my.sh /usr/local/</span><br><span class="line">RUN cd /usr/local &amp;&amp; chmod +x my.sh</span><br><span class="line">COPY mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz /usr/local/</span><br><span class="line">RUN yum -y install numactl &amp;&amp; yum -y install libaio</span><br><span class="line">RUN groupadd mysql;useradd -r -g mysql -s /bin/false mysql</span><br><span class="line">RUN cd /usr/local &amp;&amp; tar -xzvf mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz &amp;&amp; ln -s mysql-5.7.27-linux-glibc2.12-x86_64 mysql &amp;&amp; rm -fr mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">EXPOSE 3306</span><br><span class="line">ENTRYPOINT [&quot;/bin/sh&quot;,&quot;/usr/local/my.sh&quot;]</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# cat my.sh </span><br><span class="line">#!/usr/bin/bash</span><br><span class="line">if [ ! -d $DATA_PATH ] ; then mkdir -p $DATA_PATH/data ; fi</span><br><span class="line">if [ ! -d $DATA_PATH/data ] ; then mkdir $DATA_PATH/data ; fi</span><br><span class="line">if [ ! -f $DATA_PATH/mariadb.log ] ; then touch $DATA_PATH/mariadb.log &amp;&amp; chown mysql:mysql $DATA_PATH/mariadb.log ; fi</span><br><span class="line">if [ ! -f $DATA_PATH/my.cnf ] ; then cd $DATA_PATH &amp;&amp; echo -e &quot;[mysqld]\nuser=mysql\ndatadir=$&#123;DATA_PATH&#125;/data\nsocket=$&#123;DATA_PATH&#125;/mysql.sock\n[mysqld_safe]\nlog-error=$&#123;DATA_PATH&#125;/mariadb.log\npid-file=$&#123;DATA_PATH&#125;/mariadb.pid&quot; &gt; my.cnf &amp;&amp; chmod 664 my.cnf &amp;&amp; chown -R mysql:mysql $DATA_PATH &amp;&amp; cd /usr/local/mysql &amp;&amp; ./bin/mysqld  --defaults-file=$DATA_PATH/my.cnf --initialize --user=mysql --basedir=/usr/local/mysql  --datadir=$DATA_PATH/data &amp;&amp; cd /usr/local/mysql &amp;&amp; ./bin/mysqld_safe --defaults-file=$DATA_PATH/my.cnf --skip-grant-tables &amp;</span><br><span class="line"></span><br><span class="line">var=1</span><br><span class="line">until [ $var -eq 0 ]</span><br><span class="line">do</span><br><span class="line">sleep 1</span><br><span class="line">/usr/local/mysql/bin/mysql -uroot -p123456 --socket=/data/mysql.sock -e &quot;exit&quot;</span><br><span class="line">var=$?</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysql -uroot --socket=/data/mysql.sock mysql -e &quot;update user set authentication_string=password(&apos;$MYSQL_PASSWORD&apos;),password_expired=&apos;N&apos;&quot;</span><br><span class="line"></span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysqladmin -u root --socket=$DATA_PATH/mysql.sock shutdown;  fi</span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysqld_safe --defaults-file=$DATA_PATH/my.cnf &amp; </span><br><span class="line">/usr/bin/bash</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# ls</span><br><span class="line">Dockerfile  my.sh  mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker build -t mysql .</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker run -t -i -v /data:/data -p 3307:3306 --name db mysql</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker run --link db:db -t -i centos (使用mysql -u*** -p*** -hdb访问上一个容器的mysql)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;docker安装与随笔&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="虚拟化" scheme="https://zixujing.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>hadoop配置说明</title>
    <link href="https://zixujing.github.io/2019/08/22/bigdata/hadoop%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E/"/>
    <id>https://zixujing.github.io/2019/08/22/bigdata/hadoop配置说明/</id>
    <published>2019-08-21T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hadoop配置说明<br><a id="more"></a></p></blockquote><h2 id="ResourceManager相关配置参数"><a href="#ResourceManager相关配置参数" class="headerlink" title="ResourceManager相关配置参数"></a>ResourceManager相关配置参数</h2><ul><li>yarn.resourcemanager.address</li></ul><blockquote><p>参数解释：ResourceManager 对客户端暴露的地址。客户端通过该地址向RM提交应用程序，杀死应用程序等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8032</p></blockquote><ul><li>yarn.resourcemanager.scheduler.address</li></ul><blockquote><p>参数解释：ResourceManager 对ApplicationMaster暴露的访问地址。ApplicationMaster通过该地址向RM申请资源、释放资源等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8030</p></blockquote><ul><li>yarn.resourcemanager.resource-tracker.address</li></ul><blockquote><p>参数解释：ResourceManager 对NodeManager暴露的地址.。NodeManager通过该地址向RM汇报心跳，领取任务等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8031</p></blockquote><ul><li>yarn.resourcemanager.admin.address</li></ul><blockquote><p>参数解释：ResourceManager 对管理员暴露的访问地址。管理员通过该地址向RM发送管理命令等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8033</p></blockquote><ul><li>yarn.resourcemanager.webapp.address</li></ul><blockquote><p>参数解释：ResourceManager对外web ui地址。用户可通过该地址在浏览器中查看集群各类信息。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8088</p></blockquote><ul><li>yarn.resourcemanager.scheduler.class</li></ul><blockquote><p>参数解释：启用的资源调度器主类。目前可用的有FIFO、Capacity Scheduler和Fair Scheduler。</p></blockquote><blockquote><p>默认值：org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</p></blockquote><ul><li>yarn.resourcemanager.resource-tracker.client.thread-count</li></ul><blockquote><p>参数解释：处理来自NodeManager的RPC请求的Handler数目。</p></blockquote><blockquote><p>默认值：50</p></blockquote><ul><li>yarn.resourcemanager.scheduler.client.thread-count</li></ul><blockquote><p>参数解释：处理来自ApplicationMaster的RPC请求的Handler数目。</p></blockquote><blockquote><p>默认值：50</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-mb/ yarn.scheduler.maximum-allocation-mb</li></ul><blockquote><p>参数解释：单个可申请的最小/最大内存资源量。比如设置为1024和3072，则运行MapRedce作业时，每个Task最少可申请1024MB内存，最多可申请3072MB内存。</p></blockquote><blockquote><p>默认值：1024/8192</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-vcores / yarn.scheduler.maximum-allocation-vcores</li></ul><blockquote><p>参数解释：单个可申请的最小/最大虚拟CPU个数。比如设置为1和4，则运行MapRedce作业时，每个Task最少可申请1个虚拟CPU，最多可申请4个虚拟CPU。什么是虚拟CPU，可阅读我的这篇文章：“YARN 资源调度器剖析”。</p></blockquote><blockquote><p>默认值：1/32</p></blockquote><ul><li>yarn.resourcemanager.nodes.include-path /yarn.resourcemanager.nodes.exclude-path</li></ul><blockquote><p>参数解释：NodeManager黑白名单。如果发现若干个NodeManager存在问题，比如故障率很高，任务运行失败率高，则可以将之加入黑名单中。注意，这两个配置参数可以动态生效。（调用一个refresh命令即可）</p></blockquote><blockquote><p>默认值：“”</p></blockquote><ul><li>yarn.resourcemanager.nodemanagers.heartbeat-interval-ms</li></ul><blockquote><p>参数解释：NodeManager心跳间隔</p></blockquote><blockquote><p>默认值：1000（毫秒）</p></blockquote><h2 id="NodeManager相关配置参数"><a href="#NodeManager相关配置参数" class="headerlink" title="NodeManager相关配置参数"></a>NodeManager相关配置参数</h2><ul><li>yarn.nodemanager.resource.memory-mb</li></ul><blockquote><p>参数解释：NodeManager总的可用物理内存。注意，该参数是不可修改的，一旦设置，整个运行过程中不可动态修改。另外，该参数的默认值是8192MB，即使你的机器内存不够8192MB，YARN也会按照这些内存来使用（傻不傻？），因此，这个值通过一定要配置。不过，Apache已经正在尝试将该参数做成可动态修改的。</p></blockquote><blockquote><p>默认值：8192</p></blockquote><ul><li>yarn.nodemanager.vmem-pmem-ratio</li></ul><blockquote><p>参数解释：每使用1MB物理内存，最多可用的虚拟内存数。</p></blockquote><blockquote><p>默认值：2.1</p></blockquote><ul><li>yarn.nodemanager.resource.cpu-vcores</li></ul><blockquote><p>参数解释：NodeManager总的可用虚拟CPU个数。</p></blockquote><blockquote><p>默认值：8</p></blockquote><ul><li>yarn.nodemanager.local-dirs</li></ul><blockquote><p>参数解释：中间结果存放位置，类似于1.0中的mapred.local.dir。注意，这个参数通常会配置多个目录，已分摊磁盘IO负载。</p></blockquote><blockquote><p>默认值：${hadoop.tmp.dir}/nm-local-dir</p></blockquote><ul><li>yarn.nodemanager.log-dirs</li></ul><blockquote><p>参数解释：日志存放地址（可配置多个目录）。</p></blockquote><blockquote><p>默认值：${yarn.log.dir}/userlogs</p></blockquote><ul><li>yarn.nodemanager.log.retain-seconds</li></ul><blockquote><p>参数解释：NodeManager上日志最多存放时间（不启用日志聚集功能时有效）。</p></blockquote><blockquote><p>默认值：10800（3小时）</p></blockquote><ul><li>yarn.nodemanager.aux-services</li></ul><blockquote><p>参数解释：NodeManager上运行的附属服务。需配置成mapreduce_shuffle，才可运行MapReduce程序</p></blockquote><blockquote><p>默认值：“”</p></blockquote><h2 id="端口总结"><a href="#端口总结" class="headerlink" title="端口总结"></a>端口总结</h2><table><thead><tr><th>端口</th><th>参数</th></tr></thead><tbody><tr><td>9000</td><td>fs.defaultFS，如：hdfs://172.25.40.171:9000</td></tr><tr><td>9001</td><td>dfs.namenode.rpc-address，DataNode会连接这个端口</td></tr><tr><td>50070</td><td>dfs.namenode.http-address</td></tr><tr><td>50470</td><td>dfs.namenode.https-address</td></tr><tr><td>50100</td><td>dfs.namenode.backup.address</td></tr><tr><td>50105</td><td>dfs.namenode.backup.http-address</td></tr><tr><td>50090</td><td>dfs.namenode.secondary.http-address，如：172.25.39.166:50090</td></tr><tr><td>50091</td><td>dfs.namenode.secondary.https-address，如：172.25.39.166:50091</td></tr><tr><td>50020</td><td>dfs.datanode.ipc.address</td></tr><tr><td>50075</td><td>dfs.datanode.http.address</td></tr><tr><td>50475</td><td>dfs.datanode.https.address</td></tr><tr><td>50010</td><td>dfs.datanode.address，DataNode的数据传输端口</td></tr><tr><td>8480</td><td>dfs.journalnode.rpc-address</td></tr><tr><td>8481</td><td>dfs.journalnode.https-address</td></tr><tr><td>8032</td><td>yarn.resourcemanager.address</td></tr><tr><td>8088</td><td>yarn.resourcemanager.webapp.address，YARN的http端口</td></tr><tr><td>8090</td><td>yarn.resourcemanager.webapp.https.address</td></tr><tr><td>8030</td><td>yarn.resourcemanager.scheduler.address</td></tr><tr><td>8031</td><td>yarn.resourcemanager.resource-tracker.address</td></tr><tr><td>8033</td><td>yarn.resourcemanager.admin.address</td></tr><tr><td>8042</td><td>yarn.nodemanager.webapp.address</td></tr><tr><td>8040</td><td>yarn.nodemanager.localizer.address</td></tr><tr><td>8188</td><td>yarn.timeline-service.webapp.address</td></tr><tr><td>10020</td><td>mapreduce.jobhistory.address</td></tr><tr><td>19888</td><td>mapreduce.jobhistory.webapp.address</td></tr><tr><td>2888</td><td>ZooKeeper，如果是Leader，用来监听Follower的连接</td></tr><tr><td>3888</td><td>ZooKeeper，用于Leader选举</td></tr><tr><td>2181</td><td>ZooKeeper，用来监听客户端的连接</td></tr><tr><td>60010</td><td>hbase.master.info.port，HMaster的http端口</td></tr><tr><td>60000</td><td>hbase.master.port，HMaster的RPC端口</td></tr><tr><td>60030</td><td>hbase.regionserver.info.port，HRegionServer的http端口</td></tr><tr><td>60020</td><td>hbase.regionserver.port，HRegionServer的RPC端口</td></tr><tr><td>8080</td><td>hbase.rest.port，HBase REST server的端口</td></tr><tr><td>10000</td><td>hive.server2.thrift.port</td></tr><tr><td>9083</td><td>hive.metastore.uris</td></tr></tbody></table><h2 id="Hadoop配置文件的层级关系"><a href="#Hadoop配置文件的层级关系" class="headerlink" title="Hadoop配置文件的层级关系"></a>Hadoop配置文件的层级关系</h2><p>  在Hadoop源码Configuration类中，先后加载了core-default.xml 和 core-site.xml ;类HdfsConfiguration继承了Configuration类，因此，hdfs-site.xml中的配置如果在core-site.xml 中配置了，那么将覆盖掉这个配置。 同理，yarn-site.xml也是这样的。</p><h2 id="yarn-site-xml-重点配置讲解"><a href="#yarn-site-xml-重点配置讲解" class="headerlink" title="yarn-site.xml 重点配置讲解"></a>yarn-site.xml 重点配置讲解</h2><h3 id="与-memery-相关的配置"><a href="#与-memery-相关的配置" class="headerlink" title="与 memery 相关的配置"></a>与 memery 相关的配置</h3><ul><li>yarn.nodemanager.resource.memery-mb : 重要</li></ul><blockquote><p>指定NodeManager（NM）可用的内存大小，NM是yarn中的一个组件，是一个Jave服务。这内存值是指NM管理的，用于AppMaster和Map Task 和 Reduce Task 可申请的内存数目。这里主要考虑和Linux系统的协调，避免设置过大被Linux的（Out of Memary Killer）OOMK 杀掉。例如2G的内存，设置为1200（1.2G）是可行的。<br>默认配置被设置为8G，Hadoop就任务NM上就有8G的内存，因此当运行内存过大时，就有可能被linux被OOMK终结。 </p></blockquote><ul><li>yarn.scheduler.minimum-allocation-mb: </li></ul><blockquote><p>单个任务(每个Container)可申请最少内存，默认1024MB , 就是单个任务要申请的资源的话，ResourceManager(RM)会至少给你分配的内存数，即使你申请了1MB，也会派给你1024MB，因此这个地方需要根据机器配置和作业需求提前配置。 </p></blockquote><ul><li>yarn.scheduler.increment-allocation-mb </li></ul><blockquote><p>当一个Container拿到的最小内存不足以运行时，他可以申请内存递增，这个配置是配的递增的幅度。 </p></blockquote><ul><li>yarn.scheduler.maximum-allocation-mb </li></ul><blockquote><p>每个Container最多拿到的内存的数量，这里设置的是一个上限，Container申请资源时可递增直到满足运行需求，但是如果到了上限，就不能递增了。 </p></blockquote><blockquote><p>例：若yarn.scheduler.minimum-allocation-mb是50，yarn.scheduler.increment-allocation-mb是40，当申请60mb的时候，实际申请是80（50 &lt; 60 &lt; 40 * 2 ），当申请30mb的时候，实际是50（30 &lt; 50，就是小于min）。</p></blockquote><h3 id="与CPU相关的配置"><a href="#与CPU相关的配置" class="headerlink" title="与CPU相关的配置"></a>与CPU相关的配置</h3><p>与上节节相似，也可以配置CPU的相应信息： </p><ul><li>yarn.scheduler.minimum-allocation-vcores </li><li>yarn.scheduler.increment-allocation-vcores </li><li>yarn.scheduler.maximum-allocation-vcores</li></ul><h2 id="mapred-site-xml-重点配置讲解"><a href="#mapred-site-xml-重点配置讲解" class="headerlink" title="mapred-site.xml 重点配置讲解"></a>mapred-site.xml 重点配置讲解</h2><h3 id="MR-AppMaster-相关"><a href="#MR-AppMaster-相关" class="headerlink" title="MR AppMaster 相关"></a>MR AppMaster 相关</h3><ul><li>yarn.app.mapreduce.am.resource.mb </li><li>yarn.app.mapreduce.am.resource.cpu-vcores </li></ul><blockquote><p>这里am指 Yarn中AppMaster，针对MapReduce计算框架就是MR AppMaster，通过配置这两个选项，可以设定MR AppMaster使用的内存和cpu数量。 默认情况下，yarn.app.mapreduce.am.resource.mb是2G，因此这里必须配置，需要少于yarn.scheduler.minimum-allocation-mb的配置，这样才能成功启动。</p></blockquote><h3 id="map、reduce-task-相关"><a href="#map、reduce-task-相关" class="headerlink" title="map、reduce task 相关"></a>map、reduce task 相关</h3><ul><li>mapreduce.map.memory.mb、mapreduce.map.cpu.vcores、mapreduce.reduce.memory.mb、mapreduce.reduce.cpu.vcores <blockquote><p>配置每个map 和 reduce 最多可以申请的内存和cpu数量;如果是单机情况，这里的资源和MR AppMaster 时共存和竞争关系，且都应在yarn.scheduler.minimum-allocation-mb之下，MR AppMaster启动成功后，剩下的资源才用于map、reduce task。</p></blockquote></li></ul><h2 id="JVM-启动时参数设置"><a href="#JVM-启动时参数设置" class="headerlink" title="JVM 启动时参数设置"></a>JVM 启动时参数设置</h2><ul><li>mapreduce.map.java.opts、mapreduce.reduce.java.opts <blockquote><p>Java task启动时使用的参数;例如设置Java heap 的大小，会在启动map或者reduce进程时把这些参数附加在启动命令之后。<br>这个地方需要仔细配置，配置不当会引起JVM 不能正常GC。 </p></blockquote></li></ul><p>例如：</p><ul><li>mapreduce.map.memory.mb 设置为了500MB</li><li>mapreduce.map.java.opts 设置为 -Xmx600m</li><li>假设CG为JVM中内存占用达到90%时触发，也就是540MB时会触发<br>这时，由于mapreduce.map.memory.mb的限制，map 进程会被提前Kill掉，因此GC永远得不到触发。</li></ul><h2 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h2><ul><li>fs.defaultFS（老版本是fs.default.name） </li></ul><blockquote><p>默认使用的文件系统类型（hdfs://host1:8020/、viewfs://nsX）</p></blockquote><ul><li>fs.trash.interval </li></ul><blockquote><p>垃圾箱文件保留多久（单位：分钟）</p></blockquote><ul><li>io.compression.codecs </li></ul><blockquote><p>Java codec</p></blockquote><ul><li>hadoop.security.authentication </li></ul><blockquote><p>Hadoop使用的认证方法（simple或kerberos）</p></blockquote><h2 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h2><p>• dfs.namenode.name.dir<br>– namenode存放fsimage的目录</p><p>• dfs.datanode.data.dir<br>– datanode存放数据块文件的目录</p><p>• dfs.namenode.checkpoint.dir<br>– Secondarynamenode启动时使用，放置sn做合并的fsimage及 editlog</p><p>• dfs.replication<br>– 数据副本数</p><p>• dfs.blocksize<br>– 文件Block大小</p><p>• dfs.datanode.handler.count<br>– Datanode IPC 请求处理线程数</p><h2 id="yarn-site-xml其他配置"><a href="#yarn-site-xml其他配置" class="headerlink" title="yarn-site.xml其他配置"></a>yarn-site.xml其他配置</h2><ul><li><p>yarn.resourcemanager.hostname、yarn.resourcemanager.address、yarn.resourcemanager.admin.address<br>、yarn.resourcemanager.scheduler.address、 yarn.resourcemanager.resource-tracker.address、<br>yarn.resourcemanager.webapp.address等项目的基本，依据实际rm 的hostname配置</p></li><li><p>yarn.scheduler.minimum-allocation-mb </p></li></ul><blockquote><p>Yarn分配内存的最小单位</p></blockquote><ul><li>yarn.scheduler.increment -allocation-mb </li></ul><blockquote><p>内存分配递增最小单位</p></blockquote><ul><li>yarn.scheduler.maximum-allocation-mb </li></ul><blockquote><p>每个container最多申请的内存上限</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-vcores、<br>yarn.scheduler.increment -allocation-vcores、<br>yarn.scheduler.maximum-allocation-vcores </li></ul><blockquote><p>跟以上内存相关的意义相同</p></blockquote><ul><li>yarn.resourcemanager.am.max-retries </li></ul><blockquote><p>AM失败重试次数</p></blockquote><ul><li>yarn.am.liveness-monitor.expiry-interval-ms </li></ul><blockquote><p>AM多久不上报心跳被视为过期</p></blockquote><ul><li>yarn.resourcemanager.nm.liveness-monitor.interval-ms </li></ul><blockquote><p>多久检查一次nm是否还存活</p></blockquote><ul><li>yarn.application.classpath </li></ul><blockquote><p>Yarn application使用的classpath</p></blockquote><ul><li>yarn.resourcemanager.scheduler.class </li></ul><blockquote><p>调度器定义，如 org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</p></blockquote><ul><li>yarn.scheduler.fair.user -as-default -queue </li></ul><blockquote><p>对于fairscheduler使用，是否使用用户名作为任务进入的queue</p></blockquote><ul><li>yarn.scheduler.fair.preemption </li></ul><blockquote><p>Fairescheduler是否支持queue之间任务抢占</p></blockquote><ul><li>yarn.resourcemanager.max-completed-applications </li></ul><blockquote><p>RM中保留的最大的已完成的任务信息数量</p></blockquote><ul><li>yarn.nodemanager.resource.memory-mb </li></ul><blockquote><p>Nm的可用内存</p></blockquote><ul><li>yarn.nodemanager.local-dirs </li></ul><blockquote><p>Nm本地文件目录（主要是一些cache)</p></blockquote><ul><li>yarn.nodemanager.log-dirs </li></ul><blockquote><p>Nm log目录</p></blockquote><ul><li>yarn.nodemanager.remote-app-log-dir、yarn.logaggregation.retain-seconds、yarn.log-aggregationenable、yarn.nodemanager.logaggregation.compression-type </li></ul><blockquote><p>启动log aggregation的时候使用参数</p></blockquote><ul><li>yarn.app.mapreduce.am.staging-dir </li></ul><blockquote><p>Staging目录，hdfs</p></blockquote><h2 id="mapred-site-xml-其他配置讲解"><a href="#mapred-site-xml-其他配置讲解" class="headerlink" title="mapred-site.xml 其他配置讲解"></a>mapred-site.xml 其他配置讲解</h2><ul><li>mapreduce.map.speculative、mapreduce.reduce.speculative </li></ul><blockquote><p>是否开启预测执行</p></blockquote><ul><li>mapreduce.job.reduce.slowstart.completedmaps </li></ul><blockquote><p>Map完成多少之后开始启动reduce</p></blockquote><ul><li>mapreduce.jobhistory.address、mapreduce.jobhistory.webapp.address </li></ul><blockquote><p>Jobhistory地址</p></blockquote><ul><li>mapreduce.framework.name </li></ul><blockquote><p>local, classic or yarn</p></blockquote><ul><li>yarn.app.mapreduce.am.staging -dir、yarn.app.mapreduce.am.resource.mb<br>、yarn.app.mapreduce.am.resource.cpu-vcores、 yarn.app.mapreduce.am.command-opts</li></ul><blockquote><p>Am相关配置 </p></blockquote><ul><li>mapreduce.map.java.opts、mapreduce.reduce.java.opts </li></ul><blockquote><p>Java task启动时使用的参数</p></blockquote><ul><li>mapreduce.map.memory.mb、mapreduce.map.cpu.vcores、mapreduce.reduce.memory.mb、mapreduce.reduce.cpu.vcores </li></ul><blockquote><p>Map/reduce任务资源设置</p></blockquote><ul><li>mapreduce.application.classpath </li></ul><blockquote><p>Task使用的classpath</p></blockquote><h2 id="问答"><a href="#问答" class="headerlink" title="问答"></a>问答</h2><ul><li>yarn.scheduler.minimum-allocation-mb，为app分配内存时最小的配额。 </li><li>yarn.scheduler.increment-allocation-mb，每次递加申请的内存资源数，比如，若yarn.scheduler.minimum-allocation-mb是50，yarn.scheduler.increment-allocation-mb是40，当申请60mb的时候，实际申请是80（50 &lt; 60 &lt; 40 * 2 ），当申请30mb的时候，实际是50（30 &lt; 50，就是小于min）。 </li><li><p>yarn.scheduler.maximum-allocation-mb，单个container可分配的内存总量上限。</p></li><li><p>yarn.app.mapreduce.am.resource.mb，执行appManager时需要分配的内存。 </p></li><li>mapreduce.map.memory.mb，map任务执行时要申请的内存。 </li><li>mapreduce.reduce.memory.mb，reduce任务执行时要申请的内存。 </li><li>mapreduce.task.io.sort.mb，任务在做spill时，内存的缓存量，之所以提出来，因为当我们将mapreduce.map.memory.mb和apreduce.reduce.memory.mb减小时，需要将这个值也减小，否则会出现task任务资源不够跑不成功的问题</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;hadoop配置说明&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="hadoop" scheme="https://zixujing.github.io/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>neo4j 3.5.4 配置</title>
    <link href="https://zixujing.github.io/2019/07/08/bigdata/neo4j.%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/07/08/bigdata/neo4j.配置/</id>
    <published>2019-07-07T16:00:00.000Z</published>
    <updated>2019-09-15T08:25:06.064Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>neo4j 配置<br><a id="more"></a></p></blockquote><h2 id="neo4j-配置"><a href="#neo4j-配置" class="headerlink" title="neo4j 配置"></a>neo4j 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dbms.directories.import=import</span><br><span class="line">dbms.allow_upgrade=true</span><br><span class="line">dbms.connectors.default_listen_address=192.168.11.117</span><br><span class="line">dbms.connector.bolt.enabled=true</span><br><span class="line">dbms.connector.bolt.listen_address=:7687</span><br><span class="line">dbms.connector.http.enabled=true</span><br><span class="line">dbms.connector.http.listen_address=:7474</span><br><span class="line">dbms.connector.https.enabled=true</span><br><span class="line">dbms.mode=HA</span><br><span class="line">ha.server_id=3</span><br><span class="line">ha.initial_hosts=192.168.11.119:5001,192.168.11.118:5001,192.168.11.117:5001</span><br><span class="line">dbms.security.allow_csv_import_from_file_urls=true</span><br><span class="line">dbms.jvm.additional=-XX:+UseG1GC</span><br><span class="line">dbms.jvm.additional=-XX:-OmitStackTraceInFastThrow</span><br><span class="line">dbms.jvm.additional=-XX:+AlwaysPreTouch</span><br><span class="line">dbms.jvm.additional=-XX:+UnlockExperimentalVMOptions</span><br><span class="line">dbms.jvm.additional=-XX:+TrustFinalNonStaticFields</span><br><span class="line">dbms.jvm.additional=-XX:+DisableExplicitGC</span><br><span class="line">dbms.jvm.additional=-Djdk.tls.ephemeralDHKeySize=2048</span><br><span class="line">dbms.jvm.additional=-Djdk.tls.rejectClientInitiatedRenegotiation=true</span><br><span class="line">dbms.windows_service_name=neo4j</span><br><span class="line">dbms.jvm.additional=-Dunsupported.dbms.udc.source=tarball</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;neo4j 配置&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
      <category term="neo4j" scheme="https://zixujing.github.io/tags/neo4j/"/>
    
  </entry>
  
  <entry>
    <title>ansible2.3离线安装和离线安装包</title>
    <link href="https://zixujing.github.io/2019/06/26/linux/linux%E5%B7%A5%E5%85%B7/ansible2.3%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%92%8C%E5%AE%89%E8%A3%85%E5%8C%85/"/>
    <id>https://zixujing.github.io/2019/06/26/linux/linux工具/ansible2.3离线安装和安装包/</id>
    <published>2019-06-25T21:00:00.000Z</published>
    <updated>2019-06-26T17:53:05.330Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ansible2.3离线安装和离线安装包<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">## 初始化</span><br><span class="line"></span><br><span class="line">yum install python-devel openssl-devel</span><br><span class="line"></span><br><span class="line">## 1.创建文件夹</span><br><span class="line">#mkdir -p /usr/local/src/ansible</span><br><span class="line"></span><br><span class="line">## 2. 安装setuptools</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf setuptools-7.0.tar.gz</span><br><span class="line">cd setuptools-7.0</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 3. 安装pycrypto</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf pycrypto-2.6.1.tar.gz</span><br><span class="line">cd pycrypto-2.6.1</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 4. 安装yaml</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf yaml-0.1.5.tar.gz</span><br><span class="line">cd yaml-0.1.5</span><br><span class="line">./configure --prefix=/usr/local</span><br><span class="line">make --jobs=`grep processor /proc/cpuinfo | wc -l`</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">## 5. 安装PyYAML</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf PyYAML-3.11.tar.gz</span><br><span class="line">cd PyYAML-3.11  </span><br><span class="line">python setup.py install  </span><br><span class="line">  </span><br><span class="line">## 6. 安装MarkupSafe  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf MarkupSafe-0.9.3.tar.gz</span><br><span class="line">cd MarkupSafe-0.9.3  </span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 7. 安装Jinja2  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf Jinja2-2.7.3.tar.gz  </span><br><span class="line">cd Jinja2-2.7.3  </span><br><span class="line">python setup.py install  </span><br><span class="line">  </span><br><span class="line">## 8. 安装ecdsa  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf ecdsa-0.11.tar.gz</span><br><span class="line">cd ecdsa-0.11  </span><br><span class="line">python setup.py install  </span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf paramiko-1.15.1.tar.gz</span><br><span class="line">cd paramiko-1.15.1</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 9. 安装simplejson</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf simplejson-3.6.5.tar.gz</span><br><span class="line">cd simplejson-3.6.5</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 10. 安装ansible</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf ansible-2.3.1.0.tar.gz</span><br><span class="line">cd ansible-2.3.1.0</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 11. 安装sshpass</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">cd sshpass-1.06</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="安装包位置"><a href="#安装包位置" class="headerlink" title="安装包位置"></a>安装包位置</h2><p><a href="https://raw.githubusercontent.com/zixujing/book1.github.io/master/code/ansible%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85.zip" target="_blank" rel="noopener">ansible离线安装包</a></p><h2 id="配置例子"><a href="#配置例子" class="headerlink" title="配置例子"></a>配置例子</h2><h3 id="统一成一个命令"><a href="#统一成一个命令" class="headerlink" title="统一成一个命令"></a>统一成一个命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/perl</span><br><span class="line">%command=(</span><br><span class="line"></span><br><span class="line">#所有机器就绪状态</span><br><span class="line"></span><br><span class="line">1,qq \ansible all -m ping\,</span><br><span class="line"></span><br><span class="line">#服务监控</span><br><span class="line"></span><br><span class="line">2, qq \ansible http-service -m shell -a &quot;systemctl status tomcat8_pf | grep Active:&quot;\,</span><br><span class="line">3, qq \ansible http-service -m shell -a &quot;systemctl status tomcat8_sdk | grep Active:&quot;\,</span><br><span class="line">4, qq \ansible http-service -m shell -a &quot;df -H /dev/mapper/cl-home;du -sm /home/hch54&quot;\,</span><br><span class="line"></span><br><span class="line">#服务启动与结束</span><br><span class="line">5, qq \ansible 72 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">6, qq \ansible 73 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">7, qq \ansible 74 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">8, qq \ansible 72 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line">9, qq \ansible 73 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line">10, qq \ansible 74 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line"></span><br><span class="line">11, qq \ansible 72 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">12, qq \ansible 73 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">13, qq \ansible 74 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">14, qq \ansible 72 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line">15, qq \ansible 73 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line">16, qq \ansible 74 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#nginx监控</span><br><span class="line">17,qq \ansible nginx -m shell -a &quot;systemctl status nginx | grep Active:&quot;\,</span><br><span class="line">18,qq \ansible nginx -m shell -a &quot;systemctl status keepalived | grep Active:&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">19,qq \ansible 74 -m shell -a &quot;systemctl start nginx&quot;\,</span><br><span class="line">20,qq \ansible 74 -m shell -a &quot;systemctl stop nginx&quot;\,</span><br><span class="line">21,qq \ansible 48 -m shell -a &quot;systemctl start nginx&quot;\,</span><br><span class="line">22,qq \ansible 48 -m shell -a &quot;systemctl stop nginx&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">23,qq \ansible 48 -m shell -a &quot;nginx -s reload&quot;\,</span><br><span class="line"></span><br><span class="line">#kafka</span><br><span class="line"></span><br><span class="line">24,qq /ansible kafka -m shell -a &quot;ss -nlt | egrep \\&quot;(:2181)|(:9092)\\&quot;&quot;/,</span><br><span class="line">25,qq \ansible 127 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line">26,qq \ansible 128 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line">27,qq \ansible 134 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">28,qq \ansible 127 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line">29,qq \ansible 128 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line">30,qq \ansible 134 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line"></span><br><span class="line">#mysql</span><br><span class="line">31,q \ansible 26 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p12qWe@#$% -e&apos;show master status&apos;&quot;\,</span><br><span class="line">32,qq !ansible 25 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p123456 -e&apos;show slave status\G&apos;&quot;!,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">33,qq \ansible 26 -m shell -a &quot;systemctl status mysqld&quot;\,</span><br><span class="line">34,qq \ansible 25 -m shell -a &quot;systemctl status mysql&quot;\,</span><br><span class="line"></span><br><span class="line">35,qq \ansible 26 -m shell -a &quot;systemctl start mysqld&quot;\,</span><br><span class="line">36,qq \ansible 25 -m shell -a &quot;systemctl start mysql&quot;\,</span><br><span class="line">37,qq \ansible 26 -m shell -a &quot;systemctl stop mysqld&quot;\,</span><br><span class="line">38,qq \ansible 25 -m shell -a &quot;systemctl stop mysql&quot;\,</span><br><span class="line"></span><br><span class="line">39,qq !ansible 25 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p123456 -e&apos;start slave&apos;&quot;!,</span><br><span class="line"></span><br><span class="line">#oracle</span><br><span class="line">40,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl status|grep READY&quot;\,</span><br><span class="line">41,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl stop&quot;\,</span><br><span class="line">42,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl start&quot;\,</span><br><span class="line"></span><br><span class="line">43,q !ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile; echo -e  &apos;select open_mode,dbid from v\\$database;&apos; | sqlplus / as sysdba | grep 1526735889&quot;!,</span><br><span class="line"></span><br><span class="line">44,qq \ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile;dbstart&quot;\,</span><br><span class="line">45,qq \ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile;dbshut&quot;\,</span><br><span class="line"></span><br><span class="line">#redis</span><br><span class="line">46,qq _ansible redis -m shell -a &quot;ss -nlt | egrep \\&quot;(:6500)|(:6600)\\&quot;&quot;_,</span><br><span class="line">47,qq \ansible 81 -m shell -a &quot;redis-server /home/redis_copy/6500/redis.conf&quot;\,</span><br><span class="line">48,qq \ansible 81 -m shell -a &quot;redis-sentinel /home/redis_copy/6600/sentinel.conf&quot;\,</span><br><span class="line">49,qq \ansible 84 -m shell -a &quot;redis-server /home/redis_copy/6500/redis.conf&quot;\,</span><br><span class="line"></span><br><span class="line">#activemq</span><br><span class="line">50,qq \ansible 85 -m shell -a &quot;systemctl status activemq|grep Active&quot;\,</span><br><span class="line">51,qq \ansible 85 -m shell -a &quot;systemctl stop activemq&quot;\,</span><br><span class="line">52,qq \ansible 85 -m shell -a &quot;systemctl start activemq&quot;\,</span><br><span class="line">53,qq \ansible 85 -m shell -a &quot;df -h /dev/mapper/cl-home&quot;\,</span><br><span class="line"></span><br><span class="line">#文件服务器</span><br><span class="line">54,qq \ansible 83 -m shell -a &quot;df -h | grep -v tmp&quot;\,</span><br><span class="line">55,qq \ansible 83 -m shell -a &quot;systemctl status fdfs_storaged |grep Active ; systemctl status fdfs_trackerd |grep Active&quot;\,</span><br><span class="line"></span><br><span class="line">56,qq \ansible 83 -m shell -a &quot;systemctl stop fdfs_storaged ; systemctl stop fdfs_trackerd &quot;\,</span><br><span class="line">57,qq \ansible 83 -m shell -a &quot;systemctl start fdfs_storaged ; systemctl start fdfs_trackerd &quot;\,</span><br><span class="line"></span><br><span class="line">#mpp</span><br><span class="line">58,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstate&quot;\,</span><br><span class="line">59,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstart&quot;\,</span><br><span class="line">60,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstop&quot;\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#结束括号</span><br><span class="line">);</span><br><span class="line">#for debug</span><br><span class="line">#print $command&#123;$ARGV[0]&#125;,&quot;\n&quot;;</span><br><span class="line">$info=qx | $command&#123;$ARGV[0]&#125;|;</span><br><span class="line">print $info;</span><br></pre></td></tr></table></figure><h3 id="做成一个网页"><a href="#做成一个网页" class="headerlink" title="做成一个网页"></a>做成一个网页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/python</span><br><span class="line">#coding=utf8</span><br><span class="line">from BaseHTTPServer import HTTPServer,BaseHTTPRequestHandler</span><br><span class="line">import urllib</span><br><span class="line">import commands</span><br><span class="line">class ServerHttp(BaseHTTPRequestHandler):</span><br><span class="line">def do_GET(self):</span><br><span class="line">path=self.path</span><br><span class="line">#print path</span><br><span class="line">query=urllib.splitquery(path)</span><br><span class="line">#print query[1]</span><br><span class="line">#print query[0]</span><br><span class="line">body_data=None</span><br><span class="line">if(query[0]==&quot;/system&quot; and query[1] is not None):</span><br><span class="line">body_data=commands.getstatusoutput(&quot;hch_state %s&quot;%query[1])</span><br><span class="line">#print &quot;hch_state %s&quot;%query[1]</span><br><span class="line">self.send_response(200)</span><br><span class="line">self.send_header(&quot;Content-type&quot;,&quot;text/html&quot;)</span><br><span class="line">self.send_header(&quot;(^_^)&quot;,&quot;?? !&quot;)</span><br><span class="line">self.end_headers()</span><br><span class="line">buf1=&apos;&apos;&apos;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html;charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;icon&quot; href=&quot;data:;base64,=&quot;/&gt;</span><br><span class="line">&lt;title&gt;(^_^)&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;请点击以下各个链接&lt;/h1&gt;</span><br><span class="line">&lt;font size=&quot;20&quot;&gt;</span><br><span class="line">&lt;a href=&quot;?tag=1&quot;&gt;1&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=2&quot;&gt;2&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=3&quot;&gt;3&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=4&quot;&gt;4&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=5&quot;&gt;5&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=6&quot;&gt;6&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=7&quot;&gt;7&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=8&quot;&gt;8&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=9&quot;&gt;9&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=10&quot;&gt;10&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=11&quot;&gt;11&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=12&quot;&gt;12&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=13&quot;&gt;13&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=14&quot;&gt;14&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=15&quot;&gt;15&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=16&quot;&gt;16&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=17&quot;&gt;17&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=18&quot;&gt;18&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=19&quot;&gt;19&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=20&quot;&gt;20&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;a href=&quot;?tag=21&quot;&gt;21&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=22&quot;&gt;22&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=23&quot;&gt;23&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=24&quot;&gt;24&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=25&quot;&gt;25&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=26&quot;&gt;26&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=27&quot;&gt;27&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=28&quot;&gt;28&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=29&quot;&gt;29&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=30&quot;&gt;30&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=31&quot;&gt;31&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=32&quot;&gt;32&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=33&quot;&gt;33&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=34&quot;&gt;34&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=35&quot;&gt;35&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=36&quot;&gt;36&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=37&quot;&gt;37&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=38&quot;&gt;38&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=39&quot;&gt;39&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=40&quot;&gt;40&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;a href=&quot;?tag=41&quot;&gt;41&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=42&quot;&gt;42&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=43&quot;&gt;43&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=44&quot;&gt;44&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=45&quot;&gt;45&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=46&quot;&gt;46&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=47&quot;&gt;47&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=48&quot;&gt;48&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=49&quot;&gt;49&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=50&quot;&gt;50&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=51&quot;&gt;51&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=52&quot;&gt;52&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=53&quot;&gt;53&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=54&quot;&gt;54&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=55&quot;&gt;55&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=56&quot;&gt;56&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=57&quot;&gt;57&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=58&quot;&gt;58&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=59&quot;&gt;59&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=60&quot;&gt;60&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;/font&gt;</span><br><span class="line">&lt;font size=8&gt;</span><br><span class="line">&lt;table border=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;1.所有服务器是否在线&lt;/td&gt;</span><br><span class="line">&lt;td&gt;2.核查平台服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;3.sdk服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;4.平台服务磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;5.核查平台服务启动72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;6.核查平台服务启动73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;7.核查平台服务启动74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;8.核查平台服务关闭72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;9.核查平台服务关闭73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;10.核查平台服务关闭74&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;11.sdk服务启动72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;12.sdk服务启动73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;13.sdk服务启动74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;14.sdk服务关闭72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;15.sdk服务关闭73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;16.sdk服务关闭74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;17.nginx服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;18.keepalived服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;19.启动nginx74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;20.关闭nginx74&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;21.启动nginx48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;22.关闭nginx48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;23.重载nginx配置48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;24.kafka状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;25.启动kafka127&lt;/td&gt;</span><br><span class="line">&lt;td&gt;26.启动kafka128&lt;/td&gt;</span><br><span class="line">&lt;td&gt;27.启动kafka134&lt;/td&gt;</span><br><span class="line">&lt;td&gt;28.启动zookeeper127&lt;/td&gt;</span><br><span class="line">&lt;td&gt;29.启动zookeeper128&lt;/td&gt;</span><br><span class="line">&lt;td&gt;30.启动zookeeper1134&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;31.26mysql master status&lt;/td&gt;</span><br><span class="line">&lt;td&gt;32.25mysql slave status&lt;/td&gt;</span><br><span class="line">&lt;td&gt;33.26mysql服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;34.25mysql服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;35.26mysql启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;36.25mysql启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;37.26mysql关闭&lt;/td&gt;</span><br><span class="line">&lt;td&gt;38.25mysql关闭&lt;/td&gt;</span><br><span class="line">&lt;td&gt;39.25mysql start slave&lt;/td&gt;</span><br><span class="line">&lt;td&gt;40.oracle监听状态&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;41.oracle监听结束&lt;/td&gt;</span><br><span class="line">&lt;td&gt;42.oracle监听启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;43.oracle状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;44.启动oracle&lt;/td&gt;</span><br><span class="line">&lt;td&gt;45.关闭oracle&lt;/td&gt;</span><br><span class="line">&lt;td&gt;46.redis状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;47.81启动redis&lt;/td&gt;</span><br><span class="line">&lt;td&gt;48.81启动哨兵&lt;/td&gt;</span><br><span class="line">&lt;td&gt;49.84启动redis&lt;/td&gt;</span><br><span class="line">&lt;td&gt;50.activemq状态&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;51.结束activemq&lt;/td&gt;</span><br><span class="line">&lt;td&gt;52.启动activemq&lt;/td&gt;</span><br><span class="line">&lt;td&gt;53.activemq磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;54.83文件服务磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;55.fastdfs状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;56.关闭fastdfs&lt;/td&gt;</span><br><span class="line">&lt;td&gt;57.启动fastdfs&lt;/td&gt;</span><br><span class="line">&lt;td&gt;58.mpp状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;59.mpp启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;60.mpp关闭&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/font&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;h1&gt;下面是返回信息&lt;/h1&gt;</span><br><span class="line">&lt;p align=&quot;center&quot;&gt;</span><br><span class="line">&lt;textarea readonly rows=&quot;100&quot; cols=&quot;180&quot;&gt;&apos;&apos;&apos;</span><br><span class="line">buf2=&apos;&apos;&apos;&lt;/textarea&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">#print body_data</span><br><span class="line">body_data=body_data if(body_data is not None) else (0,&quot;&quot;)</span><br><span class="line">#print body_data</span><br><span class="line"></span><br><span class="line">self.wfile.write(buf1+body_data[1]+buf2)</span><br><span class="line">def start_server(port):</span><br><span class="line">http_server=HTTPServer((&apos;&apos;,int(port)),ServerHttp)</span><br><span class="line">http_server.serve_forever()</span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">start_server(12345)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ansible2.3离线安装和离线安装包&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>greenplum5.18+centos扩展结点.</title>
    <link href="https://zixujing.github.io/2019/06/12/db/postgresql/greenplum5.18+centos%E6%89%A9%E5%B1%95%E7%BB%93%E7%82%B9/"/>
    <id>https://zixujing.github.io/2019/06/12/db/postgresql/greenplum5.18+centos扩展结点/</id>
    <published>2019-06-11T17:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.477Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>greenplum5.18+centos扩展结点.<br><a id="more"></a></p></blockquote><blockquote><p>扩展结点时，至少需要两个结点</p></blockquote><h2 id="初始化配置，参考安装文档"><a href="#初始化配置，参考安装文档" class="headerlink" title="初始化配置，参考安装文档"></a>初始化配置，参考安装文档</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@mdw ~]# vi /etc/hosts</span><br><span class="line">192.168.11.84 mdw</span><br><span class="line">192.168.11.85 sdw1</span><br><span class="line">192.168.11.86 sdw2</span><br><span class="line">192.168.11.111 sdw3</span><br><span class="line">192.168.11.118 hadoopb</span><br><span class="line"></span><br><span class="line">[root@mdw ~]# vi /etc/sysctl.conf</span><br><span class="line">kernel.shmmax = 500000000</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.shmall = 4000000000</span><br><span class="line">kernel.sem = 500 1024000 200 4096</span><br><span class="line">kernel.sysrq = 1</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line">kernel.msgmni = 2048</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 4096</span><br><span class="line">net.ipv4.conf.all.arp_filter = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1025 65535</span><br><span class="line">net.core.netdev_max_backlog = 10000</span><br><span class="line">net.core.rmem_max = 2097152</span><br><span class="line">net.core.wmem_max = 2097152</span><br><span class="line">vm.overcommit_memory = 2</span><br><span class="line"></span><br><span class="line">[root@mdw ~]# vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nproc 131072</span><br><span class="line">* hard nproc 131072</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">groupadd -g 530 gpadmin</span><br><span class="line">useradd -g 530 -m -d /home/gpadmin -s /bin/bash gpadmin</span><br><span class="line">passwd gpadmin</span><br><span class="line"></span><br><span class="line">mkdir /opt/greenplum</span><br><span class="line">chown gpadmin:gpadmin /opt/greenplum</span><br></pre></td></tr></table></figure><h2 id="主节点上执行"><a href="#主节点上执行" class="headerlink" title="主节点上执行"></a>主节点上执行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$su - gpadmin</span><br><span class="line">$cd conf/</span><br><span class="line">$vi newhost </span><br><span class="line">sdw3</span><br><span class="line">sdw4</span><br><span class="line">$source pgsh##脚本中是环境变量</span><br><span class="line">$cat pgsh</span><br><span class="line">export PGPORT=5432</span><br><span class="line">export PGDATABASE=mydb</span><br><span class="line">export MASTER_DATA_DIRECTORY=/opt/greenplum/data/gpdata/gpmaster/gpseg-1</span><br><span class="line">source /opt/greenplum/greenplum-db/greenplum_path.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$cat hostlist </span><br><span class="line">mdw</span><br><span class="line">sdw1</span><br><span class="line">sdw2</span><br><span class="line">sdw3</span><br><span class="line">sdw4</span><br></pre></td></tr></table></figure><h2 id="配置ssh面密码登录"><a href="#配置ssh面密码登录" class="headerlink" title="配置ssh面密码登录"></a>配置ssh面密码登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpssh-exkeys -f /home/gpadmin/conf/hostlist</span><br></pre></td></tr></table></figure><h2 id="在新节点上安装Greenplum-DB"><a href="#在新节点上安装Greenplum-DB" class="headerlink" title="在新节点上安装Greenplum DB"></a>在新节点上安装Greenplum DB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpseginstall -f /home/gpadmin/conf/newhost</span><br></pre></td></tr></table></figure><h2 id="在两个新加的结点上分别创建目录"><a href="#在两个新加的结点上分别创建目录" class="headerlink" title="在两个新加的结点上分别创建目录"></a>在两个新加的结点上分别创建目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su - gpadmin</span><br><span class="line">mkdir -p /opt/greenplum/data/gpdata</span><br><span class="line">cd /opt/greenplum/data/gpdata</span><br><span class="line">mkdir gpdatam&#123;1,2&#125;  gpdatap&#123;1,2&#125;</span><br><span class="line">##初始化完成</span><br></pre></td></tr></table></figure><h2 id="配置文件input-file"><a href="#配置文件input-file" class="headerlink" title="配置文件input_file"></a>配置文件input_file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">gpexpand -f newhost</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-local Greenplum Version: &apos;postgres (Greenplum Database) 5.18.0 build commit:6aec9959d367d46c6b4391eb9ffc82c735d20102&apos;</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-master Greenplum Version: &apos;PostgreSQL 8.3.23 (Greenplum Database 5.18.0 build commit:6aec9959d367d46c6b4391eb9ffc82c735d20102) on x86_64-pc-linux-gnu, compiled by GCC gcc (GCC) 6.2.0, 64-bit compiled on Apr  3 2019 14:45:51&apos;</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-Querying gpexpand schema for current expansion state</span><br><span class="line"></span><br><span class="line">System Expansion is used to add segments to an existing GPDB array.</span><br><span class="line">gpexpand did not detect a System Expansion that is in progress.</span><br><span class="line"></span><br><span class="line">Before initiating a System Expansion, you need to provision and burn-in</span><br><span class="line">the new hardware.  Please be sure to run gpcheckperf to make sure the</span><br><span class="line">new hardware is working properly.</span><br><span class="line"></span><br><span class="line">Please refer to the Admin Guide for more information.</span><br><span class="line"></span><br><span class="line">Would you like to initiate a new System Expansion Yy|Nn (default=N):</span><br><span class="line">&gt; Y</span><br><span class="line"></span><br><span class="line">You must now specify a mirroring strategy for the new hosts.  Spread mirroring places</span><br><span class="line">a given hosts mirrored segments each on a separate host.  You must be </span><br><span class="line">adding more hosts than the number of segments per host to use this. </span><br><span class="line">Grouped mirroring places all of a given hosts segments on a single </span><br><span class="line">mirrored host.  You must be adding at least 2 hosts in order to use this.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">What type of mirroring strategy would you like?</span><br><span class="line"> spread|grouped (default=grouped):</span><br><span class="line">&gt; 这个选择默认</span><br><span class="line"></span><br><span class="line">    By default, new hosts are configured with the same number of primary</span><br><span class="line">    segments as existing hosts.  Optionally, you can increase the number</span><br><span class="line">    of segments per host.</span><br><span class="line">    </span><br><span class="line">    For example, if existing hosts have two primary segments, entering a value</span><br><span class="line">    of 2 will initialize two additional segments on existing hosts, and four</span><br><span class="line">    segments on new hosts.  In addition, mirror segments will be added for</span><br><span class="line">    these new primary segments if mirroring is enabled.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">How many new primary segments per host do you want to add? (default=0):</span><br><span class="line">&gt; 这里选择默认</span><br><span class="line"></span><br><span class="line">Generating configuration file...</span><br><span class="line"></span><br><span class="line">20190612:18:22:11:023132 gpexpand:mdw:gpadmin-[INFO]:-Generating input file...</span><br><span class="line"></span><br><span class="line">Input configuration files were written to &apos;gpexpand_inputfile_20190612_182211&apos; and &apos;None&apos;.</span><br><span class="line">Please review the file and make sure that it is correct then re-run</span><br><span class="line">with: gpexpand -i gpexpand_inputfile_20190612_182211 -D mydb</span><br><span class="line">                </span><br><span class="line">20190612:18:22:11:023132 gpexpand:mdw:gpadmin-[INFO]:-Exiting...</span><br><span class="line">[gpadmin@mdw conf]$ ls</span><br><span class="line">gpexpand_inputfile_20190612_182211  gpinitsystem_config  hostlist  newhost  pgsh  seg_host</span><br><span class="line">[gpadmin@mdw conf]$ cat gpexpand_inputfile_20190612_182211 </span><br><span class="line">hadoopb:hadoopb:50000:/opt/greenplum/data/gpdata/gpdatap1/gpseg4:10:4:p:51000</span><br><span class="line">sdw3:sdw3:40000:/opt/greenplum/data/gpdata/gpdatam1/gpseg4:16:4:m:41000</span><br><span class="line">hadoopb:hadoopb:50001:/opt/greenplum/data/gpdata/gpdatap2/gpseg5:11:5:p:51001</span><br><span class="line">sdw3:sdw3:40001:/opt/greenplum/data/gpdata/gpdatam2/gpseg5:17:5:m:41001</span><br><span class="line">sdw3:sdw3:50000:/opt/greenplum/data/gpdata/gpdatap1/gpseg6:12:6:p:51000</span><br><span class="line">hadoopb:hadoopb:40000:/opt/greenplum/data/gpdata/gpdatam1/gpseg6:14:6:m:41000</span><br><span class="line">sdw3:sdw3:50001:/opt/greenplum/data/gpdata/gpdatap2/gpseg7:13:7:p:51001</span><br><span class="line">hadoopb:hadoopb:40001:/opt/greenplum/data/gpdata/gpdatam2/gpseg7:15:7:m:41001</span><br></pre></td></tr></table></figure><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpexpand -i gpexpand_inputfile_20190612_193623</span><br></pre></td></tr></table></figure><h2 id="如果扩展失败则执行回滚操作"><a href="#如果扩展失败则执行回滚操作" class="headerlink" title="如果扩展失败则执行回滚操作"></a>如果扩展失败则执行回滚操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpstart -m(或者gpstart -R)</span><br><span class="line">gpexpand -r -D zhangyun_db##可以不带数据库</span><br><span class="line">gpstart -a</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;greenplum5.18+centos扩展结点.&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Maxwell配置详解</title>
    <link href="https://zixujing.github.io/2019/05/29/bigdata/Maxwell%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <id>https://zixujing.github.io/2019/05/29/bigdata/Maxwell配置详解/</id>
    <published>2019-05-28T19:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Maxwell配置详解<br><a id="more"></a></p></blockquote><blockquote><p>mysql options</p><ul><li>host<br>指定从哪个地址的mysql获取binlog</li><li>replication_host<br>如果指定了 replication_host，那么它是真正的binlog来源的mysql server地址，而那么上面的host用于存放maxwell表结构和binlog位置的地址。<br>将两者分开，可以避免 replication_user 往生产库里写数据。</li><li>schema_host<br>从哪个host获取表结构。binlog里面没有字段信息，所以maxwell需要从数据库查出schema，存起来。<br>schema_host一般用不到，但在binlog-proxy场景下就很实用。比如要将已经离线的binlog通过maxwell生成json流，于是自建一个mysql server里面没有结构，只用于发送binlog，此时表机构就可以制动从 schema_host 获取。</li></ul></blockquote><ul><li>gtid_mode<br>如果 mysql server 启用了GTID，maxwell也可以基于gtid取event。如果mysql server发生failover，maxwell不需要手动指定newfile:postion</li></ul><p>正常情况下，replication_host 和 schema_host都不需要指定，只有一个 –host。</p><ul><li>schema_database<br>使用这个db来存放 maxwell 需要的表，比如要复制的databases, tables, columns, postions, heartbeats.</li></ul><blockquote><p>filtering</p><ul><li>include_dbs<br>只发送binlog里面这些databases的变更，以,号分隔，中间不要包含空格。<br>也支持java风格的正则，如 include_tables=db1,/db\d+/，表示 db1, db2, db3…这样的。（下面的filter都支持这种regex）<br>提示：这里的dbs指定的是真实db。比如binlog里面可能 use db1 但 update db2.ttt，那么maxwell生成的json database 内容是db2。</li><li>exclude_dbs<br>排除指定的这些 databbases</li><li>include_tables<br>只发送这些表的数据变更。不只需要指定 database.</li><li>exclude_tables<br>排除指定的这些表</li><li>exclude_columns<br>不输出这些字段。如果字段名在row中不存在，则忽略这个filter。</li><li>include_column_values<br>1.12.0新引入的过滤项。只输出满足 column=values 的行，比如 include_column_values=bar=x,foo=y，如果有bar字段，那么只输出值为x的行，如果有foo字段，那么只输出值为y的行。<br>如果没有对应字段，如只有bar=x没有foo字段，那么也成立。（即不是 或，也不是 与）</li></ul></blockquote><ul><li>blacklist_dbs<br>一般不用。blacklist_dbs字面上难以与exclude_dbs 分开，官网的说明也是模棱两可。<br>从代码里面看出的意思是，屏蔽指定的这些dbs,tables的结构变更，与行变更过滤，没有关系。它应对的场景是，某个表上频繁的有ddl，比如truncate。</li></ul><blockquote><p>formatting</p><ul><li>output_ddl<br>是否在输出的json流中，包含ddl语句。默认 false</li><li>output_binlog_position<br>是否在输出的json流中，包含binlog filename:postion。默认 false</li><li>output_commit_info<br>是否在输出的json流里面，包含 commit 和 xid 信息。默认 true<br>比如一个事物里，包含多个表的变更，或一个表上多条数据的变更，那么他们都具有相同的 xid，最后一个row event输出 commit:true 字段。这有利于消费者实现 事务回放，而不仅仅是行级别的回放。</li><li>output_thread_id<br>同样，binlog里面也包含了 thread_id ，可以包含在输出中。默认 false<br>消费者可以用它来实现更粗粒度的事务回放。还有一个场景是用户审计，用户每次登陆之后将登陆ip、登陆时间、用户名、thread_id记录到一个表中，可轻松根据thread_id关联到binlog里面这条记录是哪个用户修改的。</li><li>monitoring<br>如果是长时间运行的maxwell，添加monitor配置，maxwell提供了http api返回监控数据。</li></ul></blockquote><blockquote><p>其它</p><ul><li>init_position<br>手动指定maxwell要从哪个binlog，哪个位置开始。指定的格式FILE:POSITION:HEARTBEAT。只支持在启动maxwell的命令指定，比如 –init_postion=mysql-bin.0000456:4:0。<br>maxwell 默认从连接上mysql server的当前位置开始解析，如果指定 init_postion，要确保文件确实存在，如果binlog已经被purge掉了，可能需要想其它办法。见 Binlog可视化搜索：实现类似阿里RDS数据追踪功能</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Maxwell配置详解&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="maxwell" scheme="https://zixujing.github.io/tags/maxwell/"/>
    
  </entry>
  
  <entry>
    <title>maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum</title>
    <link href="https://zixujing.github.io/2019/05/29/bigdata/maxwell+bireme+kafka+greenplum%E5%A2%9E%E9%87%8F%E6%8A%BD%E5%8F%96%E6%95%B0%E6%8D%AE%E5%88%B0greenplum/"/>
    <id>https://zixujing.github.io/2019/05/29/bigdata/maxwell+bireme+kafka+greenplum增量抽取数据到greenplum/</id>
    <published>2019-05-28T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum<br><a id="more"></a></p></blockquote><h2 id="Maxwell-数据源"><a href="#Maxwell-数据源" class="headerlink" title="Maxwell 数据源"></a>Maxwell 数据源</h2><h3 id="配置mysql"><a href="#配置mysql" class="headerlink" title="配置mysql"></a>配置mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=master</span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">mysql -uroot -pxxxx</span><br><span class="line"></span><br><span class="line">mysql&gt; create user &apos;maxwell&apos;@&apos;%&apos; identified by &apos;maxwell&apos;;</span><br><span class="line">mysql&gt; GRANT ALL on maxwell.* to &apos;maxwell&apos;@&apos;%&apos;;</span><br><span class="line">mysql&gt; GRANT SELECT, REPLICATION CLIENT, REPLICATION SLAVE on *.* to &apos;maxwell&apos;@&apos;%&apos;;</span><br><span class="line">如果是mysql8 则执行alter user &apos;maxwell&apos;@&apos;%&apos; identified with mysql_native_password by &apos;maxwell&apos;;</span><br><span class="line">mysql&gt; CREATE DATABASE test;</span><br><span class="line">mysql&gt; create table test.test (id int primary key, name varchar(10));</span><br></pre></td></tr></table></figure><h3 id="创建kafka的topic"><a href="#创建kafka的topic" class="headerlink" title="创建kafka的topic"></a>创建kafka的topic</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --topic maxwell --zookeeper 192.168.11.97:2181 --partitions 3 --replication-factor 2</span><br><span class="line">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure><h3 id="在GreenPlum中新建表"><a href="#在GreenPlum中新建表" class="headerlink" title="在GreenPlum中新建表"></a>在GreenPlum中新建表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database maxwell;</span><br><span class="line">\c maxwell;</span><br><span class="line">create table test(id int primary key,name varchar(10));</span><br></pre></td></tr></table></figure><h3 id="启动maxwell"><a href="#启动maxwell" class="headerlink" title="启动maxwell"></a>启动maxwell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/maxwell --daemon --user=&apos;maxwell&apos; --password=&apos;maxwell&apos; --host=192.168.11.99 --include_dbs=test --include_tables=test --producer=kafka --kafka_topic=maxwell --kafka.bootstrap.servers=192.168.11.99:9092</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bin/maxwell --user=&apos;maxwell&apos; --password=&apos;maxwell&apos; --host=192.168.11.99 --producer=stdout</span><br><span class="line">查看一下</span><br><span class="line">bin/kafka-console-consumer.sh --topic maxwell --from-beginning --bootstrap-server 192.168.11.99:9092</span><br></pre></td></tr></table></figure><h3 id="maxwell配置文件配置"><a href="#maxwell配置文件配置" class="headerlink" title="maxwell配置文件配置"></a>maxwell配置文件配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi config</span><br><span class="line">user=maxwell</span><br><span class="line">password=maxwell</span><br><span class="line">host=192.168.11.113</span><br><span class="line">include_dbs=infoveriplatform_test</span><br><span class="line">include_tables=tb_car_record,tb_control_car,tb_control_person,tb_person_record,tb_key_car_record,tb_key_person_record,tb_security_clearance</span><br><span class="line">producer=kafka</span><br><span class="line">kafka_topic=maxwell</span><br><span class="line">kafka.bootstrap.servers=192.168.11.97:9092,192.168.11.98:9092,192.168.11.99:9092</span><br><span class="line">kafka_partition_hash=murmur3</span><br><span class="line">producer_partition_by=primary_key</span><br><span class="line"></span><br><span class="line">./maxwell --daemon --config=config</span><br></pre></td></tr></table></figure><h3 id="关于XA问题解决"><a href="#关于XA问题解决" class="headerlink" title="关于XA问题解决"></a>关于XA问题解决</h3><p> I don’t know whether to add this code in com.zendesk.maxwell.schema.ddl.SchemaChange.java is best way to solve this problem,but can start maxwell normally.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL_BLACKLIST.add(Pattern.compile(&quot;\\s*XA\\s+&quot;, Pattern.CASE_INSENSITIVE | Pattern.MULTILINE));</span><br></pre></td></tr></table></figure></p><h2 id="bireme-配置及启动"><a href="#bireme-配置及启动" class="headerlink" title="bireme 配置及启动"></a>bireme 配置及启动</h2><blockquote><p>使用bireme-2.0.0-alpha-1比bireme-1.0.0会好一点</p></blockquote><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd </span><br><span class="line">vi `pwd`/etc/config.properties</span><br><span class="line">target.url = jdbc:postgresql://192.168.11.84:5432/maxwell</span><br><span class="line">target.user = gpadmin</span><br><span class="line">target.passwd = gpadmin</span><br><span class="line"></span><br><span class="line">data_source = mysql</span><br><span class="line">mysql.type = maxwell</span><br><span class="line">mysql.kafka.server = 192.168.11.99:9092</span><br><span class="line">mysql.kafka.topic = maxwell</span><br><span class="line">state.server.addr = 192.168.11.111</span><br><span class="line"></span><br><span class="line"> vi `pwd`/etc/mysql.properties</span><br><span class="line">test.test=public.test</span><br></pre></td></tr></table></figure><p>###启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要关联软件apache-commons-daemon-jsvc-1.0.13-7.el7.x86_64</span><br><span class="line">bin/bireme start</span><br></pre></td></tr></table></figure><p>###结束<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/bireme stop</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="maxwell bireme" scheme="https://zixujing.github.io/tags/maxwell-bireme/"/>
    
  </entry>
  
  <entry>
    <title>kafka的SASL配置</title>
    <link href="https://zixujing.github.io/2019/05/27/bigdata/kafka%E7%9A%84SASL%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/05/27/bigdata/kafka的SASL配置/</id>
    <published>2019-05-26T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>kafka的SASL配置<br><a id="more"></a></p></blockquote><h2 id="server-properties的配置"><a href="#server-properties的配置" class="headerlink" title="server.properties的配置"></a>server.properties的配置</h2><blockquote><p>可以重新制定一个配置文件如server_sasl.properties<br>到kafka的config文件加下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">listeners=SASL_PLAINTEXT://xx.xx.xx.xx:8123</span><br><span class="line">security.inter.broker.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.enabled.mechanisms=PLAIN</span><br><span class="line">sasl.mechanism.inter.broker.protocol=PLAIN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">touch kafka_server_jaas.conf</span><br><span class="line">vi kafka_server_jaas.conf</span><br><span class="line">KafkaServer &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    username=&quot;kafka&quot;#这个帐号是下面配置的</span><br><span class="line">    password=&quot;password&quot;#这个密码是下面配置的</span><br><span class="line">    user_kafka=&quot;password&quot;</span><br><span class="line">    user_mooc=&quot;mooc&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">touch kafka_client_jaas.conf</span><br><span class="line">vi kafka_client_jaas.conf</span><br><span class="line"></span><br><span class="line">KafkaClient &#123;</span><br><span class="line">        org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">        username=&quot;mooc&quot;</span><br><span class="line">        password=&quot;mooc&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="命令文件的配置"><a href="#命令文件的配置" class="headerlink" title="命令文件的配置"></a>命令文件的配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd ../bin</span><br><span class="line">vi kafka-server-start.sh</span><br><span class="line">if [ &quot;x$KAFKA_OPTS&quot; = &quot;x&quot; ]; then</span><br><span class="line">    export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/usr/local/kafka_2.12-2.1.1/config/kafka_server_jaas.conf&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi kafka-console-producer.sh</span><br><span class="line">vi kafka-console-consumer.sh</span><br><span class="line">if [ &quot;x$KAFKA_OPTS&quot; = &quot;x&quot; ]; then</span><br><span class="line">    export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/usr/local/kafka_2.12-2.1.1/config/kafka_client_jaas.conf&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-server-start.sh -daemon ../config/server.properties</span><br></pre></td></tr></table></figure><h2 id="其他相关脚本"><a href="#其他相关脚本" class="headerlink" title="其他相关脚本"></a>其他相关脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./kafka-topics.sh  --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line">./kafka-topics.sh  --zookeeper localhost:2181 --create --topic Test  --partitions 1 --replication-factor 1</span><br><span class="line"></span><br><span class="line">./kafka-console-producer.sh --broker-list 192.168.11.99:9092 --topic test --producer-property security.protocol=SASL_PLAINTEXT --producer-property sasl.mechanism=PLAIN</span><br><span class="line"></span><br><span class="line">./kafka-console-consumer.sh --bootstrap-server 192.168.11.99:9092 --from-beginning --topic test --consumer-property security.protocol=SASL_PLAINTEXT --consumer-property sasl.mechanism=PLAIN</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;kafka的SASL配置&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="kafka" scheme="https://zixujing.github.io/tags/kafka/"/>
    
  </entry>
  
</feed>
