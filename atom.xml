<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冯凯&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zixujing.github.io/"/>
  <updated>2019-04-15T18:01:44.343Z</updated>
  <id>https://zixujing.github.io/</id>
  
  <author>
    <name>冯_凯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VirtualBox 操作命令随笔</title>
    <link href="https://zixujing.github.io/2019/04/16/linux/linux%E5%B7%A5%E5%85%B7/VirtualBox%20%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4%E9%9A%8F%E7%AC%94/"/>
    <id>https://zixujing.github.io/2019/04/16/linux/linux工具/VirtualBox 操作命令随笔/</id>
    <published>2019-04-15T17:00:00.000Z</published>
    <updated>2019-04-15T18:01:44.343Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>VirtualBox 操作命令随笔<br><a id="more"></a></p></blockquote><p>　　</p><h3 id="动态磁盘与固定磁盘转换"><a href="#动态磁盘与固定磁盘转换" class="headerlink" title="动态磁盘与固定磁盘转换"></a>动态磁盘与固定磁盘转换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage.exe list hdds</span><br><span class="line">#动态转固定</span><br><span class="line">VBoxManage.exe clonemedium disk &quot;f:\s01.vdi&quot; &quot;f:\s02.vdi&quot; -variant Fixed</span><br><span class="line">#固定转动态</span><br><span class="line">VBoxManage.exe clonemedium disk &quot;f:\s01.vdi&quot; &quot;f:\s02.vdi&quot; -variant Standard</span><br></pre></td></tr></table></figure><h3 id="Oracle-vm-克隆磁盘"><a href="#Oracle-vm-克隆磁盘" class="headerlink" title="Oracle vm 克隆磁盘"></a>Oracle vm 克隆磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage.exe clonevdi D:\vm\node1\node1.vdi d:\vm\clone.vdi</span><br></pre></td></tr></table></figure><h3 id="Oracle-vm创建共享磁盘"><a href="#Oracle-vm创建共享磁盘" class="headerlink" title="Oracle vm创建共享磁盘"></a>Oracle vm创建共享磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage.exe createhd --filename D:\vm\sharedisk\s01.vdi --size 30000 --format VDI -variant Fixed</span><br><span class="line">VBoxManage.exe createhd --filename D:\vm\sharedisk\s02.vdi --size 30000 --format VDI -variant Fixed</span><br><span class="line">VBoxManage.exe createhd --filename D:\vm\sharedisk\s03.vdi --size 30000 --format VDI -variant Fixed</span><br></pre></td></tr></table></figure><h3 id="附加磁盘到虚拟机"><a href="#附加磁盘到虚拟机" class="headerlink" title="附加磁盘到虚拟机"></a>附加磁盘到虚拟机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage.exe storageattach linux1 --storagectl &quot;SATA&quot; --port 1 --device 0 --type hdd --medium D:\oraclevm\ocr.vdi --mtype shareable</span><br></pre></td></tr></table></figure><h3 id="修改磁盘为共享"><a href="#修改磁盘为共享" class="headerlink" title="修改磁盘为共享"></a>修改磁盘为共享</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VBoxManage.exe modifyhd D:\oraclevm\ocr.vdi --type shareable</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;VirtualBox 操作命令随笔&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>hadoop2.8.5+hbase2.1.4+spark2.3.3环境搭建</title>
    <link href="https://zixujing.github.io/2019/04/04/bigdata/hadoop2.8.5+hbase2.1.4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://zixujing.github.io/2019/04/04/bigdata/hadoop2.8.5+hbase2.1.4环境搭建/</id>
    <published>2019-04-03T18:00:00.000Z</published>
    <updated>2019-04-08T11:28:11.272Z</updated>
    
    <content type="html"><![CDATA[<p>　　</p><blockquote><p>hadoop2.8.5+hbase2.1.4环境搭建<br><a id="more"></a>　　</p></blockquote><h2 id="centos7-3-配置"><a href="#centos7-3-配置" class="headerlink" title="centos7.3 配置"></a>centos7.3 配置</h2><ul><li><p>119设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname hadoopa</span><br><span class="line">[root@hadoopa ~]# vi /etc/hosts</span><br><span class="line">192.168.11.119 hadoopa</span><br><span class="line">192.168.11.118 hadoopb</span><br><span class="line">192.168.11.117 hadoopc</span><br></pre></td></tr></table></figure></li><li><p>118设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname hadoopb</span><br><span class="line">[root@hadoopa ~]# vi /etc/hosts</span><br><span class="line">192.168.11.119 hadoopa</span><br><span class="line">192.168.11.118 hadoopb</span><br><span class="line">192.168.11.117 hadoopc</span><br></pre></td></tr></table></figure></li><li><p>117设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname hadoopc</span><br><span class="line">[root@hadoopa ~]# vi /etc/hosts</span><br><span class="line">192.168.11.119 hadoopa</span><br><span class="line">192.168.11.118 hadoopb</span><br><span class="line">192.168.11.117 hadoopc</span><br></pre></td></tr></table></figure></li></ul><h2 id="java安装"><a href="#java安装" class="headerlink" title="java安装"></a>java安装</h2><ul><li>分别把117jdk拷贝到三台机器的opt目录解压即可<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#以下在117上执行</span><br><span class="line">[root@hadoopc opt]# scp jdk-8u201-linux-x64.tar.gz 192.168.11.118:/opt</span><br><span class="line">#以下在117 118 119上分别执行</span><br><span class="line">[root@hadoopc opt]# tar -xzvf jdk-8u201-linux-x64.tar.gz</span><br><span class="line">[root@hadoopc opt]# mv jdk1.8.0_201/ jdk1.8</span><br></pre></td></tr></table></figure></li></ul><h2 id="ssh免密码配置"><a href="#ssh免密码配置" class="headerlink" title="ssh免密码配置"></a>ssh免密码配置</h2><ul><li><p>117上执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# cd ~/.ssh/</span><br><span class="line">[root@hadoopc .ssh]# ssh-keygen -t rsa #生成密钥和pub公钥</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">36:20:71:94:09:e4:1e:94:19:61:01:8c:e6:ea:e3:c4 root@hadoopc</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">| o.oXOoo         |</span><br><span class="line">|...+ooo          |</span><br><span class="line">|o   + .          |</span><br><span class="line">| . . o .         |</span><br><span class="line">|.   .   S        |</span><br><span class="line">|o      . .       |</span><br><span class="line">|.E               |</span><br><span class="line">|.o               |</span><br><span class="line">|...              |</span><br><span class="line">+-----------------+</span><br><span class="line">[root@hadoopc .ssh]# ls</span><br><span class="line">id_rsa  id_rsa.pub  known_hosts</span><br><span class="line">[root@hadoopc .ssh]# cat id_rsa.pub &gt;&gt; authorized_keys #此时会生成authorized_keys文件，文件中存放的是你想免密码登录的pub公钥，当前命令说明当执行ssh localhost免密码，118  119免密码登录同理把在118 和 119 下生成的公钥拷贝到当前authorized_keys文件中。</span><br></pre></td></tr></table></figure></li><li><p>118上执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# cd ~/.ssh/</span><br><span class="line">[root@hadoopc .ssh]# ssh-keygen -t rsa</span><br><span class="line">[root@hadoopc .ssh]# cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>119上执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# cd ~/.ssh/</span><br><span class="line">[root@hadoopc .ssh]# ssh-keygen -t rsa</span><br><span class="line">[root@hadoopc .ssh]# cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>分别把118和119上的pub公钥拷贝到117的authorized_keys文件中，要用scp不能直接复制</p></li><li>分别把117的authorized_keys文件拷贝到118和119中替换他们的authorized_keys文件</li><li>ssh 登录验证一下，看是否还需要密码</li></ul><h2 id="安装hadoop"><a href="#安装hadoop" class="headerlink" title="安装hadoop"></a>安装hadoop</h2><p>###以下配置仅在117上执行</p><h4 id="hdoop配置"><a href="#hdoop配置" class="headerlink" title="hdoop配置"></a>hdoop配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#仅在117上执行</span><br><span class="line">[root@hadoopa ~]# cd /opt</span><br><span class="line">[root@hadoopc opt]# ls</span><br><span class="line">hadoop-2.8.5.tar.gz  jdk1.8</span><br><span class="line">[root@hadoopc opt]# mkdir hadoop285</span><br><span class="line">[root@hadoopc opt]# tar -zxvf /opt/hadoop-2.8.5.tar.gz -C /opt/hadoop285</span><br><span class="line">[root@hadoopc opt]# cd /opt/hadoop285/hadoop-2.8.5/etc/hadoop</span><br><span class="line">[root@hadoopc hadoop]# vi hadoop-env.sh </span><br><span class="line">#export JAVA_HOME=$&#123;JAVA_HOME&#125;</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br><span class="line">#export HADOOP_HOME=/opt/hadoop285/hadoop-2.8.5</span><br><span class="line">#export PATH=$HADOOP_HOME/bin:$JAVA_HOME/bin:$PATH</span><br><span class="line">[root@hadoopc hadoop]# vi core-site.xml </span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;/opt/hadoop285/tmp&lt;/value&gt; </span><br><span class="line">    &lt;description&gt;A base for other temporary directories.&lt;/description&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;fs.default.name&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;hdfs://192.168.11.119:9000&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">　&lt;property&gt; </span><br><span class="line">　    &lt;name&gt;io.file.buffer.size&lt;/name&gt; </span><br><span class="line">　    &lt;value&gt;4096&lt;/value&gt; </span><br><span class="line">　 &lt;/property&gt; </span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">[root@hadoopc hadoop]# vi hdfs-site.xml </span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;1&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.name.dir&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;/opt/hadoop285/hdfs/name&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.data.dir&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;/opt/hadoop285/hdfs/data&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">[root@hadoopc hadoop]# cp mapred-site.xml.template mapred-site.xml</span><br><span class="line">[root@hadoopc hadoop]# vi mapred-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!--指定maoreduce运行框架--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;mapreduce.framework.name&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  &lt;!--历史服务的通信地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:10020&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  &lt;!--历史服务的web ui地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:19888&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">[root@hadoopc hadoop]# vi yarn-site.xml </span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;!-- Site specific YARN configuration properties --&gt;</span><br><span class="line">&lt;!--指定resourcemanager所启动的服务器主机名--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定mapreduce的shuffle--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;mapreduce_shuffle&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定resourcemanager的内部通讯地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:8032&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定scheduler的内部通讯地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:8030&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定resource-tracker的内部通讯地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:8031&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定resourcemanager.admin的内部通讯地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.admin.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:8033&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">&lt;!--指定resourcemanager.webapp的ui监控地址--&gt; </span><br><span class="line">  &lt;property&gt; </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.webapp.address&lt;/name&gt; </span><br><span class="line">    &lt;value&gt;192.168.11.119:8088&lt;/value&gt; </span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">[root@hadoopc hadoop]# vi slaves </span><br><span class="line">192.168.11.117</span><br><span class="line">192.168.11.118</span><br><span class="line">[root@hadoopc hadoop]# vi yarn-env.sh</span><br><span class="line"># some Java parameters</span><br><span class="line"># export JAVA_HOME=/home/y/libexec/jdk1.6.0/</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br><span class="line">[root@hadoopc hadoop]# vi mapred-env.sh</span><br><span class="line"># export JAVA_HOME=/home/y/libexec/jdk1.6.0/</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br></pre></td></tr></table></figure><p>####存放信息相关文件创建<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc hadoop285]# mkdir /opt/hadoop285/tmp</span><br><span class="line">[root@hadoopc hadoop285]# mkdir /opt/hadoop285/hdfs</span><br><span class="line">[root@hadoopc hadoop285]# mkdir /opt/hadoop285/hdfs/name</span><br><span class="line">[root@hadoopc hadoop285]# mkdir /opt/hadoop285/hdfs/data</span><br></pre></td></tr></table></figure></p><h4 id="把配置好的hadoop拷贝到118和119"><a href="#把配置好的hadoop拷贝到118和119" class="headerlink" title="把配置好的hadoop拷贝到118和119"></a>把配置好的hadoop拷贝到118和119</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc hadoop]# cd /opt</span><br><span class="line">[root@hadoopc opt]# scp -r hadoop285/ 192.168.11.118:`pwd`</span><br><span class="line">[root@hadoopc opt]# scp -r hadoop285/ 192.168.11.119:`pwd`</span><br></pre></td></tr></table></figure><p>##启动hdoop</p><p>###只是一个记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#只是一个记录</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br><span class="line">export HADOOP_HOME=/opt/hadoop285/hadoop-2.8.5</span><br><span class="line">export PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></p><p>###启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopa fk]# hdfs namenode -format</span><br><span class="line">[root@hadoopa fk]# start-dfs.sh</span><br><span class="line">[root@hadoopa fk]# start-yarn.sh</span><br></pre></td></tr></table></figure></p><p>###打开<a href="http://192.168.11.119:50070/验证" target="_blank" rel="noopener">http://192.168.11.119:50070/验证</a></p><p>　　</p><h2 id="zookeeper安装版本是3-4-14"><a href="#zookeeper安装版本是3-4-14" class="headerlink" title="zookeeper安装版本是3.4.14"></a>zookeeper安装版本是3.4.14</h2><h3 id="zookeeper仅安装到117上，非集群安装"><a href="#zookeeper仅安装到117上，非集群安装" class="headerlink" title="zookeeper仅安装到117上，非集群安装"></a>zookeeper仅安装到117上，非集群安装</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# pwd</span><br><span class="line">/opt</span><br><span class="line">[root@hadoopc opt]# mkdir zookeeper3414</span><br><span class="line">[root@hadoopc opt]# tar -xzvf zookeeper-3.4.14.tar.gz -C /opt/zookeeper3414/</span><br><span class="line">[root@hadoopc opt]# cd /opt/zookeeper3414/zookeeper-3.4.14/conf</span><br><span class="line">[root@hadoopc conf]# cp zoo_sample.cfg zoo.cfg</span><br><span class="line">[root@hadoopc conf]# vi zoo.cfg </span><br><span class="line">dataDir=/opt/zookeeper3414/data</span><br><span class="line">dataLogDir=/opt/zookeeper3414/logs</span><br><span class="line">[root@hadoopc conf]# mkdir /opt/zookeeper3414/data</span><br><span class="line">[root@hadoopc conf]# mkdir /opt/zookeeper3414/logs</span><br></pre></td></tr></table></figure><h4 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/zookeeper3414/zookeeper-3.4.14/bin:$PATH</span><br></pre></td></tr></table></figure><p>　　　</p><h4 id="启动zookeeper"><a href="#启动zookeeper" class="headerlink" title="启动zookeeper"></a>启动zookeeper</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc conf]# zkServer.sh start</span><br><span class="line">[root@hadoopc conf]# zkServer.sh stop</span><br><span class="line">[root@hadoopc conf]# zkServer.sh restart</span><br><span class="line">[root@hadoopc conf]# zkServer.sh status</span><br><span class="line">#QuorumPeerMain是zookeeper的进程名字</span><br></pre></td></tr></table></figure><p>　　　　　　</p><p>##HBASE安装</p><h3 id="以下仅在117上执行"><a href="#以下仅在117上执行" class="headerlink" title="以下仅在117上执行"></a>以下仅在117上执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# mkdir hbase214</span><br><span class="line">[root@hadoopc opt]# tar -zxvf hbase-2.1.4-bin.tar.gz -C /opt/hbase214</span><br><span class="line">[root@hadoopc opt]# cd /opt/hbase214/hbase-2.1.4/conf</span><br><span class="line">[root@hadoopc conf]# vi hbase-env.sh</span><br><span class="line">export HBASE_PID_DIR=/opt/hbase214/pids</span><br><span class="line">export HBASE_MANAGES_ZK=false</span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br><span class="line">[root@hadoopc conf]# vi hbase-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!-- 指定hbase master机器 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.master&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hdfs://192.168.11.119:9000&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;!-- hbase分布式集群为true --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;!-- 指定ZK集群地址,多个用逗号分开--&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;192.168.11.117&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;!-- 指定独立Zookeeper安装路径 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;/opt/zookeeper3414/zookeeper-3.4.14&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;!-- 指定ZooKeeper集群端口 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;2181&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;!--此处避免一个启动时候得错误--&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.unsafe.stream.capability.enforce&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;false&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">　&lt;property&gt;</span><br><span class="line">　    &lt;name&gt;hbase.root.dir&lt;/name&gt;</span><br><span class="line">　    &lt;value&gt;hdfs://192.168.11.119:9000/hbase&lt;/value&gt;</span><br><span class="line">　  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">[root@hadoopc conf]# vi regionservers </span><br><span class="line">192.168.11.117</span><br><span class="line">192.168.11.118</span><br><span class="line">192.168.11.119</span><br><span class="line">[root@hadoopc conf]# cd /opt/hbase214/hbase-2.1.4/lib/client-facing-thirdparty</span><br><span class="line">[root@hadoopc client-facing-thirdparty]# cp htrace-core4-4.2.0-incubating.jar ../</span><br></pre></td></tr></table></figure><h3 id="标记-1"><a href="#标记-1" class="headerlink" title="标记"></a>标记</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/hbase214/hbase-2.1.4/bin:$PATH</span><br></pre></td></tr></table></figure><h3 id="配置拷贝到118和119"><a href="#配置拷贝到118和119" class="headerlink" title="配置拷贝到118和119"></a>配置拷贝到118和119</h3><p>　　<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc opt]# cd /opt　　</span><br><span class="line">[root@hadoopc opt]# scp -r hbase214/ 192.168.11.118:`pwd`</span><br><span class="line">[root@hadoopc opt]# scp -r hbase214/ 192.168.11.119:`pwd`</span><br></pre></td></tr></table></figure></p><p>　　</p><h3 id="启动hbase"><a href="#启动hbase" class="headerlink" title="启动hbase"></a>启动hbase</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopa conf]# start-hbase.sh</span><br></pre></td></tr></table></figure><h3 id="关于报错解决"><a href="#关于报错解决" class="headerlink" title="关于报错解决"></a>关于报错解决</h3><ul><li>报错信息是：Caused by: java.lang.ClassNotFoundException: org.apache.htrace.SamplerBuilder</li><li>进过百度说缺少htrace-core-3.1.0-incubating.jar包但hbase2.1.4的lib\client-facing-thirdparty目录下没有这个文件，解决方法是下载hbase2.1.3在目录lib\client-facing-thirdparty中找到文件htrace-core-3.1.0-incubating.jar拷贝到hbase2.1.4的lib目录中。</li></ul><p>##spark安装（2.3.3）</p><h3 id="以下仅在117上执行-1"><a href="#以下仅在117上执行-1" class="headerlink" title="以下仅在117上执行"></a>以下仅在117上执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc ~]# cd /home</span><br><span class="line">[root@hadoopc opt]# mkdir spark233</span><br><span class="line">[root@hadoopc opt]# tar -xzvf /opt/spark-2.3.3-bin-hadoop2.7.tgz -C /home/spark233/</span><br><span class="line">[root@hadoopc home]# cd spark233/spark-2.3.3-bin-hadoop2.7/</span><br><span class="line">[root@hadoopc spark-2.3.3-bin-hadoop2.7]# cd conf</span><br><span class="line">[root@hadoopc conf]# cp spark-env.sh.template spark-env.sh</span><br><span class="line">[root@hadoopc conf]# vi spark-env.sh </span><br><span class="line">export JAVA_HOME=/opt/jdk1.8</span><br><span class="line">export HADOOP_CONF_DIR=/opt/hadoop285/hadoop-2.8.5/etc/hadoop/</span><br><span class="line">export YARN_CONF_DIR=/opt/hadoop285/hadoop-2.8.5/etc/hadoop/</span><br><span class="line">export SPARK_MASTER_PORT=7077</span><br><span class="line">export SPARK_HOME=/home/spark233/spark-2.3.3-bin-hadoop2.7</span><br><span class="line">[root@hadoopc conf]# cp slaves.template slaves</span><br><span class="line">[root@hadoopc conf]# vi slaves</span><br><span class="line">#localhost</span><br><span class="line">#192.168.11.117</span><br><span class="line">#不需要指定MASTER在哪里启动哪里就是Master</span><br><span class="line">192.168.11.118</span><br><span class="line">192.168.11.119</span><br><span class="line">[root@hadoopc conf]# cd ../../..</span><br><span class="line">[root@hadoopc home]# scp -r spark233/ 192.168.11.118:`pwd`</span><br><span class="line">[root@hadoopc home]# scp -r spark233/ 192.168.11.119:`pwd`</span><br></pre></td></tr></table></figure><p>###标记<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export SPARK_HOME=/home/spark233/spark-2.3.3-bin-hadoop2.7</span><br><span class="line">export PATH=$PATH:$SPARK_HOME/sbin:$SPARK_HOME/bin</span><br></pre></td></tr></table></figure></p><p>###启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoopc sbin]# ./start-master.sh </span><br><span class="line">[root@hadoopc sbin]# ./start-all.sh</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;　　&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hadoop2.8.5+hbase2.1.4环境搭建&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="hadoop" scheme="https://zixujing.github.io/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>JVM监控和调优常用命令工具</title>
    <link href="https://zixujing.github.io/2019/04/01/java/JVM%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/04/01/java/JVM监控和调优常用命令工具总结/</id>
    <published>2019-03-31T18:00:00.000Z</published>
    <updated>2019-04-08T11:28:11.288Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>JVM监控和调优常用命令工具<br><a id="more"></a></p></blockquote><p>　　</p><h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><p>命令格式：<br>jps [options] [hostid]<br>options参数解释：</p><ul><li>-l : 输出主类全名或jar路径</li><li>-q : 只输出LVMID</li><li>-m : 输出JVM启动时传递给main()的参数</li><li>-v : 输出JVM启动时显示指定的JVM参数</li></ul><p>最常用示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jps -l 输出jar包路径，类全名</span><br><span class="line">jps -m 输出main参数</span><br><span class="line">jps -v 输出JVM参数</span><br></pre></td></tr></table></figure></p><h2 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h2><p>命令格式：<br>jinfo [option] <pid><br>options参数解释：</pid></p><ul><li>-flag <name> 打印指定名称的参数</name></li><li>-flag [+|-]<name> 打开或关闭参数</name></li><li>-flag <name>=<value> 设置参数</value></name></li><li>-flags 打印所有参数</li><li>-sysprops 打印系统配置</li><li><no option=""> 打印上面两个选项</no></li></ul><p>最常用示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#查看JVM参数和系统配置</span><br><span class="line">jinfo 11666</span><br><span class="line">jinfo -flags 11666</span><br><span class="line">jinfo -sysprops 11666</span><br><span class="line">#查看打印GC日志参数</span><br><span class="line">jinfo -flag PrintGC 11666</span><br><span class="line">jinfo -flag PrintGCDetails 11666</span><br><span class="line">#打开GC日志参数</span><br><span class="line">jinfo -flag +PrintGC 11666</span><br><span class="line">jinfo -flag +PrintGCDetails 11666</span><br><span class="line">关闭GC日志参数</span><br><span class="line">jinfo -flag -PrintGC 11666</span><br><span class="line">jinfo -flag -PrintGCDetails 11666</span><br><span class="line">#还可以使用下面的命令查看那些参数可以使用jinfo命令来管理：</span><br><span class="line">java -XX:+PrintFlagsFinal -version | grep manageable</span><br></pre></td></tr></table></figure></p><p>常用JVM参数：</p><ul><li>-Xms：初始堆大小，默认为物理内存的1/64(&lt;1GB)；默认(MinHeapFreeRatio参数可以调整)空余堆内存小于40%时，JVM就会增大堆直到-Xmx的最大限制</li><li>-Xmx：最大堆大小，默认(MaxHeapFreeRatio参数可以调整)空余堆内存大于70%时，JVM会减少堆直到 -Xms的最小限制</li><li>-Xmn：新生代的内存空间大小，注意：此处的大小是（eden+ 2 survivor space)。与jmap -heap中显示的New gen是不同的。整个堆大小=新生代大小 + 老生代大小 + 永久代大小。在保证堆大小不变的情况下，增大新生代后,将会减小老生代大小。此值对系统性能影响较大,Sun官方推荐配置为整个堆的3/8。</li><li>-XX:SurvivorRatio：新生代中Eden区域与Survivor区域的容量比值，默认值为8。两个Survivor区与一个Eden区的比值为2:8,一个Survivor区占整个年轻代的1/10。</li><li>-Xss：每个线程的堆栈大小。JDK5.0以后每个线程堆栈大小为1M,以前每个线程堆栈大小为256K。应根据应用的线程所需内存大小进行适当调整。在相同物理内存下,减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在3000~5000左右。一般小的应用， 如果栈不是很深， 应该是128k够用的，大的应用建议使用256k。这个选项对性能影响比较大，需要严格的测试。和threadstacksize选项解释很类似,官方文档似乎没有解释,在论坛中有这样一句话:”-Xss is translated in a VM flag named ThreadStackSize”一般设置这个值就可以了。</li><li>-XX:PermSize：设置永久代(perm gen)初始值。默认值为物理内存的1/64。</li><li>-XX:MaxPermSize：设置持久代最大值。物理内存的1/4。</li></ul><h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><p>命令格式：<br>jstat [option] LVMID [interval] [count]<br>其中LVMID是进程id，interval是打印间隔时间（毫秒），count是打印次数（默认一直打印）<br>option参数解释：</p><ul><li>-class class loader的行为统计</li><li>-compiler HotSpt JIT编译器行为统计</li><li>-gc 垃圾回收堆的行为统计</li><li>-gccapacity 各个垃圾回收代容量(young,old,perm)和他们相应的空间统计</li><li>-gcutil 垃圾回收统计概述</li><li>-gccause 垃圾收集统计概述（同-gcutil），附加最近两次垃圾回收事件的原因</li><li>-gcnew 新生代行为统计</li><li>-gcnewcapacity 新生代与其相应的内存空间的统计</li><li>-gcold 年老代和永生代行为统计</li><li>-gcoldcapacity 年老代行为统计</li><li>-gcpermcapacity 永生代行为统计</li><li>-printcompilation HotSpot编译方法统计</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">常用示例及打印字段解释：</span><br><span class="line">jstat -gcutil 11666 1000 3</span><br></pre></td></tr></table></figure><p>字段解释:<br>S0 survivor0使用百分比<br>S1 survivor1使用百分比<br>E Eden区使用百分比<br>O 老年代使用百分比<br>M 元数据区使用百分比<br>CCS 压缩使用百分比<br>YGC 年轻代垃圾回收次数<br>YGCT 年轻代垃圾回收消耗时间<br>FGC 老年代垃圾回收次数<br>FGCT 老年代垃圾回收消耗时间<br>GCT 垃圾回收消耗总时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc 11666 1000 3</span><br></pre></td></tr></table></figure></p><p>字段解释：<br>S0C survivor0大小<br>S1C survivor1大小<br>S0U survivor0已使用大小<br>S1U survivor1已使用大小<br>EC Eden区大小<br>EU Eden区已使用大小<br>OC 老年代大小<br>OU 老年代已使用大小<br>MC 方法区大小<br>MU 方法区已使用大小<br>CCSC 压缩类空间大小<br>CCSU 压缩类空间已使用大小<br>YGC 年轻代垃圾回收次数<br>YGCT 年轻代垃圾回收消耗时间<br>FGC 老年代垃圾回收次数<br>FGCT 老年代垃圾回收消耗时间<br>GCT 垃圾回收消耗总时间</p><h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack　"></a>jstack　</h2><p>命令格式：<br>jstack [-l] <pid> (连接运行中的进程)<br>jstack -F [-m] [-l] <pid> (连接挂起的进程)<br>jstack [-m] [-l] <executable> <core> (连接core文件)<br>jstack [-m] [-l] [server_id@]<remote server="" ip="" or="" hostname=""> (连接远程debug服务器)<br>option参数解释：</remote></core></executable></pid></pid></p><ul><li>-F 当使用jstack <pid>无响应时，强制输出线程堆栈。</pid></li><li>-m 同时输出java和本地堆栈(混合模式)</li><li>-l 额外显示锁信息</li></ul><figure class="highlight plain"><figcaption><span>-l 11666 | more```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输出信息：</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.25-b02 mixed mode):</span><br><span class="line">&quot;Attach Listener&quot; #25525 daemon prio=9 os_prio=0 tid=0x00007fd374002000 nid=0x70e8 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">    None</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">## jmap</span><br><span class="line">命令格式：</span><br><span class="line">jmap [option] &lt;pid&gt; (连接正在执行的进程)</span><br><span class="line">jmap [option] &lt;executable &lt;core&gt; (连接一个core文件)</span><br><span class="line">jmap [option] [server_id@]&lt;remote server IP or hostname&gt; (链接远程服务器)</span><br><span class="line">option参数解释：</span><br><span class="line">- &lt;none&gt; to print same info as Solaris pmap</span><br><span class="line">- -heap 打印java heap摘要</span><br><span class="line">- -histo[:live] 打印堆中的java对象统计信息</span><br><span class="line">- -clstats 打印类加载器统计信息</span><br><span class="line">- -finalizerinfo 打印在f-queue中等待执行finalizer方法的对象</span><br><span class="line">- -dump:&lt;dump-options&gt; 生成java堆的dump文件</span><br><span class="line">    　　　　dump-options:</span><br><span class="line">    　　　　　　live 只转储存活的对象，如果没有指定则转储所有对象</span><br><span class="line">    　　　　　　format=b 二进制格式</span><br><span class="line">    　　　　　　file=&lt;file&gt; 转储文件到 &lt;file&gt;</span><br><span class="line">- -F 强制选项</span><br></pre></td></tr></table></figure><p>jmap -dump:live,format=b,file=dump.hprof 11666　<br>jmap -finalizerinfo 11666<br>jmap -heap 11666<br>jmap -histo:live 11666 | more</p><h2 id="num-instances-bytes-class-name"><a href="#num-instances-bytes-class-name" class="headerlink" title="num     #instances         #bytes  class name"></a>num     #instances         #bytes  class name</h2><p>1:         46608        1111232  java.lang.String<br>2:          6919         734516  java.lang.Class<br>3:          4787         536164  java.net.SocksSocketImpl<br>4:         15935         497100  java.util.concurrent.ConcurrentHashMap$Node<br>5:         28561         436016  java.lang.Object<br><code>`</code></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;JVM监控和调优常用命令工具&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="https://zixujing.github.io/categories/java/"/>
    
    
      <category term="java" scheme="https://zixujing.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Cursor mutex S和library cache lock</title>
    <link href="https://zixujing.github.io/2019/03/31/db/oracle/Cursor-Mutex-S%E5%92%8Clibrary-cache-lock/"/>
    <id>https://zixujing.github.io/2019/03/31/db/oracle/Cursor-Mutex-S和library-cache-lock/</id>
    <published>2019-03-30T18:00:00.000Z</published>
    <updated>2019-04-08T11:28:11.276Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Cursor: Mutex S和library cache lock<br><a id="more"></a></p></blockquote><blockquote><p>实际在版本10g中就引入了该Cursor Obsolescence游标废弃特性，当时child cursor 的总数阀值是1024，但是这个阀值在11g中被移除了，这导致出现一个父游标下大量child cursor即high version count的发生；由此引发了一系列的版本11.2.0.3之前的cursor sharing 性能问题，主要症状是版本11.2.0.1和11.2.0.2上出现大量的Cursor: Mutex S 和 library cache lock等待事件。</p></blockquote><blockquote><p>增强补丁Enhancement patch《Bug 10187168 – Enhancement to obsolete parent cursors if VERSION_COUNT exceeds a threshold》就该问题引入了新的隐藏参数_cursor_obsolete_threshold(Number of cursors per parent before obsoletion.)，该”_cursor_obsolete_threshold”参数用以指定子游标总数阀值，若一个父游标的child cursor count&lt;=&gt;version count高于”_cursor_obsolete_threshold”，则触发Cursor Obsolescence游标废弃特性。<strong>注意版本11.2.0.3中默认就有”_cursor_obsolete_threshold”了，而且默认值为100。</strong></p></blockquote><blockquote><p>对于版本11.1.0.7、11.2.0.1和11.2.0.2则都有该Bug 10187168的bug backport存在，从2011年5月开始就有相关针对的one-off backport补丁存在。 但是这些one-off backport补丁不使用”_cursor_obsolete_threshold”参数。在版本11.1.0.7、11.2.0.1和11.2.0.2上需要设置合适的”_cursor_features_enabled”(默认值为2)参数，并设置必要的106001 event，该event的level值即是child cursor count的阀值，必须设置该106001事件后该特性才生效。但是请注意 “_cursor_features_enabled”参数需要重启实例方能生效。而”_cursor_obsolete_threshold”参数和106001 event则可以在线启用、禁用。对于不同的版本而言，一般推荐打上最新的PSU补丁，并根据补丁的README提示或者咨询Oracle Support获得关于该版本上Cursor Obsolescence问题的信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#针对不同版本设置 “_cursor_features_enabled”+106001 event的方法。</span><br><span class="line">#注意重启实例</span><br><span class="line">#版本11.1.0.7</span><br><span class="line">SQL&gt; alter system set &quot;_cursor_features_enabled&quot;=18 scope=spfile;</span><br><span class="line">SQL&gt; alter system set event=&apos;106001 trace name context forever,level 1024&apos; scope=spfile;</span><br><span class="line">#版本11.2.0.1</span><br><span class="line">SQL&gt; alter system set &quot;_cursor_features_enabled&quot;=34 scope=spfile;</span><br><span class="line">SQL&gt; alter system set event=&apos;106001 trace name context forever,level 1024&apos; scope=spfile;</span><br><span class="line">#版本11.2.0.2</span><br><span class="line">SQL&gt; alter system set &quot;_cursor_features_enabled&quot;=1026 scope=spfile;</span><br><span class="line">SQL&gt; alter system set event=&apos;106001 trace name context forever,level 1024&apos; scope=spfile;</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">11gR2 Experience -&gt; If using cursor_sharing = “FORCE” or “SIMILAR”</span><br><span class="line">　　1) ORA-600 errors as workload increases [kkspsc0: basehd]</span><br><span class="line">　　or [kglLockOwnersListAppend-ovf] - applied patches to address</span><br><span class="line">　　2) AWR showing -&gt; cursor: mutex S and library cache lock</span><br><span class="line">1. Download and apply the 11.2.0.2.3PSU Patch 11724916</span><br><span class="line">2. Enable event 106001 to address Bug 10187168.</span><br><span class="line">　　To enable the fix &quot;_cursor_features_enabled&quot; needs to be set</span><br><span class="line">　　3) Oracle 11.2.0.2.2 PSU (Patch Set Update) includes new parameters that you can tweak</span><br><span class="line">　　based on workload characteristics. Even more fixes have been added</span><br><span class="line">　　Note: 10411618 - Enhancement to add different &quot;Mutex&quot; wait schemes [ID 10411618.8]</span><br><span class="line">　　4) 11.2.0.3 Has many Mutex enhancement’s</span><br><span class="line">　　106001 level</span><br><span class="line">　　The level is used to specify the maximum number of child cursors</span><br><span class="line">　　that a parent can have before we obsolete</span><br><span class="line">　　the parent cursor and create a new parent.</span><br><span class="line">　　Doing the above can help reduce mutex waits,</span><br><span class="line">　　memory consumption and other side effects seen when we see</span><br><span class="line">　　many child cursors for a given parent.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Cursor: Mutex S和library cache lock&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>生成awr报告</title>
    <link href="https://zixujing.github.io/2019/03/31/db/oracle/%E7%94%9F%E6%88%90awr%E6%8A%A5%E5%91%8A/"/>
    <id>https://zixujing.github.io/2019/03/31/db/oracle/生成awr报告/</id>
    <published>2019-03-30T17:00:00.000Z</published>
    <updated>2019-04-08T11:28:11.283Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>生成awr报告<br><a id="more"></a></p></blockquote><ol><li>sqlplus下执行：<br>@?/rdbms/admin/awrrpt.sql<br>或者@$ORACLE_HOME/rdbms/admin/awrrpt.sql</li><li>输入要生成报告的文件格式<br>Type Specified:  html</li><li>输入要生成报告相隔的天数<br>Enter value for num_days: 1</li><li>输入相隔的快照之间的Snap Id开始号和结束号<br>Specify the Begin and End Snapshot Ids<br>Enter value for begin_snap: 101<br>Enter value for end_snap: 102<br>End   Snapshot Id specified: 102</li><li>输入生成报告的名字：<br>Enter value for report_name: awr.html</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;生成awr报告&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>ogg for big data 12.3.2.1 using the elasticsearch (5.2.2) handler[再次]</title>
    <link href="https://zixujing.github.io/2019/03/25/ogg/ogg%20for%20big%20data%2012.3.2.1%20using%20the%20elasticsearch%20(5.2.2)%20handler%5B%E5%86%8D%E6%AC%A1%5D/"/>
    <id>https://zixujing.github.io/2019/03/25/ogg/ogg for big data 12.3.2.1 using the elasticsearch (5.2.2) handler[再次]/</id>
    <published>2019-03-24T16:00:00.000Z</published>
    <updated>2019-03-31T13:44:23.123Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>elasticsearch 5.2.2是ogg for bigdata支持的最高版本<br>elasticsearch 5.2.2 安装略<br><a id="more"></a></p></blockquote><ol><li><p>源数据配置略，因与ogg普通配置一致。以下给出关键配置其他ogg相关的请参照ogg安装文档</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dblogin userid ogg password ogg</span><br><span class="line">add trandata smartecap_data.*</span><br></pre></td></tr></table></figure></li><li><p>cat dirprm/elastic.prm</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REPLICAT elastic</span><br><span class="line">TARGETDB LIBFILE libggjava.so SET property=./dirprm/elastic.properties </span><br><span class="line">MAP smartecap_data.*, TARGET smartecap_data.*;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>cat dirprm/elastic.properties </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#any name of your choice</span><br><span class="line">gg.handlerlist=elasticsearch</span><br><span class="line">#type of handler to use ex Elasticsearch , kafka and so on</span><br><span class="line">gg.handler.elasticsearch.type=elasticsearch</span><br><span class="line"></span><br><span class="line">## Handler properties for Elasticsearch 5.x, 逗号分隔</span><br><span class="line">gg.handler.elasticsearch.ServerAddressList=192.168.106.213:9300</span><br><span class="line">gg.handler.elasticsearch.clientSettingsFile=client5.properties</span><br><span class="line">gg.handler.elasticsearch.version=5.x</span><br><span class="line">#gg.handler.elasticsearch.bulkWrite=true</span><br><span class="line">gg.handler.elasticsearch.upsert=true</span><br><span class="line">#Set the Classpath , Default location of 5.X JARs, classpath 中一定要有elasticsearch的客户端驱动。</span><br><span class="line">gg.classpath=./dirprm*:/home/es/elasticsearch-5.2.2/lib/*:/home/es/elasticsearch-5.2.2/modules/transport-netty3/*:/home/es/elasticsearch-5.2.2/modules/transport-netty4/*:/home/es/elasticsearch-5.2.2/modules/reindex/*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#goldengate.userexit.writers=javawriter</span><br><span class="line">#javawriter.stats.display=TRUE</span><br><span class="line">#javawriter.stats.full=TRUE</span><br><span class="line">gg.log=log4j</span><br><span class="line">gg.log.level=INFO</span><br><span class="line">gg.report.time=30sec</span><br><span class="line">#javawriter.bootoptions=-Xmx512m -Xms32m -Djava.class.path=.:ggjava/ggjava.jar:./dirprm</span><br></pre></td></tr></table></figure></li><li><p>cat dirprm/client5.properties </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#集群名称</span><br><span class="line">cluster.name=oggtest</span><br><span class="line">#xpack.security.user=&lt;x-pack user name&gt;:&lt;x-pack password&gt;</span><br></pre></td></tr></table></figure></li><li><p>Elasticsearch 5.1.2 with X-Pack 5.1.2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">commons-codec-1.10.jar</span><br><span class="line">commons-logging-1.1.3.jar</span><br><span class="line">compiler-0.9.3.jar</span><br><span class="line">elasticsearch-5.1.2.jar</span><br><span class="line">HdrHistogram-2.1.6.jar</span><br><span class="line">hppc-0.7.1.jar</span><br><span class="line">httpasyncclient-4.1.2.jar</span><br><span class="line">httpclient-4.5.2.jar</span><br><span class="line">httpcore-4.4.5.jar</span><br><span class="line">httpcore-nio-4.4.5.jar</span><br><span class="line">jackson-core-2.8.1.jar</span><br><span class="line">jackson-dataformat-cbor-2.8.1.jar</span><br><span class="line">jackson-dataformat-smile-2.8.1.jar</span><br><span class="line">jackson-dataformat-yaml-2.8.1.jar</span><br><span class="line">jna-4.2.2.jar</span><br><span class="line">joda-time-2.9.5.jar</span><br><span class="line">jopt-simple-5.0.2.jar</span><br><span class="line">lang-mustache-client-5.1.2.jar</span><br><span class="line">lucene-analyzers-common-6.3.0.jar</span><br><span class="line">lucene-backward-codecs-6.3.0.jar</span><br><span class="line">lucene-core-6.3.0.jar</span><br><span class="line">lucene-grouping-6.3.0.jar</span><br><span class="line">lucene-highlighter-6.3.0.jar</span><br><span class="line">lucene-join-6.3.0.jar</span><br><span class="line">lucene-memory-6.3.0.jar</span><br><span class="line">lucene-misc-6.3.0.jar</span><br><span class="line">lucene-queries-6.3.0.jar</span><br><span class="line">lucene-queryparser-6.3.0.jar</span><br><span class="line">lucene-sandbox-6.3.0.jar</span><br><span class="line">lucene-spatial3d-6.3.0.jar</span><br><span class="line">lucene-spatial-6.3.0.jar</span><br><span class="line">lucene-spatial-extras-6.3.0.jar</span><br><span class="line">lucene-suggest-6.3.0.jar</span><br><span class="line">netty-3.10.6.Final.jar</span><br><span class="line">netty-buffer-4.1.6.Final.jar</span><br><span class="line">netty-codec-4.1.6.Final.jar</span><br><span class="line">netty-codec-http-4.1.6.Final.jar</span><br><span class="line">netty-common-4.1.6.Final.jar</span><br><span class="line">netty-handler-4.1.6.Final.jar</span><br><span class="line">netty-resolver-4.1.6.Final.jar</span><br><span class="line">netty-transport-4.1.6.Final.jar</span><br><span class="line">percolator-client-5.1.2.jar</span><br><span class="line">reindex-client-5.1.2.jar</span><br><span class="line">rest-5.1.2.jar</span><br><span class="line">securesm-1.1.jar</span><br><span class="line">snakeyaml-1.15.jar</span><br><span class="line">t-digest-3.0.jar</span><br><span class="line">transport-5.1.2.jar</span><br><span class="line">transport-netty3-client-5.1.2.jar</span><br><span class="line">transport-netty4-client-5.1.2.jar</span><br><span class="line">x-pack-transport-5.1.2.jar</span><br></pre></td></tr></table></figure></li><li><p>其中dirprm中需要的esearch驱动有</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lang-mustache-client-5.2.2.jar</span><br><span class="line">percolator-client-5.2.2.jar</span><br><span class="line">transport-5.2.2.jar</span><br><span class="line">x-pack-transport-5.2.2.jar</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;elasticsearch 5.2.2是ogg for bigdata支持的最高版本&lt;br&gt;elasticsearch 5.2.2 安装略&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="elasticsearch" scheme="https://zixujing.github.io/tags/elasticsearch/"/>
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>FASTDFS安装步骤</title>
    <link href="https://zixujing.github.io/2019/03/04/linux/linux%E5%B7%A5%E5%85%B7/FASTDFS%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/"/>
    <id>https://zixujing.github.io/2019/03/04/linux/linux工具/FASTDFS安装步骤/</id>
    <published>2019-03-03T21:00:00.000Z</published>
    <updated>2019-03-31T13:44:23.111Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>FASTDFS安装步骤<br><a id="more"></a></p></blockquote><h2 id="FASTDFS安装步骤"><a href="#FASTDFS安装步骤" class="headerlink" title="FASTDFS安装步骤"></a>FASTDFS安装步骤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">0.init</span><br><span class="line">[root@fileserver ~]# yum install gcc</span><br><span class="line">[root@fileserver ~]# yum install unzip</span><br><span class="line">1.libfastcommon</span><br><span class="line">[root@fileserver ~]# unzip libfastcommon-1.0.36.zip</span><br><span class="line">[root@fileserver ~]# cd libfastcommon-1.0.36</span><br><span class="line">[root@localhost libfastcommon-1.0.36]# ./make.sh</span><br><span class="line">[root@localhost libfastcommon-1.0.36]# ./make.sh install</span><br><span class="line">2.FastDFS</span><br><span class="line">[root@fileserver ~]# yum install perl</span><br><span class="line">[root@fileserver ~]# unzip fastdfs-5.11.zip</span><br><span class="line">[root@fileserver ~]# cd fastdfs-5.11</span><br><span class="line">[root@fileserver fastdfs-5.11]# ./make.sh</span><br><span class="line">[root@fileserver fastdfs-5.11]# ./make.sh install</span><br><span class="line">3.3配置Tracker和Storage</span><br><span class="line">[root@fileserver ~]# cd /etc/fdfs</span><br><span class="line">[root@fileserver fdfs]# cp tracker.conf.sample tracker.conf</span><br><span class="line">[root@fileserver fdfs]# mkdir /home/filedata</span><br><span class="line">[root@fileserver fdfs]# mkdir /home/filedata/tracker</span><br><span class="line">[root@fileserver fdfs]# vi tracker.conf</span><br><span class="line"></span><br><span class="line">bind_addr=10.24.70.83</span><br><span class="line">max_connections=500</span><br><span class="line">base_path=/home/filedata/tracker</span><br><span class="line"></span><br><span class="line">[root@fileserver fdfs]# cp storage.conf.sample storage.conf</span><br><span class="line">[root@fileserver fdfs]# mkdir /home/filedata/storage</span><br><span class="line">[root@fileserver fdfs]# mkdir /home/filedata/storage/info</span><br><span class="line">[root@fileserver fdfs]# mkdir /home/filedata/storage/data</span><br><span class="line">[root@fileserver fdfs]# vi storage.conf</span><br><span class="line">bind_addr=10.24.70.83</span><br><span class="line">base_path=/home/filedata/storage/info</span><br><span class="line">store_path0=/home/filedata/storage/data</span><br><span class="line">max_connections=500</span><br><span class="line">tracker_server=10.24.70.83:22122</span><br><span class="line">[root@fileserver etc]# chkconfig --add fdfs_trackerd</span><br><span class="line">[root@fileserver etc]# chkconfig fdfs_trackerd on</span><br><span class="line">[root@fileserver etc]# chkconfig fdfs_storaged on</span><br><span class="line">[root@fileserver etc]# service fdfs_trackerd start</span><br><span class="line">[root@fileserver etc]# service fdfs_storaged start</span><br></pre></td></tr></table></figure><h2 id="上传测试"><a href="#上传测试" class="headerlink" title="上传测试"></a>上传测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#cd /etc/fdfs</span><br><span class="line">#cp client.conf.sample client.conf</span><br><span class="line">#vim client.conf</span><br><span class="line"># Client 的数据和日志目录</span><br><span class="line">base_path=/home/client</span><br><span class="line"># Tracker端口</span><br><span class="line">tracker_server=10.24.70.83:22122</span><br><span class="line">#/usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;FASTDFS安装步骤&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>redis主从+自动切换</title>
    <link href="https://zixujing.github.io/2019/02/21/linux/linux%E5%B7%A5%E5%85%B7/redis%E4%B8%BB%E4%BB%8E+%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/"/>
    <id>https://zixujing.github.io/2019/02/21/linux/linux工具/redis主从+自动切换/</id>
    <published>2019-02-20T21:00:00.000Z</published>
    <updated>2019-03-03T16:13:39.772Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>redis主从+自动切换<br><a id="more"></a></p></blockquote><h2 id="正式环境redis主从配置"><a href="#正式环境redis主从配置" class="headerlink" title="正式环境redis主从配置"></a>正式环境redis主从配置</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /home/redis_copy</span><br><span class="line">[root@localhost ~]# mkdir /home/redis_copy/6500</span><br><span class="line">[root@localhost ~]# vi /home/redis_copy/6500/redis.conf</span><br><span class="line">#master</span><br><span class="line">port 6500</span><br><span class="line">bind 10.24.70.84</span><br><span class="line">daemonize yes</span><br><span class="line">logfile redis6500.log</span><br><span class="line">pidfile 6500.pid</span><br><span class="line">#cluster-enabled yes</span><br><span class="line">#cluster-config-file nodes_7000.conf</span><br><span class="line">#cluster-node-timeout 15000</span><br><span class="line">#appendonly yes</span><br><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">timeout 0</span><br><span class="line">rdbcompression yes</span><br><span class="line">dbfilename redis.rdb</span><br><span class="line">dir /home/redis_copy/6500</span><br><span class="line">maxmemory 50gb</span><br><span class="line">maxmemory-policy noeviction</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line">vm-enabled no</span><br><span class="line"></span><br><span class="line">#slave</span><br><span class="line">port 6500</span><br><span class="line">bind 10.24.70.81</span><br><span class="line">daemonize yes</span><br><span class="line">logfile redis6500.log</span><br><span class="line">pidfile 6500.pid</span><br><span class="line">#cluster-enabled yes</span><br><span class="line">#cluster-config-file nodes_7000.conf</span><br><span class="line">#cluster-node-timeout 15000</span><br><span class="line">#appendonly yes</span><br><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br><span class="line">slaveof 10.24.70.84 6500</span><br><span class="line">slave-read-only yes</span><br><span class="line">slave-priority 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">timeout 0</span><br><span class="line">rdbcompression yes</span><br><span class="line">dbfilename redis.rdb</span><br><span class="line">dir /home/redis_copy/6500</span><br><span class="line">maxmemory 50gb</span><br><span class="line">maxmemory-policy noeviction</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line">vm-enabled no</span><br></pre></td></tr></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# redis-server /home/redis_copy/6500/redis.conf</span><br></pre></td></tr></table></figure><h3 id="81上配置哨兵"><a href="#81上配置哨兵" class="headerlink" title="81上配置哨兵"></a>81上配置哨兵</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /home/redis_copy/6600</span><br><span class="line">[root@localhost ~]# vi /home/redis_copy/6600/sentinel.conf</span><br><span class="line"></span><br><span class="line">port 6600</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">logfile sentinel.log</span><br><span class="line">dir /home/redis_copy/6600</span><br><span class="line">sentinel monitor mymaster 10.24.70.84 6500 1</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 18000</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br></pre></td></tr></table></figure><h3 id="启动哨兵"><a href="#启动哨兵" class="headerlink" title="启动哨兵"></a>启动哨兵</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# redis-sentinel /home/redis_copy/6600/sentinel.conf</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;redis主从+自动切换&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>linux参数配置</title>
    <link href="https://zixujing.github.io/2019/02/20/linux/linux%E5%B7%A5%E5%85%B7/linuxOracle%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4/"/>
    <id>https://zixujing.github.io/2019/02/20/linux/linux工具/linuxOracle参数调整/</id>
    <published>2019-02-19T21:00:00.000Z</published>
    <updated>2019-03-03T16:13:23.674Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>linux参数配置<br><a id="more"></a></p></blockquote><h2 id="linux配置"><a href="#linux配置" class="headerlink" title="linux配置"></a>linux配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]# vi /etc/security/limits.conf</span><br><span class="line">*             soft    nproc           2065651</span><br><span class="line">*             hard    nproc           2065651</span><br><span class="line">*             soft    nofile          65535</span><br><span class="line">*             hard    nofile          65535</span><br><span class="line"></span><br><span class="line">[root@xxx ~]# vi /etc/sysctl.conf</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1024    65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 500</span><br><span class="line">vm.overcommit_memory = 2</span><br><span class="line">vm.overcommit_ratio= 85</span><br><span class="line">vm.zone_reclaim_mode=0</span><br><span class="line">fs.file-max=6553560</span><br><span class="line">[root@xxx ~]# sysctl -p</span><br></pre></td></tr></table></figure><h2 id="oracle-64G服务器例子"><a href="#oracle-64G服务器例子" class="headerlink" title="oracle 64G服务器例子"></a>oracle 64G服务器例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]# echo &quot;</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.shmall = 7864320</span><br><span class="line">kernel.shmmax = 132212254720</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">#semaphores: semmsl, semmns, semopm, semmni</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.core.rmem_default=262144</span><br><span class="line">net.core.rmem_max=16777216</span><br><span class="line">net.core.wmem_default=262144</span><br><span class="line">net.core.wmem_max=16777216</span><br><span class="line">net.core.somaxconn=4096</span><br><span class="line">net.core.netdev_max_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_syn_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_tw_buckets=10000</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 3600</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">vm.swappiness = 0</span><br><span class="line">vm.panic_on_oom = 1</span><br><span class="line">kernel.randomize_va_space=0&quot; &gt;&gt;/etc/sysctl.conf</span><br></pre></td></tr></table></figure><h2 id="mysql例子"><a href="#mysql例子" class="headerlink" title="mysql例子"></a>mysql例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness=1</span><br><span class="line">net.core.somaxconn = 65535</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1024    65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 500</span><br><span class="line">vm.overcommit_memory = 2</span><br><span class="line">vm.overcommit_ratio= 85</span><br><span class="line">vm.zone_reclaim_mode=0</span><br><span class="line">fs.file-max=6553560</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">readahead设置（谨慎）</span><br><span class="line">[root@xxx ~]#blockdev --setra 16 /dev/sdb1</span><br><span class="line">noatime set</span><br><span class="line">[root@xxx ~]# vi /etc/fstab</span><br><span class="line">/dev/mapper/vg_data-lv_data /opt                   ext4    rw,noatime        1 2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;linux参数配置&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>redis集群搭建文档</title>
    <link href="https://zixujing.github.io/2019/02/14/linux/linux%E5%B7%A5%E5%85%B7/redis%E9%9B%86%E7%BE%A4%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/02/14/linux/linux工具/redis集群文档/</id>
    <published>2019-02-13T17:00:00.000Z</published>
    <updated>2019-02-14T02:49:12.597Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>redis集群搭建文档<br><a id="more"></a></p></blockquote><h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf redis-4.0.2.tar.gz </span><br><span class="line">cd redis-4.0.2</span><br><span class="line">yum install gcc</span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="创建redis节点-三台服务器"><a href="#创建redis节点-三台服务器" class="headerlink" title="创建redis节点,三台服务器"></a>创建redis节点,三台服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">==》81</span><br><span class="line">mkdir /home/redis_cluster</span><br><span class="line">cd /home/redis_cluster</span><br><span class="line">mkdir 7000 7001</span><br><span class="line">vi 7000/redis.conf</span><br><span class="line">port 7000</span><br><span class="line">bind 10.24.70.81</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7000.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7000.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi 7001/redis.conf</span><br><span class="line">port 7001</span><br><span class="line">bind 10.24.70.81</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7001.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7001.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line">==》82</span><br><span class="line">mkdir /home/redis_cluster</span><br><span class="line">cd /home/redis_cluster</span><br><span class="line">mkdir 7000 7001</span><br><span class="line">vi 7000/redis.conf</span><br><span class="line">port 7000</span><br><span class="line">bind 10.24.70.82</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7000.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7000.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi 7001/redis.conf</span><br><span class="line">port 7001</span><br><span class="line">bind 10.24.70.82</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7001.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7001.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==》84</span><br><span class="line">mkdir /home/redis_cluster</span><br><span class="line">cd /home/redis_cluster</span><br><span class="line">mkdir 7000 7001</span><br><span class="line">vi 7000/redis.conf</span><br><span class="line">port 7000</span><br><span class="line">bind 10.24.70.84</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7000.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7000.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi 7001/redis.conf</span><br><span class="line">port 7001</span><br><span class="line">bind 10.24.70.84</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile /home/redis_cluster/7001.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes_7001.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure><h2 id="启动各个节点，三台服务器"><a href="#启动各个节点，三台服务器" class="headerlink" title="启动各个节点，三台服务器"></a>启动各个节点，三台服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server /home/redis_cluster/7000/redis.conf</span><br><span class="line">redis-server /home/redis_cluster/7001/redis.conf</span><br></pre></td></tr></table></figure><h2 id="创建集群，只在redis-trib-rb执行端安装以下程序"><a href="#创建集群，只在redis-trib-rb执行端安装以下程序" class="headerlink" title="创建集群，只在redis-trib.rb执行端安装以下程序"></a>创建集群，只在redis-trib.rb执行端安装以下程序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-3.2.2.gem文件拷贝到84服务器，以下命令只在84上执行。注意这里的ruby的redis驱动版本不用和redis服务端版本一致，ruby的redis驱动版本是redis-3.2.2，redis服务端的版本是redis-4.0.2</span><br><span class="line">yum install ruby ruby-devel rubygems rpm-build</span><br><span class="line">gem install redis-3.2.2.gem</span><br><span class="line">./redis-trib.rb create --replicas 1 10.24.70.81:7000 10.24.70.81:7001 10.24.70.82:7000 10.24.70.82:7001 10.24.70.84:7000 10.24.70.84:7001</span><br></pre></td></tr></table></figure><h2 id="简单维护"><a href="#简单维护" class="headerlink" title="简单维护"></a>简单维护</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb check 10.24.70.81:7000</span><br><span class="line">cluster info</span><br><span class="line">cluster nodes</span><br><span class="line">cluster meet ip port</span><br><span class="line">cluster forget nodeid</span><br><span class="line">cluster replicate nodeid</span><br><span class="line">cluster saveconfig</span><br><span class="line">cluster addslots slot</span><br><span class="line">cluster delsolts slot</span><br><span class="line">cluster flushslots</span><br><span class="line">cluster setslot slot node nodeid</span><br><span class="line">cluster setslot slot migrating nodeis</span><br><span class="line">cluster setslot slot importing nodeid</span><br><span class="line">cluster setslot slot stable </span><br><span class="line">cluster keyslot key</span><br><span class="line">cluster countkeysinslot slot</span><br><span class="line">cluster getkeysinslot slot count</span><br><span class="line">cluster slaves nodeid</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;redis集群搭建文档&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>时间同步与tomcat自启动</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E4%B8%8Etomcat%E8%87%AA%E5%90%AF%E5%8A%A8/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/时间同步与tomcat自启动/</id>
    <published>2019-02-12T21:00:00.000Z</published>
    <updated>2019-03-31T13:44:23.120Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>时间同步与tomcat自启动<br><a id="more"></a></p></blockquote><h2 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h2><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line">server 10.24.70.72 iburst</span><br></pre></td></tr></table></figure><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop chronyd</span><br><span class="line">systemctl start chronyd</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources</span><br></pre></td></tr></table></figure><h2 id="tomcat自启动"><a href="#tomcat自启动" class="headerlink" title="tomcat自启动"></a>tomcat自启动</h2><h3 id="添加变量到setenv-sh（没有的话在bin目录新建一个）中-catalina-sh会调用"><a href="#添加变量到setenv-sh（没有的话在bin目录新建一个）中-catalina-sh会调用" class="headerlink" title="添加变量到setenv.sh（没有的话在bin目录新建一个）中,catalina.sh会调用"></a>添加变量到setenv.sh（没有的话在bin目录新建一个）中,catalina.sh会调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/apache-tomcat-8.5.35/bin/setenv.sh</span><br><span class="line">JAVA_HOME=/opt/jdk1.8.0_144</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">CATALINA_PID=&quot;$CATALINA_BASE/tomcat8_hcpt.pid&quot;</span><br></pre></td></tr></table></figure><h3 id="设置启动脚本"><a href="#设置启动脚本" class="headerlink" title="设置启动脚本"></a>设置启动脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/tomcat8_hcpt.service</span><br><span class="line">#/usr/lib/systemd/system/tomcat8_hcpt.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Tomcat8</span><br><span class="line">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/local/apache-tomcat-8.5.35/tomcat8_hcpt.pid</span><br><span class="line">ExecStart=/usr/local/apache-tomcat-8.5.35/bin/startup.sh</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable tomcat8_hcpt</span><br><span class="line">systemctl start tomcat8_hcpt</span><br></pre></td></tr></table></figure><h2 id="centos7-tomcat9自启动"><a href="#centos7-tomcat9自启动" class="headerlink" title="centos7+tomcat9自启动"></a>centos7+tomcat9自启动</h2><h3 id="添加变量到setclasspath-sh中-catalina-sh会调用"><a href="#添加变量到setclasspath-sh中-catalina-sh会调用" class="headerlink" title="添加变量到setclasspath.sh中,catalina.sh会调用"></a>添加变量到setclasspath.sh中,catalina.sh会调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/tomcat9/bin/setclasspath.sh</span><br><span class="line"># -----------------------------------------------------------------------------</span><br><span class="line">#  Set JAVA_HOME or JRE_HOME if not already set, ensure any provided settings</span><br><span class="line">#  are valid and consistent with the selected start-up options and set up the</span><br><span class="line">#  endorsed directory.</span><br><span class="line"># -----------------------------------------------------------------------------</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export JRE_HOME=/usr/local/jdk/jre</span><br></pre></td></tr></table></figure><h3 id="设置启动脚本-1"><a href="#设置启动脚本-1" class="headerlink" title="设置启动脚本"></a>设置启动脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/tomcat9.service</span><br><span class="line">#/usr/lib/systemd/system/tomcat9.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Tomcat9</span><br><span class="line">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">PIDFile=/usr/local/tomcat9/tomcat.pid</span><br><span class="line">ExecStart=/usr/local/tomcat9/bin/startup.sh</span><br><span class="line">ExecStop=/usr/local/tomcat9/bin/shutdown.sh</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable tomcat9</span><br><span class="line">systemctl start tomcat9</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;时间同步与tomcat自启动&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>keepalived监控切换功能</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/keepalived%E7%9B%91%E6%8E%A7%E5%88%87%E6%8D%A2%E5%8A%9F%E8%83%BD/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/keepalived监控切换功能/</id>
    <published>2019-02-12T19:00:00.000Z</published>
    <updated>2019-02-13T12:16:09.989Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>keepalived监控切换功能<br><a id="more"></a></p></blockquote><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">tar -cvf all.repo.tar *</span><br><span class="line">rm -fr *.repo</span><br><span class="line">vi cdiso.repo</span><br><span class="line"></span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///root/c7</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">#把iso挂载到/root/c7目录下</span><br><span class="line">mkdir /root/c7</span><br><span class="line">mount -o loop CentOS-7-x86_64-DVD-1611.iso /root/c7</span><br></pre></td></tr></table></figure><h2 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum install keepalived</span><br><span class="line">keepalived -v</span><br><span class="line">systemctl enable keepalived</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br></pre></td></tr></table></figure><h2 id="nginx监控脚本"><a href="#nginx监控脚本" class="headerlink" title="nginx监控脚本"></a>nginx监控脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/keepalived/</span><br><span class="line">vi check_nginx.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">counter=$(ps -C nginx --no-heading | wc -l)</span><br><span class="line">if [ &quot;$&#123;counter&#125;&quot; = &quot;0&quot; ]; then</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    exit0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">chmod +x check_nginx.sh</span><br></pre></td></tr></table></figure><h2 id="keepalived-conf-配置"><a href="#keepalived-conf-配置" class="headerlink" title="keepalived.conf 配置"></a>keepalived.conf 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">cp keepalived.conf keepalived.conf.bak</span><br><span class="line">vi keepalived.conf</span><br><span class="line">##主节点的配置</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">    script &quot;/etc/keepalived/check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -5</span><br><span class="line">    fall 1</span><br><span class="line">    rise 1</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.24.70.251</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##从节点的配置</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">    script &quot;/etc/keepalived/check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -5</span><br><span class="line">    fall 3</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.24.70.251</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="启动keepalived"><a href="#启动keepalived" class="headerlink" title="启动keepalived"></a>启动keepalived</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable keepalived</span><br><span class="line">systemctl start keepalived</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;keepalived监控切换功能&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>nginx1.14.2 安装配置文档</title>
    <link href="https://zixujing.github.io/2019/02/13/linux/linux%E5%B7%A5%E5%85%B7/nginx1.14.2%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/02/13/linux/linux工具/nginx1.14.2 安装配置文档/</id>
    <published>2019-02-12T17:00:00.000Z</published>
    <updated>2019-02-13T08:13:58.006Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx安装配置文档<br><a id="more"></a></p></blockquote><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#cd /etc/yum.repos.d/</span><br><span class="line">#tar -cvf all.repo.tar *</span><br><span class="line">#rm -fr *.repo</span><br><span class="line">#vi cdiso.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///root/c7</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">#把iso挂载到/root/c7目录下</span><br><span class="line">#mkdir /root/c7</span><br><span class="line">#mount -o loop 系统iso文件.iso /root/c7</span><br></pre></td></tr></table></figure><h2 id="基本环境配置"><a href="#基本环境配置" class="headerlink" title="基本环境配置"></a>基本环境配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#yum install gcc pcre-devel zlib-devel openssl-devel</span><br><span class="line">#systemctl stop firewalld</span><br><span class="line">#systemctl disable firewalld</span><br><span class="line">#groupadd nginx</span><br><span class="line">#useradd nginx -g nginx -s /sbin/nologin -M</span><br><span class="line">#vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#./configure \</span><br><span class="line">--prefix=/usr/local/nginx \</span><br><span class="line">--sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx.lock \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-openssl=</span><br><span class="line">#make</span><br><span class="line">#make install</span><br></pre></td></tr></table></figure><h2 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h2><ul><li><p>编辑文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vi /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure></li><li><p>文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#/usr/lib/systemd/system/nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">ExecReload=/usr/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/sbin/nginx -s stop</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul><li><p>编辑配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>编辑文件内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line">pid        /var/log/nginx/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  65535;</span><br><span class="line">    use epoll;</span><br><span class="line">    multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    tcp_nodelay    on;</span><br><span class="line">    </span><br><span class="line">    server_tokens off;</span><br><span class="line">    </span><br><span class="line">    open_file_cache max=65535 inactive=20s;</span><br><span class="line">    open_file_cache_valid 30s;</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">    </span><br><span class="line">    client_header_buffer_size 4k;</span><br><span class="line">    large_client_header_buffers 4 32k;</span><br><span class="line">    client_header_timeout 15;</span><br><span class="line">    client_body_timeout 15;</span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    </span><br><span class="line">    client_body_temp_path /usr/local/nginx/body_temp 1 2;</span><br><span class="line">    </span><br><span class="line">    reset_timedout_connection on;</span><br><span class="line">    send_timeout 30;</span><br><span class="line">    </span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length 1k;</span><br><span class="line">    gzip_buffers 4 16k;</span><br><span class="line">    gzip_http_version 1.0;</span><br><span class="line">    gzip_comp_level 2;</span><br><span class="line">    gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    </span><br><span class="line">    upstream hch80&#123;</span><br><span class="line">        server 10.24.70.81:80;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream hch18080&#123;</span><br><span class="line">        server 10.24.70.82:18080;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  10.24.70.74;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://hch80;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line">            proxy_temp_path /usr/local/nginx/proxy_temp80 1 2;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       18080;</span><br><span class="line">        server_name  10.24.70.74;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://hch18080;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line">            proxy_temp_path /usr/local/nginx/proxy_temp18080 1 2;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;nginx安装配置文档&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>nginx随笔</title>
    <link href="https://zixujing.github.io/2019/02/11/linux/linux%E5%B7%A5%E5%85%B7/nginx%E9%9A%8F%E7%AC%94/"/>
    <id>https://zixujing.github.io/2019/02/11/linux/linux工具/nginx随笔/</id>
    <published>2019-02-10T17:00:00.000Z</published>
    <updated>2019-02-12T17:57:36.050Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx笔记<br><a id="more"></a></p></blockquote><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="tcp握手"><a href="#tcp握手" class="headerlink" title="tcp握手"></a>tcp握手</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/30193702-7287165c73e7440382207309e07fcbb5.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/30193703-330b281cddc5439f99eb027ac1c9627c.png" alt=""></p><h3 id="tcp-cork"><a href="#tcp-cork" class="headerlink" title="tcp_cork"></a>tcp_cork</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190212/image013.png" alt=""></p><h2 id="sendfile"><a href="#sendfile" class="headerlink" title="sendfile"></a>sendfile</h2><h3 id="读取文件并socket传输的普通过程"><a href="#读取文件并socket传输的普通过程" class="headerlink" title="读取文件并socket传输的普通过程"></a>读取文件并socket传输的普通过程</h3><ol start="0"><li>read(file,tmp_buf, len);<br>write(socket,tmp_buf, len);</li><li>系统调用 read()产生一个上下文切换，从 user mode 切换到 kernel mode，然后 DMA 执行拷贝，把文件数据从硬盘读到一个 kernel buffer 里。</li><li>数据从 kernel buffer拷贝到 user buffer，然后系统调用 read() 返回，这时又产生一个上下文切换，从kernel mode 切换到 user mode。</li><li>系统调用write()产生一个上下文切换，从 user mode切换到 kernel mode，然后把步骤2读到 user buffer的数据拷贝到 kernel buffer，不过这次是个不同的 kernel buffer，这个 buffer和 socket相关联。</li><li>系统调用 write()返回，产生一个上下文切换，从 kernel mode 切换到 user mode ，然后 DMA 从 kernel buffer拷贝数据到协议栈。<h3 id="sendfile的协议栈传输过程"><a href="#sendfile的协议栈传输过程" class="headerlink" title="sendfile的协议栈传输过程"></a>sendfile的协议栈传输过程</h3></li><li>sendfile(socket,file, len);</li><li>系统调用sendfile()通过 DMA把硬盘数据拷贝到 kernel buffer，然后数据被 kernel直接拷贝到另外一个与 socket相关的 kernel buffer。这里没有 user mode和 kernel mode之间的切换，在 kernel中直接完成了从一个 buffer到另一个 buffer的拷贝。</li><li>DMA 把数据从 kernelbuffer 直接拷贝给协议栈，没有切换，也不需要数据从 user mode 拷贝到 kernel mode，因为数据就在 kernel 里。<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3>sendfile 是将 in_fd 的内容发送到 out_fd 。而 in_fd 不能是 socket ， 也就是只能文件句柄。 所以当 Nginx 是一个静态文件服务器的时候，开启 SENDFILE 配置项能大大提高 Nginx 的性能。 但是当 Nginx 是作为一个反向代理来使用的时候，SENDFILE 则没什么用了，因为 Nginx 是反向代理的时候。 in_fd 就不是文件句柄而是 socket，此时就不符合 sendfile 函数的参数要求了。</li></ol><h2 id="accept-mutex"><a href="#accept-mutex" class="headerlink" title="accept_mutex"></a>accept_mutex</h2><ol><li>当一个新连接到达时，如果激活了accept_mutex，那么多个Worker将以串行方式来处理，其中有一个Worker会被唤醒，其他的Worker继续保持休眠状态；如果没有激活accept_mutex，那么所有的Worker都会被唤醒，不过只有一个Worker能获取新连接，其它的Worker会重新进入休眠状态，这就是「惊群问题」。</li><li>OS may wake all processes waiting on accept() and select(), this is called thundering herd problem. This is a problem if you have a lot of workers as in Apache (hundreds and more), but this insensible if you have just several workers as nginx usually has. Therefore turning accept_mutex off is as scheduling incoming connection by OS via select/kqueue/epoll/etc (but not accept()).</li></ol><h2 id="multi-accept"><a href="#multi-accept" class="headerlink" title="multi_accept"></a>multi_accept</h2><ol><li>在Nginx获得有新连接的通知之后,接受尽可能多的连接。</li></ol><h2 id="tcp-nopush"><a href="#tcp-nopush" class="headerlink" title="tcp_nopush"></a>tcp_nopush</h2><p>Enables or disables the use of the TCP_NOPUSH socket option on FreeBSD) or the TCP_CORK socket option on Linux. The options are enabled only when sendfile is used. Enabling the option allows</p><ul><li>sending the response header and the beginning of a file in one packet, on Linux and FreeBSD 4.*;</li><li>sending a file in full packets.</li><li>在nginx中，tcp_nopush配置与tcp_nodelay“互斥”。它可以配置一次发送数据包的大小。也就是说，数据包累积到一定大小后就发送。</li><li>在nginx中tcp_nopush必须和sendfile配合使用。</li></ul><h2 id="tcp-nodelay"><a href="#tcp-nodelay" class="headerlink" title="tcp_nodelay"></a>tcp_nodelay</h2><p>这个选项的作用就是禁用 Nagle’s Algorithm，默认开启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#nagle algorithm</span><br><span class="line">if there is new data to send</span><br><span class="line">  if the window size &gt;= MSS and available data is &gt;= MSS</span><br><span class="line">    send complete MSS segment now</span><br><span class="line">  else</span><br><span class="line">    if there is unconfirmed data still in the pipe</span><br><span class="line">      enqueue data in the buffer until an acknowledge is received</span><br><span class="line">    else</span><br><span class="line">      send data immediately</span><br><span class="line">    end if</span><br><span class="line">  end if</span><br><span class="line">end if</span><br></pre></td></tr></table></figure></p><p>  可以看到，当待发送的数据比 MSS 小的时候（外层的 else 分支），还要再判断 时候还有未确认的数据。只有当管道里还有未确认数据的时候才会进入缓冲区， 等待 Ack。<br>  所以发送端发送的第一个 write 是不会被缓冲起来，而是立刻发送的（进入内层 的else 分支），这时接收端收到对应的数据，但它还期待更多数据才进行处理， 所以不会往回发送数据，因此也没机会把 Ack 给带回去，根据Delayed Ack 机制， 这个 Ack 会被 Hold 住。这时发送端发送第二个包，而队列里还有未确认的数据 包，所以进入了内层 if 的 then 分支，这个 packet 会被缓冲起来。此时，发 送端在等待接收端的 Ack；接收端则在 Delay 这个 Ack，所以都在等待，直到接 收端 Deplayed Ack 超时（40ms），此 Ack 被发送回去，发送端缓冲的这个 packet 才会被真正送到接收端，从而继续下去。<br>  再看我上面的 strace 记录也能发现端倪，因为设计的一些不足，我没能做到把 短小的 HTTP Body 连同 HTTP Headers 一起发送出去，而是分开成两次调用实 现的，之后进入 epoll_wait 等待下一个 Request 被发送过来（相当于阻塞模 型里直接 read）。正好是 write-write-read 的模式。<br>  那么 write-read-write-read 会不会出问题呢？维基百科上的解释是不会。</p><h2 id="Delayed-Ack-机制"><a href="#Delayed-Ack-机制" class="headerlink" title="Delayed Ack 机制"></a>Delayed Ack 机制</h2><h2 id="keepalive-timeout"><a href="#keepalive-timeout" class="headerlink" title="keepalive_timeout"></a>keepalive_timeout</h2><p>  这个参数不是tcp的keepalive，是程序的keepalive，处理完业务后会等待一段时间再关闭连接.</p><h2 id="net-ipv4-tcp-tw-recycle"><a href="#net-ipv4-tcp-tw-recycle" class="headerlink" title="net.ipv4.tcp_tw_recycle"></a>net.ipv4.tcp_tw_recycle</h2><p>  net.ipv4.tcp_tw_recycle = {0|1} 是否启用timewait快速回收；注意：开启此功能在NAT环境下可能会出现严重的问题：因为TCP有一种行为，它可以缓存每个连接最新的时间戳，后续请求中如果时间戳小于缓存中的时间戳，即被视为无效并丢弃相应的请求报文；Linux是否启用这种行为取决于tcp_timestamp和tcp_tw_recycle，而前一个参数默认是启用的，所以启用后面的参数就会激活此功能； 因此，如果是NAT环境，安全起见，应该禁用tcp_tw_recycle。另一种解决方案：把tcp_timestamps设置为0，tcp_tw_recycle设置为1并不会如想象中奏效，因为一旦关闭了tcp_timestamps，那么即便打开了tcp_tw_recycle，后面的参数也没有效果。此时降低net.ipv4.tcp_max_tw_buckets的值就可以显著降低tw连接的数量了。对客户端和服务器同时起作用。</p><h2 id="net-ipv4-tcp-tw-reuse"><a href="#net-ipv4-tcp-tw-reuse" class="headerlink" title="net.ipv4.tcp_tw_reuse"></a>net.ipv4.tcp_tw_reuse</h2><p>net.ipv4.tcp_tw_reuse = {0|1} 是否开启tw重用，即是否允许将TIME-WAIT sockets 用于新的TCP连接，就是数据结构不会收，只更改一下ip和port就继续使用。 只对客户端起作用，开启后客户端在1s内回收。</p><h2 id="somaxconn"><a href="#somaxconn" class="headerlink" title="somaxconn"></a>somaxconn</h2><p>  定义了系统中每一个端口最大的监听队列的长度,这是个全局的参数,默认值为128，对于一个经常处理新连接的高负载 web服务环境来说，默认的 128 太小了。大多数环境这个值建议增加到 1024 或者更多。大的侦听队列对防止拒绝服务 DoS 攻击也会有所帮助。</p><h2 id="net-core-netdev-max-backlog-262144"><a href="#net-core-netdev-max-backlog-262144" class="headerlink" title="net.core.netdev_max_backlog = 262144"></a>net.core.netdev_max_backlog = 262144</h2><p>  每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。</p><h2 id="net-ipv4-tcp-max-syn-backlog-262144"><a href="#net-ipv4-tcp-max-syn-backlog-262144" class="headerlink" title="net.ipv4.tcp_max_syn_backlog = 262144"></a>net.ipv4.tcp_max_syn_backlog = 262144</h2><p>  这个参数标示TCP三次握手建立阶段接受SYN请求队列的最大长度，默认为1024，将其设置得大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux不至于丢失客户端发起的连接请求。</p><h2 id="MTU-MSS"><a href="#MTU-MSS" class="headerlink" title="MTU MSS"></a>MTU MSS</h2><h3 id="MTU-Maxitum-Transmission-Unit-最大传输单元"><a href="#MTU-Maxitum-Transmission-Unit-最大传输单元" class="headerlink" title="MTU: Maxitum Transmission Unit 最大传输单元"></a>MTU: Maxitum Transmission Unit 最大传输单元</h3><h3 id="MSS-Maxitum-Segment-Size-最大分段大小"><a href="#MSS-Maxitum-Segment-Size-最大分段大小" class="headerlink" title="MSS: Maxitum Segment Size 最大分段大小"></a>MSS: Maxitum Segment Size 最大分段大小</h3><p>  MSS就是TCP数据包每次能够传输的最大数据分段。为了达到最佳的传输效能TCP协议在建立连接的时候通常要协商双方的MSS值，这个值TCP协议在实现的时候往往用MTU值代替（需要减去IP数据包包头的大小20Bytes和TCP数据段的包头20Bytes）, 通讯双方会根据双方提供的MSS值得最小值确定为这次连接的最大MSS值。而一般以太网MTU都为1500, 所以在以太网中, 往往TCP MSS为1460。</p><h2 id="滑动窗口与内核缓冲区的关系"><a href="#滑动窗口与内核缓冲区的关系" class="headerlink" title="滑动窗口与内核缓冲区的关系"></a>滑动窗口与内核缓冲区的关系</h2><ul><li>net.ipv4.tcp_rmem:这个参数定义了TCP接收缓冲（用于TCP接收滑动窗口）的最小值、默认值、最大值</li><li>net.ipv4.tcp_wmem:这个参数定义了TCP发送缓冲（用于TCP发送滑动窗口）的最小值、默认值、最大值</li><li>netdev_max_backlog：当网卡接收数据包的速度大于内核处理的速度时，会有一个队列保存这些数据包。这个参数表示队列的最大值</li><li>rmem_default：这个参数表示内核套接字接收缓存区默认的大小</li><li>wmem_default：这个参数表示内核套接字发送缓存区默认的大小</li><li>rmem_max：这个参数表示内核套接字接收缓存区最大的大小</li><li><p>rmem_max：这个参数表示内核套接字接收缓存区最大的大小<br>对于发送数据来说，应用程序将数据拷贝到各自TCP发送缓冲区内（也就是发送滑动窗口），然后系统的所有TCP套接字上发送缓冲区（也就是发送滑动窗口）内的数据都将数据拷贝到内核发送缓冲区内，然后内核将内核缓冲区的数据经过网卡发送出去。</p><p>  TCP的发送/接受缓冲区（也就是发送/接受滑动窗口），是针对某一个具体的TCP连接来说的，每一个TCP连接都会有相应的滑动窗口，但是内核的发送/接受缓冲区是针对整个系统的，里面存放着整个系统的所有TCP连接的接收/发送的数据。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;nginx笔记&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>zabbix安装</title>
    <link href="https://zixujing.github.io/2019/01/30/linux/linux%E5%B7%A5%E5%85%B7/centos7+zabbix4.0source/"/>
    <id>https://zixujing.github.io/2019/01/30/linux/linux工具/centos7+zabbix4.0source/</id>
    <published>2019-01-29T17:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.379Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>zabbix源码方式安装<br><a id="more"></a></p></blockquote><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul><li><a href="https://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/4.0.3/zabbix-4.0.3.tar.gz/download" target="_blank" rel="noopener">下载zabbix源码</a></li><li><p>上传zabbix源码到目标机器后执行下面命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf zabbix-4.0.1.tar.gz</span><br><span class="line">[root@master ~]# groupadd zabbix</span><br><span class="line">[root@master ~]# useradd -g zabbix zabbix</span><br></pre></td></tr></table></figure></li><li><p>配置数据库【安装mysql数据库略】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql -uroot -p&lt;password&gt;</span><br><span class="line">MYSQL&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">MYSQL&gt; grant all privileges on zabbix.* to &apos;zabbix&apos;@&apos;localhost&apos; identified by &apos;zabbix&apos;;</span><br><span class="line">MYSQL&gt; quit;</span><br><span class="line">[root@master ~]# cd zabbix-4.0.1/database/mysql/</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; schema.sql</span><br><span class="line">[root@master mysql]# #stop here if you are creating database for Zabbix proxy</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; images.sql</span><br><span class="line">[root@master mysql]# mysql -uzabbix -pzabbix zabbix &lt; data.sql</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装server"><a href="#安装server" class="headerlink" title="安装server"></a>安装server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ./configure --enable-server --enable-agent --with-mysql=/usr/local/mysql/bin/mysql_config --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2</span><br><span class="line">[root@master ~]# make install</span><br><span class="line">[root@master ~]# #启动服务：zabbix_server</span><br><span class="line">[root@master ~]# su - zabbix</span><br><span class="line">[zabbix@master ~]# zabbix_agentd</span><br></pre></td></tr></table></figure><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ul><li><p>configure: error: LIBXML2 library not found </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install libxml2-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Invalid Net-SNMP directory - unable to find net-snmp-config</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install net-snmp-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Unable to use libevent (libevent check failed)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install libevent-devel</span><br></pre></td></tr></table></figure></li><li><p>configure: error: Curl library not found </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install curl-devel</span><br></pre></td></tr></table></figure></li><li><p>zabbix_server: error while loading shared libraries: libmysqlclient.so.20:<br>cannot open shared object file: No such file or<br>directory<br>===========》</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ln -s /usr/local/mysql/lib/libmysqlclient.so.20 /usr/lib64/mysql/libmysqlclient.so.20</span><br><span class="line">[root@master ~]# ldconfig</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装配置web"><a href="#安装配置web" class="headerlink" title="安装配置web"></a>安装配置web</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install httpd</span><br><span class="line">[root@master ~]# mkdir /var/www/html/zabbix</span><br><span class="line">[root@master ~]# cd zabbix-4.0.1/frontends/php</span><br><span class="line">[root@master php]# cp -a . /var/www/html/zabbix</span><br><span class="line">[root@master php]# systemctl start httpd</span><br><span class="line">[root@master php]# systemctl enable httpd</span><br><span class="line">[root@master php]# yum install php php-mysql</span><br></pre></td></tr></table></figure><p>打开URL<a href="http://ip/zabbix/setup.php" target="_blank" rel="noopener">http://ip/zabbix/setup.php</a><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/82372470ffa120dd2b39885d612a8c0c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/ef64285fe2b51d57b48e84d2cfd5831f.png" alt=""><br>按照提示处理依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install php-ldap</span><br><span class="line">[root@master ~]# yum install php-gd</span><br><span class="line">[root@master ~]# yum install php-xmlreader</span><br><span class="line">[root@master ~]# yum install php-mbstring</span><br><span class="line">[root@master ~]# yum install php-bcmath</span><br><span class="line">#修改php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 32M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/266ddc2c9f4edfcfdc418868cb6f0c2e.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/eadf734873ebbb6ab31991418842d30a.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/588b045598dc5f4117b9e37ea0be5bc6.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/29e1fa333ef65708c055cfba81bdcf8c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/fe3f959eaed4507ab43f55b7f729a8f3.png" alt=""><br>cd /var/www/html/zabbix/conf<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/fe80eae3c35590b107a86a97a6e3f0b6.png" alt=""></p><h2 id="Zabbix-agent安装"><a href="#Zabbix-agent安装" class="headerlink" title="Zabbix-agent安装"></a>Zabbix-agent安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -xzvf zabbix-4.0.1.tar.gz</span><br><span class="line">[root@master zabbix-4.0.1]# cd zabbix-4.0.1/</span><br><span class="line">[root@master zabbix-4.0.1]# ./configure --enable-agent</span><br><span class="line">[root@master zabbix-4.0.1]# make install</span><br><span class="line">[root@master zabbix-4.0.1]# vi /usr/local/etc/zabbix_agentd.conf #配置</span><br><span class="line">[root@master zabbix-4.0.1]# groupadd zabbix</span><br><span class="line">[root@master zabbix-4.0.1]# useradd -g zabbix zabbix</span><br><span class="line">[root@master zabbix-4.0.1]# zabbix_agentd</span><br></pre></td></tr></table></figure><h2 id="选择中文语言"><a href="#选择中文语言" class="headerlink" title="选择中文语言"></a>选择中文语言</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/6d0cfe4bdaeba69974aa556bbb2d6ab5.png" alt=""></p><h2 id="Zabbix中文监控服务器图形图表显示乱码处理"><a href="#Zabbix中文监控服务器图形图表显示乱码处理" class="headerlink" title="Zabbix中文监控服务器图形图表显示乱码处理"></a>Zabbix中文监控服务器图形图表显示乱码处理</h2><p>复制下图中的字体到linux中的zabbix中<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/b228cea352906b5c030e113e8d39d20d.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/7be29779af4f6ce40bba758a1bcb083c.png" alt=""><br>并做如下修改<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190130/bb2180500d7b1001bcb81854b9f9ec6e.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;zabbix源码方式安装&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>ORACLE 数据生成器 Data Generator</title>
    <link href="https://zixujing.github.io/2019/01/29/db/oracle/ORACLE-%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E5%99%A8-Data-Generator/"/>
    <id>https://zixujing.github.io/2019/01/29/db/oracle/ORACLE-数据生成器-Data-Generator/</id>
    <published>2019-01-28T18:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.362Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ORACLE生成测试数据</p></blockquote><a id="more"></a><ul><li><p>在psql的工具菜单下找到数据生成器：Data Generator<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190129/1548743024766.png" alt=""></p></li><li><p>psql有一些帮助信息<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190129/1548743314201.png" alt=""></p></li><li><p>例子</p></li></ul><ol><li>SQL(sys_guid())：guid</li><li>List(1,2,3,4,5,6,7,8,9,10,11,12)：从list中随机选数据</li><li>SQL(sysdate-dbms_random.value(1,180))：半年内时间生成</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ORACLE生成测试数据&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>ogg 几个命令</title>
    <link href="https://zixujing.github.io/2019/01/26/ogg/ogg%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/"/>
    <id>https://zixujing.github.io/2019/01/26/ogg/ogg几个命令/</id>
    <published>2019-01-26T08:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.387Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ogg相关的几个命令<br><a id="more"></a></p></blockquote><h2 id="查询相关"><a href="#查询相关" class="headerlink" title="查询相关"></a>查询相关</h2><ol><li><p>info all</p><ul><li>作用：查看整体的运行情况</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 5&gt; info all</span><br><span class="line">Program     Status      Group       Lag at Chkpt  Time Since Chkpt</span><br><span class="line">MANAGER     RUNNING                                           </span><br><span class="line">EXTRACT     RUNNING     DMP2        842:45:01     00:00:09    </span><br><span class="line">EXTRACT     RUNNING     EXT1        841:19:24     00:00:04    </span><br><span class="line">EXTRACT     RUNNING     EXT2        529:12:40     00:00:00</span><br></pre></td></tr></table></figure></li></ul></li><li><p>view params process</p><ul><li>作用：查看进程的参数设置</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 6&gt; view params EXT1</span><br><span class="line">extract ext1</span><br><span class="line">userid ggate@gavinprod, password oracle</span><br><span class="line">rmthost odellprod.com, mgrport 7809</span><br><span class="line">rmttrail /opt/oracle/ggate/dirdat/lt</span><br><span class="line">ddl include mapped objname sender.*;</span><br><span class="line">table sender.*;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process</p><ul><li>作用：查看进程的信息性，包括进程的状态、Checkpoint信息、延时等</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 7&gt; info EXT1</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       529:05:45 (updated 00:00:02 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-06 04:27:03  Seqno 24, RBA 18464196</span><br><span class="line">                     SCN 0.1440415 (1440415)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process detail</p><ul><li>作用：查看更加详细的信息，包括所使用的trail文件、参数文件、报告文件、警告文件的位置</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 8&gt; info EXT1 detail</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       431:32:57 (updated 00:00:04 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-10 06:00:18  Seqno 31, RBA 40079092</span><br><span class="line">                     SCN 0.1553661 (1553661)</span><br><span class="line">  Target Extract Trails:</span><br><span class="line">  Remote Trail Name                                Seqno        RBA     Max MB</span><br><span class="line">  /opt/oracle/ggate/dirdat/lt                          1       1105        100</span><br><span class="line">  Extract Source                          Begin             End             </span><br><span class="line">  /opt/oracle/flash_recovery_area/GAVINPROD/archivelog/2015_01_10/o1_mf_1_31_bc2d3p27_.arc  2014-12-24 04:12  2015-01-10 06:00</span><br><span class="line">  /opt/oracle/oradata/gavinprod/redo01.log  2014-12-24 00:23  2014-12-24 04:12</span><br><span class="line">  Not Available                           * Initialized *   2014-12-24 00:23</span><br><span class="line">Current directory    /opt/oracle/ggate</span><br><span class="line">Report file          /opt/oracle/ggate/dirrpt/EXT1.rpt</span><br><span class="line">Parameter file       /opt/oracle/ggate/dirprm/ext1.prm</span><br><span class="line">Checkpoint file      /opt/oracle/ggate/dirchk/EXT1.cpe</span><br><span class="line">Process file         /opt/oracle/ggate/dirpcs/EXT1.pce</span><br><span class="line">Stdout file          /opt/oracle/ggate/dirout/EXT1.out</span><br><span class="line">Error log            /opt/oracle/ggate/ggserr.log</span><br></pre></td></tr></table></figure></li></ul></li><li><p>info process showch</p><ul><li>作用：查看详细的关于checkpoint的细心你想，用于查询GoldenGate进行处理过的事物记录<br>Extract进程的Recovery checkpoing，他标识源数据最早的未被处理事物，可以查到该事物的redo log位于哪个日志文件以及该日志文件的序列号，所有序列号比它大得日志文件都需保留</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 9&gt; info EXT1 showch</span><br><span class="line">EXTRACT    EXT1      Last Started 2015-01-28 05:31   Status RUNNING</span><br><span class="line">Checkpoint Lag       00:00:00 (updated 00:00:06 ago)</span><br><span class="line">Log Read Checkpoint  Oracle Redo Logs</span><br><span class="line">                     2015-01-28 05:33:32  Seqno 42, RBA 2548736</span><br><span class="line">                     SCN 0.1750257 (1750257)</span><br><span class="line">Current Checkpoint Detail:</span><br><span class="line">Read Checkpoint #1</span><br><span class="line">  Oracle Redo Log</span><br><span class="line">  Startup Checkpoint (starting position in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 19</span><br><span class="line">    RBA: 37158416</span><br><span class="line">    Timestamp: 2014-12-24 04:12:21.000000</span><br><span class="line">    SCN: 0.1341390 (1341390)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo01.log</span><br><span class="line">  Recovery Checkpoint (position of oldest unprocessed transaction in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 42</span><br><span class="line">    RBA: 2504208</span><br><span class="line">    Timestamp: 2015-01-28 05:33:32.000000</span><br><span class="line">    SCN: 0.1750256 (1750256)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo03.log</span><br><span class="line">  Current Checkpoint (position of last record read in the data source):</span><br><span class="line">    Thread #: 1</span><br><span class="line">    Sequence #: 42</span><br><span class="line">    RBA: 2548736</span><br><span class="line">    Timestamp: 2015-01-28 05:33:32.000000</span><br><span class="line">    SCN: 0.1750257 (1750257)</span><br><span class="line">    Redo File: /opt/oracle/oradata/gavinprod/redo03.log</span><br><span class="line">Write Checkpoint #1</span><br><span class="line">  GGS Log Trail</span><br><span class="line">  Current Checkpoint (current write position):</span><br><span class="line">    Sequence #: 1</span><br><span class="line">    RBA: 1105</span><br><span class="line">    Timestamp: 2015-01-28 05:33:46.462178</span><br><span class="line">    Extract Trail: /opt/oracle/ggate/dirdat/lt</span><br><span class="line">CSN state information:</span><br><span class="line">  CRC: A4-7E-18-EE</span><br><span class="line">  Latest CSN: 1749736</span><br><span class="line">  Latest TXN: 7.29.894</span><br><span class="line">  Latest CSN of finished TXNs: 1749736</span><br><span class="line">  Completed TXNs: 7.29.894</span><br><span class="line">Header:</span><br><span class="line">  Version = 2</span><br><span class="line">  Record Source = A</span><br><span class="line">  Type = 10</span><br><span class="line">  # Input Checkpoints = 1</span><br><span class="line">  # Output Checkpoints = 1</span><br><span class="line">File Information:</span><br><span class="line">  Block Size = 2048</span><br><span class="line">  Max Blocks = 100</span><br><span class="line">  Record Length = 2048</span><br><span class="line">  Current Offset = 0</span><br><span class="line">Configuration:</span><br><span class="line">  Data Source = 3</span><br><span class="line">  Transaction Integrity = 1</span><br><span class="line">  Task Type = 0</span><br><span class="line">Status:</span><br><span class="line">  Start Time = 2015-01-28 05:31:39</span><br><span class="line">  Last Update Time = 2015-01-28 05:33:46</span><br><span class="line">  Stop Status = A</span><br><span class="line">  Last Result = 400</span><br></pre></td></tr></table></figure></li></ul></li><li><p>lag process</p><ul><li>作用：查看详细的延时信息</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 10&gt; lag EXT1</span><br><span class="line">Sending GETLAG request to EXTRACT EXT1 ...</span><br><span class="line">Last record lag: 23 seconds.</span><br><span class="line">At EOF, no more records to process.</span><br></pre></td></tr></table></figure></li></ul></li><li><p>stats</p><ul><li>作用：查看进程处理的记录数</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 13&gt; stats EXT1, total</span><br><span class="line">Sending STATS request to EXTRACT EXT1 ...</span><br><span class="line">Start of Statistics at 2015-01-28 05:37:59.</span><br><span class="line">DDL replication statistics (for all trails):</span><br><span class="line">*** Total statistics since extract started     ***</span><br><span class="line">        Operations                                      2899.00</span><br><span class="line">        Mapped operations                                  0.00</span><br><span class="line">        Unmapped operations                             2809.00</span><br><span class="line">        Other operations                                  90.00</span><br><span class="line">        Excluded operations                             2899.00</span><br><span class="line">Output to /opt/oracle/ggate/dirdat/lt:</span><br><span class="line">Extracting from GGATE.GGS_MARKER to GGATE.GGS_MARKER:</span><br><span class="line">*** Total statistics since 2015-01-28 05:31:45 ***</span><br><span class="line">        No database operations have been performed.</span><br><span class="line">End of Statistics.</span><br></pre></td></tr></table></figure></li></ul></li><li><p>view report process</p><ul><li>作用：查看对应的报告文件</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 11&gt; view report EXT1</span><br><span class="line">/***********************************************************************</span><br><span class="line">                 Oracle GoldenGate Capture for Oracle</span><br><span class="line">    Version 11.2.1.0.1 OGGCORE_11.2.1.0.1_PLATFORMS_120423.0230_FBO</span><br><span class="line">   Linux, x64, 64bit (optimized), Oracle 11g on Apr 23 2012 08:42:16</span><br><span class="line">Copyright (C) 1995, 2012, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">                    Starting at 2015-01-28 05:31:33</span><br><span class="line">/***********************************************************************</span><br><span class="line">Operating System Version:</span><br><span class="line">Linux</span><br><span class="line">Version #1 SMP Mon Nov 12 02:14:55 EST 2007, Release 2.6.18-53.el5</span><br><span class="line">Node: gavinprod.com</span><br><span class="line">Machine: x86_64</span><br><span class="line">                         soft limit   hard limit</span><br><span class="line">Address Space Size   :    unlimited    unlimited</span><br><span class="line">Heap Size            :    unlimited    unlimited</span><br><span class="line">File Size            :    unlimited    unlimited</span><br><span class="line">CPU Time             :    unlimited    unlimited</span><br><span class="line">Process id: 5097</span><br><span class="line">Description:</span><br><span class="line">/***********************************************************************</span><br><span class="line">**            Running with the following parameters                  **</span><br><span class="line">/***********************************************************************</span><br><span class="line">2015-01-28 05:31:33  INFO    OGG-03035  Operating system character set identified as UTF-8. Locale: en_US, LC_ALL:.</span><br><span class="line">extract ext1</span><br><span class="line">userid ggate@gavinprod, password ******</span><br><span class="line">2015-01-28 05:31:35  INFO    OGG-03500  WARNING: NLS_LANG environment variable does not match database character set, or not set.</span><br><span class="line">Using database character set value of AL32UTF8.</span><br><span class="line">rmthost odellprod.com, mgrport 7809</span><br><span class="line">rmttrail /opt/oracle/ggate/dirdat/lt</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>9 view ggsevt</p><ul><li>作用：查看日志</li><li>示例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (gavinprod.com) 14&gt; view ggsevt</span><br><span class="line">2014-09-10 01:26:35  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): edit params mgr.</span><br><span class="line">2014-09-10 01:27:16  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): edit params mgr.</span><br><span class="line">2014-09-10 01:27:27  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): start manager.</span><br><span class="line">2014-09-10 01:27:28  INFO    OGG-00983  Oracle GoldenGate Manager for Oracle, mgr.prm:  Manager started (port 7809).</span><br><span class="line">2014-09-10 01:27:40  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): add extract ext1  tranlog, begin now.</span><br><span class="line">2014-09-10 01:29:24  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): add exttrail2014-09-10 02:24:03</span><br><span class="line">2014-09-10 02:24:03  INFO    OGG-00983  Oracle GoldenGate Manager for Oracle, mgr.prm:  Manager started (port 7809).</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00987  Oracle GoldenGate Command Interpreter for Oracle:  GGSCI command (ggate): start EXT1.</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00963  Oracle GoldenGate Manager for Oracle, mgr.prm:  Command received from GGSCI on host gavinprod.com</span><br><span class="line">2014-09-10 02:24:07  INFO    OGG-00975  Oracle GoldenGate Manager for Oracle, mgr.prm:  EXTRACT EXT1 starting.</span><br><span class="line">2014-09-10 02:24:08  INFO    OGG-00992  Oracle GoldenGate Capture for Oracle, ext1.prm:  EXTRACT EXT1 starting.</span><br><span class="line">2014-09-10 02:24:08  INFO    OGG-03035  Oracle GoldenGate Capture for Oracle, ext1.prm:  Operating system character set identified as UTF-8.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01635  Oracle GoldenGate Capture for Oracle, ext1.prm:  BOUNDED RECOVERY: reset to initial or altered checkpoint.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01815  Oracle GoldenGate Capture for Oracle, ext1.prm:  Virtual Memory Facilities for: BR</span><br><span class="line">    anon alloc: mmap(MAP_ANON)  anon free: munmap</span><br><span class="line">    file alloc: mmap(MAP_SHARED)  file free: munmap</span><br><span class="line">    target directories:</span><br><span class="line">    /opt/oracle/ggate/BR/EXT1.</span><br><span class="line">2014-09-10 02:24:19  INFO    OGG-01815  Oracle GoldenGate Capture for Oracle, ext1.prm:  Virtual Memory Facilities for: COM</span><br><span class="line">    anon alloc: mmap(MAP_ANON)  anon free: munmap</span><br><span class="line">    file alloc: mmap(MAP_SHARED)  file free: munmap</span><br><span class="line">    target directories:</span><br><span class="line">    /opt/oracle/ggate/dirtmp.</span><br><span class="line">2014-09-10 02:24:20  WARNING OGG-01423  Oracle GoldenGate Capture for Oracle, ext1.prm:  No valid default archive log destination directory found</span><br></pre></td></tr></table></figure></li></ul><h2 id="extract相关"><a href="#extract相关" class="headerlink" title="extract相关"></a>extract相关</h2><ol><li><p>修改rba,checkpoint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter EXT_ALO,extseqno 17,extrba 9194144,thread 1</span><br><span class="line">alter EXT_ALO,extseqno 10,extrba 5740032,thread 2</span><br></pre></td></tr></table></figure></li><li><p>修改recovery checkpoint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter EXT_ALO,ioextseqno 17,ioextrba 9193488,thread 1</span><br><span class="line">alter  EXT_ALO,ioextseqno 10,ioextrba 5739536,thread 2</span><br></pre></td></tr></table></figure></li><li><p>info extract cust_ext, detail</p><blockquote><p>抽取进程的详细信息</p></blockquote></li></ol><ol start="4"><li>info extract ext*, showch  <blockquote><p>抽取进程的检查点信息,注意checkpoint和recovery checkpoint</p></blockquote></li></ol><ol start="5"><li><p>INFO TRANDATA user_name.table_names</p><blockquote><p>表的补充日志</p></blockquote></li><li><p>常用添加extract命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; add extract ext1, tranlog, begin now</span><br><span class="line">ggsci&gt; add extract ext1, tranlog, begin now, threads 4</span><br><span class="line">ggsci&gt; add extract ext1, tranlog, begin now, passive</span><br><span class="line">ggsci&gt; add extract ext1, extseqno 111, begin now</span><br><span class="line">ggsci&gt; add extract ext1, extrba 567890, begin 2012-02-02 12:00:00</span><br><span class="line">ggsci&gt; add extract ext1, sourceistable</span><br><span class="line">ggsci&gt; add extract ext1, exttrailsource /oracle/gg11/dirdat/hr   --data pump</span><br><span class="line">ggsci&gt; add extract ext1, vam                        -- VAM - Vendor Access Module</span><br><span class="line">ggsci&gt; add extract ext1, vamtrailsource /ogg/dirdat/vt</span><br><span class="line">ggsci&gt; add extract ext1, rmthost host123, mgrport 7810, rmtname fin</span><br></pre></td></tr></table></figure></li><li><p>status</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; STATUS MANAGER    -- To determine whether or not the Manager process is running</span><br><span class="line">ggsci&gt; STATUS EXTRACT group_name [, TASKS | ALLPROCESSES]   -- To determine whether or not Extract is running</span><br><span class="line">ggsci&gt; status extract extr_hr</span><br><span class="line">ggsci&gt; status extract ext*, tasks</span><br><span class="line">ggsci&gt; status extract *ext*, allprocesses</span><br><span class="line">ggsci&gt; STATUS REPLICAT group_name [, TASKS | ALLPROCESSES]  -- To determine whether or not Replicat is running</span><br><span class="line">ggsci&gt; status replicat emp_rep</span><br><span class="line">ggsci&gt; status replicat cust_rep, allprocesses</span><br><span class="line">ggsci&gt; STATUS ER group_wildcard_specification   -- To check the status of multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; status er *EX*</span><br><span class="line">Reading Program Database management system Vacuum Pump The Word Find email address free</span><br><span class="line">ggsci&gt; STATS EXTRACT group_name [, statistic] [, TABLE table] [, TOTALSONLY table_specification] [, REPORTFETCH | NOREPORTFETCH] [, REPORTRATE HR|MIN|SEC] [, ... ]  -- To display statistics for one or more Extract group</span><br><span class="line">ggsci&gt; stats ext_hr</span><br><span class="line">ggsci&gt; stats extract ext</span><br><span class="line">ggsci&gt; stats extract ext2 reportrate sec</span><br><span class="line">ggsci&gt; stats extract fin, total, daily</span><br><span class="line">ggsci&gt; stats extract fin, total, hourly, table acct, reportrate min, reset, reportfetch</span><br></pre></td></tr></table></figure></li><li><p>send</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; SEND MANAGER [CHILDSTATUS [DEBUG]] [GETPORTINFO [DETAIL]] [GETPURGEOLDEXTRACTS]   -- To retrieve the status of the active Manager process or to retrieve dynamic port information as configured in the Manager parameter file</span><br><span class="line">ggsci&gt; send manager childstatus</span><br><span class="line">ggsci&gt; send manager childstatus debug</span><br><span class="line">ggsci&gt; send manager getportinfo</span><br><span class="line">ggsci&gt; send manager getportinfo detail</span><br><span class="line">ggsci&gt; send manager getpurgeoldextracts</span><br><span class="line">ggsci&gt; SEND EXTRACT group_name,</span><br><span class="line">&#123; CACHEMGR &#123;CACHESTATS | CACHEQUEUES | CACHEPOOL&#125; | FORCESTOP | FORCETRANS id [THREAD n] [FORCE] | GETLAG | GETTCPSTATS | LOGEND | REPORT | ROLLOVER | SHOWTRANS [id] [THREAD n] [COUNT n] [DURATION duration_unit] [TABULAR] [FILE file_name [DETAIL]] | SKIPTRANS id [THREAD n] [FORCE] | STATUS | STOP | TLTRACE &#123;DEBUG | OFF | level&#125; [SIZELIMIT size] [DDLINCLUDE | DDL[ONLY]] [FILE] file_name | TRACE[2] &#123;tracefile | OFF&#125; | TRACEINIT | TRANLOGOPTIONS &#123;PURGEORPHANEDTRANSACTIONS | NOPURGEORPHANEDTRANSACTIONS&#125; | TRANLOGOPTIONS TRANSCLEANUPFREQUENCY minutes | VAMMESSAGE &quot;Teradata_command&quot; | VAMMESSAGE &#123;ARSTATS | INCLUDELIST [filter] | EXCLUDELIST [filter]&#125; | VAMMESSAGE OPENTRANS</span><br><span class="line">&#125;     -- To communicate with a running Extract process</span><br><span class="line">Teradata_command = &#123;&quot;control:terminate&quot; | &quot;control:suspend&quot; | &quot;control:resume&quot; | &quot;control:copy database.table&quot;</span><br><span class="line">ggsci&gt; send extract exthr status</span><br><span class="line">ggsci&gt; send extract extr, getlag</span><br><span class="line">ggsci&gt; send extract group_name tltrace file file_name ddlinclude</span><br><span class="line">ggsci&gt; send extract fin, rollover</span><br><span class="line">ggsci&gt; send extract fin  stop</span><br><span class="line">ggsci&gt; send extract fin, vammessage control:suspend</span><br><span class="line">ggsci&gt; send extract fin, tranlogoptions transcleanupfrequency 15</span><br><span class="line">ggsci&gt; send extract fin, showtrans count 10</span><br><span class="line">ggsci&gt; send extract fin, skiptrans 5.17.27634 thread 2</span><br></pre></td></tr></table></figure></li><li><p>alter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ALTER EXTRACT group_name [, ADD_EXTRACT_attribute] [, THREAD number] [, ETROLLOVER]  -- To change the attributes of an Extract group, To increment a trail to the next file in the sequence</span><br><span class="line">ggsci&gt; alter extract fin, begin 2012-02-16</span><br><span class="line">ggsci&gt; alter extract fin, etrollover</span><br><span class="line">ggsci&gt; alter extract fin, extseqno 26, extrba 338</span><br><span class="line">ggsci&gt; alter extract accounts, thread 4, begin 2012-03-09</span><br><span class="line">ggsci&gt; alter extract sales, lsn 1234:123:1</span><br></pre></td></tr></table></figure></li><li><p>lag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; LAG EXTRACT group_name    -- To determine a true lag time between Extract and the datasource</span><br><span class="line">ggsci&gt; lag extract ext*</span><br><span class="line">ggsci&gt; lag extract *</span><br></pre></td></tr></table></figure></li></ol><h2 id="replicat相关"><a href="#replicat相关" class="headerlink" title="replicat相关"></a>replicat相关</h2><ol><li>send rep2, NOHANDLECOLLISIONS<blockquote><p>send 命令动态取消HANDLECOLLISIONS</p></blockquote></li></ol><ol start="2"><li><p>info replicat fin, showch</p><blockquote><p>复制进程的检查点信息</p></blockquote></li><li><p>info replicat emp_rep, detail</p><blockquote><p>复制进程的相应信息</p></blockquote></li><li><p>info checkpointtable gg_owner.chkpt_table</p><blockquote><p>检查点表信息</p></blockquote></li><li><p>常用添加replicat进程命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; add replicat repl, exttrail C:\OGG10G\dirdat\lt</span><br><span class="line">ggsci&gt; add replicat repl, exttrail /oracle/gg11/dirdat/lt, checkpointtable gg_owner.checkpoint</span><br><span class="line">ggsci&gt; add replicat initload, specialrun</span><br><span class="line">ggsci&gt; add replicat repl, exttrail /oracle/gg11/dirdat/lt, nodbcheckpoint</span><br></pre></td></tr></table></figure></li><li><p>stats</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; STATS REPLICAT group_name [, statistic] [, TABLE table] [, TOTALSONLY table_specification] [, REPORTDETAIL | NOREPORTDETAIL] [, REPORTRATE HR|MIN|SEC] [, ... ]   -- To display statistics for one or more Replicat groups</span><br><span class="line">ggsci&gt; stats rep_hr</span><br><span class="line">ggsci&gt; stats replicat fin, total, table acct, reportrate hr, reset, noreportdetail</span><br><span class="line">ggsci&gt; STATS ER group_wildcard_specification   -- To get statistics on multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; stats er ext*</span><br></pre></td></tr></table></figure></li><li><p>send</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; SEND REPLICAT group_name,</span><br><span class="line">&#123; FORCESTOP | GETLAG | HANDLECOLLISIONS [table_specification] | NOHANDLECOLLISIONS [table_specification] | REPORT [HANDLECOLLISIONS [table_specification]] | STATUS | STOP | TRACE[2] [DDLINCLUDE | DDL[ONLY]] [FILE] file_name | TRACE[2] OFF | TRACEINIT</span><br><span class="line">&#125;    -- To communicate with a starting or running Replicat process</span><br><span class="line">ggsci&gt; send replicat fin, handlecollisions</span><br><span class="line">ggsci&gt; send replicat fin, report handlecollisions fin_*</span><br><span class="line">ggsci&gt; send replicat fin, getlag</span><br><span class="line">ggsci&gt; SEND ER group_wildcard_specification   -- To send instructions to multiple Extract and Replicat groups as a unit</span><br><span class="line">ggsci&gt; send er *ext</span><br></pre></td></tr></table></figure></li><li><p>lag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; LAG REPLICAT group_name   -- To determine a true lag time between Replicat and the trail</span><br><span class="line">ggsci&gt; lag replicat myrepl</span><br><span class="line">ggsci&gt; lag replicat *</span><br></pre></td></tr></table></figure></li></ol><h2 id="trail相关"><a href="#trail相关" class="headerlink" title="trail相关"></a>trail相关</h2><ol><li><p>INFO EXTTRAIL trail_name</p></li><li><p>info exttrail e:\ogg\dirdat\ex</p><blockquote><p>本地trail文件信息</p></blockquote></li><li><p>INFO RMTTRAIL trail_name</p></li><li><p>info rmttrail d:\ogg\dirdat\ex</p><blockquote><p>远程trail文件信息</p></blockquote></li><li><p>常用添加trail 命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ADD EXTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n] [, SEQNO n]   -- To create a trail for online processing on local system</span><br><span class="line">ggsci&gt; add exttrail /oracle/gg11/dirdat/lt, extract s_extr</span><br><span class="line">ggsci&gt; add exttrail C:\OGG10G\dirdat\et, extract emp_ext</span><br><span class="line">ggsci&gt; add exttrail c:\ogg\dirdat\fi, extract fin, megabytes 30</span><br><span class="line">ggsci&gt; ADD RMTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n] [, SEQNO n]   -- To create a trail for online processing on remote system</span><br><span class="line">ggsci&gt; add rmttrail C:\OGG10G\dirdat\hr, extract extr</span><br><span class="line">ggsci&gt; add rmttrail /u01/app/oracle/ogg/dirdat/ms, extract msextr</span><br><span class="line">ggsci&gt; add rmttrail /u01/app/oracle/ogg/dirdat/my, extract mysql, megabytes 50</span><br></pre></td></tr></table></figure></li><li><p>alter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; ALTER EXTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n]   -- To change the attributes of a trail (on the local system)</span><br><span class="line">ggsci&gt; alter exttrail c:\ogg\dirdat\aa, extract fin, megabytes 30</span><br><span class="line">ggsci&gt; ALTER RMTTRAIL trail_name, EXTRACT group_name [, MEGABYTES n]   -- To change the attributes of a trail (on a remote system)</span><br><span class="line">ggsci&gt; alter rmttrail c:\ogg\dirdat\et, extract fin, megabytes 25</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ogg相关的几个命令&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>ogg安装和搭建文档</title>
    <link href="https://zixujing.github.io/2019/01/26/ogg/ogg%E5%AE%89%E8%A3%85%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/01/26/ogg/ogg安装搭建文档/</id>
    <published>2019-01-26T07:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.410Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ogg的安装和搭建内容<br><a id="more"></a></p></blockquote><h2 id="安装ogg软件"><a href="#安装ogg软件" class="headerlink" title="安装ogg软件"></a>安装ogg软件</h2><h3 id="建立ogg软件目录"><a href="#建立ogg软件目录" class="headerlink" title="建立ogg软件目录"></a>建立ogg软件目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost oracle]# su - oracle</span><br><span class="line">[oracle@localhost ~]$ cd /home/oracle/app/oracle</span><br><span class="line">[oracle@localhost oracle]$ mkdir ogg</span><br></pre></td></tr></table></figure><h3 id="复制ogg软件到目标机器"><a href="#复制ogg软件到目标机器" class="headerlink" title="复制ogg软件到目标机器"></a>复制ogg软件到目标机器</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/0ca089f3b044e3c8ebb70034da8241ae.png" alt=""></p><h3 id="解压软件"><a href="#解压软件" class="headerlink" title="解压软件"></a>解压软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[oracle@localhost ogg]$ pwd</span><br><span class="line">/home/oracle/app/oracle/ogg</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip</span><br><span class="line">[oracle@localhost ogg]$ unzip 122022_fbo_ggs_Linux_x64_shiphome.zip</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip fbo_ggs_Linux_x64_shiphome</span><br><span class="line">OGG-12.2.0.2-README.txt OGGCORE_12.2.0.2.2.pdf</span><br><span class="line">[oracle@localhost ogg]$ rm OGG-12.2.0.2-README.txt OGGCORE_12.2.0.2.2.pdf</span><br><span class="line">[oracle@localhost ogg]$ ls</span><br><span class="line">122022_fbo_ggs_Linux_x64_shiphome.zip fbo_ggs_Linux_x64_shiphome</span><br></pre></td></tr></table></figure><h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><p>打开xmanager进入目标机器，进入目录/home/oracle/app/oracle/ogg/fbo_ggs_Linux_x64_shiphome/Disk1，运行runInstaller安装。</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/ea6f4191a1a752f66325ef8c42d9234f.png" alt=""></p><p>选择oracle11g点击下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/86a029775b233dbe7736680f356b2b26.png" alt=""></p><p>配置后点击下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/4cbb6ad0cc6267e4e094f2ffbed24fdf.png" alt=""></p><p>点击安装</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/f8f50b7ce0b573926a6daf82dce0d169.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/d4c1a6fbbcab268440c924304cf36667.png" alt=""></p><h2 id="主从库初始化设置"><a href="#主从库初始化设置" class="headerlink" title="主从库初始化设置"></a>主从库初始化设置</h2><blockquote><p>如果从库不做其他数据库的主库，那么supplemental log只需要在主库添加即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[oracle@localhost ~]$ sqlplus / as sysdba</span><br><span class="line">SQL*Plus: Release 11.2.0.1.0 Production on Thu Jul 5 12:40:45 2018</span><br><span class="line">Copyright (c) 1982, 2009, Oracle. All rights reserved.</span><br><span class="line">Connected to:</span><br><span class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</span><br><span class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area 784998400 bytes</span><br><span class="line">Fixed Size 2217464 bytes</span><br><span class="line">Variable Size 486541832 bytes</span><br><span class="line">Database Buffers 293601280 bytes</span><br><span class="line">Redo Buffers 2637824 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; alter database add supplemental log data;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">Database altered.</span><br><span class="line">SQL&gt; create user ogg identified by ogg;</span><br><span class="line">User created.</span><br><span class="line">SQL&gt; grant connect,resource to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant execute on utl_file to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant select any dictionary,select any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant alter any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant flashback any table to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant execute on DBMS_FLASHBACK to ogg;</span><br><span class="line">Grant succeeded.</span><br><span class="line">SQL&gt; grant dba to ogg;</span><br><span class="line">Grant succeeded.</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>注意：如果想简单的设置ogg的权限，那么ogg用户只赋dba权限既可。</p></blockquote><h3 id="数据源（主库）设置"><a href="#数据源（主库）设置" class="headerlink" title="数据源（主库）设置"></a>数据源（主库）设置</h3><blockquote><p>进入ogg即运行ggsci命令执行（执行./ggsci）：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&gt; dblogin userid ogg password ogg</span><br><span class="line">&gt; add trandata smartecap_numone.tb*</span><br><span class="line">&gt; create subdirs</span><br><span class="line">&gt; edit params ./GLOBALS</span><br><span class="line">_DISABLEFIX21427144 --远程访问</span><br><span class="line">&gt; edit params mgr</span><br><span class="line">PORT 7809</span><br><span class="line">DYNAMICPORTLIST 7810-7818,7820-7830 --远程访问端口</span><br><span class="line">ACCESSRULE,PROG *,IPADDR *,ALLOW --远程访问</span><br><span class="line">PURGEOLDEXTRACTS ./dirdat/st, USECHECKPOINTS, MINKEEPDAYS 7</span><br><span class="line">&gt;add trandata smartecap_numone.tb*</span><br><span class="line">&gt;info trandata smartecap_numone.tb* #查看是否设置传输数据成功</span><br><span class="line">&gt;add extract exts,tranlog ,begin now</span><br><span class="line">&gt;info all #查看所有进程</span><br><span class="line">&gt;add exttrail ./dirdat/st,extract exts,megabytes 1024</span><br><span class="line">&gt; edit params exts</span><br><span class="line">EXTRACT exts</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">DISCARDFILE ./dirrpt/exts.dsc,APPEND,MEGABYTES 1024</span><br><span class="line">DBOPTIONS ALLOWUNUSEDCOLUMN</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 350s</span><br><span class="line">EXTTRAIL ./dirdat/st</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">TRANLOGOPTIONS CONVERTUCS2CLOBS</span><br><span class="line">IGNOREDELETES</span><br><span class="line">TABLE smartecap_numone.tb*;</span><br><span class="line">&gt; add extract dpend,exttrailsource ./dirdat/st</span><br><span class="line">&gt; add rmttrail /home/oracle/app/ogg/dirdat/st ,extract dpend</span><br><span class="line">&gt; edit params dpend</span><br><span class="line">EXTRACT dpend</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">PASSTHRU</span><br><span class="line">RMTHOST 176.100.13.245, MGRPORT 7809, compress</span><br><span class="line">RMTTRAIL /home/oracle/app/ogg/dirdat/st</span><br><span class="line">TABLE smartecap_numone.tb*;</span><br></pre></td></tr></table></figure><h3 id="目标端（从库）设置"><a href="#目标端（从库）设置" class="headerlink" title="目标端（从库）设置"></a>目标端（从库）设置</h3><blockquote><p>进入ogg即运行ggsci命令执行（执行./ggsci）：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;create subdirs</span><br><span class="line">&gt;dblogin userid ogg,password ogg</span><br><span class="line">&gt;add checkpointtable ogg.checkpoint</span><br><span class="line">&gt;add replicat repnd,exttrail ./dirdat/st,checkpointtable ogg.checkpoint</span><br><span class="line">&gt;edit param repnd</span><br><span class="line">REPLICAT repnd</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">--HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ddloptions report</span><br><span class="line">MAP smartecap_numone.*, TARGET smartecap_numone.*;</span><br></pre></td></tr></table></figure><h2 id="备份主库的ddl语句并还原到从库"><a href="#备份主库的ddl语句并还原到从库" class="headerlink" title="备份主库的ddl语句并还原到从库"></a>备份主库的ddl语句并还原到从库</h2><h3 id="ddl导出"><a href="#ddl导出" class="headerlink" title="ddl导出"></a>ddl导出</h3><p>可以使用工具导出ddl语句，这里使用toad，步骤如下：</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/6e777cb404cf6fa7e640f554689d89f7.png" alt=""></p><p>选择add并点击load rows</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/01fafae08aefbb91886abe825a6927a9.png" alt=""></p><p>选择需要导出的表</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/40a3af35b6908b0fac6ff857573bc523.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/611d6128ae38b1c8dec4a8cf8e4ebcd3.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/4d4972afeb3828141c27690e2d0c8a39.png" alt=""></p><p>选择存储文件并点击导出</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/2f71c61b36f0f3454ae859f7107bc21e.png" alt=""></p><h3 id="在从库创建用户并恢复主库的ddl"><a href="#在从库创建用户并恢复主库的ddl" class="headerlink" title="在从库创建用户并恢复主库的ddl"></a>在从库创建用户并恢复主库的ddl</h3><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;CREATE USER SMARTECAP_NUMONE_XJ IDENTIFIED BY &lt;password&gt; ACCOUNT UNLOCK;</span><br><span class="line">&gt;GRANT CONNECT TO SMARTECAP_NUMONE_XJ;</span><br><span class="line">&gt;GRANT DBA TO SMARTECAP_NUMONE_XJ;</span><br><span class="line">&gt;GRANT RESOURCE TO SMARTECAP_NUMONE_XJ;</span><br></pre></td></tr></table></figure><h4 id="恢复ddl语句"><a href="#恢复ddl语句" class="headerlink" title="恢复ddl语句"></a>恢复ddl语句</h4><blockquote><p>使用toad登录从库的用户SMARTECAP_NUMONE_XJ，执行主库导出的ddl文件。</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/befe2282482863424bc057d4237441a0.png" alt=""></p><h2 id="通过toad工具使主从数据同步，并同步"><a href="#通过toad工具使主从数据同步，并同步" class="headerlink" title="通过toad工具使主从数据同步，并同步"></a>通过toad工具使主从数据同步，并同步</h2><blockquote><p>在从库创建主库的dblink</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database link &quot;source&quot;</span><br><span class="line">connect to SMARTECAP_NUMONE_XJ</span><br><span class="line">identified by &quot;123456&quot;</span><br><span class="line">using &apos;192.168.106.174:1521/orcl&apos;;</span><br></pre></td></tr></table></figure><blockquote><p>然后每张表都依次执行如下sql语句。为保证数据的一致性在导数过程中（ogg未同步前停止所有主库的应用）</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190126/7162ca279063e1ed5b5c623ab7cca4c6.png" alt=""></p><h2 id="ogg启动"><a href="#ogg启动" class="headerlink" title="ogg启动"></a>ogg启动</h2><h3 id="首先在从库ggsci中执行"><a href="#首先在从库ggsci中执行" class="headerlink" title="首先在从库ggsci中执行"></a>首先在从库ggsci中执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (localhost.localdomain) 1&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT STOPPED REPND 00:00:00 01:25:26</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 2&gt; start repnd</span><br><span class="line"></span><br><span class="line">Sending START request to MANAGER ...</span><br><span class="line">REPLICAT REPND starting</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 3&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT STARTING REPND 00:00:00 01:25:32</span><br><span class="line"></span><br><span class="line">GGSCI (localhost.localdomain) 6&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">REPLICAT RUNNING REPND 00:00:00 00:00:05</span><br></pre></td></tr></table></figure><h3 id="然后在主库ggsci中执行"><a href="#然后在主库ggsci中执行" class="headerlink" title="然后在主库ggsci中执行"></a>然后在主库ggsci中执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GGSCI (oracle.domain) 23&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">EXTRACT RUNNING DPEND 00:00:00 00:00:06</span><br><span class="line">EXTRACT ABENDED DPENDD 00:00:00 01:25:16</span><br><span class="line">EXTRACT RUNNING EXTS 00:00:00 00:00:00</span><br><span class="line"></span><br><span class="line">GGSCI (oracle.domain) 24&gt; start dpendd</span><br><span class="line"></span><br><span class="line">Sending START request to MANAGER ...</span><br><span class="line">EXTRACT DPENDD starting</span><br><span class="line"></span><br><span class="line">GGSCI (oracle.domain) 25&gt; info all</span><br><span class="line"></span><br><span class="line">Program Status Group Lag at Chkpt Time Since Chkpt</span><br><span class="line">MANAGER RUNNING</span><br><span class="line">EXTRACT RUNNING DPEND 00:00:00 00:00:02</span><br><span class="line">EXTRACT RUNNING DPENDD 00:00:00 01:25:22</span><br><span class="line">EXTRACT RUNNING EXTS 00:00:00 00:00:06</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ogg的安装和搭建内容&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>Mysql安装手册</title>
    <link href="https://zixujing.github.io/2019/01/26/db/mysql/mysql%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9/"/>
    <id>https://zixujing.github.io/2019/01/26/db/mysql/mysql安装相关内容/</id>
    <published>2019-01-25T18:00:00.000Z</published>
    <updated>2019-01-30T16:03:43.358Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql 安装相关的内容</p></blockquote><a id="more"></a><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><p>选择绿色安装。数据库版本是5.7.22。</p><h2 id="主机系统环境"><a href="#主机系统环境" class="headerlink" title="主机系统环境"></a>主机系统环境</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/91fdb214232ced7ed657aa473462337c.png" alt=""></p><h2 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt; groupadd mysql</span><br><span class="line">$&gt; useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure><h2 id="数据库软件准备"><a href="#数据库软件准备" class="headerlink" title="数据库软件准备"></a>数据库软件准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&gt; tar -xzvf mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">$&gt; mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql</span><br><span class="line">$&gt; chown mysql:mysql -R /usr/local/mysql</span><br><span class="line">#数据目录创建，建议新挂一个磁盘到/opt下，然后在opt下创建data目录专门存储mysql数据</span><br><span class="line">$&gt;mkdir /opt/data</span><br><span class="line">$&gt;chown -R mysql:mysql /opt/data</span><br></pre></td></tr></table></figure><h2 id="设置PATH路径"><a href="#设置PATH路径" class="headerlink" title="设置PATH路径"></a>设置PATH路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt;vi ~/.bash_profile</span><br></pre></td></tr></table></figure><p>设置如下图：</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/2bb12b141f9ac28ff39b1248f537e1ff.png" alt=""></p><p>保存后source生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; source ~/.bash_profile</span><br></pre></td></tr></table></figure></p><h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt; cd /usr/local/mysql/bin</span><br><span class="line">$&gt; ./mysqld --initialize --user=mysql --basedir=/usr/local/mysql/ --datadir=/opt/data/</span><br></pre></td></tr></table></figure><blockquote><p>记住初始密码（ZBy%#Uh45%gj），如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/10648641329e44faf01eb00e182c6646.png" alt=""></p></blockquote><h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&gt;vi /etc/my.cnf</span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置如下</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql/</span><br><span class="line">datadir = /opt/data/</span><br><span class="line">character-set-server = utf8</span><br><span class="line">pid-file=/opt/data/mysqld.pid</span><br><span class="line">back_log=1024</span><br><span class="line">wait_timeout=1800</span><br><span class="line">max_connections=3200</span><br><span class="line">max_user_connections=800</span><br><span class="line">innodb_thread_concurrency=4</span><br><span class="line">skip-name-resolve #在5.7.18安装是使用此参数会有问题，不能</span><br><span class="line">innodb_buffer_pool_size=100M</span><br><span class="line">innodb_log_buffer_size=20M</span><br><span class="line">read_buffer_size=10M</span><br><span class="line">sort_buffer_size=10M</span><br><span class="line">read_rnd_buffer_size=10M</span><br><span class="line">server-id=100</span><br><span class="line">log-bin = master</span><br><span class="line">max_allowed_packet=20M </span><br><span class="line">lower_case_table_names=1</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure><h2 id="配置解释"><a href="#配置解释" class="headerlink" title="配置解释"></a>配置解释</h2><ol><li><p>back_log=1024</p><blockquote><p>back_log的值指出在mysql暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。也就是说，如果mysql的连接数据达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。</p></blockquote></li><li><p>wait_timeout=1800</p><blockquote><p>mysql连接闲置超过此设定值的时间后将会被强行关闭，单位是秒。</p></blockquote></li><li><p>max_connections=3200</p><blockquote><p>指mysql的最大连接数，如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量，当然这是建立在机器能支撑的情况下，因为如果连接数越多，介于mysql会为每个连接提供连接缓冲区，就会开销越多的内存，所以要适当调整该值，不能盲目提高设值。</p></blockquote></li><li><p>max_user_connections=800</p><blockquote><p>指每个数据库用户的最大连接。针对某一个账号的所有客户端并行连接到mysql服务的最大并行连接数。简单说是指同一个账号能够同时连接到mysql服务的最大连接数。设置为0表示不限制。</p></blockquote></li><li><p>innodb_thread_concurrency=CPU核数*2</p><blockquote><p>此值应设为CPU核数的2倍。</p></blockquote></li><li><p>skip-name-resolve</p><blockquote><p>禁止mysql对外部连接进行DNS解析，使用这一选项可以消除mysql进行DNS解析的时间。</p></blockquote></li><li><p>innodb_buffer_pool_size&lt;=服务器内存*0.7</p><blockquote><p>用于缓存索引和数据的内存大小。</p></blockquote></li><li><p>innodb_log_buffer_size=20M</p><blockquote><p>InnoDB存储引擎的事务日志所使用的缓冲区。</p></blockquote></li><li><p>read_buffer_size=10M</p><blockquote><p>  这个值代表读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区。</p></blockquote></li><li><p>sort_buffer_size=10M</p><blockquote><p>执行排序使用的缓冲大小。</p></blockquote></li><li><p>read_rnd_buffer_size=10M</p><blockquote><p>随机读缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，mysql会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。</p></blockquote></li><li><p>binlog=日志名字</p><blockquote><p>mysql的二进制日志是mysql最重要的日志，它记录了所有的DDL和DML语句，以事件形式记录，还包含语句所执行的消耗的时间，mysql的二进制日志是事务安全型的。</p></blockquote></li></ol><h2 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">$&gt;service mysqld start</span><br></pre></td></tr></table></figure><h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt;mysql_secure_installation</span><br></pre></td></tr></table></figure><blockquote><p>图中划红线的是修改密码部分，旧密码是初始化数据库时生成的随机密码。</p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c35978840d79c90476c7e0fbaafb3170.png" alt=""></p><h2 id="centos7配置开机启动"><a href="#centos7配置开机启动" class="headerlink" title="centos7配置开机启动"></a>centos7配置开机启动</h2><h2 id="配置文件创建"><a href="#配置文件创建" class="headerlink" title="配置文件创建"></a>配置文件创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# touch /usr/lib/systemd/system/mysqld.service</span><br><span class="line">[root@localhost ~]# cd /usr/lib/systemd/system</span><br><span class="line">#编辑上一步创建的mysqld.service文件，加入如下内容:</span><br><span class="line">[root@localhost system]# vi mysqld.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line">ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf</span><br><span class="line">LimitNOFILE = 5000</span><br></pre></td></tr></table></figure><blockquote><p>备注:ExecStart=/usr/local/mysql/bin/mysqld(此处请对应修改为mysql程序所在的路径)</p></blockquote><h2 id="启动mysql-1"><a href="#启动mysql-1" class="headerlink" title="启动mysql"></a>启动mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost system]# systemctl enable mysqld</span><br><span class="line">[root@localhost system]# systemctl start mysqld</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql 安装相关的内容&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Oracle安装文档</title>
    <link href="https://zixujing.github.io/2019/01/26/db/oracle/oracle%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3_centos7.5_11.2.0.4/"/>
    <id>https://zixujing.github.io/2019/01/26/db/oracle/oracle安装文档_centos7.5_11.2.0.4/</id>
    <published>2019-01-25T17:00:00.000Z</published>
    <updated>2019-01-31T03:05:58.765Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>oracle11.2.0.4 + centos 7.5安装文档</p></blockquote><a id="more"></a><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><p>Oracle版本是11.2.0.4</p><h2 id="主机系统环境"><a href="#主机系统环境" class="headerlink" title="主机系统环境"></a>主机系统环境</h2><h3 id="示例环境"><a href="#示例环境" class="headerlink" title="示例环境"></a>示例环境</h3><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/38af0a72d5fb814cd7c8715c819ed9cf.png" alt=""></p><h3 id="修改系统标识"><a href="#修改系统标识" class="headerlink" title="修改系统标识"></a>修改系统标识</h3><p><code>$&gt; echo &quot;Red Hat Enterprise Linux Server release 7.0 (Maipo)&quot; &gt;/etc/redhat-release</code></p><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><p><code>$&gt; hostnamectl set-hostname oracle-server</code></p><h3 id="修改系统内核参数"><a href="#修改系统内核参数" class="headerlink" title="修改系统内核参数"></a>修改系统内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$&gt; echo &quot;</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">#单位是页</span><br><span class="line">kernel.shmall = 7864320</span><br><span class="line">kernel.shmmax = 132212254720</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">#semaphores: semmsl, semmns, semopm, semmni</span><br><span class="line">#SEMMSL==&gt;processes+10 SEMMNS===&gt;SEMMNI*SEMMSL SEMOPM====&gt;系统调用允许的信号量最大个数至少100</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.core.rmem_default=262144</span><br><span class="line">net.core.rmem_max=16777216</span><br><span class="line">net.core.wmem_default=262144</span><br><span class="line">net.core.wmem_max=16777216</span><br><span class="line">net.core.somaxconn=4096</span><br><span class="line">net.core.netdev_max_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_syn_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_tw_buckets=10000</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 3600</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">vm.swappiness = 0</span><br><span class="line">vm.panic_on_oom = 1</span><br><span class="line">kernel.randomize_va_space=0&quot; &gt;&gt;/etc/sysctl.conf</span><br><span class="line">$&gt; sysctl –p</span><br></pre></td></tr></table></figure><h3 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt;echo &quot;# Oracle-Server</span><br><span class="line">192.168.106.111 oracle-server</span><br><span class="line">&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="修改操作系统资源限制"><a href="#修改操作系统资源限制" class="headerlink" title="修改操作系统资源限制"></a>修改操作系统资源限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$&gt;echo &quot;#ORACLE</span><br><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 4096</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240&quot; &gt;&gt; /etc/security/limits.conf</span><br><span class="line">$&gt;echo &quot;session required pam_limits.so&quot; &gt;&gt; /etc/pam.d/login</span><br><span class="line">$&gt;#如果存在文件/etc/security/limits.d/20-nproc.conf那么做如下修改</span><br><span class="line">$&gt;vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line">#把下面这句</span><br><span class="line">* soft nproc 1024</span><br><span class="line">#修改为</span><br><span class="line">* - nproc 16384</span><br></pre></td></tr></table></figure><h3 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&gt;groupadd -g 54321 oinstall</span><br><span class="line">$&gt;groupadd -g 54322 dba</span><br><span class="line">$&gt;groupadd -g 54323 oper</span><br><span class="line">$&gt;useradd -u 54322 -g oinstall -G dba,oper oracle</span><br><span class="line">$&gt;passwd oracle</span><br></pre></td></tr></table></figure><h3 id="修改oracle用户环境变量"><a href="#修改oracle用户环境变量" class="headerlink" title="修改oracle用户环境变量"></a>修改oracle用户环境变量</h3><blockquote><p>在/home/oracle/.bash_profile末尾添加</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#Oracle Settings</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=$TMP</span><br><span class="line">export ORACLE_HOSTNAME=oracle-server</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE /db11204</span><br><span class="line">export ORACLE_SID=ORCL</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br></pre></td></tr></table></figure><h3 id="创建目录及授权"><a href="#创建目录及授权" class="headerlink" title="创建目录及授权"></a>创建目录及授权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&gt;mkdir -p /u01/app/oracle</span><br><span class="line">$&gt;mkdir -p /u01/app/oracle/db11204</span><br><span class="line">$&gt;chown oracle:oinstall /u01/app</span><br><span class="line">$&gt;chown -R oracle:oinstall /u01/app/oracle</span><br><span class="line">$&gt;chmod -R 0775 /u01</span><br></pre></td></tr></table></figure><h3 id="安装oracle所需的软件环境"><a href="#安装oracle所需的软件环境" class="headerlink" title="安装oracle所需的软件环境"></a>安装oracle所需的软件环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$&gt;rpm -Uvh compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh ksh-20120801-137.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh unixODBC-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh unixODBC-devel-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh zlib-devel-1.2.7-17.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh elfutils-libelf-devel-0.170-4.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -ivh libXmu-1.1.2-2.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh libXaw-1.0.13-4.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh xterm-295-3.el7.x86_64.rpm</span><br><span class="line">$&gt;rpm -Uvh perl-Switch-2.16-7.el7.noarch.rpm</span><br></pre></td></tr></table></figure><blockquote><p>注意：上面是本文档环境实际执行的，如果linux操作系统有出入，则有两种方式获取安装包，其一，去系统安装盘中寻找对应版本的软件，其二，用yum下载，例如ksh-20120801-137.el7.x86_64.rpm可以在linux中执行yum<br>–y install ksh即可。</p></blockquote><h3 id="设置selinux并使之生效"><a href="#设置selinux并使之生效" class="headerlink" title="设置selinux并使之生效"></a>设置selinux并使之生效</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;sed -i &apos;/SELINUX=enforcing/s/enforcing/permissive/g&apos; /etc/selinux/config</span><br><span class="line">$&gt;setenforce Permissive</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙并取消开机启动"><a href="#关闭防火墙并取消开机启动" class="headerlink" title="关闭防火墙并取消开机启动"></a>关闭防火墙并取消开机启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&gt;systemctl stop firewalld</span><br><span class="line">$&gt;systemctl disable firewalld</span><br></pre></td></tr></table></figure><h3 id="设置NTP时钟"><a href="#设置NTP时钟" class="headerlink" title="设置NTP时钟"></a>设置NTP时钟</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt;systemctl stop ntpd</span><br><span class="line">$&gt;systemctl disable ntpd</span><br><span class="line">$&gt;mv /etc/ntp.conf /etc/ntp.conf.orig</span><br></pre></td></tr></table></figure><h2 id="Oracle安装"><a href="#Oracle安装" class="headerlink" title="Oracle安装"></a>Oracle安装</h2><p>执行./runInstaller</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8648eb24e32f99e7aca5c7f07caf5ff1.png" alt=""></p><p>选择不更新，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c1ac5f05f5335f3cae0c348b5a417ca4.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/be2e87a8b94516b5a3114cd7890ade8c.png" alt=""></p><p>选择仅安装软件，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/729535785378935c8224af2949e32774.png" alt=""></p><p>选择单实例，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/a1666c25e1f4215d4d19864283df33f6.png" alt=""></p><p>默认，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8f17a8f328d71efddb948a86193d06b9.png" alt=""></p><p>选择企业版，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/52b0d90f783e0876fadd16a9373b0d9c.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/ea1b2d772c9ccf3219e74f46540b2619.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/dcb93cdf3f63ab7dcd04e48075d004d4.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/51c3acaa721259649fa9d3bc8f228895.png" alt=""></p><blockquote><p>说明：因为文档中安装的是64位oracle，所以上图依赖环境中如果检测到有32位软件未按照时，可以忽略。除了上面说的，还有其他依赖检查失败，并且安装步骤是按照本文档执行的，那么需要联系DBA解决这个问题。</p></blockquote><p>选择忽略所有，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8bfbfe52895fd7b808fb59832a777d31.png" alt=""></p><p>完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e9776a1b1aafc7341dc648d82e0ea4fd.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/bb76efedbef27d89c3f01fb08b347605.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e1abef691028b5f6c1a0a1e3512b0341.png" alt=""></p><p>用root账户执行上面脚本，点完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/03ca5ef7c40f221da405b247c57c8ffb.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/34374713818d831761b03cc720598b56.png" alt=""></p><h2 id="Oracle监听配置"><a href="#Oracle监听配置" class="headerlink" title="Oracle监听配置"></a>Oracle监听配置</h2><p>执行netca</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/c55ac08666992251a903f44b1656959d.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/520ce2bb9a399c6978966b0fa4506873.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/632cbdeeee59a7eae16860470d1b27f0.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/bfb4ea1200def1165037586694d8dc58.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/b8520c9225bf64b9f20193abb8801ca2.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d0a74ce6e52183e75dbe76ec8af358a1.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d8bbd22b2a716b62e6e93a77bfe2a3ca.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/f64f4eb3a1830778b7cc5aa8abd30813.png" alt=""></p><p>点完成</p><h2 id="Oracle数据库配置"><a href="#Oracle数据库配置" class="headerlink" title="Oracle数据库配置"></a>Oracle数据库配置</h2><p>执行dbca</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/add043123b071bb3dce44725f4e44704.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/90454c0fe8afbc3c4ec7c5591e8639e0.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/5b46bdce515dca7d38f4ba3683d6888a.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/b622361a804e02135b54467cf87a4381.png" alt=""></p><p>指定实例名，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/3cd232ed89eca28cbd404db1359f028a.png" alt=""></p><p>默认，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/1c37b26e3199013a9a43f7bc8e5b6d9d.png" alt=""></p><p>所有账号使用同一个密码，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/4c492b3fe795666bf5d19f5a66fdb108.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/1797408e37336a017e0df5d4190953a5.png" alt=""></p><p>默认下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e30d0d1e83e5ce99f7abe993bde841da.png" alt=""></p><p>闪回区至少设置10G，下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/6cb0ee8cb2d924cd3213945e1bd7df1c.png" alt=""></p><p>默认下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/457c22f538bacf7760e2365799ff3f29.png" alt=""></p><p>内存设置40%</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/0dd008b83fd27b06efb85dda2563e42e.png" alt=""></p><p>进程设置1500</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/0856628e3c2f837ae1f20dbce08f51e6.png" alt=""></p><p>字符集选择AL32UTF8</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/12dc8ffd360557adacd1647a981b3528.png" alt=""></p><p>下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/928d07c37e387b4832990cfb05db24bd.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/781e7ad2cd7687fc9990fd28a5a4251e.png" alt=""></p><p>3个redo文件大小设置1G到10G之间，不确定的话，默认3个文档都设置为1G。下一步</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/8db707ab0be9692bce8e1a589fa3f74e.png" alt=""></p><p>完成</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/d94f8d4f86c0abdc13483a255afbd371.png" alt=""></p><p>确定</p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/47920725615af4f0f59157ea7127c75b.png" alt=""></p><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_mysql_install/e38ee84fcab229f25a0d4b1ccc6a47ef.png" alt=""></p><p>等待安装完成</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;oracle11.2.0.4 + centos 7.5安装文档&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
</feed>
