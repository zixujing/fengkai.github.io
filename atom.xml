<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冯凯&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zixujing.github.io/"/>
  <updated>2019-10-09T16:58:54.963Z</updated>
  <id>https://zixujing.github.io/</id>
  
  <author>
    <name>冯_凯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>harbor安装</title>
    <link href="https://zixujing.github.io/2019/09/30/linux/linux%E5%B7%A5%E5%85%B7/harbor%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/09/30/linux/linux工具/harbor安装/</id>
    <published>2019-09-29T17:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.963Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>harbor安装</p></blockquote><a id="more"></a><h2 id="harbor安装"><a href="#harbor安装" class="headerlink" title="harbor安装"></a>harbor安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">##先安装docker和docker-compose</span><br><span class="line">[root@sdw3 ~]# wget https://github.com/vmware/harbor/releases/download/v1.2.0/harbor-offline-installer-v1.2.0.tgz</span><br><span class="line">[root@sdw3 ~]# tar -zxf harbor-offline-installer-v1.2.0.tgz  -C /usr/local/</span><br><span class="line">[root@sdw3 ~]# cd /usr/local/harbor/</span><br><span class="line">[root@sdw3 ~]# vim /usr/local/harbor/harbor.cfg</span><br><span class="line">hostname = rgs.unixfbi.com</span><br><span class="line">#邮箱配置</span><br><span class="line">email_server = smtp.qq.com</span><br><span class="line">email_server_port = 25</span><br><span class="line">email_username = unixfbi@unixfbi.com</span><br><span class="line">email_password =12345678</span><br><span class="line">email_from = UnixFBI &lt;unixfbi@unixfbi.com&gt;</span><br><span class="line">email_ssl = false</span><br><span class="line">#禁止用户注册</span><br><span class="line">self_registration = off</span><br><span class="line">#设置只有管理员可以创建项目</span><br><span class="line">project_creation_restriction = adminonly</span><br><span class="line">[root@sdw3 ~]# /usr/local/harbor/install.sh</span><br></pre></td></tr></table></figure><h2 id="启动compose"><a href="#启动compose" class="headerlink" title="启动compose"></a>启动compose</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">启动Harbor</span><br><span class="line"># docker-compose start</span><br><span class="line">停止Harbor</span><br><span class="line"># docker-comose stop</span><br><span class="line">重启Harbor</span><br><span class="line"># docker-compose restart</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在浏览器输入rgs.unixfbi.com，因为我配置的域名为rgs.unixfbi.com。请大家根据自己的配置情况输入访问的域名；</span><br><span class="line">默认账号密码： admin / Harbor12345 登录后修改密码</span><br></pre></td></tr></table></figure><h2 id="上传下载镜像"><a href="#上传下载镜像" class="headerlink" title="上传下载镜像"></a>上传下载镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@sdw3 ~]# vim /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd --insecure-registry rgs.unixfbi.com</span><br><span class="line">[root@sdw3 ~]# systemctl  restart docker</span><br><span class="line">[root@sdw3 ~]# docker login rgs.unixfbi.com</span><br><span class="line">[root@sdw3 ~]# docker push rgs.unixfbi.com/library/centos7.1:0.1</span><br><span class="line">创建Dockerfile</span><br><span class="line"># vim Dockerfile </span><br><span class="line">FROM centos:centos7.1.1503</span><br><span class="line">ENV TZ &quot;Asia/Shanghai&quot;</span><br><span class="line">创建镜像</span><br><span class="line"># docker build -t rgs.unixfbi.com/library/centos7.1:0.1 .</span><br><span class="line">把镜像push到Harbor</span><br><span class="line"># docker login rgs.unixfbi.com</span><br><span class="line"># docker push rgs.unixfbi.com/library/centos7.1:0.1</span><br><span class="line">如果不是自己创建的镜像，记得先执行 docker tags 给镜像做tag</span><br><span class="line">例如：</span><br><span class="line"># docker pull busybox</span><br><span class="line"># docker tag busybox:latest rgs.unixfbi.com/library/busybox:latest</span><br><span class="line"># docker push rgs.unixfbi.com/library/busybox:latest</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;harbor安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="linux" scheme="https://zixujing.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>BI相关工具总结</title>
    <link href="https://zixujing.github.io/2019/09/25/linux/linux%E5%B7%A5%E5%85%B7/BI%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/09/25/linux/linux工具/BI相关工具总结/</id>
    <published>2019-09-24T17:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>BI相关工具总结<br><a id="more"></a></p></blockquote><h2 id="BI相关工具总结"><a href="#BI相关工具总结" class="headerlink" title="BI相关工具总结"></a>BI相关工具总结</h2><h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><h4 id="superset"><a href="#superset" class="headerlink" title="superset"></a>superset</h4><p>略</p><h4 id="metabase"><a href="#metabase" class="headerlink" title="metabase"></a>metabase</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@controller fk]# wget https://downloads.metabase.com/v0.33.3/metabase.jar</span><br><span class="line">[root@controller fk]# java -jar metabase.jar</span><br></pre></td></tr></table></figure><h4 id="redash"><a href="#redash" class="headerlink" title="redash"></a>redash</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM_38_115_centos redash]# vi docker-compose.production.yml</span><br><span class="line"># This is an example configuration for Docker Compose. Make sure to atleast update</span><br><span class="line"># the cookie secret &amp; postgres database password.</span><br><span class="line">#</span><br><span class="line"># Some other recommendations:</span><br><span class="line"># 1. To persist Postgres data, assign it a volume host location.</span><br><span class="line"># 2. Split the worker service to adhoc workers and scheduled queries workers.</span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  server:</span><br><span class="line">    image: redash/redash:latest</span><br><span class="line">    command: server</span><br><span class="line">    depends_on:</span><br><span class="line">      - postgres</span><br><span class="line">      - redis</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    environment:</span><br><span class="line">      PYTHONUNBUFFERED: 0</span><br><span class="line">      REDASH_LOG_LEVEL: &quot;INFO&quot;</span><br><span class="line">      REDASH_REDIS_URL: &quot;redis://redis:6379/0&quot;</span><br><span class="line">      REDASH_DATABASE_URL: &quot;postgresql://postgres@postgres/postgres&quot;</span><br><span class="line">      REDASH_COOKIE_SECRET: &quot;Q422k6vaXUk8&quot;</span><br><span class="line">      REDASH_WEB_WORKERS: 4      </span><br><span class="line">    restart: always</span><br><span class="line">  worker:</span><br><span class="line">    image: redash/redash:latest</span><br><span class="line">    command: scheduler</span><br><span class="line">    environment:</span><br><span class="line">      PYTHONUNBUFFERED: 0</span><br><span class="line">      REDASH_LOG_LEVEL: &quot;INFO&quot;</span><br><span class="line">      REDASH_REDIS_URL: &quot;redis://redis:6379/0&quot;</span><br><span class="line">      REDASH_DATABASE_URL: &quot;postgresql://postgres@postgres/postgres&quot;</span><br><span class="line">      QUEUES: &quot;queries,scheduled_queries,celery&quot;</span><br><span class="line">      WORKERS_COUNT: 2</span><br><span class="line">    restart: always</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:3.0-alpine</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;6379:6379&quot;</span><br><span class="line">    volumes: </span><br><span class="line">      - ./data/redis_data:/data</span><br><span class="line">    restart: always</span><br><span class="line">  postgres:</span><br><span class="line">    image: postgres:9.5.6-alpine</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;5432:5432&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data/postgresql_data:/var/lib/postgresql/data</span><br><span class="line">    restart: always</span><br><span class="line">  nginx:</span><br><span class="line">    image: redash/nginx:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;88:80&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - server</span><br><span class="line">    links:</span><br><span class="line">      - server:redash</span><br><span class="line">    restart: always</span><br><span class="line">[root@VM_38_115_centos redash]# docker-compose -f docker-compose.production.yml run --rm server create_db</span><br><span class="line">[root@VM_38_115_centos redash]# docker-compose -f docker-compose.production.yml up</span><br></pre></td></tr></table></figure><h4 id="zeppelin"><a href="#zeppelin" class="headerlink" title="zeppelin"></a>zeppelin</h4><p>大数据</p><h4 id="sqlpad"><a href="#sqlpad" class="headerlink" title="sqlpad"></a>sqlpad</h4><p>略</p><h4 id="cboard"><a href="#cboard" class="headerlink" title="cboard"></a>cboard</h4><p>国产的<br><a href="https://peter_zhang921.gitee.io/cboard_docsify/#/" target="_blank" rel="noopener">https://peter_zhang921.gitee.io/cboard_docsify/#/</a></p><h4 id="FineBI"><a href="#FineBI" class="headerlink" title="FineBI"></a>FineBI</h4><p>finebi   <a href="https://help.finebi.com/" target="_blank" rel="noopener">https://help.finebi.com/</a><br>finereport   <a href="https://help.finereport.com/" target="_blank" rel="noopener">https://help.finereport.com/</a></p><p>试用码：dbe8992a-085c130cf-2278-d0857c2db051</p><h3 id="web报表技术-java"><a href="#web报表技术-java" class="headerlink" title="web报表技术(java)"></a>web报表技术(java)</h3><ul><li>jfreechart</li><li>cewolf</li><li>jcharts</li><li>ireport</li><li>jasperreports</li><li>jfreereport</li><li>openreport</li><li>birt</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;BI相关工具总结&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>rttys和rtty离线安装使用</title>
    <link href="https://zixujing.github.io/2019/09/23/linux/linux%E5%B7%A5%E5%85%B7/rttys%E5%92%8Crtty%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>https://zixujing.github.io/2019/09/23/linux/linux工具/rttys和rtty离线安装使用/</id>
    <published>2019-09-22T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.964Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>rttys和rtty离线安装使用<br><a id="more"></a></p></blockquote><h2 id="rttys离线安装说明"><a href="#rttys离线安装说明" class="headerlink" title="rttys离线安装说明"></a>rttys离线安装说明</h2><blockquote><p><a href="https://github.com/zhaojh329/rttys/releases下载合适的rttys" target="_blank" rel="noopener">https://github.com/zhaojh329/rttys/releases下载合适的rttys</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@sdw3 ~]# tar -xzvf rttys-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><h3 id="查看支持哪些命令行参数"><a href="#查看支持哪些命令行参数" class="headerlink" title="查看支持哪些命令行参数"></a>查看支持哪些命令行参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./rttys -h</span><br><span class="line">Usage of ./rttys:</span><br><span class="line">  -addr string</span><br><span class="line">        address to listen (default &quot;:5912&quot;)</span><br><span class="line">  -conf string</span><br><span class="line">        config file to load (default &quot;./rttys.conf&quot;)</span><br><span class="line">  -gen-token</span><br><span class="line">        generate token</span><br><span class="line">  -ssl-cert string</span><br><span class="line">        certFile Path (default &quot;./rttys.crt&quot;)</span><br><span class="line">  -ssl-key string</span><br><span class="line">        keyFile Path (default &quot;./rttys.key&quot;)</span><br><span class="line">  -token string</span><br><span class="line">        token to use</span><br></pre></td></tr></table></figure><h3 id="以root用户运行-使用系统用户名和密码"><a href="#以root用户运行-使用系统用户名和密码" class="headerlink" title="以root用户运行(使用系统用户名和密码)"></a>以root用户运行(使用系统用户名和密码)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo ./rttys</span><br></pre></td></tr></table></figure><h3 id="以普通用户运行-用户名和密码来自配置文件"><a href="#以普通用户运行-用户名和密码来自配置文件" class="headerlink" title="以普通用户运行(用户名和密码来自配置文件)"></a>以普通用户运行(用户名和密码来自配置文件)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rttys</span><br></pre></td></tr></table></figure><h3 id="如何在后台运行模式下查看日志"><a href="#如何在后台运行模式下查看日志" class="headerlink" title="如何在后台运行模式下查看日志"></a>如何在后台运行模式下查看日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/rttys.log</span><br></pre></td></tr></table></figure><h3 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./rttys -gen-token</span><br><span class="line">Please set a password:******</span><br><span class="line">Your token is: 34762d07637276694b938d23f10d7164</span><br><span class="line"></span><br><span class="line">./rttys -token 34762d07637276694b938d23f10d7164</span><br></pre></td></tr></table></figure><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><blockquote><p>帐号密码为服务器帐号密码</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://192.168.106.237:5912</span><br></pre></td></tr></table></figure><h2 id="rtty离线安装使用"><a href="#rtty离线安装使用" class="headerlink" title="rtty离线安装使用"></a>rtty离线安装使用</h2><h3 id="客户端依赖"><a href="#客户端依赖" class="headerlink" title="客户端依赖"></a>客户端依赖</h3><ul><li>libev 高性能的事件循环库</li><li>libuwsc 一个轻量的针对嵌入式Linux的基于libev的WebSocket客户端C库。</li><li>mbedtls(polarssl)、CyaSSl(wolfssl)或者openssl 如果你需要支持SSL</li></ul><blockquote><p>离线安装例子<br>libev：地址=》<a href="https://src.fedoraproject.org/repo/pkgs/libev/libev-4.27.tar.gz/sha512/18fbac15c3a24b2efcd547d98d423fe59a1684cd3afe7ff25a3da54d8df3e11f351df455657d830df93366853f74d584f6e47a7c9ffaba84aa586957bf39ea82/libev-4.27.tar.gz：./configure" target="_blank" rel="noopener">https://src.fedoraproject.org/repo/pkgs/libev/libev-4.27.tar.gz/sha512/18fbac15c3a24b2efcd547d98d423fe59a1684cd3afe7ff25a3da54d8df3e11f351df455657d830df93366853f74d584f6e47a7c9ffaba84aa586957bf39ea82/libev-4.27.tar.gz：./configure</a> &amp;&amp; make &amp;&amp; makeinstall<br>libywsc: 再下面的sh中通过git下载后编译安装<br>openssl：使用yum安装，搭建本地yum源即可安装</p></blockquote><h3 id="安装rtty"><a href="#安装rtty" class="headerlink" title="安装rtty"></a>安装rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/zhaojh329/rtty/master/tools/install.sh | sudo bash</span><br></pre></td></tr></table></figure><blockquote><p>install.sh说明</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">LSB_ID=</span><br><span class="line">INSTALL=</span><br><span class="line">REMOVE=</span><br><span class="line">UPDATE=</span><br><span class="line">PKG_LIBEV=&quot;libev-dev&quot;</span><br><span class="line">PKG_SSL=&quot;libssl-dev&quot;</span><br><span class="line">show_distribution() &#123;</span><br><span class="line"></span><br><span class="line">       local pretty_name=&quot;&quot;</span><br><span class="line">       if [ -f /etc/os-release ];</span><br><span class="line">       then</span><br><span class="line">               . /etc/os-release</span><br><span class="line">               pretty_name=&quot;$PRETTY_NAME&quot;</span><br><span class="line">               LSB_ID=&quot;$(echo &quot;$ID&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)&quot;</span><br><span class="line">       elif [ -f /etc/redhat-release ];</span><br><span class="line">       then</span><br><span class="line">               pretty_name=$(cat /etc/redhat-release)</span><br><span class="line">               LSB_ID=&quot;$(echo &quot;$pretty_name&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)&quot;</span><br><span class="line">               echo &quot;$LSB_ID&quot; | grep centos &gt; /dev/null &amp;&amp; LSB_ID=centos</span><br><span class="line">       fi</span><br><span class="line">       LSB_ID=$(echo &quot;$LSB_ID&quot; | tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;)</span><br><span class="line">       echo &quot;Platform: $pretty_name&quot;</span><br><span class="line">&#125;</span><br><span class="line">check_cmd() &#123;</span><br><span class="line">       which $1 &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line">detect_pkg_tool() &#123;</span><br><span class="line">       check_cmd apt &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;apt update -q&quot;</span><br><span class="line">               INSTALL=&quot;apt install -y&quot;</span><br><span class="line">               REMOVE=&quot;apt remove -y&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd apt-get &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;apt-get update -q&quot;</span><br><span class="line">               INSTALL=&quot;apt-get install -y&quot;</span><br><span class="line">               REMOVE=&quot;apt-get remove -y&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd yum &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;yum update -yq&quot;</span><br><span class="line">               INSTALL=&quot;yum install -y&quot;</span><br><span class="line">               REMOVE=&quot;yum &quot;</span><br><span class="line">               PKG_LIBEV=&quot;libev-devel&quot;</span><br><span class="line">               PKG_SSL=&quot;openssl-devel&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       check_cmd pacman &amp;&amp; &#123;</span><br><span class="line">               UPDATE=&quot;pacman -Sy --noprogressbar&quot;</span><br><span class="line">               INSTALL=&quot;pacman -S --noconfirm --noprogressbar&quot;</span><br><span class="line">               REMOVE=&quot;pacman -R --noconfirm --noprogressbar&quot;</span><br><span class="line">               PKG_LIBEV=&quot;libev&quot;</span><br><span class="line">               PKG_SSL=&quot;openssl&quot;</span><br><span class="line">               return 0</span><br><span class="line">       &#125;</span><br><span class="line">       return 1</span><br><span class="line">&#125;</span><br><span class="line">check_tool() &#123;</span><br><span class="line">       local tool=$1</span><br><span class="line"></span><br><span class="line">       check_cmd $tool || $INSTALL $tool</span><br><span class="line">&#125;</span><br><span class="line">show_distribution</span><br><span class="line">detect_pkg_tool || &#123;</span><br><span class="line">       echo &quot;Your platform is not supported by this installer script.&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line">#$UPDATE</span><br><span class="line">[ &quot;$LSB_ID&quot; = &quot;centos&quot; ] &amp;&amp; $INSTALL epel-release</span><br><span class="line">check_tool pkg-config</span><br><span class="line">check_tool gcc</span><br><span class="line">check_tool make</span><br><span class="line">check_tool cmake</span><br><span class="line">check_tool git</span><br><span class="line">$INSTALL $PKG_LIBEV</span><br><span class="line">$INSTALL $PKG_SSL</span><br><span class="line">rm -rf /tmp/rtty-build</span><br><span class="line">mkdir /tmp/rtty-build</span><br><span class="line">pushd /tmp/rtty-build</span><br><span class="line">git clone --recursive https://github.com/zhaojh329/libuwsc.git || &#123;</span><br><span class="line">       echo &quot;Clone libuwsc failed&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line">sleep 2</span><br><span class="line">git clone https://github.com/zhaojh329/rtty.git || &#123;</span><br><span class="line">       echo &quot;Clone rtty failed&quot;</span><br><span class="line">       exit 1</span><br><span class="line">&#125;</span><br><span class="line"># libuwsc</span><br><span class="line">rm -f /usr/local/lib/libuwsc.*</span><br><span class="line">cd libuwsc &amp;&amp; cmake . &amp;&amp; make install &amp;&amp; cd -</span><br><span class="line">[ $? -eq 0 ] || exit 1</span><br><span class="line"># rtty</span><br><span class="line">cd rtty &amp;&amp; cmake . &amp;&amp; make install</span><br><span class="line">[ $? -eq 0 ] || exit 1</span><br><span class="line">popd</span><br><span class="line">rm -rf /tmp/rtty-build</span><br><span class="line">ldconfig</span><br><span class="line">case &quot;$LSB_ID&quot; in</span><br><span class="line">       centos|arch)</span><br><span class="line">               echo &quot;/usr/local/lib&quot; &gt; /etc/ld.so.conf.d/rtty</span><br><span class="line">               ldconfig -f /etc/ld.so.conf.d/rtty</span><br><span class="line">       ;;</span><br><span class="line">esac</span><br><span class="line">rtty -V</span><br></pre></td></tr></table></figure><h3 id="查看命令行选项rtty"><a href="#查看命令行选项rtty" class="headerlink" title="查看命令行选项rtty"></a>查看命令行选项rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Usage: rtty [option]</span><br><span class="line">  -i ifname    # Network interface name - Using the MAC address of</span><br><span class="line">                     the interface as the device ID</span><br><span class="line">  -I id        # Set an ID for the device(Maximum 63 bytes, valid character:letters</span><br><span class="line">                     and numbers and underlines and short lines) - If set,</span><br><span class="line">                     it will cover the MAC address(if you have specify the ifname)</span><br><span class="line">  -h host      # Server host</span><br><span class="line">  -p port      # Server port(Default is 5912)</span><br><span class="line">  -a           # Auto reconnect to the server</span><br><span class="line">  -v           # verbose</span><br><span class="line">  -d           # Adding a description to the device(Maximum 126 bytes)</span><br><span class="line">  -s           # SSL on</span><br><span class="line">  -k keepalive # keep alive in seconds for this client. Defaults to 5</span><br><span class="line">  -V           # Show version</span><br><span class="line">  -D           # Run in the background</span><br><span class="line">  -t token     # Authorization token</span><br></pre></td></tr></table></figure><h3 id="运行RTTY-将下面的参数替换为你自己的参数-rtty"><a href="#运行RTTY-将下面的参数替换为你自己的参数-rtty" class="headerlink" title="运行RTTY(将下面的参数替换为你自己的参数)rtty"></a>运行RTTY(将下面的参数替换为你自己的参数)rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rtty -I &apos;My-device-ID&apos; -h &apos;your-server&apos; -p 5912 -a -v -s -d &apos;My Device Description&apos;</span><br><span class="line">实例，不能用root登录可以用其他帐号登录</span><br><span class="line">rtty -I &quot;237&quot; -h 192.168.106.237 -p 5912 -s</span><br></pre></td></tr></table></figure><h3 id="如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty"><a href="#如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty" class="headerlink" title="如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty"></a>如果你的rttys配置了一个token，请加上如下参数（将下面的token替换为你自己生成的）rtty</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-t 34762d07637276694b938d23f10d7164</span><br></pre></td></tr></table></figure><h2 id="如何让root能够登录"><a href="#如何让root能够登录" class="headerlink" title="如何让root能够登录"></a>如何让root能够登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">加入如下配置</span><br><span class="line"></span><br><span class="line">[root@sdw3 ~]# vi /etc/securetty</span><br><span class="line"></span><br><span class="line">pts/0</span><br><span class="line">pts/1</span><br><span class="line">pts/2</span><br><span class="line">[root@sdw3 ~]# cd /etc/pam.d</span><br><span class="line">[root@sdw3 pam.d]# cat login </span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so</span><br><span class="line">auth       substack     system-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      system-auth</span><br><span class="line">password   include      system-auth</span><br><span class="line"># pam_selinux.so close should be the first session rule</span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    optional     pam_console.so</span><br><span class="line"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span><br><span class="line">session    required     pam_selinux.so open</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      system-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line">-session   optional     pam_ck_connector.so</span><br><span class="line">[root@sdw3 pam.d]# cat sshd </span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth       required     pam_sepermit.so</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line"># Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-auth      optional     pam_reauthorize.so prepare</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      password-auth</span><br><span class="line">password   include      password-auth</span><br><span class="line"># pam_selinux.so close should be the first session rule</span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span><br><span class="line">session    required     pam_selinux.so open env_params</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      password-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line"># Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-session   optional     pam_reauthorize.so prepare</span><br><span class="line">[root@sdw3 pam.d]# cat system-auth</span><br><span class="line">#%PAM-1.0</span><br><span class="line"># This file is auto-generated.</span><br><span class="line"># User changes will be destroyed the next time authconfig is run.</span><br><span class="line">auth        required      pam_env.so</span><br><span class="line">auth        sufficient    pam_unix.so nullok try_first_pass</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &lt;= 1000 quiet_success</span><br><span class="line">auth        required      pam_deny.so</span><br><span class="line"></span><br><span class="line">account     required      pam_unix.so</span><br><span class="line">account     sufficient    pam_localuser.so</span><br><span class="line">account     sufficient    pam_succeed_if.so uid &lt; 1000 quiet</span><br><span class="line">account     required      pam_permit.so</span><br><span class="line"></span><br><span class="line">password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=</span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">password    required      pam_deny.so</span><br><span class="line"></span><br><span class="line">session     optional      pam_keyinit.so revoke</span><br><span class="line">session     required      pam_limits.so</span><br><span class="line">-session     optional      pam_systemd.so</span><br><span class="line">session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid</span><br><span class="line">session     required      pam_unix.so</span><br><span class="line">[root@sdw3 pam.d]# </span><br><span class="line">修改==》</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &gt;= 1000 quiet_success</span><br><span class="line">为==》</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &lt;= 1000 quiet_success</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;rttys和rtty离线安装使用&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat总结</title>
    <link href="https://zixujing.github.io/2019/09/22/linux/linux%E5%B7%A5%E5%85%B7/Tomcat%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/09/22/linux/linux工具/Tomcat总结/</id>
    <published>2019-09-21T18:00:00.000Z</published>
    <updated>2019-09-22T03:52:29.304Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Tomcat总结<br><a id="more"></a></p></blockquote><h2 id="Tomcat-调优的技巧"><a href="#Tomcat-调优的技巧" class="headerlink" title="Tomcat 调优的技巧"></a>Tomcat 调优的技巧</h2><ol><li><p>Tomcat的自身调优</p><blockquote><p>采用动静分离节约 Tomcat 的性能<br>调整 Tomcat 的线程池<br>调整 Tomcat 的连接器<br>修改 Tomcat 的运行模式<br>禁用 AJP 连接器</p></blockquote></li><li><p>JVM的调优</p><blockquote><p>调优Jvm内存</p></blockquote></li></ol><h3 id="Tomcat-自身调优"><a href="#Tomcat-自身调优" class="headerlink" title="Tomcat 自身调优"></a>Tomcat 自身调优</h3><ol><li>采用动静分离<blockquote><p>静态资源如果让 Tomcat 处理的话 Tomcat 的性能会被损耗很多，所以我们一般都是采用：Nginx+Tomcat 实现动静分离，让 Tomcat 只负责 jsp 文件的解析工作，Nginx 实现静态资源的访问。</p></blockquote></li><li>调优 Tomcat 线程池<br>打开tomcat的serve.xml，配置Executor，相关参数说明如下。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Executor </span><br><span class="line">  name=&quot;tomcatThreadPool&quot;</span><br><span class="line">  namePrefix=&quot;catalina-exec-&quot;</span><br><span class="line">  maxThreads=&quot;500&quot;</span><br><span class="line">  minSpareThreads=&quot;20&quot;</span><br><span class="line">  maxIdleTime=&quot;60000&quot;</span><br></pre></td></tr></table></figure><ul><li>name：给执行器（线程池）起一个名字；</li><li>namePrefix：指定线程池中的每一个线程的 name 前缀；</li><li>maxThreads：线程池中最大的线程数量，假设请求的数量超过了 750，这将不是意味着将 maxThreads 属性值设置为 750，它的最好解决方案是使用「Tomcat集群」。也就是说，如果有 1000 请求，两个 * Tomcat 实例设置 maxThreads = 500，而不在单 Tomcat 实例的情况下设置 maxThreads=1000。</li><li>minSpareThreads：线程池中允许空闲的线程数量（多余的线程都杀死）；</li><li>maxIdLeTime：一个线程空闲多久算是一个空闲线程；</li></ul><ol start="3"><li>调优 Tomcat 的连接器 </li></ol><p>打开 Tomcat 的 serve.xml，配置 Connector，参数说明如下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector</span><br><span class="line">  executor=&quot;tomcatThreadPool&quot;</span><br><span class="line">  prot=&quot;8014&quot;</span><br><span class="line">  protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">  connectionTimeout=&quot;20000&quot;</span><br><span class="line">  enableLookups=&quot;false&quot;</span><br><span class="line">  URIEncoding=&quot;UTF-8&quot;</span><br></pre></td></tr></table></figure><p>executor：指定这个连接器所使用的执行器（线程池）,如下；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector</span><br><span class="line">  executor=&quot;tomcatThreadPool&quot;</span><br><span class="line">  prot=&quot;8014&quot;</span><br><span class="line">  protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">  connectionTimeout=&quot;20000&quot;</span><br><span class="line">  enableLookups=&quot;false&quot;</span><br><span class="line">  URIEncoding=&quot;UTF-8&quot;/&gt;</span><br><span class="line">&lt;Executor </span><br><span class="line">  name=&quot;tomcatThreadPool&quot;</span><br><span class="line">  namePrefix=&quot;catalina-exec-&quot;</span><br><span class="line">  maxThreads=&quot;500&quot;</span><br><span class="line">  minSpareThreads=&quot;20&quot;</span><br><span class="line">  maxIdleTime=&quot;60000&quot;/&gt;</span><br></pre></td></tr></table></figure></p><ul><li>enableLookups=false：关闭 DNS 解析，减少性能损耗；</li><li>minProcessors：服务器启动时创建的最少线程数；</li><li>maxProcessors：最大可以创建的线程数；</li><li>acceptCount=1000：线程池中的线程都被占用，允许放到队列中的请求数；</li><li>maxThreads=3000：最大线程数；</li><li>minSpareThreads=20：最小空闲线程数，这里是一直会运行的线程；</li><li>与压缩有关系的配置：如果已经对代码进行了动静分离，静态页面和图片等数据就不需要 Tomcat 处理了，那么也就不需要配置在 Tomcat 中配置压缩了；</li><li>一个完整的配置如下。</li></ul><p><connector port="8080" protocol="HTTP/1.1" connectiontimeout="20000" ##="" 20s="" redirectport="443" maxthreads="3000" minsparethreads="20" acceptcount="1000" enablelookups="false" server="None" uriencoding="UTF-8"></connector></p><ol start="4"><li>通过修改 Tomcat 的运行模式</li></ol><blockquote><p><strong>BIO</strong><br>Tomcat8 以下版本，默认使用的就是 BIO「阻塞式IO)」模式。<br>对于每一个请求都要创建一个线程来进行处理，不适合高并发。<br><strong>NIO</strong><br>Tomcat8 以上版本，默认使用的就是NIO模式「非阻塞式 IO」。</p></blockquote><blockquote><p><strong>APR</strong><br>全称 Apache Portable Runtime，是Tomcat生产环境运行的首选方式，如果操作系统未安装 APR 或者 APR 路径未指到 Tomcat 默认可识别的路径，则 APR 模式无法启动，自动切换启动 NIO 模式。所以必须要安装 APR 和 Native，直接启动就支持 APR，APR是从操作系统级别解决异步 IO 问题，APR 的本质就是使用 JNI 技术调用操作系统底层的 IO 接口，所以需要提前安装所需要的依赖</p></blockquote><ol start="5"><li>禁用 AJP 连接器<br>AJP的全称 Apache JServer Protocol，使用 Nginx+Tomca t的架构，所以用不着 AJP 协议，所以把AJP连接器禁用。<br>注释掉：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot;/&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="JVM-调优"><a href="#JVM-调优" class="headerlink" title="JVM 调优"></a>JVM 调优</h3><p>Tomcat 是运行在 JVM 上的，所以对 JVM 的调优也是非常有必要的。<br>找到 catalina.sh；<br>添加；<br>参数设置；<br>JAVA_OPTS=”-Djava.awt.headless=true -Dfile.encoding=UTF-8-server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XXermSize=512m -XX:MaxPermSize=512m -XX:+DisableExplicitGC”<br>调整堆大小的的目的是最小化垃圾收集的时间，以在特定的时间内最大化处理客户的请求。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Tomcat总结&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>mysql自动备份脚本</title>
    <link href="https://zixujing.github.io/2019/09/18/linux/linux%E5%B7%A5%E5%85%B7/mysql%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/"/>
    <id>https://zixujing.github.io/2019/09/18/linux/linux工具/mysql备份脚本/</id>
    <published>2019-09-17T21:00:00.000Z</published>
    <updated>2019-09-22T03:53:17.002Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql自动备份脚本<br><a id="more"></a></p></blockquote><h3 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /home/bak_data</span><br><span class="line">[root@localhost ~]# mkdir /home/bak_data/log</span><br><span class="line">[root@localhost ~]# vi bak_mysql.sh</span><br><span class="line">#! /bin/bash</span><br><span class="line"># name fengk</span><br><span class="line">USER=root</span><br><span class="line">PASSWORD=P@ssW0rd</span><br><span class="line">DATABASE1=infoveriplatform_zhuozhou</span><br><span class="line">BACKUP_DIR=/home/bak_data</span><br><span class="line">LOGFILE=/home/bak_data/log/bak_data.log</span><br><span class="line">DATE=`date +%Y%m%d-%H%M -d -3minute`</span><br><span class="line">DUMPFILE1=$DATE-$&#123;DATABASE1&#125;.sql</span><br><span class="line">ARCHIVE1=$DUMPFILE1.gz</span><br><span class="line">KEEPTIME=1</span><br><span class="line">if [ ! -d $BACKUP_DIR ];</span><br><span class="line">then</span><br><span class="line">mkdir -p &quot;$BACKUP_DIR&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo -e &quot;\n&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;BACKUP DATE:$DATE&quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line"></span><br><span class="line">cd $BACKUP_DIR</span><br><span class="line">/home/mysql/bin/mysqldump --triggers --routines --events -h127.0.0.1 -P3306 -u$USER -p$PASSWORD --databases $DATABASE1 | gzip &gt; $ARCHIVE1</span><br><span class="line"></span><br><span class="line">if [[ $? == 0 ]];then</span><br><span class="line">DELFILE=`find $BACKUP_DIR -type f -mtime +$&#123;KEEPTIME&#125; -exec rm -fr &#123;&#125; \;`</span><br><span class="line">echo &quot;delete expire file &quot; &gt;&gt; $LOGFILE</span><br><span class="line">echo &quot;-----------------------------------------------------&quot; &gt;&gt; $LOGFILE</span><br><span class="line">fi</span><br><span class="line">[root@localhost ~]# chmod +x bak_mysql.sh</span><br></pre></td></tr></table></figure><h3 id="设置定时任务"><a href="#设置定时任务" class="headerlink" title="设置定时任务"></a>设置定时任务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/corntab</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"># For details see man 4 crontabs</span><br><span class="line"></span><br><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59)</span><br><span class="line"># |  .------------- hour (0 - 23)</span><br><span class="line"># |  |  .---------- day of month (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name  command to be executed</span><br><span class="line">  30 00 *  *  * root  /root/bak_mysql.sh</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# systemctl restart crond</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql自动备份脚本&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>docker安装与随笔</title>
    <link href="https://zixujing.github.io/2019/09/17/linux/linux%E5%B7%A5%E5%85%B7/docker%E5%AE%89%E8%A3%85%E4%B8%8E%E9%9A%8F%E7%AC%94/"/>
    <id>https://zixujing.github.io/2019/09/17/linux/linux工具/docker安装与随笔/</id>
    <published>2019-09-16T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.963Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>docker安装与随笔<br><a id="more"></a></p></blockquote><h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>  <a href="https://docs.docker.com/install/linux/docker-ce/binaries/#install-static-binaries" target="_blank" rel="noopener">参照连接</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# tar -xzvf docker-19.03.0.tgz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# cd docker</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# mv * /usr/bin/</span><br><span class="line">如果不是默认path目录，那么请用systemctl show-environment/set-environment</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# vi .bash_profile</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# source .bash_profile</span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# vi /usr/lib/systemd/system/docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/docker</span><br><span class="line"># the default is not to use systemd for cgroups because the delegate issues still</span><br><span class="line"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="line"># for containers run by docker</span><br><span class="line">ExecStart=/usr/local/docker/dockerd</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"># Uncomment TasksMax if your systemd version supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">#TasksMax=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class="line">Delegate=yes</span><br><span class="line"># kill only the docker process, not all processes in the cgroup</span><br><span class="line">KillMode=process</span><br><span class="line"># restart the docker process if it exits prematurely</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# systemctl daemon-reload</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz ~]# systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="docker-compose-安装"><a href="#docker-compose-安装" class="headerlink" title="docker-compose 安装"></a>docker-compose 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="dockerfile-制作镜像"><a href="#dockerfile-制作镜像" class="headerlink" title="dockerfile 制作镜像"></a>dockerfile 制作镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# pwd</span><br><span class="line">/root/mk</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# cat Dockerfile </span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER fengk</span><br><span class="line"></span><br><span class="line">ENV DATA_PATH /data</span><br><span class="line">ENV MYSQL_PASSWORD 123456</span><br><span class="line">ENV PATH /usr/local/mysql/bin:$PATH</span><br><span class="line">VOLUME [$DATA_PATH]</span><br><span class="line"></span><br><span class="line">COPY my.sh /usr/local/</span><br><span class="line">RUN cd /usr/local &amp;&amp; chmod +x my.sh</span><br><span class="line">COPY mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz /usr/local/</span><br><span class="line">RUN yum -y install numactl &amp;&amp; yum -y install libaio</span><br><span class="line">RUN groupadd mysql;useradd -r -g mysql -s /bin/false mysql</span><br><span class="line">RUN cd /usr/local &amp;&amp; tar -xzvf mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz &amp;&amp; ln -s mysql-5.7.27-linux-glibc2.12-x86_64 mysql &amp;&amp; rm -fr mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">EXPOSE 3306</span><br><span class="line">ENTRYPOINT [&quot;/bin/sh&quot;,&quot;/usr/local/my.sh&quot;]</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# cat my.sh </span><br><span class="line">#!/usr/bin/bash</span><br><span class="line">if [ ! -d $DATA_PATH ] ; then mkdir -p $DATA_PATH/data ; fi</span><br><span class="line">if [ ! -d $DATA_PATH/data ] ; then mkdir $DATA_PATH/data ; fi</span><br><span class="line">if [ ! -f $DATA_PATH/mariadb.log ] ; then touch $DATA_PATH/mariadb.log &amp;&amp; chown mysql:mysql $DATA_PATH/mariadb.log ; fi</span><br><span class="line">if [ ! -f $DATA_PATH/my.cnf ] ; then cd $DATA_PATH &amp;&amp; echo -e &quot;[mysqld]\nuser=mysql\ndatadir=$&#123;DATA_PATH&#125;/data\nsocket=$&#123;DATA_PATH&#125;/mysql.sock\n[mysqld_safe]\nlog-error=$&#123;DATA_PATH&#125;/mariadb.log\npid-file=$&#123;DATA_PATH&#125;/mariadb.pid&quot; &gt; my.cnf &amp;&amp; chmod 664 my.cnf &amp;&amp; chown -R mysql:mysql $DATA_PATH &amp;&amp; cd /usr/local/mysql &amp;&amp; ./bin/mysqld  --defaults-file=$DATA_PATH/my.cnf --initialize --user=mysql --basedir=/usr/local/mysql  --datadir=$DATA_PATH/data &amp;&amp; cd /usr/local/mysql &amp;&amp; ./bin/mysqld_safe --defaults-file=$DATA_PATH/my.cnf --skip-grant-tables &amp;</span><br><span class="line"></span><br><span class="line">var=1</span><br><span class="line">until [ $var -eq 0 ]</span><br><span class="line">do</span><br><span class="line">sleep 1</span><br><span class="line">/usr/local/mysql/bin/mysql -uroot -p123456 --socket=/data/mysql.sock -e &quot;exit&quot;</span><br><span class="line">var=$?</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysql -uroot --socket=/data/mysql.sock mysql -e &quot;update user set authentication_string=password(&apos;$MYSQL_PASSWORD&apos;),password_expired=&apos;N&apos;&quot;</span><br><span class="line"></span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysqladmin -u root --socket=$DATA_PATH/mysql.sock shutdown;  fi</span><br><span class="line">cd /usr/local/mysql &amp;&amp; ./bin/mysqld_safe --defaults-file=$DATA_PATH/my.cnf &amp; </span><br><span class="line">/usr/bin/bash</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# ls</span><br><span class="line">Dockerfile  my.sh  mysql-5.7.27-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker build -t mysql .</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker run -t -i -v /data:/data -p 3307:3306 --name db mysql</span><br><span class="line">[root@iz2zegdp0r569zzor0c3quz mk]# docker run --link db:db -t -i centos (使用mysql -u*** -p*** -hdb访问上一个容器的mysql)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;docker安装与随笔&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="虚拟化" scheme="https://zixujing.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>hadoop配置说明</title>
    <link href="https://zixujing.github.io/2019/08/22/bigdata/hadoop%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E/"/>
    <id>https://zixujing.github.io/2019/08/22/bigdata/hadoop配置说明/</id>
    <published>2019-08-21T18:00:00.000Z</published>
    <updated>2019-10-09T16:58:54.961Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hadoop配置说明<br><a id="more"></a></p></blockquote><h2 id="ResourceManager相关配置参数"><a href="#ResourceManager相关配置参数" class="headerlink" title="ResourceManager相关配置参数"></a>ResourceManager相关配置参数</h2><ul><li>yarn.resourcemanager.address</li></ul><blockquote><p>参数解释：ResourceManager 对客户端暴露的地址。客户端通过该地址向RM提交应用程序，杀死应用程序等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8032</p></blockquote><ul><li>yarn.resourcemanager.scheduler.address</li></ul><blockquote><p>参数解释：ResourceManager 对ApplicationMaster暴露的访问地址。ApplicationMaster通过该地址向RM申请资源、释放资源等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8030</p></blockquote><ul><li>yarn.resourcemanager.resource-tracker.address</li></ul><blockquote><p>参数解释：ResourceManager 对NodeManager暴露的地址.。NodeManager通过该地址向RM汇报心跳，领取任务等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8031</p></blockquote><ul><li>yarn.resourcemanager.admin.address</li></ul><blockquote><p>参数解释：ResourceManager 对管理员暴露的访问地址。管理员通过该地址向RM发送管理命令等。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8033</p></blockquote><ul><li>yarn.resourcemanager.webapp.address</li></ul><blockquote><p>参数解释：ResourceManager对外web ui地址。用户可通过该地址在浏览器中查看集群各类信息。</p></blockquote><blockquote><p>默认值：${yarn.resourcemanager.hostname}:8088</p></blockquote><ul><li>yarn.resourcemanager.scheduler.class</li></ul><blockquote><p>参数解释：启用的资源调度器主类。目前可用的有FIFO、Capacity Scheduler和Fair Scheduler。</p></blockquote><blockquote><p>默认值：org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</p></blockquote><ul><li>yarn.resourcemanager.resource-tracker.client.thread-count</li></ul><blockquote><p>参数解释：处理来自NodeManager的RPC请求的Handler数目。</p></blockquote><blockquote><p>默认值：50</p></blockquote><ul><li>yarn.resourcemanager.scheduler.client.thread-count</li></ul><blockquote><p>参数解释：处理来自ApplicationMaster的RPC请求的Handler数目。</p></blockquote><blockquote><p>默认值：50</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-mb/ yarn.scheduler.maximum-allocation-mb</li></ul><blockquote><p>参数解释：单个可申请的最小/最大内存资源量。比如设置为1024和3072，则运行MapRedce作业时，每个Task最少可申请1024MB内存，最多可申请3072MB内存。</p></blockquote><blockquote><p>默认值：1024/8192</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-vcores / yarn.scheduler.maximum-allocation-vcores</li></ul><blockquote><p>参数解释：单个可申请的最小/最大虚拟CPU个数。比如设置为1和4，则运行MapRedce作业时，每个Task最少可申请1个虚拟CPU，最多可申请4个虚拟CPU。什么是虚拟CPU，可阅读我的这篇文章：“YARN 资源调度器剖析”。</p></blockquote><blockquote><p>默认值：1/32</p></blockquote><ul><li>yarn.resourcemanager.nodes.include-path /yarn.resourcemanager.nodes.exclude-path</li></ul><blockquote><p>参数解释：NodeManager黑白名单。如果发现若干个NodeManager存在问题，比如故障率很高，任务运行失败率高，则可以将之加入黑名单中。注意，这两个配置参数可以动态生效。（调用一个refresh命令即可）</p></blockquote><blockquote><p>默认值：“”</p></blockquote><ul><li>yarn.resourcemanager.nodemanagers.heartbeat-interval-ms</li></ul><blockquote><p>参数解释：NodeManager心跳间隔</p></blockquote><blockquote><p>默认值：1000（毫秒）</p></blockquote><h2 id="NodeManager相关配置参数"><a href="#NodeManager相关配置参数" class="headerlink" title="NodeManager相关配置参数"></a>NodeManager相关配置参数</h2><ul><li>yarn.nodemanager.resource.memory-mb</li></ul><blockquote><p>参数解释：NodeManager总的可用物理内存。注意，该参数是不可修改的，一旦设置，整个运行过程中不可动态修改。另外，该参数的默认值是8192MB，即使你的机器内存不够8192MB，YARN也会按照这些内存来使用（傻不傻？），因此，这个值通过一定要配置。不过，Apache已经正在尝试将该参数做成可动态修改的。</p></blockquote><blockquote><p>默认值：8192</p></blockquote><ul><li>yarn.nodemanager.vmem-pmem-ratio</li></ul><blockquote><p>参数解释：每使用1MB物理内存，最多可用的虚拟内存数。</p></blockquote><blockquote><p>默认值：2.1</p></blockquote><ul><li>yarn.nodemanager.resource.cpu-vcores</li></ul><blockquote><p>参数解释：NodeManager总的可用虚拟CPU个数。</p></blockquote><blockquote><p>默认值：8</p></blockquote><ul><li>yarn.nodemanager.local-dirs</li></ul><blockquote><p>参数解释：中间结果存放位置，类似于1.0中的mapred.local.dir。注意，这个参数通常会配置多个目录，已分摊磁盘IO负载。</p></blockquote><blockquote><p>默认值：${hadoop.tmp.dir}/nm-local-dir</p></blockquote><ul><li>yarn.nodemanager.log-dirs</li></ul><blockquote><p>参数解释：日志存放地址（可配置多个目录）。</p></blockquote><blockquote><p>默认值：${yarn.log.dir}/userlogs</p></blockquote><ul><li>yarn.nodemanager.log.retain-seconds</li></ul><blockquote><p>参数解释：NodeManager上日志最多存放时间（不启用日志聚集功能时有效）。</p></blockquote><blockquote><p>默认值：10800（3小时）</p></blockquote><ul><li>yarn.nodemanager.aux-services</li></ul><blockquote><p>参数解释：NodeManager上运行的附属服务。需配置成mapreduce_shuffle，才可运行MapReduce程序</p></blockquote><blockquote><p>默认值：“”</p></blockquote><h2 id="端口总结"><a href="#端口总结" class="headerlink" title="端口总结"></a>端口总结</h2><table><thead><tr><th>端口</th><th>参数</th></tr></thead><tbody><tr><td>9000</td><td>fs.defaultFS，如：hdfs://172.25.40.171:9000</td></tr><tr><td>9001</td><td>dfs.namenode.rpc-address，DataNode会连接这个端口</td></tr><tr><td>50070</td><td>dfs.namenode.http-address</td></tr><tr><td>50470</td><td>dfs.namenode.https-address</td></tr><tr><td>50100</td><td>dfs.namenode.backup.address</td></tr><tr><td>50105</td><td>dfs.namenode.backup.http-address</td></tr><tr><td>50090</td><td>dfs.namenode.secondary.http-address，如：172.25.39.166:50090</td></tr><tr><td>50091</td><td>dfs.namenode.secondary.https-address，如：172.25.39.166:50091</td></tr><tr><td>50020</td><td>dfs.datanode.ipc.address</td></tr><tr><td>50075</td><td>dfs.datanode.http.address</td></tr><tr><td>50475</td><td>dfs.datanode.https.address</td></tr><tr><td>50010</td><td>dfs.datanode.address，DataNode的数据传输端口</td></tr><tr><td>8480</td><td>dfs.journalnode.rpc-address</td></tr><tr><td>8481</td><td>dfs.journalnode.https-address</td></tr><tr><td>8032</td><td>yarn.resourcemanager.address</td></tr><tr><td>8088</td><td>yarn.resourcemanager.webapp.address，YARN的http端口</td></tr><tr><td>8090</td><td>yarn.resourcemanager.webapp.https.address</td></tr><tr><td>8030</td><td>yarn.resourcemanager.scheduler.address</td></tr><tr><td>8031</td><td>yarn.resourcemanager.resource-tracker.address</td></tr><tr><td>8033</td><td>yarn.resourcemanager.admin.address</td></tr><tr><td>8042</td><td>yarn.nodemanager.webapp.address</td></tr><tr><td>8040</td><td>yarn.nodemanager.localizer.address</td></tr><tr><td>8188</td><td>yarn.timeline-service.webapp.address</td></tr><tr><td>10020</td><td>mapreduce.jobhistory.address</td></tr><tr><td>19888</td><td>mapreduce.jobhistory.webapp.address</td></tr><tr><td>2888</td><td>ZooKeeper，如果是Leader，用来监听Follower的连接</td></tr><tr><td>3888</td><td>ZooKeeper，用于Leader选举</td></tr><tr><td>2181</td><td>ZooKeeper，用来监听客户端的连接</td></tr><tr><td>60010</td><td>hbase.master.info.port，HMaster的http端口</td></tr><tr><td>60000</td><td>hbase.master.port，HMaster的RPC端口</td></tr><tr><td>60030</td><td>hbase.regionserver.info.port，HRegionServer的http端口</td></tr><tr><td>60020</td><td>hbase.regionserver.port，HRegionServer的RPC端口</td></tr><tr><td>8080</td><td>hbase.rest.port，HBase REST server的端口</td></tr><tr><td>10000</td><td>hive.server2.thrift.port</td></tr><tr><td>9083</td><td>hive.metastore.uris</td></tr></tbody></table><h2 id="Hadoop配置文件的层级关系"><a href="#Hadoop配置文件的层级关系" class="headerlink" title="Hadoop配置文件的层级关系"></a>Hadoop配置文件的层级关系</h2><p>  在Hadoop源码Configuration类中，先后加载了core-default.xml 和 core-site.xml ;类HdfsConfiguration继承了Configuration类，因此，hdfs-site.xml中的配置如果在core-site.xml 中配置了，那么将覆盖掉这个配置。 同理，yarn-site.xml也是这样的。</p><h2 id="yarn-site-xml-重点配置讲解"><a href="#yarn-site-xml-重点配置讲解" class="headerlink" title="yarn-site.xml 重点配置讲解"></a>yarn-site.xml 重点配置讲解</h2><h3 id="与-memery-相关的配置"><a href="#与-memery-相关的配置" class="headerlink" title="与 memery 相关的配置"></a>与 memery 相关的配置</h3><ul><li>yarn.nodemanager.resource.memery-mb : 重要</li></ul><blockquote><p>指定NodeManager（NM）可用的内存大小，NM是yarn中的一个组件，是一个Jave服务。这内存值是指NM管理的，用于AppMaster和Map Task 和 Reduce Task 可申请的内存数目。这里主要考虑和Linux系统的协调，避免设置过大被Linux的（Out of Memary Killer）OOMK 杀掉。例如2G的内存，设置为1200（1.2G）是可行的。<br>默认配置被设置为8G，Hadoop就任务NM上就有8G的内存，因此当运行内存过大时，就有可能被linux被OOMK终结。 </p></blockquote><ul><li>yarn.scheduler.minimum-allocation-mb: </li></ul><blockquote><p>单个任务(每个Container)可申请最少内存，默认1024MB , 就是单个任务要申请的资源的话，ResourceManager(RM)会至少给你分配的内存数，即使你申请了1MB，也会派给你1024MB，因此这个地方需要根据机器配置和作业需求提前配置。 </p></blockquote><ul><li>yarn.scheduler.increment-allocation-mb </li></ul><blockquote><p>当一个Container拿到的最小内存不足以运行时，他可以申请内存递增，这个配置是配的递增的幅度。 </p></blockquote><ul><li>yarn.scheduler.maximum-allocation-mb </li></ul><blockquote><p>每个Container最多拿到的内存的数量，这里设置的是一个上限，Container申请资源时可递增直到满足运行需求，但是如果到了上限，就不能递增了。 </p></blockquote><blockquote><p>例：若yarn.scheduler.minimum-allocation-mb是50，yarn.scheduler.increment-allocation-mb是40，当申请60mb的时候，实际申请是80（50 &lt; 60 &lt; 40 * 2 ），当申请30mb的时候，实际是50（30 &lt; 50，就是小于min）。</p></blockquote><h3 id="与CPU相关的配置"><a href="#与CPU相关的配置" class="headerlink" title="与CPU相关的配置"></a>与CPU相关的配置</h3><p>与上节节相似，也可以配置CPU的相应信息： </p><ul><li>yarn.scheduler.minimum-allocation-vcores </li><li>yarn.scheduler.increment-allocation-vcores </li><li>yarn.scheduler.maximum-allocation-vcores</li></ul><h2 id="mapred-site-xml-重点配置讲解"><a href="#mapred-site-xml-重点配置讲解" class="headerlink" title="mapred-site.xml 重点配置讲解"></a>mapred-site.xml 重点配置讲解</h2><h3 id="MR-AppMaster-相关"><a href="#MR-AppMaster-相关" class="headerlink" title="MR AppMaster 相关"></a>MR AppMaster 相关</h3><ul><li>yarn.app.mapreduce.am.resource.mb </li><li>yarn.app.mapreduce.am.resource.cpu-vcores </li></ul><blockquote><p>这里am指 Yarn中AppMaster，针对MapReduce计算框架就是MR AppMaster，通过配置这两个选项，可以设定MR AppMaster使用的内存和cpu数量。 默认情况下，yarn.app.mapreduce.am.resource.mb是2G，因此这里必须配置，需要少于yarn.scheduler.minimum-allocation-mb的配置，这样才能成功启动。</p></blockquote><h3 id="map、reduce-task-相关"><a href="#map、reduce-task-相关" class="headerlink" title="map、reduce task 相关"></a>map、reduce task 相关</h3><ul><li>mapreduce.map.memory.mb、mapreduce.map.cpu.vcores、mapreduce.reduce.memory.mb、mapreduce.reduce.cpu.vcores <blockquote><p>配置每个map 和 reduce 最多可以申请的内存和cpu数量;如果是单机情况，这里的资源和MR AppMaster 时共存和竞争关系，且都应在yarn.scheduler.minimum-allocation-mb之下，MR AppMaster启动成功后，剩下的资源才用于map、reduce task。</p></blockquote></li></ul><h2 id="JVM-启动时参数设置"><a href="#JVM-启动时参数设置" class="headerlink" title="JVM 启动时参数设置"></a>JVM 启动时参数设置</h2><ul><li>mapreduce.map.java.opts、mapreduce.reduce.java.opts <blockquote><p>Java task启动时使用的参数;例如设置Java heap 的大小，会在启动map或者reduce进程时把这些参数附加在启动命令之后。<br>这个地方需要仔细配置，配置不当会引起JVM 不能正常GC。 </p></blockquote></li></ul><p>例如：</p><ul><li>mapreduce.map.memory.mb 设置为了500MB</li><li>mapreduce.map.java.opts 设置为 -Xmx600m</li><li>假设CG为JVM中内存占用达到90%时触发，也就是540MB时会触发<br>这时，由于mapreduce.map.memory.mb的限制，map 进程会被提前Kill掉，因此GC永远得不到触发。</li></ul><h2 id="core-site-xml"><a href="#core-site-xml" class="headerlink" title="core-site.xml"></a>core-site.xml</h2><ul><li>fs.defaultFS（老版本是fs.default.name） </li></ul><blockquote><p>默认使用的文件系统类型（hdfs://host1:8020/、viewfs://nsX）</p></blockquote><ul><li>fs.trash.interval </li></ul><blockquote><p>垃圾箱文件保留多久（单位：分钟）</p></blockquote><ul><li>io.compression.codecs </li></ul><blockquote><p>Java codec</p></blockquote><ul><li>hadoop.security.authentication </li></ul><blockquote><p>Hadoop使用的认证方法（simple或kerberos）</p></blockquote><h2 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h2><p>• dfs.namenode.name.dir<br>– namenode存放fsimage的目录</p><p>• dfs.datanode.data.dir<br>– datanode存放数据块文件的目录</p><p>• dfs.namenode.checkpoint.dir<br>– Secondarynamenode启动时使用，放置sn做合并的fsimage及 editlog</p><p>• dfs.replication<br>– 数据副本数</p><p>• dfs.blocksize<br>– 文件Block大小</p><p>• dfs.datanode.handler.count<br>– Datanode IPC 请求处理线程数</p><h2 id="yarn-site-xml其他配置"><a href="#yarn-site-xml其他配置" class="headerlink" title="yarn-site.xml其他配置"></a>yarn-site.xml其他配置</h2><ul><li><p>yarn.resourcemanager.hostname、yarn.resourcemanager.address、yarn.resourcemanager.admin.address<br>、yarn.resourcemanager.scheduler.address、 yarn.resourcemanager.resource-tracker.address、<br>yarn.resourcemanager.webapp.address等项目的基本，依据实际rm 的hostname配置</p></li><li><p>yarn.scheduler.minimum-allocation-mb </p></li></ul><blockquote><p>Yarn分配内存的最小单位</p></blockquote><ul><li>yarn.scheduler.increment -allocation-mb </li></ul><blockquote><p>内存分配递增最小单位</p></blockquote><ul><li>yarn.scheduler.maximum-allocation-mb </li></ul><blockquote><p>每个container最多申请的内存上限</p></blockquote><ul><li>yarn.scheduler.minimum-allocation-vcores、<br>yarn.scheduler.increment -allocation-vcores、<br>yarn.scheduler.maximum-allocation-vcores </li></ul><blockquote><p>跟以上内存相关的意义相同</p></blockquote><ul><li>yarn.resourcemanager.am.max-retries </li></ul><blockquote><p>AM失败重试次数</p></blockquote><ul><li>yarn.am.liveness-monitor.expiry-interval-ms </li></ul><blockquote><p>AM多久不上报心跳被视为过期</p></blockquote><ul><li>yarn.resourcemanager.nm.liveness-monitor.interval-ms </li></ul><blockquote><p>多久检查一次nm是否还存活</p></blockquote><ul><li>yarn.application.classpath </li></ul><blockquote><p>Yarn application使用的classpath</p></blockquote><ul><li>yarn.resourcemanager.scheduler.class </li></ul><blockquote><p>调度器定义，如 org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</p></blockquote><ul><li>yarn.scheduler.fair.user -as-default -queue </li></ul><blockquote><p>对于fairscheduler使用，是否使用用户名作为任务进入的queue</p></blockquote><ul><li>yarn.scheduler.fair.preemption </li></ul><blockquote><p>Fairescheduler是否支持queue之间任务抢占</p></blockquote><ul><li>yarn.resourcemanager.max-completed-applications </li></ul><blockquote><p>RM中保留的最大的已完成的任务信息数量</p></blockquote><ul><li>yarn.nodemanager.resource.memory-mb </li></ul><blockquote><p>Nm的可用内存</p></blockquote><ul><li>yarn.nodemanager.local-dirs </li></ul><blockquote><p>Nm本地文件目录（主要是一些cache)</p></blockquote><ul><li>yarn.nodemanager.log-dirs </li></ul><blockquote><p>Nm log目录</p></blockquote><ul><li>yarn.nodemanager.remote-app-log-dir、yarn.logaggregation.retain-seconds、yarn.log-aggregationenable、yarn.nodemanager.logaggregation.compression-type </li></ul><blockquote><p>启动log aggregation的时候使用参数</p></blockquote><ul><li>yarn.app.mapreduce.am.staging-dir </li></ul><blockquote><p>Staging目录，hdfs</p></blockquote><h2 id="mapred-site-xml-其他配置讲解"><a href="#mapred-site-xml-其他配置讲解" class="headerlink" title="mapred-site.xml 其他配置讲解"></a>mapred-site.xml 其他配置讲解</h2><ul><li>mapreduce.map.speculative、mapreduce.reduce.speculative </li></ul><blockquote><p>是否开启预测执行</p></blockquote><ul><li>mapreduce.job.reduce.slowstart.completedmaps </li></ul><blockquote><p>Map完成多少之后开始启动reduce</p></blockquote><ul><li>mapreduce.jobhistory.address、mapreduce.jobhistory.webapp.address </li></ul><blockquote><p>Jobhistory地址</p></blockquote><ul><li>mapreduce.framework.name </li></ul><blockquote><p>local, classic or yarn</p></blockquote><ul><li>yarn.app.mapreduce.am.staging -dir、yarn.app.mapreduce.am.resource.mb<br>、yarn.app.mapreduce.am.resource.cpu-vcores、 yarn.app.mapreduce.am.command-opts</li></ul><blockquote><p>Am相关配置 </p></blockquote><ul><li>mapreduce.map.java.opts、mapreduce.reduce.java.opts </li></ul><blockquote><p>Java task启动时使用的参数</p></blockquote><ul><li>mapreduce.map.memory.mb、mapreduce.map.cpu.vcores、mapreduce.reduce.memory.mb、mapreduce.reduce.cpu.vcores </li></ul><blockquote><p>Map/reduce任务资源设置</p></blockquote><ul><li>mapreduce.application.classpath </li></ul><blockquote><p>Task使用的classpath</p></blockquote><h2 id="问答"><a href="#问答" class="headerlink" title="问答"></a>问答</h2><ul><li>yarn.scheduler.minimum-allocation-mb，为app分配内存时最小的配额。 </li><li>yarn.scheduler.increment-allocation-mb，每次递加申请的内存资源数，比如，若yarn.scheduler.minimum-allocation-mb是50，yarn.scheduler.increment-allocation-mb是40，当申请60mb的时候，实际申请是80（50 &lt; 60 &lt; 40 * 2 ），当申请30mb的时候，实际是50（30 &lt; 50，就是小于min）。 </li><li><p>yarn.scheduler.maximum-allocation-mb，单个container可分配的内存总量上限。</p></li><li><p>yarn.app.mapreduce.am.resource.mb，执行appManager时需要分配的内存。 </p></li><li>mapreduce.map.memory.mb，map任务执行时要申请的内存。 </li><li>mapreduce.reduce.memory.mb，reduce任务执行时要申请的内存。 </li><li>mapreduce.task.io.sort.mb，任务在做spill时，内存的缓存量，之所以提出来，因为当我们将mapreduce.map.memory.mb和apreduce.reduce.memory.mb减小时，需要将这个值也减小，否则会出现task任务资源不够跑不成功的问题</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;hadoop配置说明&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="hadoop" scheme="https://zixujing.github.io/tags/hadoop/"/>
    
  </entry>
  
  <entry>
    <title>neo4j 3.5.4 配置</title>
    <link href="https://zixujing.github.io/2019/07/08/bigdata/neo4j.%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/07/08/bigdata/neo4j.配置/</id>
    <published>2019-07-07T16:00:00.000Z</published>
    <updated>2019-09-15T08:25:06.064Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>neo4j 配置<br><a id="more"></a></p></blockquote><h2 id="neo4j-配置"><a href="#neo4j-配置" class="headerlink" title="neo4j 配置"></a>neo4j 配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dbms.directories.import=import</span><br><span class="line">dbms.allow_upgrade=true</span><br><span class="line">dbms.connectors.default_listen_address=192.168.11.117</span><br><span class="line">dbms.connector.bolt.enabled=true</span><br><span class="line">dbms.connector.bolt.listen_address=:7687</span><br><span class="line">dbms.connector.http.enabled=true</span><br><span class="line">dbms.connector.http.listen_address=:7474</span><br><span class="line">dbms.connector.https.enabled=true</span><br><span class="line">dbms.mode=HA</span><br><span class="line">ha.server_id=3</span><br><span class="line">ha.initial_hosts=192.168.11.119:5001,192.168.11.118:5001,192.168.11.117:5001</span><br><span class="line">dbms.security.allow_csv_import_from_file_urls=true</span><br><span class="line">dbms.jvm.additional=-XX:+UseG1GC</span><br><span class="line">dbms.jvm.additional=-XX:-OmitStackTraceInFastThrow</span><br><span class="line">dbms.jvm.additional=-XX:+AlwaysPreTouch</span><br><span class="line">dbms.jvm.additional=-XX:+UnlockExperimentalVMOptions</span><br><span class="line">dbms.jvm.additional=-XX:+TrustFinalNonStaticFields</span><br><span class="line">dbms.jvm.additional=-XX:+DisableExplicitGC</span><br><span class="line">dbms.jvm.additional=-Djdk.tls.ephemeralDHKeySize=2048</span><br><span class="line">dbms.jvm.additional=-Djdk.tls.rejectClientInitiatedRenegotiation=true</span><br><span class="line">dbms.windows_service_name=neo4j</span><br><span class="line">dbms.jvm.additional=-Dunsupported.dbms.udc.source=tarball</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;neo4j 配置&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
      <category term="neo4j" scheme="https://zixujing.github.io/tags/neo4j/"/>
    
  </entry>
  
  <entry>
    <title>ansible2.3离线安装和离线安装包</title>
    <link href="https://zixujing.github.io/2019/06/26/linux/linux%E5%B7%A5%E5%85%B7/ansible2.3%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%92%8C%E5%AE%89%E8%A3%85%E5%8C%85/"/>
    <id>https://zixujing.github.io/2019/06/26/linux/linux工具/ansible2.3离线安装和安装包/</id>
    <published>2019-06-25T21:00:00.000Z</published>
    <updated>2019-06-26T17:53:05.330Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ansible2.3离线安装和离线安装包<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">## 初始化</span><br><span class="line"></span><br><span class="line">yum install python-devel openssl-devel</span><br><span class="line"></span><br><span class="line">## 1.创建文件夹</span><br><span class="line">#mkdir -p /usr/local/src/ansible</span><br><span class="line"></span><br><span class="line">## 2. 安装setuptools</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf setuptools-7.0.tar.gz</span><br><span class="line">cd setuptools-7.0</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 3. 安装pycrypto</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf pycrypto-2.6.1.tar.gz</span><br><span class="line">cd pycrypto-2.6.1</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 4. 安装yaml</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf yaml-0.1.5.tar.gz</span><br><span class="line">cd yaml-0.1.5</span><br><span class="line">./configure --prefix=/usr/local</span><br><span class="line">make --jobs=`grep processor /proc/cpuinfo | wc -l`</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">## 5. 安装PyYAML</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf PyYAML-3.11.tar.gz</span><br><span class="line">cd PyYAML-3.11  </span><br><span class="line">python setup.py install  </span><br><span class="line">  </span><br><span class="line">## 6. 安装MarkupSafe  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf MarkupSafe-0.9.3.tar.gz</span><br><span class="line">cd MarkupSafe-0.9.3  </span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 7. 安装Jinja2  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf Jinja2-2.7.3.tar.gz  </span><br><span class="line">cd Jinja2-2.7.3  </span><br><span class="line">python setup.py install  </span><br><span class="line">  </span><br><span class="line">## 8. 安装ecdsa  </span><br><span class="line">cd /usr/local/src/ansible  </span><br><span class="line">tar xvzf ecdsa-0.11.tar.gz</span><br><span class="line">cd ecdsa-0.11  </span><br><span class="line">python setup.py install  </span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf paramiko-1.15.1.tar.gz</span><br><span class="line">cd paramiko-1.15.1</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 9. 安装simplejson</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf simplejson-3.6.5.tar.gz</span><br><span class="line">cd simplejson-3.6.5</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">## 10. 安装ansible</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">tar xvzf ansible-2.3.1.0.tar.gz</span><br><span class="line">cd ansible-2.3.1.0</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 11. 安装sshpass</span><br><span class="line">cd /usr/local/src/ansible</span><br><span class="line">cd sshpass-1.06</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="安装包位置"><a href="#安装包位置" class="headerlink" title="安装包位置"></a>安装包位置</h2><p><a href="https://raw.githubusercontent.com/zixujing/book1.github.io/master/code/ansible%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85.zip" target="_blank" rel="noopener">ansible离线安装包</a></p><h2 id="配置例子"><a href="#配置例子" class="headerlink" title="配置例子"></a>配置例子</h2><h3 id="统一成一个命令"><a href="#统一成一个命令" class="headerlink" title="统一成一个命令"></a>统一成一个命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/perl</span><br><span class="line">%command=(</span><br><span class="line"></span><br><span class="line">#所有机器就绪状态</span><br><span class="line"></span><br><span class="line">1,qq \ansible all -m ping\,</span><br><span class="line"></span><br><span class="line">#服务监控</span><br><span class="line"></span><br><span class="line">2, qq \ansible http-service -m shell -a &quot;systemctl status tomcat8_pf | grep Active:&quot;\,</span><br><span class="line">3, qq \ansible http-service -m shell -a &quot;systemctl status tomcat8_sdk | grep Active:&quot;\,</span><br><span class="line">4, qq \ansible http-service -m shell -a &quot;df -H /dev/mapper/cl-home;du -sm /home/hch54&quot;\,</span><br><span class="line"></span><br><span class="line">#服务启动与结束</span><br><span class="line">5, qq \ansible 72 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">6, qq \ansible 73 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">7, qq \ansible 74 -m shell -a &quot;systemctl start tomcat8_pf&quot;\,</span><br><span class="line">8, qq \ansible 72 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line">9, qq \ansible 73 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line">10, qq \ansible 74 -m shell -a &quot;systemctl stop tomcat8_pf&quot;\,</span><br><span class="line"></span><br><span class="line">11, qq \ansible 72 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">12, qq \ansible 73 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">13, qq \ansible 74 -m shell -a &quot;systemctl start tomcat8_sdk&quot;\,</span><br><span class="line">14, qq \ansible 72 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line">15, qq \ansible 73 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line">16, qq \ansible 74 -m shell -a &quot;systemctl stop tomcat8_sdk&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#nginx监控</span><br><span class="line">17,qq \ansible nginx -m shell -a &quot;systemctl status nginx | grep Active:&quot;\,</span><br><span class="line">18,qq \ansible nginx -m shell -a &quot;systemctl status keepalived | grep Active:&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">19,qq \ansible 74 -m shell -a &quot;systemctl start nginx&quot;\,</span><br><span class="line">20,qq \ansible 74 -m shell -a &quot;systemctl stop nginx&quot;\,</span><br><span class="line">21,qq \ansible 48 -m shell -a &quot;systemctl start nginx&quot;\,</span><br><span class="line">22,qq \ansible 48 -m shell -a &quot;systemctl stop nginx&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">23,qq \ansible 48 -m shell -a &quot;nginx -s reload&quot;\,</span><br><span class="line"></span><br><span class="line">#kafka</span><br><span class="line"></span><br><span class="line">24,qq /ansible kafka -m shell -a &quot;ss -nlt | egrep \\&quot;(:2181)|(:9092)\\&quot;&quot;/,</span><br><span class="line">25,qq \ansible 127 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line">26,qq \ansible 128 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line">27,qq \ansible 134 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/server_sasl.properties&quot;\,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">28,qq \ansible 127 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line">29,qq \ansible 128 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line">30,qq \ansible 134 -m shell -a &quot;source /root/.bash_profile;/opt/kafka_2.12-2.1.1/bin/zookeeper-server-start.sh -daemon /opt/kafka_2.12-2.1.1/config/zookeeper.properties&quot;\,</span><br><span class="line"></span><br><span class="line">#mysql</span><br><span class="line">31,q \ansible 26 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p12qWe@#$% -e&apos;show master status&apos;&quot;\,</span><br><span class="line">32,qq !ansible 25 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p123456 -e&apos;show slave status\G&apos;&quot;!,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">33,qq \ansible 26 -m shell -a &quot;systemctl status mysqld&quot;\,</span><br><span class="line">34,qq \ansible 25 -m shell -a &quot;systemctl status mysql&quot;\,</span><br><span class="line"></span><br><span class="line">35,qq \ansible 26 -m shell -a &quot;systemctl start mysqld&quot;\,</span><br><span class="line">36,qq \ansible 25 -m shell -a &quot;systemctl start mysql&quot;\,</span><br><span class="line">37,qq \ansible 26 -m shell -a &quot;systemctl stop mysqld&quot;\,</span><br><span class="line">38,qq \ansible 25 -m shell -a &quot;systemctl stop mysql&quot;\,</span><br><span class="line"></span><br><span class="line">39,qq !ansible 25 -m shell -a &quot;source /root/.bash_profile;mysql -uroot -p123456 -e&apos;start slave&apos;&quot;!,</span><br><span class="line"></span><br><span class="line">#oracle</span><br><span class="line">40,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl status|grep READY&quot;\,</span><br><span class="line">41,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl stop&quot;\,</span><br><span class="line">42,qq \ansible 25 -m shell -a &quot;source /etc/profile; lsnrctl start&quot;\,</span><br><span class="line"></span><br><span class="line">43,q !ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile; echo -e  &apos;select open_mode,dbid from v\\$database;&apos; | sqlplus / as sysdba | grep 1526735889&quot;!,</span><br><span class="line"></span><br><span class="line">44,qq \ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile;dbstart&quot;\,</span><br><span class="line">45,qq \ansible 25 -m shell --become-user=oracle -b -a &quot;source /etc/profile;dbshut&quot;\,</span><br><span class="line"></span><br><span class="line">#redis</span><br><span class="line">46,qq _ansible redis -m shell -a &quot;ss -nlt | egrep \\&quot;(:6500)|(:6600)\\&quot;&quot;_,</span><br><span class="line">47,qq \ansible 81 -m shell -a &quot;redis-server /home/redis_copy/6500/redis.conf&quot;\,</span><br><span class="line">48,qq \ansible 81 -m shell -a &quot;redis-sentinel /home/redis_copy/6600/sentinel.conf&quot;\,</span><br><span class="line">49,qq \ansible 84 -m shell -a &quot;redis-server /home/redis_copy/6500/redis.conf&quot;\,</span><br><span class="line"></span><br><span class="line">#activemq</span><br><span class="line">50,qq \ansible 85 -m shell -a &quot;systemctl status activemq|grep Active&quot;\,</span><br><span class="line">51,qq \ansible 85 -m shell -a &quot;systemctl stop activemq&quot;\,</span><br><span class="line">52,qq \ansible 85 -m shell -a &quot;systemctl start activemq&quot;\,</span><br><span class="line">53,qq \ansible 85 -m shell -a &quot;df -h /dev/mapper/cl-home&quot;\,</span><br><span class="line"></span><br><span class="line">#文件服务器</span><br><span class="line">54,qq \ansible 83 -m shell -a &quot;df -h | grep -v tmp&quot;\,</span><br><span class="line">55,qq \ansible 83 -m shell -a &quot;systemctl status fdfs_storaged |grep Active ; systemctl status fdfs_trackerd |grep Active&quot;\,</span><br><span class="line"></span><br><span class="line">56,qq \ansible 83 -m shell -a &quot;systemctl stop fdfs_storaged ; systemctl stop fdfs_trackerd &quot;\,</span><br><span class="line">57,qq \ansible 83 -m shell -a &quot;systemctl start fdfs_storaged ; systemctl start fdfs_trackerd &quot;\,</span><br><span class="line"></span><br><span class="line">#mpp</span><br><span class="line">58,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstate&quot;\,</span><br><span class="line">59,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstart&quot;\,</span><br><span class="line">60,qq \ansible 135 -m shell --become-user=gpadmin -b -a &quot;source /home/gpadmin/conf/gpsh;gpstop&quot;\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#结束括号</span><br><span class="line">);</span><br><span class="line">#for debug</span><br><span class="line">#print $command&#123;$ARGV[0]&#125;,&quot;\n&quot;;</span><br><span class="line">$info=qx | $command&#123;$ARGV[0]&#125;|;</span><br><span class="line">print $info;</span><br></pre></td></tr></table></figure><h3 id="做成一个网页"><a href="#做成一个网页" class="headerlink" title="做成一个网页"></a>做成一个网页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/python</span><br><span class="line">#coding=utf8</span><br><span class="line">from BaseHTTPServer import HTTPServer,BaseHTTPRequestHandler</span><br><span class="line">import urllib</span><br><span class="line">import commands</span><br><span class="line">class ServerHttp(BaseHTTPRequestHandler):</span><br><span class="line">def do_GET(self):</span><br><span class="line">path=self.path</span><br><span class="line">#print path</span><br><span class="line">query=urllib.splitquery(path)</span><br><span class="line">#print query[1]</span><br><span class="line">#print query[0]</span><br><span class="line">body_data=None</span><br><span class="line">if(query[0]==&quot;/system&quot; and query[1] is not None):</span><br><span class="line">body_data=commands.getstatusoutput(&quot;hch_state %s&quot;%query[1])</span><br><span class="line">#print &quot;hch_state %s&quot;%query[1]</span><br><span class="line">self.send_response(200)</span><br><span class="line">self.send_header(&quot;Content-type&quot;,&quot;text/html&quot;)</span><br><span class="line">self.send_header(&quot;(^_^)&quot;,&quot;?? !&quot;)</span><br><span class="line">self.end_headers()</span><br><span class="line">buf1=&apos;&apos;&apos;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html;charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;icon&quot; href=&quot;data:;base64,=&quot;/&gt;</span><br><span class="line">&lt;title&gt;(^_^)&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;请点击以下各个链接&lt;/h1&gt;</span><br><span class="line">&lt;font size=&quot;20&quot;&gt;</span><br><span class="line">&lt;a href=&quot;?tag=1&quot;&gt;1&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=2&quot;&gt;2&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=3&quot;&gt;3&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=4&quot;&gt;4&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=5&quot;&gt;5&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=6&quot;&gt;6&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=7&quot;&gt;7&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=8&quot;&gt;8&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=9&quot;&gt;9&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=10&quot;&gt;10&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=11&quot;&gt;11&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=12&quot;&gt;12&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=13&quot;&gt;13&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=14&quot;&gt;14&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=15&quot;&gt;15&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=16&quot;&gt;16&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=17&quot;&gt;17&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=18&quot;&gt;18&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=19&quot;&gt;19&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=20&quot;&gt;20&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;a href=&quot;?tag=21&quot;&gt;21&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=22&quot;&gt;22&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=23&quot;&gt;23&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=24&quot;&gt;24&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=25&quot;&gt;25&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=26&quot;&gt;26&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=27&quot;&gt;27&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=28&quot;&gt;28&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=29&quot;&gt;29&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=30&quot;&gt;30&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=31&quot;&gt;31&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=32&quot;&gt;32&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=33&quot;&gt;33&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=34&quot;&gt;34&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=35&quot;&gt;35&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=36&quot;&gt;36&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=37&quot;&gt;37&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=38&quot;&gt;38&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=39&quot;&gt;39&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=40&quot;&gt;40&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;a href=&quot;?tag=41&quot;&gt;41&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=42&quot;&gt;42&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=43&quot;&gt;43&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=44&quot;&gt;44&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=45&quot;&gt;45&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=46&quot;&gt;46&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=47&quot;&gt;47&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=48&quot;&gt;48&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=49&quot;&gt;49&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=50&quot;&gt;50&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=51&quot;&gt;51&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=52&quot;&gt;52&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=53&quot;&gt;53&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=54&quot;&gt;54&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=55&quot;&gt;55&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=56&quot;&gt;56&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=57&quot;&gt;57&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=58&quot;&gt;58&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=59&quot;&gt;59&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;?tag=60&quot;&gt;60&lt;/a&gt;&lt;/br&gt;</span><br><span class="line">&lt;/font&gt;</span><br><span class="line">&lt;font size=8&gt;</span><br><span class="line">&lt;table border=&quot;1&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;1.所有服务器是否在线&lt;/td&gt;</span><br><span class="line">&lt;td&gt;2.核查平台服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;3.sdk服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;4.平台服务磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;5.核查平台服务启动72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;6.核查平台服务启动73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;7.核查平台服务启动74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;8.核查平台服务关闭72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;9.核查平台服务关闭73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;10.核查平台服务关闭74&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;11.sdk服务启动72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;12.sdk服务启动73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;13.sdk服务启动74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;14.sdk服务关闭72&lt;/td&gt;</span><br><span class="line">&lt;td&gt;15.sdk服务关闭73&lt;/td&gt;</span><br><span class="line">&lt;td&gt;16.sdk服务关闭74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;17.nginx服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;18.keepalived服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;19.启动nginx74&lt;/td&gt;</span><br><span class="line">&lt;td&gt;20.关闭nginx74&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;21.启动nginx48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;22.关闭nginx48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;23.重载nginx配置48&lt;/td&gt;</span><br><span class="line">&lt;td&gt;24.kafka状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;25.启动kafka127&lt;/td&gt;</span><br><span class="line">&lt;td&gt;26.启动kafka128&lt;/td&gt;</span><br><span class="line">&lt;td&gt;27.启动kafka134&lt;/td&gt;</span><br><span class="line">&lt;td&gt;28.启动zookeeper127&lt;/td&gt;</span><br><span class="line">&lt;td&gt;29.启动zookeeper128&lt;/td&gt;</span><br><span class="line">&lt;td&gt;30.启动zookeeper1134&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;31.26mysql master status&lt;/td&gt;</span><br><span class="line">&lt;td&gt;32.25mysql slave status&lt;/td&gt;</span><br><span class="line">&lt;td&gt;33.26mysql服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;34.25mysql服务状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;35.26mysql启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;36.25mysql启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;37.26mysql关闭&lt;/td&gt;</span><br><span class="line">&lt;td&gt;38.25mysql关闭&lt;/td&gt;</span><br><span class="line">&lt;td&gt;39.25mysql start slave&lt;/td&gt;</span><br><span class="line">&lt;td&gt;40.oracle监听状态&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;41.oracle监听结束&lt;/td&gt;</span><br><span class="line">&lt;td&gt;42.oracle监听启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;43.oracle状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;44.启动oracle&lt;/td&gt;</span><br><span class="line">&lt;td&gt;45.关闭oracle&lt;/td&gt;</span><br><span class="line">&lt;td&gt;46.redis状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;47.81启动redis&lt;/td&gt;</span><br><span class="line">&lt;td&gt;48.81启动哨兵&lt;/td&gt;</span><br><span class="line">&lt;td&gt;49.84启动redis&lt;/td&gt;</span><br><span class="line">&lt;td&gt;50.activemq状态&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;51.结束activemq&lt;/td&gt;</span><br><span class="line">&lt;td&gt;52.启动activemq&lt;/td&gt;</span><br><span class="line">&lt;td&gt;53.activemq磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;54.83文件服务磁盘使用&lt;/td&gt;</span><br><span class="line">&lt;td&gt;55.fastdfs状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;56.关闭fastdfs&lt;/td&gt;</span><br><span class="line">&lt;td&gt;57.启动fastdfs&lt;/td&gt;</span><br><span class="line">&lt;td&gt;58.mpp状态&lt;/td&gt;</span><br><span class="line">&lt;td&gt;59.mpp启动&lt;/td&gt;</span><br><span class="line">&lt;td&gt;60.mpp关闭&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/font&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;h1&gt;下面是返回信息&lt;/h1&gt;</span><br><span class="line">&lt;p align=&quot;center&quot;&gt;</span><br><span class="line">&lt;textarea readonly rows=&quot;100&quot; cols=&quot;180&quot;&gt;&apos;&apos;&apos;</span><br><span class="line">buf2=&apos;&apos;&apos;&lt;/textarea&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">#print body_data</span><br><span class="line">body_data=body_data if(body_data is not None) else (0,&quot;&quot;)</span><br><span class="line">#print body_data</span><br><span class="line"></span><br><span class="line">self.wfile.write(buf1+body_data[1]+buf2)</span><br><span class="line">def start_server(port):</span><br><span class="line">http_server=HTTPServer((&apos;&apos;,int(port)),ServerHttp)</span><br><span class="line">http_server.serve_forever()</span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">start_server(12345)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ansible2.3离线安装和离线安装包&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>greenplum5.18+centos扩展结点.</title>
    <link href="https://zixujing.github.io/2019/06/12/db/postgresql/greenplum5.18+centos%E6%89%A9%E5%B1%95%E7%BB%93%E7%82%B9/"/>
    <id>https://zixujing.github.io/2019/06/12/db/postgresql/greenplum5.18+centos扩展结点/</id>
    <published>2019-06-11T17:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.477Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>greenplum5.18+centos扩展结点.<br><a id="more"></a></p></blockquote><blockquote><p>扩展结点时，至少需要两个结点</p></blockquote><h2 id="初始化配置，参考安装文档"><a href="#初始化配置，参考安装文档" class="headerlink" title="初始化配置，参考安装文档"></a>初始化配置，参考安装文档</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@mdw ~]# vi /etc/hosts</span><br><span class="line">192.168.11.84 mdw</span><br><span class="line">192.168.11.85 sdw1</span><br><span class="line">192.168.11.86 sdw2</span><br><span class="line">192.168.11.111 sdw3</span><br><span class="line">192.168.11.118 hadoopb</span><br><span class="line"></span><br><span class="line">[root@mdw ~]# vi /etc/sysctl.conf</span><br><span class="line">kernel.shmmax = 500000000</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.shmall = 4000000000</span><br><span class="line">kernel.sem = 500 1024000 200 4096</span><br><span class="line">kernel.sysrq = 1</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line">kernel.msgmni = 2048</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 4096</span><br><span class="line">net.ipv4.conf.all.arp_filter = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1025 65535</span><br><span class="line">net.core.netdev_max_backlog = 10000</span><br><span class="line">net.core.rmem_max = 2097152</span><br><span class="line">net.core.wmem_max = 2097152</span><br><span class="line">vm.overcommit_memory = 2</span><br><span class="line"></span><br><span class="line">[root@mdw ~]# vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nproc 131072</span><br><span class="line">* hard nproc 131072</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">groupadd -g 530 gpadmin</span><br><span class="line">useradd -g 530 -m -d /home/gpadmin -s /bin/bash gpadmin</span><br><span class="line">passwd gpadmin</span><br><span class="line"></span><br><span class="line">mkdir /opt/greenplum</span><br><span class="line">chown gpadmin:gpadmin /opt/greenplum</span><br></pre></td></tr></table></figure><h2 id="主节点上执行"><a href="#主节点上执行" class="headerlink" title="主节点上执行"></a>主节点上执行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$su - gpadmin</span><br><span class="line">$cd conf/</span><br><span class="line">$vi newhost </span><br><span class="line">sdw3</span><br><span class="line">sdw4</span><br><span class="line">$source pgsh##脚本中是环境变量</span><br><span class="line">$cat pgsh</span><br><span class="line">export PGPORT=5432</span><br><span class="line">export PGDATABASE=mydb</span><br><span class="line">export MASTER_DATA_DIRECTORY=/opt/greenplum/data/gpdata/gpmaster/gpseg-1</span><br><span class="line">source /opt/greenplum/greenplum-db/greenplum_path.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$cat hostlist </span><br><span class="line">mdw</span><br><span class="line">sdw1</span><br><span class="line">sdw2</span><br><span class="line">sdw3</span><br><span class="line">sdw4</span><br></pre></td></tr></table></figure><h2 id="配置ssh面密码登录"><a href="#配置ssh面密码登录" class="headerlink" title="配置ssh面密码登录"></a>配置ssh面密码登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpssh-exkeys -f /home/gpadmin/conf/hostlist</span><br></pre></td></tr></table></figure><h2 id="在新节点上安装Greenplum-DB"><a href="#在新节点上安装Greenplum-DB" class="headerlink" title="在新节点上安装Greenplum DB"></a>在新节点上安装Greenplum DB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpseginstall -f /home/gpadmin/conf/newhost</span><br></pre></td></tr></table></figure><h2 id="在两个新加的结点上分别创建目录"><a href="#在两个新加的结点上分别创建目录" class="headerlink" title="在两个新加的结点上分别创建目录"></a>在两个新加的结点上分别创建目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su - gpadmin</span><br><span class="line">mkdir -p /opt/greenplum/data/gpdata</span><br><span class="line">cd /opt/greenplum/data/gpdata</span><br><span class="line">mkdir gpdatam&#123;1,2&#125;  gpdatap&#123;1,2&#125;</span><br><span class="line">##初始化完成</span><br></pre></td></tr></table></figure><h2 id="配置文件input-file"><a href="#配置文件input-file" class="headerlink" title="配置文件input_file"></a>配置文件input_file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">gpexpand -f newhost</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-local Greenplum Version: &apos;postgres (Greenplum Database) 5.18.0 build commit:6aec9959d367d46c6b4391eb9ffc82c735d20102&apos;</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-master Greenplum Version: &apos;PostgreSQL 8.3.23 (Greenplum Database 5.18.0 build commit:6aec9959d367d46c6b4391eb9ffc82c735d20102) on x86_64-pc-linux-gnu, compiled by GCC gcc (GCC) 6.2.0, 64-bit compiled on Apr  3 2019 14:45:51&apos;</span><br><span class="line">20190612:18:22:05:023132 gpexpand:mdw:gpadmin-[INFO]:-Querying gpexpand schema for current expansion state</span><br><span class="line"></span><br><span class="line">System Expansion is used to add segments to an existing GPDB array.</span><br><span class="line">gpexpand did not detect a System Expansion that is in progress.</span><br><span class="line"></span><br><span class="line">Before initiating a System Expansion, you need to provision and burn-in</span><br><span class="line">the new hardware.  Please be sure to run gpcheckperf to make sure the</span><br><span class="line">new hardware is working properly.</span><br><span class="line"></span><br><span class="line">Please refer to the Admin Guide for more information.</span><br><span class="line"></span><br><span class="line">Would you like to initiate a new System Expansion Yy|Nn (default=N):</span><br><span class="line">&gt; Y</span><br><span class="line"></span><br><span class="line">You must now specify a mirroring strategy for the new hosts.  Spread mirroring places</span><br><span class="line">a given hosts mirrored segments each on a separate host.  You must be </span><br><span class="line">adding more hosts than the number of segments per host to use this. </span><br><span class="line">Grouped mirroring places all of a given hosts segments on a single </span><br><span class="line">mirrored host.  You must be adding at least 2 hosts in order to use this.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">What type of mirroring strategy would you like?</span><br><span class="line"> spread|grouped (default=grouped):</span><br><span class="line">&gt; 这个选择默认</span><br><span class="line"></span><br><span class="line">    By default, new hosts are configured with the same number of primary</span><br><span class="line">    segments as existing hosts.  Optionally, you can increase the number</span><br><span class="line">    of segments per host.</span><br><span class="line">    </span><br><span class="line">    For example, if existing hosts have two primary segments, entering a value</span><br><span class="line">    of 2 will initialize two additional segments on existing hosts, and four</span><br><span class="line">    segments on new hosts.  In addition, mirror segments will be added for</span><br><span class="line">    these new primary segments if mirroring is enabled.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">How many new primary segments per host do you want to add? (default=0):</span><br><span class="line">&gt; 这里选择默认</span><br><span class="line"></span><br><span class="line">Generating configuration file...</span><br><span class="line"></span><br><span class="line">20190612:18:22:11:023132 gpexpand:mdw:gpadmin-[INFO]:-Generating input file...</span><br><span class="line"></span><br><span class="line">Input configuration files were written to &apos;gpexpand_inputfile_20190612_182211&apos; and &apos;None&apos;.</span><br><span class="line">Please review the file and make sure that it is correct then re-run</span><br><span class="line">with: gpexpand -i gpexpand_inputfile_20190612_182211 -D mydb</span><br><span class="line">                </span><br><span class="line">20190612:18:22:11:023132 gpexpand:mdw:gpadmin-[INFO]:-Exiting...</span><br><span class="line">[gpadmin@mdw conf]$ ls</span><br><span class="line">gpexpand_inputfile_20190612_182211  gpinitsystem_config  hostlist  newhost  pgsh  seg_host</span><br><span class="line">[gpadmin@mdw conf]$ cat gpexpand_inputfile_20190612_182211 </span><br><span class="line">hadoopb:hadoopb:50000:/opt/greenplum/data/gpdata/gpdatap1/gpseg4:10:4:p:51000</span><br><span class="line">sdw3:sdw3:40000:/opt/greenplum/data/gpdata/gpdatam1/gpseg4:16:4:m:41000</span><br><span class="line">hadoopb:hadoopb:50001:/opt/greenplum/data/gpdata/gpdatap2/gpseg5:11:5:p:51001</span><br><span class="line">sdw3:sdw3:40001:/opt/greenplum/data/gpdata/gpdatam2/gpseg5:17:5:m:41001</span><br><span class="line">sdw3:sdw3:50000:/opt/greenplum/data/gpdata/gpdatap1/gpseg6:12:6:p:51000</span><br><span class="line">hadoopb:hadoopb:40000:/opt/greenplum/data/gpdata/gpdatam1/gpseg6:14:6:m:41000</span><br><span class="line">sdw3:sdw3:50001:/opt/greenplum/data/gpdata/gpdatap2/gpseg7:13:7:p:51001</span><br><span class="line">hadoopb:hadoopb:40001:/opt/greenplum/data/gpdata/gpdatam2/gpseg7:15:7:m:41001</span><br></pre></td></tr></table></figure><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpexpand -i gpexpand_inputfile_20190612_193623</span><br></pre></td></tr></table></figure><h2 id="如果扩展失败则执行回滚操作"><a href="#如果扩展失败则执行回滚操作" class="headerlink" title="如果扩展失败则执行回滚操作"></a>如果扩展失败则执行回滚操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpstart -m(或者gpstart -R)</span><br><span class="line">gpexpand -r -D zhangyun_db##可以不带数据库</span><br><span class="line">gpstart -a</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;greenplum5.18+centos扩展结点.&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Maxwell配置详解</title>
    <link href="https://zixujing.github.io/2019/05/29/bigdata/Maxwell%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <id>https://zixujing.github.io/2019/05/29/bigdata/Maxwell配置详解/</id>
    <published>2019-05-28T19:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Maxwell配置详解<br><a id="more"></a></p></blockquote><blockquote><p>mysql options</p><ul><li>host<br>指定从哪个地址的mysql获取binlog</li><li>replication_host<br>如果指定了 replication_host，那么它是真正的binlog来源的mysql server地址，而那么上面的host用于存放maxwell表结构和binlog位置的地址。<br>将两者分开，可以避免 replication_user 往生产库里写数据。</li><li>schema_host<br>从哪个host获取表结构。binlog里面没有字段信息，所以maxwell需要从数据库查出schema，存起来。<br>schema_host一般用不到，但在binlog-proxy场景下就很实用。比如要将已经离线的binlog通过maxwell生成json流，于是自建一个mysql server里面没有结构，只用于发送binlog，此时表机构就可以制动从 schema_host 获取。</li></ul></blockquote><ul><li>gtid_mode<br>如果 mysql server 启用了GTID，maxwell也可以基于gtid取event。如果mysql server发生failover，maxwell不需要手动指定newfile:postion</li></ul><p>正常情况下，replication_host 和 schema_host都不需要指定，只有一个 –host。</p><ul><li>schema_database<br>使用这个db来存放 maxwell 需要的表，比如要复制的databases, tables, columns, postions, heartbeats.</li></ul><blockquote><p>filtering</p><ul><li>include_dbs<br>只发送binlog里面这些databases的变更，以,号分隔，中间不要包含空格。<br>也支持java风格的正则，如 include_tables=db1,/db\d+/，表示 db1, db2, db3…这样的。（下面的filter都支持这种regex）<br>提示：这里的dbs指定的是真实db。比如binlog里面可能 use db1 但 update db2.ttt，那么maxwell生成的json database 内容是db2。</li><li>exclude_dbs<br>排除指定的这些 databbases</li><li>include_tables<br>只发送这些表的数据变更。不只需要指定 database.</li><li>exclude_tables<br>排除指定的这些表</li><li>exclude_columns<br>不输出这些字段。如果字段名在row中不存在，则忽略这个filter。</li><li>include_column_values<br>1.12.0新引入的过滤项。只输出满足 column=values 的行，比如 include_column_values=bar=x,foo=y，如果有bar字段，那么只输出值为x的行，如果有foo字段，那么只输出值为y的行。<br>如果没有对应字段，如只有bar=x没有foo字段，那么也成立。（即不是 或，也不是 与）</li></ul></blockquote><ul><li>blacklist_dbs<br>一般不用。blacklist_dbs字面上难以与exclude_dbs 分开，官网的说明也是模棱两可。<br>从代码里面看出的意思是，屏蔽指定的这些dbs,tables的结构变更，与行变更过滤，没有关系。它应对的场景是，某个表上频繁的有ddl，比如truncate。</li></ul><blockquote><p>formatting</p><ul><li>output_ddl<br>是否在输出的json流中，包含ddl语句。默认 false</li><li>output_binlog_position<br>是否在输出的json流中，包含binlog filename:postion。默认 false</li><li>output_commit_info<br>是否在输出的json流里面，包含 commit 和 xid 信息。默认 true<br>比如一个事物里，包含多个表的变更，或一个表上多条数据的变更，那么他们都具有相同的 xid，最后一个row event输出 commit:true 字段。这有利于消费者实现 事务回放，而不仅仅是行级别的回放。</li><li>output_thread_id<br>同样，binlog里面也包含了 thread_id ，可以包含在输出中。默认 false<br>消费者可以用它来实现更粗粒度的事务回放。还有一个场景是用户审计，用户每次登陆之后将登陆ip、登陆时间、用户名、thread_id记录到一个表中，可轻松根据thread_id关联到binlog里面这条记录是哪个用户修改的。</li><li>monitoring<br>如果是长时间运行的maxwell，添加monitor配置，maxwell提供了http api返回监控数据。</li></ul></blockquote><blockquote><p>其它</p><ul><li>init_position<br>手动指定maxwell要从哪个binlog，哪个位置开始。指定的格式FILE:POSITION:HEARTBEAT。只支持在启动maxwell的命令指定，比如 –init_postion=mysql-bin.0000456:4:0。<br>maxwell 默认从连接上mysql server的当前位置开始解析，如果指定 init_postion，要确保文件确实存在，如果binlog已经被purge掉了，可能需要想其它办法。见 Binlog可视化搜索：实现类似阿里RDS数据追踪功能</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Maxwell配置详解&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="maxwell" scheme="https://zixujing.github.io/tags/maxwell/"/>
    
  </entry>
  
  <entry>
    <title>maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum</title>
    <link href="https://zixujing.github.io/2019/05/29/bigdata/maxwell+bireme+kafka+greenplum%E5%A2%9E%E9%87%8F%E6%8A%BD%E5%8F%96%E6%95%B0%E6%8D%AE%E5%88%B0greenplum/"/>
    <id>https://zixujing.github.io/2019/05/29/bigdata/maxwell+bireme+kafka+greenplum增量抽取数据到greenplum/</id>
    <published>2019-05-28T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum<br><a id="more"></a></p></blockquote><h2 id="Maxwell-数据源"><a href="#Maxwell-数据源" class="headerlink" title="Maxwell 数据源"></a>Maxwell 数据源</h2><h3 id="配置mysql"><a href="#配置mysql" class="headerlink" title="配置mysql"></a>配置mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=master</span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">mysql -uroot -pxxxx</span><br><span class="line"></span><br><span class="line">mysql&gt; create user &apos;maxwell&apos;@&apos;%&apos; identified by &apos;maxwell&apos;;</span><br><span class="line">mysql&gt; GRANT ALL on maxwell.* to &apos;maxwell&apos;@&apos;%&apos;;</span><br><span class="line">mysql&gt; GRANT SELECT, REPLICATION CLIENT, REPLICATION SLAVE on *.* to &apos;maxwell&apos;@&apos;%&apos;;</span><br><span class="line">如果是mysql8 则执行alter user &apos;maxwell&apos;@&apos;%&apos; identified with mysql_native_password by &apos;maxwell&apos;;</span><br><span class="line">mysql&gt; CREATE DATABASE test;</span><br><span class="line">mysql&gt; create table test.test (id int primary key, name varchar(10));</span><br></pre></td></tr></table></figure><h3 id="创建kafka的topic"><a href="#创建kafka的topic" class="headerlink" title="创建kafka的topic"></a>创建kafka的topic</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --topic maxwell --zookeeper 192.168.11.97:2181 --partitions 3 --replication-factor 2</span><br><span class="line">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure><h3 id="在GreenPlum中新建表"><a href="#在GreenPlum中新建表" class="headerlink" title="在GreenPlum中新建表"></a>在GreenPlum中新建表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database maxwell;</span><br><span class="line">\c maxwell;</span><br><span class="line">create table test(id int primary key,name varchar(10));</span><br></pre></td></tr></table></figure><h3 id="启动maxwell"><a href="#启动maxwell" class="headerlink" title="启动maxwell"></a>启动maxwell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/maxwell --daemon --user=&apos;maxwell&apos; --password=&apos;maxwell&apos; --host=192.168.11.99 --include_dbs=test --include_tables=test --producer=kafka --kafka_topic=maxwell --kafka.bootstrap.servers=192.168.11.99:9092</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bin/maxwell --user=&apos;maxwell&apos; --password=&apos;maxwell&apos; --host=192.168.11.99 --producer=stdout</span><br><span class="line">查看一下</span><br><span class="line">bin/kafka-console-consumer.sh --topic maxwell --from-beginning --bootstrap-server 192.168.11.99:9092</span><br></pre></td></tr></table></figure><h3 id="maxwell配置文件配置"><a href="#maxwell配置文件配置" class="headerlink" title="maxwell配置文件配置"></a>maxwell配置文件配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi config</span><br><span class="line">user=maxwell</span><br><span class="line">password=maxwell</span><br><span class="line">host=192.168.11.113</span><br><span class="line">include_dbs=infoveriplatform_test</span><br><span class="line">include_tables=tb_car_record,tb_control_car,tb_control_person,tb_person_record,tb_key_car_record,tb_key_person_record,tb_security_clearance</span><br><span class="line">producer=kafka</span><br><span class="line">kafka_topic=maxwell</span><br><span class="line">kafka.bootstrap.servers=192.168.11.97:9092,192.168.11.98:9092,192.168.11.99:9092</span><br><span class="line">kafka_partition_hash=murmur3</span><br><span class="line">producer_partition_by=primary_key</span><br><span class="line"></span><br><span class="line">./maxwell --daemon --config=config</span><br></pre></td></tr></table></figure><h3 id="关于XA问题解决"><a href="#关于XA问题解决" class="headerlink" title="关于XA问题解决"></a>关于XA问题解决</h3><p> I don’t know whether to add this code in com.zendesk.maxwell.schema.ddl.SchemaChange.java is best way to solve this problem,but can start maxwell normally.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL_BLACKLIST.add(Pattern.compile(&quot;\\s*XA\\s+&quot;, Pattern.CASE_INSENSITIVE | Pattern.MULTILINE));</span><br></pre></td></tr></table></figure></p><h2 id="bireme-配置及启动"><a href="#bireme-配置及启动" class="headerlink" title="bireme 配置及启动"></a>bireme 配置及启动</h2><blockquote><p>使用bireme-2.0.0-alpha-1比bireme-1.0.0会好一点</p></blockquote><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd </span><br><span class="line">vi `pwd`/etc/config.properties</span><br><span class="line">target.url = jdbc:postgresql://192.168.11.84:5432/maxwell</span><br><span class="line">target.user = gpadmin</span><br><span class="line">target.passwd = gpadmin</span><br><span class="line"></span><br><span class="line">data_source = mysql</span><br><span class="line">mysql.type = maxwell</span><br><span class="line">mysql.kafka.server = 192.168.11.99:9092</span><br><span class="line">mysql.kafka.topic = maxwell</span><br><span class="line">state.server.addr = 192.168.11.111</span><br><span class="line"></span><br><span class="line"> vi `pwd`/etc/mysql.properties</span><br><span class="line">test.test=public.test</span><br></pre></td></tr></table></figure><p>###启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要关联软件apache-commons-daemon-jsvc-1.0.13-7.el7.x86_64</span><br><span class="line">bin/bireme start</span><br></pre></td></tr></table></figure><p>###结束<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/bireme stop</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;maxwell+bireme+kafka+greenplum  mysql增量数据抽取到greenplum&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="maxwell bireme" scheme="https://zixujing.github.io/tags/maxwell-bireme/"/>
    
  </entry>
  
  <entry>
    <title>kafka的SASL配置</title>
    <link href="https://zixujing.github.io/2019/05/27/bigdata/kafka%E7%9A%84SASL%E9%85%8D%E7%BD%AE/"/>
    <id>https://zixujing.github.io/2019/05/27/bigdata/kafka的SASL配置/</id>
    <published>2019-05-26T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>kafka的SASL配置<br><a id="more"></a></p></blockquote><h2 id="server-properties的配置"><a href="#server-properties的配置" class="headerlink" title="server.properties的配置"></a>server.properties的配置</h2><blockquote><p>可以重新制定一个配置文件如server_sasl.properties<br>到kafka的config文件加下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">listeners=SASL_PLAINTEXT://xx.xx.xx.xx:8123</span><br><span class="line">security.inter.broker.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.enabled.mechanisms=PLAIN</span><br><span class="line">sasl.mechanism.inter.broker.protocol=PLAIN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">touch kafka_server_jaas.conf</span><br><span class="line">vi kafka_server_jaas.conf</span><br><span class="line">KafkaServer &#123;</span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    username=&quot;kafka&quot;#这个帐号是下面配置的</span><br><span class="line">    password=&quot;password&quot;#这个密码是下面配置的</span><br><span class="line">    user_kafka=&quot;password&quot;</span><br><span class="line">    user_mooc=&quot;mooc&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">touch kafka_client_jaas.conf</span><br><span class="line">vi kafka_client_jaas.conf</span><br><span class="line"></span><br><span class="line">KafkaClient &#123;</span><br><span class="line">        org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">        username=&quot;mooc&quot;</span><br><span class="line">        password=&quot;mooc&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="命令文件的配置"><a href="#命令文件的配置" class="headerlink" title="命令文件的配置"></a>命令文件的配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd ../bin</span><br><span class="line">vi kafka-server-start.sh</span><br><span class="line">if [ &quot;x$KAFKA_OPTS&quot; = &quot;x&quot; ]; then</span><br><span class="line">    export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/usr/local/kafka_2.12-2.1.1/config/kafka_server_jaas.conf&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi kafka-console-producer.sh</span><br><span class="line">vi kafka-console-consumer.sh</span><br><span class="line">if [ &quot;x$KAFKA_OPTS&quot; = &quot;x&quot; ]; then</span><br><span class="line">    export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/usr/local/kafka_2.12-2.1.1/config/kafka_client_jaas.conf&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-server-start.sh -daemon ../config/server.properties</span><br></pre></td></tr></table></figure><h2 id="其他相关脚本"><a href="#其他相关脚本" class="headerlink" title="其他相关脚本"></a>其他相关脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./kafka-topics.sh  --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line">./kafka-topics.sh  --zookeeper localhost:2181 --create --topic Test  --partitions 1 --replication-factor 1</span><br><span class="line"></span><br><span class="line">./kafka-console-producer.sh --broker-list 192.168.11.99:9092 --topic test --producer-property security.protocol=SASL_PLAINTEXT --producer-property sasl.mechanism=PLAIN</span><br><span class="line"></span><br><span class="line">./kafka-console-consumer.sh --bootstrap-server 192.168.11.99:9092 --from-beginning --topic test --consumer-property security.protocol=SASL_PLAINTEXT --consumer-property sasl.mechanism=PLAIN</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;kafka的SASL配置&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="kafka" scheme="https://zixujing.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>区块链数据库chainsql调研总结</title>
    <link href="https://zixujing.github.io/2019/05/17/db/mysql/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%95%B0%E6%8D%AE%E5%BA%93chainsql%E8%B0%83%E7%A0%94%E6%80%BB%E7%BB%93/"/>
    <id>https://zixujing.github.io/2019/05/17/db/mysql/区块链数据库chainsql调研总结/</id>
    <published>2019-05-16T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>区块链数据库chainsql调研总结<br><a id="more"></a></p></blockquote><h2 id="ChainSQL网络搭建"><a href="#ChainSQL网络搭建" class="headerlink" title="ChainSQL网络搭建"></a>ChainSQL网络搭建</h2><h3 id="安装mysql并配置"><a href="#安装mysql并配置" class="headerlink" title="安装mysql并配置"></a>安装mysql并配置</h3><p>  查阅mysql安装文档<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS chainsql DEFAULT CHARSET utf8;</span><br><span class="line">配置文件加入</span><br><span class="line">character_set_server = utf8</span><br><span class="line">max_connections=10000</span><br></pre></td></tr></table></figure></p><h3 id="验证结点搭建"><a href="#验证结点搭建" class="headerlink" title="验证结点搭建"></a>验证结点搭建</h3><h4 id="验证节点公私钥的生成"><a href="#验证节点公私钥的生成" class="headerlink" title="验证节点公私钥的生成"></a>验证节点公私钥的生成</h4><p>多个验证结点重复一下步骤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chainsqld_classic.exe validation_create</span><br></pre></td></tr></table></figure></p><blockquote><p>在0.30.3版本之前，执行这一命令要提前启动chainsqld进程，是因为下面的validation_create命令要向进程发送rpc请求，如果进程启动不成功，命令会返回错误。0.30.3及之后的版本可以不启动chainsqld程序直接返回结果。</p></blockquote><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>为方便把所有的配置都写下面<br>节点1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">############################################################################################</span><br><span class="line">###</span><br><span class="line">### 这是一个单点启动的配置文件（自己作为验证节点），只做测试使用，真正运行时不会使用单点验证</span><br><span class="line">### 查看具体配置说明请看https://github.com/ChainSQL/chainsqld/blob/master/doc/chainsqld-example.cfg</span><br><span class="line">### 及 https://github.com/ChainSQL/chainsqld/blob/master/doc/ChainSQLDesign.md</span><br><span class="line">###</span><br><span class="line">############################################################################################</span><br><span class="line"></span><br><span class="line">#端口配置列表</span><br><span class="line">[server]</span><br><span class="line">port_rpc_admin_local</span><br><span class="line">port_peer</span><br><span class="line">port_ws_admin_local</span><br><span class="line"></span><br><span class="line">#http端口配置</span><br><span class="line">[port_rpc_admin_local]</span><br><span class="line">port = 5006</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = http</span><br><span class="line"></span><br><span class="line">#peer端口配置，用于p2p节点发现</span><br><span class="line">[port_peer]</span><br><span class="line">port = 5126</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">protocol = peer</span><br><span class="line"></span><br><span class="line">#websocket端口配置</span><br><span class="line">[port_ws_admin_local]</span><br><span class="line">port = 6006</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = ws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[node_size]</span><br><span class="line">medium</span><br><span class="line"></span><br><span class="line"># This is primary persistent datastore for rippled.  This includes transaction</span><br><span class="line"># metadata, account states, and ledger headers.  Helpful information can be</span><br><span class="line"># found here: https://ripple.com/wiki/NodeBackEnd</span><br><span class="line"># delete old ledgers while maintaining at least 2000. Do not require an</span><br><span class="line"># external administrative command to initiate deletion.</span><br><span class="line"># 区块数据存储配置，windows下用NuDB,Linux/Mac下用RocksDB</span><br><span class="line">[node_db]</span><br><span class="line">type=NuDB</span><br><span class="line">path=./NuDB</span><br><span class="line">open_files=2000</span><br><span class="line">filter_bits=12</span><br><span class="line">cache_mb=256</span><br><span class="line">file_size_mb=8</span><br><span class="line">file_size_mult=2</span><br><span class="line"></span><br><span class="line">#是否全节点</span><br><span class="line">[ledger_history]</span><br><span class="line">full</span><br><span class="line"></span><br><span class="line">#sqlite数据库（存储区块头数据，交易概要数据）</span><br><span class="line">[database_path]</span><br><span class="line">./db</span><br><span class="line"></span><br><span class="line"># This needs to be an absolute directory reference, not a relative one.</span><br><span class="line"># Modify this value as required.</span><br><span class="line">[debug_logfile]</span><br><span class="line">./debug.log</span><br><span class="line"></span><br><span class="line">#时间服务器，用于不同节点单时间同步</span><br><span class="line">[sntp_servers]</span><br><span class="line">time.windows.com</span><br><span class="line">time.apple.com</span><br><span class="line">time.nist.gov</span><br><span class="line">pool.ntp.org</span><br><span class="line"></span><br><span class="line"># Where to find some other servers speaking the Ripple protocol.</span><br><span class="line"># 2016-12-15 15:00:00</span><br><span class="line"># 要连接的其它节点的Ip及端口</span><br><span class="line">[ips]</span><br><span class="line">127.0.0.1 5127</span><br><span class="line">127.0.0.1 5128</span><br><span class="line">127.0.0.1 5129</span><br><span class="line"></span><br><span class="line"># Public keys of the validators that this rippled instance trusts.</span><br><span class="line"># 信任节点列表（信任节点的公钥列表）</span><br><span class="line">[validators]</span><br><span class="line">n9LePgsBc7e3BNDdKESk9vppBD2fTNtwerfbqL5fB2MmkahirRNN</span><br><span class="line">n9LDnydvRMR1sbGDyMHaSU7QHhVCesJtDjGDNxQv3chmXsBJYfY4</span><br><span class="line">n9K8YTeGvm6u6As7JRBzomCtG7LNPxz9vmPpSrnCLnJEJ3u4nYHu</span><br><span class="line"></span><br><span class="line"># 本节点私钥（如不配置，不参与共识）</span><br><span class="line">[validation_seed]</span><br><span class="line">xnKPgGfu1FkvVbBR8CXBpmVNEXvPi</span><br><span class="line"></span><br><span class="line"># 本节点公钥</span><br><span class="line">[validation_public_key]</span><br><span class="line">n9KrVLNS8sBgaVLHZiciUeWUuKH9Q8RoLf2bNGRLdLJeuNn338yH</span><br><span class="line"></span><br><span class="line"># Turn down default logging to save disk space in the long run.</span><br><span class="line">#Valid values here are trace, debug, info, warning, error, and fatal</span><br><span class="line">#日志级别，一般设置为warning级别</span><br><span class="line">[rpc_startup]</span><br><span class="line">&#123; &quot;command&quot;: &quot;log_level&quot;, &quot;severity&quot;: &quot;warning&quot; &#125;</span><br><span class="line"></span><br><span class="line"># If ssl_verify is 1, certificates will be validated.</span><br><span class="line"># To allow the use of self-signed certificates for development or internal use,</span><br><span class="line"># set to ssl_verify to 0.</span><br><span class="line">[ssl_verify]</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">#禁用某些支持但未不需要启用的特性,(开启会影响稳定性)</span><br><span class="line">[veto_amendments]</span><br><span class="line">42EEA5E28A97824821D4EF97081FE36A54E9593C6E4F20CBAE098C69D2E072DC fix1373</span><br><span class="line">740352F2412A9909880C23A559FCECEDA3BE2126FED62FC7660D628A06927F11 Flow</span><br><span class="line">E2E6F2866106419B88C50045ACE96368558C345566AC8F2BDF5A5B5587F0E6FA fix1368</span><br><span class="line">C6970A8B603D8778783B61C0D445C23D1633CCFAEF0D43E7DBCD1521D34BD7C3 SHAMapV2</span><br><span class="line">C1B8D934087225F509BEB5A8EC24447854713EE447D277F69545ABFA0E0FD490 Tickets</span><br><span class="line">86E83A7D2ECE3AD5FA87AB2195AE015C950469ABF0B72EAACED318F74886AE90 CryptoConditionsSuite</span><br><span class="line">1562511F573A19AE9BD103B5D6B9E01B3B46805AEC5D3C4805C902B514399146 CryptoConditions</span><br><span class="line">3012E8230864E95A58C60FD61430D7E1B4D3353195F2981DC12B0C7C0950FFAC FlowCross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#chainsql数据库配置，根据自己的机子</span><br><span class="line">[sync_db]</span><br><span class="line">type=mysql</span><br><span class="line">host=192.168.106.174</span><br><span class="line">port=3306</span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line">db=chainsqla</span><br><span class="line">first_storage=0</span><br><span class="line">charset=utf8</span><br><span class="line"></span><br><span class="line"># 开户自动同步后，节点运行情况下会去自动同步新建的表，开启这个开关，或者使用sync_tables标签的配置，否则无法同步表</span><br><span class="line">[auto_sync]</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p><p>节点2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">############################################################################################</span><br><span class="line">###</span><br><span class="line">### 这是一个单点启动的配置文件（自己作为验证节点），只做测试使用，真正运行时不会使用单点验证</span><br><span class="line">### 查看具体配置说明请看https://github.com/ChainSQL/chainsqld/blob/master/doc/chainsqld-example.cfg</span><br><span class="line">### 及 https://github.com/ChainSQL/chainsqld/blob/master/doc/ChainSQLDesign.md</span><br><span class="line">###</span><br><span class="line">############################################################################################</span><br><span class="line"></span><br><span class="line">#端口配置列表</span><br><span class="line">[server]</span><br><span class="line">port_rpc_admin_local</span><br><span class="line">port_peer</span><br><span class="line">port_ws_admin_local</span><br><span class="line"></span><br><span class="line">#http端口配置</span><br><span class="line">[port_rpc_admin_local]</span><br><span class="line">port = 5007</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = http</span><br><span class="line"></span><br><span class="line">#peer端口配置，用于p2p节点发现</span><br><span class="line">[port_peer]</span><br><span class="line">port = 5127</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">protocol = peer</span><br><span class="line"></span><br><span class="line">#websocket端口配置</span><br><span class="line">[port_ws_admin_local]</span><br><span class="line">port = 6007</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = ws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[node_size]</span><br><span class="line">medium</span><br><span class="line"></span><br><span class="line"># This is primary persistent datastore for rippled.  This includes transaction</span><br><span class="line"># metadata, account states, and ledger headers.  Helpful information can be</span><br><span class="line"># found here: https://ripple.com/wiki/NodeBackEnd</span><br><span class="line"># delete old ledgers while maintaining at least 2000. Do not require an</span><br><span class="line"># external administrative command to initiate deletion.</span><br><span class="line"># 区块数据存储配置，windows下用NuDB,Linux/Mac下用RocksDB</span><br><span class="line">[node_db]</span><br><span class="line">type=NuDB</span><br><span class="line">path=./NuDB</span><br><span class="line">open_files=2000</span><br><span class="line">filter_bits=12</span><br><span class="line">cache_mb=256</span><br><span class="line">file_size_mb=8</span><br><span class="line">file_size_mult=2</span><br><span class="line"></span><br><span class="line">#是否全节点</span><br><span class="line">[ledger_history]</span><br><span class="line">full</span><br><span class="line"></span><br><span class="line">#sqlite数据库（存储区块头数据，交易概要数据）</span><br><span class="line">[database_path]</span><br><span class="line">./db</span><br><span class="line"></span><br><span class="line"># This needs to be an absolute directory reference, not a relative one.</span><br><span class="line"># Modify this value as required.</span><br><span class="line">[debug_logfile]</span><br><span class="line">./debug.log</span><br><span class="line"></span><br><span class="line">#时间服务器，用于不同节点单时间同步</span><br><span class="line">[sntp_servers]</span><br><span class="line">time.windows.com</span><br><span class="line">time.apple.com</span><br><span class="line">time.nist.gov</span><br><span class="line">pool.ntp.org</span><br><span class="line"></span><br><span class="line"># Where to find some other servers speaking the Ripple protocol.</span><br><span class="line"># 2016-12-15 15:00:00</span><br><span class="line"># 要连接的其它节点的Ip及端口</span><br><span class="line">[ips]</span><br><span class="line">127.0.0.1 5126</span><br><span class="line">127.0.0.1 5128</span><br><span class="line">127.0.0.1 5129</span><br><span class="line"></span><br><span class="line"># Public keys of the validators that this rippled instance trusts.</span><br><span class="line"># 信任节点列表（信任节点的公钥列表）</span><br><span class="line">[validators]</span><br><span class="line">n9KrVLNS8sBgaVLHZiciUeWUuKH9Q8RoLf2bNGRLdLJeuNn338yH</span><br><span class="line">n9LDnydvRMR1sbGDyMHaSU7QHhVCesJtDjGDNxQv3chmXsBJYfY4</span><br><span class="line">n9K8YTeGvm6u6As7JRBzomCtG7LNPxz9vmPpSrnCLnJEJ3u4nYHu</span><br><span class="line"></span><br><span class="line"># 本节点私钥（如不配置，不参与共识）</span><br><span class="line">[validation_seed]</span><br><span class="line">xxEEippTRiy9MxaUU7yhKY2SXsCCr</span><br><span class="line"></span><br><span class="line"># 本节点公钥</span><br><span class="line">[validation_public_key]</span><br><span class="line">n9LePgsBc7e3BNDdKESk9vppBD2fTNtwerfbqL5fB2MmkahirRNN</span><br><span class="line"></span><br><span class="line"># Turn down default logging to save disk space in the long run.</span><br><span class="line">#Valid values here are trace, debug, info, warning, error, and fatal</span><br><span class="line">#日志级别，一般设置为warning级别</span><br><span class="line">[rpc_startup]</span><br><span class="line">&#123; &quot;command&quot;: &quot;log_level&quot;, &quot;severity&quot;: &quot;warning&quot; &#125;</span><br><span class="line"></span><br><span class="line"># If ssl_verify is 1, certificates will be validated.</span><br><span class="line"># To allow the use of self-signed certificates for development or internal use,</span><br><span class="line"># set to ssl_verify to 0.</span><br><span class="line">[ssl_verify]</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">#禁用某些支持但未不需要启用的特性,(开启会影响稳定性)</span><br><span class="line">[veto_amendments]</span><br><span class="line">42EEA5E28A97824821D4EF97081FE36A54E9593C6E4F20CBAE098C69D2E072DC fix1373</span><br><span class="line">740352F2412A9909880C23A559FCECEDA3BE2126FED62FC7660D628A06927F11 Flow</span><br><span class="line">E2E6F2866106419B88C50045ACE96368558C345566AC8F2BDF5A5B5587F0E6FA fix1368</span><br><span class="line">C6970A8B603D8778783B61C0D445C23D1633CCFAEF0D43E7DBCD1521D34BD7C3 SHAMapV2</span><br><span class="line">C1B8D934087225F509BEB5A8EC24447854713EE447D277F69545ABFA0E0FD490 Tickets</span><br><span class="line">86E83A7D2ECE3AD5FA87AB2195AE015C950469ABF0B72EAACED318F74886AE90 CryptoConditionsSuite</span><br><span class="line">1562511F573A19AE9BD103B5D6B9E01B3B46805AEC5D3C4805C902B514399146 CryptoConditions</span><br><span class="line">3012E8230864E95A58C60FD61430D7E1B4D3353195F2981DC12B0C7C0950FFAC FlowCross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#chainsql数据库配置，根据自己的机子</span><br><span class="line">[sync_db]</span><br><span class="line">type=mysql</span><br><span class="line">host=192.168.106.174</span><br><span class="line">port=3306</span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line">db=chainsqlb</span><br><span class="line">first_storage=0</span><br><span class="line">charset=utf8</span><br><span class="line"></span><br><span class="line"># 开户自动同步后，节点运行情况下会去自动同步新建的表，开启这个开关，或者使用sync_tables标签的配置，否则无法同步表</span><br><span class="line">[auto_sync]</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p><p>节点3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">############################################################################################</span><br><span class="line">###</span><br><span class="line">### 这是一个单点启动的配置文件（自己作为验证节点），只做测试使用，真正运行时不会使用单点验证</span><br><span class="line">### 查看具体配置说明请看https://github.com/ChainSQL/chainsqld/blob/master/doc/chainsqld-example.cfg</span><br><span class="line">### 及 https://github.com/ChainSQL/chainsqld/blob/master/doc/ChainSQLDesign.md</span><br><span class="line">###</span><br><span class="line">############################################################################################</span><br><span class="line"></span><br><span class="line">#端口配置列表</span><br><span class="line">[server]</span><br><span class="line">port_rpc_admin_local</span><br><span class="line">port_peer</span><br><span class="line">port_ws_admin_local</span><br><span class="line"></span><br><span class="line">#http端口配置</span><br><span class="line">[port_rpc_admin_local]</span><br><span class="line">port = 5008</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = http</span><br><span class="line"></span><br><span class="line">#peer端口配置，用于p2p节点发现</span><br><span class="line">[port_peer]</span><br><span class="line">port = 5128</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">protocol = peer</span><br><span class="line"></span><br><span class="line">#websocket端口配置</span><br><span class="line">[port_ws_admin_local]</span><br><span class="line">port = 6008</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = ws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[node_size]</span><br><span class="line">medium</span><br><span class="line"></span><br><span class="line"># This is primary persistent datastore for rippled.  This includes transaction</span><br><span class="line"># metadata, account states, and ledger headers.  Helpful information can be</span><br><span class="line"># found here: https://ripple.com/wiki/NodeBackEnd</span><br><span class="line"># delete old ledgers while maintaining at least 2000. Do not require an</span><br><span class="line"># external administrative command to initiate deletion.</span><br><span class="line"># 区块数据存储配置，windows下用NuDB,Linux/Mac下用RocksDB</span><br><span class="line">[node_db]</span><br><span class="line">type=NuDB</span><br><span class="line">path=./NuDB</span><br><span class="line">open_files=2000</span><br><span class="line">filter_bits=12</span><br><span class="line">cache_mb=256</span><br><span class="line">file_size_mb=8</span><br><span class="line">file_size_mult=2</span><br><span class="line"></span><br><span class="line">#是否全节点</span><br><span class="line">[ledger_history]</span><br><span class="line">full</span><br><span class="line"></span><br><span class="line">#sqlite数据库（存储区块头数据，交易概要数据）</span><br><span class="line">[database_path]</span><br><span class="line">./db</span><br><span class="line"></span><br><span class="line"># This needs to be an absolute directory reference, not a relative one.</span><br><span class="line"># Modify this value as required.</span><br><span class="line">[debug_logfile]</span><br><span class="line">./debug.log</span><br><span class="line"></span><br><span class="line">#时间服务器，用于不同节点单时间同步</span><br><span class="line">[sntp_servers]</span><br><span class="line">time.windows.com</span><br><span class="line">time.apple.com</span><br><span class="line">time.nist.gov</span><br><span class="line">pool.ntp.org</span><br><span class="line"></span><br><span class="line"># Where to find some other servers speaking the Ripple protocol.</span><br><span class="line"># 2016-12-15 15:00:00</span><br><span class="line"># 要连接的其它节点的Ip及端口</span><br><span class="line">[ips]</span><br><span class="line">127.0.0.1 5126</span><br><span class="line">127.0.0.1 5127</span><br><span class="line">127.0.0.1 5129</span><br><span class="line"></span><br><span class="line"># Public keys of the validators that this rippled instance trusts.</span><br><span class="line"># 信任节点列表（信任节点的公钥列表）</span><br><span class="line">[validators]</span><br><span class="line">n9KrVLNS8sBgaVLHZiciUeWUuKH9Q8RoLf2bNGRLdLJeuNn338yH</span><br><span class="line">n9LePgsBc7e3BNDdKESk9vppBD2fTNtwerfbqL5fB2MmkahirRNN</span><br><span class="line">n9K8YTeGvm6u6As7JRBzomCtG7LNPxz9vmPpSrnCLnJEJ3u4nYHu</span><br><span class="line"></span><br><span class="line"># 本节点私钥（如不配置，不参与共识）</span><br><span class="line">[validation_seed]</span><br><span class="line">xxbF6YeFdqYHVcqpErZZvFHayzytc</span><br><span class="line"></span><br><span class="line"># 本节点公钥</span><br><span class="line">[validation_public_key]</span><br><span class="line">n9LDnydvRMR1sbGDyMHaSU7QHhVCesJtDjGDNxQv3chmXsBJYfY4</span><br><span class="line"></span><br><span class="line"># Turn down default logging to save disk space in the long run.</span><br><span class="line">#Valid values here are trace, debug, info, warning, error, and fatal</span><br><span class="line">#日志级别，一般设置为warning级别</span><br><span class="line">[rpc_startup]</span><br><span class="line">&#123; &quot;command&quot;: &quot;log_level&quot;, &quot;severity&quot;: &quot;warning&quot; &#125;</span><br><span class="line"></span><br><span class="line"># If ssl_verify is 1, certificates will be validated.</span><br><span class="line"># To allow the use of self-signed certificates for development or internal use,</span><br><span class="line"># set to ssl_verify to 0.</span><br><span class="line">[ssl_verify]</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">#禁用某些支持但未不需要启用的特性,(开启会影响稳定性)</span><br><span class="line">[veto_amendments]</span><br><span class="line">42EEA5E28A97824821D4EF97081FE36A54E9593C6E4F20CBAE098C69D2E072DC fix1373</span><br><span class="line">740352F2412A9909880C23A559FCECEDA3BE2126FED62FC7660D628A06927F11 Flow</span><br><span class="line">E2E6F2866106419B88C50045ACE96368558C345566AC8F2BDF5A5B5587F0E6FA fix1368</span><br><span class="line">C6970A8B603D8778783B61C0D445C23D1633CCFAEF0D43E7DBCD1521D34BD7C3 SHAMapV2</span><br><span class="line">C1B8D934087225F509BEB5A8EC24447854713EE447D277F69545ABFA0E0FD490 Tickets</span><br><span class="line">86E83A7D2ECE3AD5FA87AB2195AE015C950469ABF0B72EAACED318F74886AE90 CryptoConditionsSuite</span><br><span class="line">1562511F573A19AE9BD103B5D6B9E01B3B46805AEC5D3C4805C902B514399146 CryptoConditions</span><br><span class="line">3012E8230864E95A58C60FD61430D7E1B4D3353195F2981DC12B0C7C0950FFAC FlowCross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#chainsql数据库配置，根据自己的机子</span><br><span class="line">[sync_db]</span><br><span class="line">type=mysql</span><br><span class="line">host=192.168.106.174</span><br><span class="line">port=3306</span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line">db=chainsqlc</span><br><span class="line">first_storage=0</span><br><span class="line">charset=utf8</span><br><span class="line"></span><br><span class="line"># 开户自动同步后，节点运行情况下会去自动同步新建的表，开启这个开关，或者使用sync_tables标签的配置，否则无法同步表</span><br><span class="line">[auto_sync]</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p><p>节点4<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">############################################################################################</span><br><span class="line">###</span><br><span class="line">### 这是一个单点启动的配置文件（自己作为验证节点），只做测试使用，真正运行时不会使用单点验证</span><br><span class="line">### 查看具体配置说明请看https://github.com/ChainSQL/chainsqld/blob/master/doc/chainsqld-example.cfg</span><br><span class="line">### 及 https://github.com/ChainSQL/chainsqld/blob/master/doc/ChainSQLDesign.md</span><br><span class="line">###</span><br><span class="line">############################################################################################</span><br><span class="line"></span><br><span class="line">#端口配置列表</span><br><span class="line">[server]</span><br><span class="line">port_rpc_admin_local</span><br><span class="line">port_peer</span><br><span class="line">port_ws_admin_local</span><br><span class="line"></span><br><span class="line">#http端口配置</span><br><span class="line">[port_rpc_admin_local]</span><br><span class="line">port = 5009</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = http</span><br><span class="line"></span><br><span class="line">#peer端口配置，用于p2p节点发现</span><br><span class="line">[port_peer]</span><br><span class="line">port = 5129</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">protocol = peer</span><br><span class="line"></span><br><span class="line">#websocket端口配置</span><br><span class="line">[port_ws_admin_local]</span><br><span class="line">port = 6009</span><br><span class="line">ip = 0.0.0.0</span><br><span class="line">admin = 127.0.0.1</span><br><span class="line">protocol = ws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[node_size]</span><br><span class="line">medium</span><br><span class="line"></span><br><span class="line"># This is primary persistent datastore for rippled.  This includes transaction</span><br><span class="line"># metadata, account states, and ledger headers.  Helpful information can be</span><br><span class="line"># found here: https://ripple.com/wiki/NodeBackEnd</span><br><span class="line"># delete old ledgers while maintaining at least 2000. Do not require an</span><br><span class="line"># external administrative command to initiate deletion.</span><br><span class="line"># 区块数据存储配置，windows下用NuDB,Linux/Mac下用RocksDB</span><br><span class="line">[node_db]</span><br><span class="line">type=NuDB</span><br><span class="line">path=./NuDB</span><br><span class="line">open_files=2000</span><br><span class="line">filter_bits=12</span><br><span class="line">cache_mb=256</span><br><span class="line">file_size_mb=8</span><br><span class="line">file_size_mult=2</span><br><span class="line"></span><br><span class="line">#是否全节点</span><br><span class="line">[ledger_history]</span><br><span class="line">full</span><br><span class="line"></span><br><span class="line">#sqlite数据库（存储区块头数据，交易概要数据）</span><br><span class="line">[database_path]</span><br><span class="line">./db</span><br><span class="line"></span><br><span class="line"># This needs to be an absolute directory reference, not a relative one.</span><br><span class="line"># Modify this value as required.</span><br><span class="line">[debug_logfile]</span><br><span class="line">./debug.log</span><br><span class="line"></span><br><span class="line">#时间服务器，用于不同节点单时间同步</span><br><span class="line">[sntp_servers]</span><br><span class="line">time.windows.com</span><br><span class="line">time.apple.com</span><br><span class="line">time.nist.gov</span><br><span class="line">pool.ntp.org</span><br><span class="line"></span><br><span class="line"># Where to find some other servers speaking the Ripple protocol.</span><br><span class="line"># 2016-12-15 15:00:00</span><br><span class="line"># 要连接的其它节点的Ip及端口</span><br><span class="line">[ips]</span><br><span class="line">127.0.0.1 5126</span><br><span class="line">127.0.0.1 5127</span><br><span class="line">127.0.0.1 5128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Public keys of the validators that this rippled instance trusts.</span><br><span class="line"># 信任节点列表（信任节点的公钥列表）</span><br><span class="line">[validators]</span><br><span class="line">n9KrVLNS8sBgaVLHZiciUeWUuKH9Q8RoLf2bNGRLdLJeuNn338yH</span><br><span class="line">n9LePgsBc7e3BNDdKESk9vppBD2fTNtwerfbqL5fB2MmkahirRNN</span><br><span class="line">n9LDnydvRMR1sbGDyMHaSU7QHhVCesJtDjGDNxQv3chmXsBJYfY4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 本节点私钥（如不配置，不参与共识）</span><br><span class="line">[validation_seed]</span><br><span class="line">xx98vyzwAXBkRijuxMAKeegh2CAa4</span><br><span class="line"></span><br><span class="line"># 本节点公钥</span><br><span class="line">[validation_public_key]</span><br><span class="line">n9K8YTeGvm6u6As7JRBzomCtG7LNPxz9vmPpSrnCLnJEJ3u4nYHu</span><br><span class="line"></span><br><span class="line"># Turn down default logging to save disk space in the long run.</span><br><span class="line">#Valid values here are trace, debug, info, warning, error, and fatal</span><br><span class="line">#日志级别，一般设置为warning级别</span><br><span class="line">[rpc_startup]</span><br><span class="line">&#123; &quot;command&quot;: &quot;log_level&quot;, &quot;severity&quot;: &quot;warning&quot; &#125;</span><br><span class="line"></span><br><span class="line"># If ssl_verify is 1, certificates will be validated.</span><br><span class="line"># To allow the use of self-signed certificates for development or internal use,</span><br><span class="line"># set to ssl_verify to 0.</span><br><span class="line">[ssl_verify]</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">#禁用某些支持但未不需要启用的特性,(开启会影响稳定性)</span><br><span class="line">[veto_amendments]</span><br><span class="line">42EEA5E28A97824821D4EF97081FE36A54E9593C6E4F20CBAE098C69D2E072DC fix1373</span><br><span class="line">740352F2412A9909880C23A559FCECEDA3BE2126FED62FC7660D628A06927F11 Flow</span><br><span class="line">E2E6F2866106419B88C50045ACE96368558C345566AC8F2BDF5A5B5587F0E6FA fix1368</span><br><span class="line">C6970A8B603D8778783B61C0D445C23D1633CCFAEF0D43E7DBCD1521D34BD7C3 SHAMapV2</span><br><span class="line">C1B8D934087225F509BEB5A8EC24447854713EE447D277F69545ABFA0E0FD490 Tickets</span><br><span class="line">86E83A7D2ECE3AD5FA87AB2195AE015C950469ABF0B72EAACED318F74886AE90 CryptoConditionsSuite</span><br><span class="line">1562511F573A19AE9BD103B5D6B9E01B3B46805AEC5D3C4805C902B514399146 CryptoConditions</span><br><span class="line">3012E8230864E95A58C60FD61430D7E1B4D3353195F2981DC12B0C7C0950FFAC FlowCross</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#chainsql数据库配置，根据自己的机子</span><br><span class="line">[sync_db]</span><br><span class="line">type=mysql</span><br><span class="line">host=192.168.106.174</span><br><span class="line">port=3306</span><br><span class="line">user=root</span><br><span class="line">pass=123456</span><br><span class="line">db=chainsqld</span><br><span class="line">first_storage=0</span><br><span class="line">charset=utf8</span><br><span class="line"></span><br><span class="line"># 开户自动同步后，节点运行情况下会去自动同步新建的表，开启这个开关，或者使用sync_tables标签的配置，否则无法同步表</span><br><span class="line">[auto_sync]</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chainsqld_classic.exe</span><br><span class="line">#如果想要加载之前的区块链数据启动，在某一全节点下执行下面的</span><br><span class="line">chainsqld_classic.exe --load</span><br></pre></td></tr></table></figure><h3 id="java操作"><a href="#java操作" class="headerlink" title="java操作"></a>java操作</h3><p><a href="https://raw.githubusercontent.com/zixujing/book1.github.io/master/code/libs.zip" target="_blank" rel="noopener">ChainSql驱动</a><br><a href="https://raw.githubusercontent.com/zixujing/book1.github.io/master/code/chainsql.rar" target="_blank" rel="noopener">java例子</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;区块链数据库chainsql调研总结&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql chainsql" scheme="https://zixujing.github.io/tags/mysql-chainsql/"/>
    
  </entry>
  
  <entry>
    <title>Spark的资源管理和YARN的App模型</title>
    <link href="https://zixujing.github.io/2019/05/13/bigdata/Spark%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8CYARN%E7%9A%84App%E6%A8%A1%E5%9E%8B/"/>
    <id>https://zixujing.github.io/2019/05/13/bigdata/Spark的资源管理和YARN的App模型/</id>
    <published>2019-05-12T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Spark的资源管理和YARN的App模型<br><a id="more"></a></p></blockquote><h2 id="一个关于在YARN下运行-Spark-和-MapReduce-如何管理资源的简单介绍"><a href="#一个关于在YARN下运行-Spark-和-MapReduce-如何管理资源的简单介绍" class="headerlink" title="一个关于在YARN下运行 Spark 和 MapReduce 如何管理资源的简单介绍"></a>一个关于在YARN下运行 Spark 和 MapReduce 如何管理资源的简单介绍</h2><p>在 YARN 上出现最多的应用除了 MapReduce 之外就是 SPARK，在 Cloudera，我们花了很大的精力在稳定 Spark-on-YARN，在 CDH 5.0.0 上添加了 Spark on YARN 集群的支持。<br>在这篇文章中，你将了解到 Spark 和 MapReduce 结构的不同，为什么你需要关心这些已经他们如何在 YARN 的 ResourceManager 上运行的。</p><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>在 MapReduce 中，最高级的计算单元是 Job。系统载入数据，对数据使用 map function，再对数据进行 shuffle，在对数据使用 reduce function，最后将数据写回磁盘。Spark 有相似的 Job 的概念（只是在每个 Job 中相比 map 和 reduce 包含更多的 stage），但是它有一个更加高级的概念，叫做 应用（application)，应用可以以并行或者串行的方式同时运行多个 Job。<br>熟悉 Spark API的用户知道，一个 应用 对于一个 SparkContext 的实例。一个 应用 可以用于单个 Job，或者分开的多个 Job 的 session，或者响应请求的长时间生存的服务器。与 MapReduce 不同的是，一个 应用 的进程（我们称之为 Executor)，会一直在集群上运行，即时当时没有 Job 在上面运行。这样实现的目的在于支持在内存中保持数据用于快速访问和闪电般的 task 启动速度。</p><h2 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h2><p>MapReduce 的每个 task 对应一个进程，当 task 结束之后，进程也随之结束。在 Spark 中很多个 task 可以在一个进程中并行地执行，而且这个进程得声明周期与整个 Spark 应用一致，即使没有任何 Job 在运行。<br>这种模型的优势在上面提到过，就是速度。每个 task 可以非常快地启动、访问内存中的数据。劣势在于粗粒度的资源管理。当一个 应用 启动时，executor 的个数已经确定了，每个 executor 分配了固定的资源，在这个 应用 的声明周期里面就一直占用着这些资源。（一旦 YARN 支持 container resizing，我们就会在 Spark 上应用它使得支持资源动态分配）。</p><h2 id="Active-Driver"><a href="#Active-Driver" class="headerlink" title="Active Driver"></a>Active Driver</h2><p>Spark 使用一个有效的 driver 进程管理 Job 的流以及调度 task。一般情况下，这个 driver 进程跟客户端进程一样用于初始化 Job，但是在 YARN 模式中，driver 进程可以在集群上运行（后面会详细介绍）。与此不同的是，即使客户端经常停止了之后 MapReduce 的 Job 可以继续执行。在 Hadoop 1.x 中， JobTracker 负责 task 的调度，在 Hadoop 2.x 中则由 application master 负责调度。</p><h2 id="可替换的资源管理"><a href="#可替换的资源管理" class="headerlink" title="可替换的资源管理"></a>可替换的资源管理</h2><p>Spark 支持可替换的集群管理，集群的管理器负责启动 executor 进程。 Spark 程序的开发人员则不需要关心自己的程序使用的是什么集群管理器。<br>Spark 支持 YARN、Mesos 以及它自带的 standalone 资源管理器。所有这三种框架都包含两个组件。一个中心的管理服务（YARN 的 ResourceManager，Mesos 的 master 以及 Spark 的 standlone master）决定哪些 应用 可以启动 executor 进程，以及在何时何处启动。一个在每个节点上运行的从服务（YARN 的 NodeManager，Mesos 的 slave 以及 Spark 的 standlone slave），它才是真正的启动 executor 进程。它也同时监控进程是否存活已经资源消耗。</p><h2 id="为什么要在-YARN-上运行"><a href="#为什么要在-YARN-上运行" class="headerlink" title="为什么要在 YARN 上运行"></a>为什么要在 YARN 上运行</h2><p>相比于在 Mesos 和 Standalone，在 YARN 运行有以下几个优势：<br>在YARN可以支持同时管理在它上面运行的不同的框架的资源，你可以先把所有的资源运行一个 MapReduce Job，然后再把一部分资源给 Impala 做查询同时另一部分给 Spark 应用，实现这些不需要更改任何配置。<br>你可以利用 YARN 调度去的所有优点用户对 应用 进行分类、隔离以及分优先级。<br>只有 YARN 为 Spark 提供了安全性。在 YARN 上，Spark 可以在 Kerberized Hadoop 集群上从而可以再进程间使用安全授权。</p><h2 id="在-YARN-上运行"><a href="#在-YARN-上运行" class="headerlink" title="在 YARN 上运行"></a>在 YARN 上运行</h2><p>当 Spark 在 YARN 上运行时，每个 executor 以 YARN 容器的方式运行。MapReduce 会为每一个 task 调度一个容器再起一个 JVM，Spark 在同一个容器中维护多个 task。这样的实现方式可以使得 task 的启动速度有量级上的提升。<br>Spark 在 YARN 上运行时支持两种方式，“yarn-cluster”模式和”yarn-client“模式。一般情况下，yarn-cluster 模式更适合线上环境，yarn-client 模式更适合用户交互和调试环境。<br>需要了解这两者之间的不同需要先理解 YARN Application master 的概念。在 YARN 中，每个 应用 都有一个 Application master 进程，这个启动这个应用的第一个容器。这个进程负责向 ResourceManager 请求资源，当资源分配完成之后，向 NodeManager 发送启动容器的指令。Application master* 避免使用需要一直运行的client。即使启动这个应用的进程退出了，任务还是会有在集群上运行的 YARN 继续执行。<br>在 yarn-cluster 模式中， driver 运行 Application master，这就意味着这个进程需要同时进程驱动应用以及从 YARN 请求资源，并且这个进程在一个 YARN 容器中运行。启动这个应用的进程并不需要在整个应用的运行周期内一直运行着。<br>然而在 yarn-cluster 模式并不适合需要交互地使用 Spark。有些 Spark 应用 需要用户的输入，比如 spark-shell 和 pyspark，需要 Spark driver 在用于初始化 Spark 应用的 client 进程中执行。在 yarn-client 模式中， Application master 仅仅是用于向 YARN 请求资源容器，client 进程直接与这些容器进行通信以进行调度。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Spark的资源管理和YARN的App模型&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="nginx" scheme="https://zixujing.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>logstash input说明</title>
    <link href="https://zixujing.github.io/2019/05/09/bigdata/logstash%20input%E8%AF%B4%E6%98%8E/"/>
    <id>https://zixujing.github.io/2019/05/09/bigdata/logstash input说明/</id>
    <published>2019-05-08T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>logstash input说明<br><a id="more"></a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    file&#123;</span><br><span class="line">        #path属性接受的参数是一个数组，其含义是标明需要读取的文件位置</span><br><span class="line">        path =&gt; [‘pathA’，‘pathB’]</span><br><span class="line">        #表示多就去path路径下查看是够有新的文件产生。默认是15秒检查一次。</span><br><span class="line">        discover_interval =&gt; 15</span><br><span class="line">        #排除那些文件，也就是不去读取那些文件</span><br><span class="line">        exclude =&gt; [‘fileName1’,‘fileNmae2’]</span><br><span class="line">        #被监听的文件多久没更新后断开连接不在监听，默认是一个小时。</span><br><span class="line">        close_older =&gt; 3600</span><br><span class="line">        #在每次检查文件列 表的时候， 如果一个文件的最后 修改时间 超过这个值， 就忽略这个文件。 默认一天。</span><br><span class="line">        ignore_older =&gt; 86400</span><br><span class="line">        #logstash 每隔多 久检查一次被监听文件状态（ 是否有更新） ， 默认是 1 秒。</span><br><span class="line">        stat_interval =&gt; 1</span><br><span class="line">        #sincedb记录数据上一次的读取位置的一个index</span><br><span class="line">        sincedb_path =&gt; ’$HOME/. sincedb‘</span><br><span class="line">        #logstash 从什么 位置开始读取文件数据， 默认是结束位置 也可以设置为：beginning 从头开始</span><br><span class="line">        start_position =&gt; ‘beginning’</span><br><span class="line">        #注意：这里需要提醒大家的是，如果你需要每次都从同开始读取文件的话，关设置start_position =&gt; beginning是没有用的，你可以选择sincedb_path 定义为 /dev/null</span><br><span class="line">    &#125;            </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input&#123;</span><br><span class="line">    jdbc&#123;</span><br><span class="line">    #jdbc sql server 驱动,各个数据库都有对应的驱动，需自己下载</span><br><span class="line">    jdbc_driver_library =&gt; &quot;/etc/logstash/driver.d/sqljdbc_2.0/enu/sqljdbc4.jar&quot;</span><br><span class="line">    #jdbc class 不同数据库有不同的 class 配置</span><br><span class="line">    jdbc_driver_class =&gt; &quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;</span><br><span class="line">    #配置数据库连接 ip 和端口，以及数据库    </span><br><span class="line">    jdbc_connection_string =&gt; &quot;jdbc:sqlserver://200.200.0.18:1433;databaseName=test_db&quot;</span><br><span class="line">    #配置数据库用户名</span><br><span class="line">    jdbc_user =&gt;   </span><br><span class="line">    #配置数据库密码</span><br><span class="line">    jdbc_password =&gt;</span><br><span class="line">    #上面这些都不重要，要是这些都看不懂的话，你的老板估计要考虑换人了。重要的是接下来的内容。</span><br><span class="line">    # 定时器 多久执行一次SQL，默认是一分钟</span><br><span class="line">    # schedule =&gt; 分 时 天 月 年  </span><br><span class="line">    # schedule =&gt; * 22  *  *  * 表示每天22点执行一次</span><br><span class="line">    schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">    #是否清除 last_run_metadata_path 的记录,如果为真那么每次都相当于从头开始查询所有的数据库记录</span><br><span class="line">    clean_run =&gt; false</span><br><span class="line">    #是否需要记录某个column 的值,如果 record_last_run 为真,可以自定义我们需要表的字段名称，</span><br><span class="line">    #此时该参数就要为 true. 否则默认 track 的是 timestamp 的值.</span><br><span class="line">    use_column_value =&gt; true</span><br><span class="line">    #如果 use_column_value 为真,需配置此参数. 这个参数就是数据库给出的一个字段名称。当然该字段必须是递增的，可以是 数据库的数据时间这类的</span><br><span class="line">    tracking_column =&gt; create_time</span><br><span class="line">    #是否记录上次执行结果, 如果为真,将会把上次执行到的 tracking_column 字段的值记录下来,保存到 last_run_metadata_path 指定的文件中</span><br><span class="line">    record_last_run =&gt; true</span><br><span class="line">    #们只需要在 SQL 语句中 WHERE MY_ID &gt; :last_sql_value 即可. 其中 :last_sql_value 取得就是该文件中的值</span><br><span class="line">    last_run_metadata_path =&gt; &quot;/etc/logstash/run_metadata.d/my_info&quot;</span><br><span class="line">    #是否将字段名称转小写。</span><br><span class="line">    #这里有个小的提示，如果你这前就处理过一次数据，并且在Kibana中有对应的搜索需求的话，还是改为true，</span><br><span class="line">    #因为默认是true，并且Kibana是大小写区分的。准确的说应该是ES大小写区分</span><br><span class="line">    lowercase_column_names =&gt; false</span><br><span class="line">    #你的SQL的位置，当然，你的SQL也可以直接写在这里。</span><br><span class="line">    #statement =&gt; SELECT * FROM tabeName t WHERE  t.creat_time &gt; :last_sql_value</span><br><span class="line">    statement_filepath =&gt; &quot;/etc/logstash/statement_file.d/my_info.sql&quot;</span><br><span class="line">    #数据类型，标明你属于那一方势力。单了ES哪里好给你安排不同的山头。</span><br><span class="line">    type =&gt; &quot;my_info&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    #注意：外载的SQL文件就是一个文本文件就可以了，还有需要注意的是，一个jdbc&#123;&#125;插件就只能处理一个SQL语句，</span><br><span class="line">    #如果你有多个SQL需要处理的话，只能在重新建立一个jdbc&#123;&#125;插件。</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    #接受数据端口</span><br><span class="line">    port =&gt; 5044</span><br><span class="line">    #数据类型</span><br><span class="line">    type =&gt; &quot;logs&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  #这个插件需要和filebeat进行配很这里不做多讲，到时候结合起来一起介绍。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;logstash input说明&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="logstash" scheme="https://zixujing.github.io/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>nginx1.14.2https代理实现</title>
    <link href="https://zixujing.github.io/2019/05/09/linux/linux%E5%B7%A5%E5%85%B7/nginx1.14.2https%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0/"/>
    <id>https://zixujing.github.io/2019/05/09/linux/linux工具/nginx1.14.2https代理实现/</id>
    <published>2019-05-08T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.477Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>nginx1.14.2https代理实现<br><a id="more"></a></p></blockquote><h2 id="基本环境配置"><a href="#基本环境配置" class="headerlink" title="基本环境配置"></a>基本环境配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#yum install gcc pcre-devel zlib-devel openssl-devel</span><br><span class="line">#systemctl stop firewalld</span><br><span class="line">#systemctl disable firewalld</span><br><span class="line">#groupadd nginx</span><br><span class="line">#useradd nginx -g nginx -s /sbin/nologin -M</span><br><span class="line">#vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br><span class="line"></span><br><span class="line"># ./configure \</span><br><span class="line">--prefix=/usr/local/nginx \</span><br><span class="line">--sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx.lock \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-openssl=</span><br><span class="line"></span><br><span class="line">#make</span><br><span class="line">#make install</span><br><span class="line"></span><br><span class="line">#vi /usr/lib/systemd/system/nginx.service</span><br><span class="line">#/usr/lib/systemd/system/nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">ExecReload=/usr/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/sbin/nginx -s stop</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">#systemctl start nginx</span><br><span class="line">#systemctl enable nginx</span><br></pre></td></tr></table></figure><h2 id="手动配置ssl证书"><a href="#手动配置ssl证书" class="headerlink" title="手动配置ssl证书"></a>手动配置ssl证书</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx</span><br><span class="line">openssl genrsa -des3 -out cert.key 1024</span><br><span class="line">密码：123456</span><br><span class="line">openssl req -new -key cert.key -out cert.csr</span><br><span class="line">Enter pass phrase for cert.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:cn</span><br><span class="line">State or Province Name (full name) []:hebei</span><br><span class="line">Locality Name (eg, city) [Default City]:shijiazhuang</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:hbfec</span><br><span class="line">Organizational Unit Name (eg, section) []:soft</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:ythserver</span><br><span class="line">Email Address []:yth@hbfec.com</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:123456</span><br><span class="line">An optional company name []:hbfec</span><br><span class="line"></span><br><span class="line">cp cert.key cert.key.bak</span><br><span class="line">openssl rsa -in cert.key.bak -out cert.key</span><br><span class="line">openssl x509 -req -days 365 -in cert.csr -signkey cert.key -out cert.crt</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/nginx/nginx.conf</span><br><span class="line">    upstream baidu&#123;</span><br><span class="line">        server 103.235.46.39;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  192.168.106.219;</span><br><span class="line">        #ssl证书文件位置(常见证书文件格式为：crt/pem)</span><br><span class="line">        ssl_certificate      cert.crt;</span><br><span class="line">        #ssl证书key位置</span><br><span class="line">        ssl_certificate_key  cert.key;</span><br><span class="line">        #ssl配置参数（选择性配置）</span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line">        #数字签名，此处使用MD5</span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        #编码格式</span><br><span class="line">        charset utf-8;</span><br><span class="line">        #代理配置参数</span><br><span class="line">        proxy_connect_timeout 180;</span><br><span class="line">        proxy_send_timeout 180;</span><br><span class="line">        proxy_read_timeout 180;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarder-For $remote_addr;</span><br><span class="line"> </span><br><span class="line">        #反向代理的路径（和upstream绑定），location 后面设置映射的路径</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass https://baidu;</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        #设定查看Nginx状态的地址</span><br><span class="line">        location /NginxStatus &#123;</span><br><span class="line">            stub_status           on;</span><br><span class="line">            access_log            on;</span><br><span class="line">            auth_basic            &quot;NginxStatus&quot;;</span><br><span class="line">            auth_basic_user_file  conf/htpasswd;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;nginx1.14.2https代理实现&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="nginx" scheme="https://zixujing.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>kafka 集群安装</title>
    <link href="https://zixujing.github.io/2019/05/07/bigdata/kafka%20%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/05/07/bigdata/kafka 集群安装/</id>
    <published>2019-05-06T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>kafka 2.12-2.1.1 集群安装<br><a id="more"></a></p></blockquote><h2 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cd /opt</span><br><span class="line">$ tar -xzvf jdk-8u161-linux-x64.tar.gz</span><br><span class="line">$ vi ~/.bash_profile</span><br><span class="line">JAVA_HOME=/opt/jdk1.8.0_161</span><br><span class="line">PATH=$PATH:$HOME/bin:$JAVA_HOME/bin</span><br><span class="line">export PATH</span><br><span class="line">$ source ~/.bash_profile</span><br></pre></td></tr></table></figure><h2 id="zk安装"><a href="#zk安装" class="headerlink" title="zk安装"></a>zk安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xzvf kafka_2.12-2.1.1.tgz -C /usr/local</span><br><span class="line">$ cd /usr/local/kafka_2.12-2.1.1/</span><br><span class="line">##zk配置</span><br><span class="line">$ vi config/zookeeper.properties</span><br><span class="line">dataDir=/opt/kafka/zkdata</span><br><span class="line">dataLogDir=/opt/kafka/zklog</span><br><span class="line">clientPort=2181</span><br><span class="line">maxClientCnxns=100</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">server.1=192.168.11.97:2888:3888</span><br><span class="line">server.2=192.168.11.98:2888:3888</span><br><span class="line">server.3=192.168.11.99:2888:3888</span><br><span class="line"></span><br><span class="line">mkdir /opt/kafka/zkdata -p</span><br><span class="line">mkdir /opt/kafka/zklog -p</span><br><span class="line">echo &quot;1&quot; &gt; /opt/kafka/zkdata/myid</span><br><span class="line">echo &quot;2&quot; &gt; /opt/kafka/zkdata/myid</span><br><span class="line">echo &quot;3&quot; &gt; /opt/kafka/zkdata/myid</span><br><span class="line"></span><br><span class="line">./bin/zookeeper-server-start.sh  config/zookeeper.properties &amp;</span><br></pre></td></tr></table></figure><h2 id="kafka配置"><a href="#kafka配置" class="headerlink" title="kafka配置"></a>kafka配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/kafka_2.12-2.1.1</span><br><span class="line">$ vi config/server.properties </span><br><span class="line">broker.id=1 # 1 2 3</span><br><span class="line">listeners=PLAINTEXT://ip地址:9092</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">log.dirs=/opt/kafka/kfklog</span><br><span class="line">zookeeper.connect=192.168.11.97:2181,192.168.11.98:2181,192.168.11.99:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line"></span><br><span class="line">$ mkdir /opt/kafka/kfklog</span><br><span class="line">$ bin/kafka-server-start.sh -daemon config/server.properties</span><br></pre></td></tr></table></figure><h2 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"># ----------------------系统相关----------------------</span><br><span class="line"># broker的全局唯一编号，不能重复，和zookeeper的myid是一个意思</span><br><span class="line">broker.id=0</span><br><span class="line"></span><br><span class="line"># broker监听IP和端口也可以是域名</span><br><span class="line">listeners=PLAINTEXT://172.16.48.163:9092</span><br><span class="line"></span><br><span class="line"># 用于接收请求的线程数量</span><br><span class="line">num.network.threads=3</span><br><span class="line"></span><br><span class="line"># 用于处理请求的线程数量，包括磁盘IO请求，这个数量和log.dirs配置的目录数量有关，这里的数量不能小于log.dirs的数量，</span><br><span class="line"># 虽然log.dirs是配置日志存放路径，但是它可以配置多个目录后面用逗号分隔</span><br><span class="line">num.io.threads=8</span><br><span class="line"></span><br><span class="line"># 发送缓冲区大小，也就是说发送消息先发送到缓冲区，当缓冲区满了之后一起发送出去</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"># 接收缓冲区大小，同理接收到缓冲区，当到达这个数量时就同步到磁盘</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line"></span><br><span class="line"># 向kafka套接字请求最大字节数量，防止服务器OOM，也就是OutOfMemery，这个数量不要超过JAVA的堆栈大小，</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line"></span><br><span class="line"># 日志路径也就是分区日志存放的地方，你所建立的topic的分区就在这里面，但是它可以配置多个目录后面用逗号分隔</span><br><span class="line">log.dirs=/tmp/kafka-logs</span><br><span class="line"></span><br><span class="line"># 消息体（也就是往Kafka发送的单条消息）最大大小，单位是字节，必须小于socket.request.max.bytes值</span><br><span class="line">message.max.bytes =5000000</span><br><span class="line"></span><br><span class="line"># 自动平衡由于某个broker故障会导致Leader副本迁移到别的broker，当之前的broker恢复后也不会迁移回来，有时候我们需要</span><br><span class="line"># 手动进行平衡避免同一个主题不同分区的Leader副本在同一台broker上，下面这个参数就是开启自动平衡功能</span><br><span class="line">auto.leader.rebalance.enable=true</span><br><span class="line"></span><br><span class="line"># 设置了上面的自动平衡，当故障转移后，隔300秒（默认）触发一个定时任务进行平衡操作，而只有代理的不均衡率为10%以上才会执行</span><br><span class="line">leader.imbalance.check.interval.seconds=300</span><br><span class="line"></span><br><span class="line"># 设置代理的不均衡率，默认是10%</span><br><span class="line">leader.imbalance.per.broker.percentage=10</span><br><span class="line"></span><br><span class="line"># ---------------分区相关-------------------------</span><br><span class="line"></span><br><span class="line"># 默认分区数量，当建立Topic时不指定分区数量，默认就1</span><br><span class="line">num.partitions=1</span><br><span class="line"></span><br><span class="line"># 是否允许自动创建topic ，若是false，就需要通过命令创建topic</span><br><span class="line">auto.create.topics.enable =true</span><br><span class="line"> </span><br><span class="line"># 一个topic ，默认分区的replication个数 ，不得大于集群中broker的个数</span><br><span class="line">default.replication.factor =2</span><br><span class="line"></span><br><span class="line"># ---------------日志相关-------------------------</span><br><span class="line"></span><br><span class="line"># segment文件默认会被保留7天的时间，超时的话就会被清理，那么清理这件事情就需要有一些线程来做。</span><br><span class="line"># 这里就是用来设置恢复和清理data下数据的线程数量</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line"></span><br><span class="line"># 日志文件中每个segment的大小，默认为1G。topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，当超过这个大小会建立一个新日志文件</span><br><span class="line"># 这个参数会被topic创建时的指定参数覆盖，如果你创建Topic的时候指定了这个参数，那么你以你指定的为准。</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line"></span><br><span class="line"># 数据存储的最大时间 超过这个时间 会根据log.cleanup.policy设置的策略处理数据，也就是消费端能够多久去消费数据</span><br><span class="line"># log.retention.bytes和log.retention.minutes|hours任意一个达到要求，都会执行删除</span><br><span class="line"># 如果你创建Topic的时候指定了这个参数，那么你以你指定的为准</span><br><span class="line">log.retention.hours|minutes=168</span><br><span class="line"></span><br><span class="line"># 这个参数会在日志segment没有达到log.segment.bytes设置的大小默认1G的时候，也会强制新建一个segment会被</span><br><span class="line"># topic创建时的指定参数覆盖</span><br><span class="line">log.roll.hours=168 </span><br><span class="line"></span><br><span class="line"># 上面的参数设置了每一个segment文件的大小是1G，那么就需要有一个东西去定期检查segment文件有没有达到1G，多长时间去检查一次，</span><br><span class="line"># 就需要设置一个周期性检查文件大小的时间（单位是毫秒）。</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line"></span><br><span class="line"># 日志清理策略 选择有：delete和compact 主要针对过期数据的处理，或是日志文件达到限制的额度，</span><br><span class="line"># 如果你创建Topic的时候指定了这个参数，那么你以你指定的为准</span><br><span class="line">log.cleanup.policy = delete</span><br><span class="line"></span><br><span class="line"># 是否启用日志清理功能，默认是启用的且清理策略为compact，也就是压缩。</span><br><span class="line">log.cleaner.enable=false</span><br><span class="line"></span><br><span class="line"># 日志清理时所使用的缓存空间大小</span><br><span class="line">log.cleaner.dedupe.buffer.size=134217728</span><br><span class="line"></span><br><span class="line"># log文件&quot;sync&quot;到磁盘之前累积的消息条数，因为磁盘IO操作是一个慢操作,但又是一个&quot;数据可靠性&quot;的必要手段</span><br><span class="line"># 所以此参数的设置,需要在&quot;数据可靠性&quot;与&quot;性能&quot;之间做必要的权衡.</span><br><span class="line"># 如果此值过大,将会导致每次&quot;fsync&quot;的时间较长(IO阻塞)</span><br><span class="line"># 如果此值过小,将会导致&quot;fsync&quot;的次数较多,这也意味着整体的client请求有一定的延迟.</span><br><span class="line"># 物理server故障,将会导致没有fsync的消息丢失.</span><br><span class="line">log.flush.interval.messages=9223372036854775807</span><br><span class="line"></span><br><span class="line"># 检查是否需要固化到硬盘的时间间隔</span><br><span class="line">log.flush.scheduler.interval.ms =3000</span><br><span class="line"> </span><br><span class="line"># 仅仅通过interval来控制消息的磁盘写入时机,是不足的.</span><br><span class="line"># 此参数用于控制&quot;fsync&quot;的时间间隔,如果消息量始终没有达到阀值,但是离上一次磁盘同步的时间间隔</span><br><span class="line"># 达到阀值,也将触发.</span><br><span class="line">log.flush.interval.ms = None</span><br><span class="line"></span><br><span class="line"># --------------------------复制(Leader、replicas) 相关-------------------</span><br><span class="line"># partition leader与replicas之间通讯时,socket的超时时间</span><br><span class="line">controller.socket.timeout.ms =30000</span><br><span class="line"></span><br><span class="line"># replicas响应partition leader的最长等待时间，若是超过这个时间，就将replicas列入ISR(in-sync replicas)，</span><br><span class="line"># 并认为它是死的，不会再加入管理中</span><br><span class="line">replica.lag.time.max.ms =10000</span><br><span class="line"></span><br><span class="line"># follower与leader之间的socket超时时间</span><br><span class="line">replica.socket.timeout.ms=300000</span><br><span class="line"></span><br><span class="line"># leader复制时候的socket缓存大小</span><br><span class="line">replica.socket.receive.buffer.bytes=65536</span><br><span class="line"></span><br><span class="line"># replicas每次获取数据的最大大小</span><br><span class="line">replica.fetch.max.bytes =1048576</span><br><span class="line"></span><br><span class="line"># replicas同leader之间通信的最大等待时间，失败了会重试</span><br><span class="line">replica.fetch.wait.max.ms =500</span><br><span class="line"></span><br><span class="line"># fetch的最小数据尺寸,如果leader中尚未同步的数据不足此值,将会阻塞,直到满足条件</span><br><span class="line">replica.fetch.min.bytes =1</span><br><span class="line"></span><br><span class="line"># leader 进行复制的线程数，增大这个数值会增加follower的IO</span><br><span class="line">num.replica.fetchers=1</span><br><span class="line"></span><br><span class="line"># 最小副本数量</span><br><span class="line">min.insync.replicas = 2</span><br></pre></td></tr></table></figure><h2 id="一些命令"><a href="#一些命令" class="headerlink" title="一些命令"></a>一些命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper 192.168.11.97:2181,192.168.11.98:2181,192.168.11.99:2181 --replication-factor 2 --partitions 1 --topic test</span><br><span class="line">bin/kafka-console-producer.sh --broker-list 192.168.11.97:9092 --topic test</span><br><span class="line">bin/kafka-console-consumer.sh --boostrap-server 192.168.11.97:9092 --topic test --from-beginning</span><br><span class="line">bin/kafka-topics.sh --list --zookeeper 192.168.11.97:2181,192.168.11.98:2181,192.168.11.99:2181</span><br><span class="line">bin/kafka-topics.sh --describe --zookeeper 192.168.11.99:2181 </span><br><span class="line">bin/kafka-run-class.sh kafka.tools.GetOffsetShell --topic maxwell --partitions 1 --broker-list 192.168.11.99:9092</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;kafka 2.12-2.1.1 集群安装&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="kafka" scheme="https://zixujing.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>fastdfs-nginx-module安装</title>
    <link href="https://zixujing.github.io/2019/05/06/linux/linux%E5%B7%A5%E5%85%B7/fastdfs-nginx-module%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/05/06/linux/linux工具/fastdfs-nginx-module安装/</id>
    <published>2019-05-05T17:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.477Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>fastdfs-nginx-module安装</p></blockquote><a id="more"></a><h2 id="fastdfs-nginx-module安装"><a href="#fastdfs-nginx-module安装" class="headerlink" title="fastdfs-nginx-module安装"></a>fastdfs-nginx-module安装</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y  install pcre-devel opensslopenssl-devel zlib-devel zlib</span><br></pre></td></tr></table></figure><h3 id="下载fastdfs-nginx-module"><a href="#下载fastdfs-nginx-module" class="headerlink" title="下载fastdfs-nginx-module"></a>下载fastdfs-nginx-module</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zip</span><br></pre></td></tr></table></figure><h3 id="nginx使用版本1-14-2"><a href="#nginx使用版本1-14-2" class="headerlink" title="nginx使用版本1.14.2"></a>nginx使用版本1.14.2</h3><p>###解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">unzip master.zip</span><br><span class="line">tar -xzvf nginx-1.14.2.tar.gz</span><br><span class="line">mv nginx-1.14.2 /usr/local</span><br><span class="line">cd /usr/local/nginx-1.14.2</span><br><span class="line">./configure --add-module=/root/fastdfs-nginx-module-master/src/ --prefix=/usr/local/nginx-1.14.2 --user=root --group=root --with-http_gzip_static_module --with-http_gunzip_module</span><br><span class="line">#报错解决</span><br><span class="line">vi /root/fastdfs-nginx-module-master/src/config</span><br><span class="line">ngx_module_incs=&quot;/usr/include/fastdfs /usr/include/fastcommon/&quot;</span><br><span class="line">CORE_INCS=&quot;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&quot;</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">vi /etc/fdfs/mod_fastdfs.conf </span><br><span class="line">connect_timeout=10</span><br><span class="line">tracker_server=127.0.0.1:22122</span><br><span class="line">url_have_group_name=true</span><br><span class="line">store_path0=/home/filedata/storage/data</span><br><span class="line">group_name=group1</span><br><span class="line">base_path=/home/filedata/storage/info</span><br><span class="line">#include http.conf</span><br><span class="line"></span><br><span class="line">cd fastdfs-5.11</span><br><span class="line">cd conf</span><br><span class="line">cp http.conf mime.types  /etc/fdfs/</span><br><span class="line"></span><br><span class="line">mkdir /usr/local/nginx-1.14.2/logs</span><br><span class="line">vi /usr/local/nginx-1.14.2/conf/nginx.conf</span><br><span class="line">在http部分中添加配置信息如下：</span><br><span class="line">#修改第一行</span><br><span class="line">user root;</span><br><span class="line">#然后加入</span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections  1024;  ## Default: 1024</span><br><span class="line">&#125;</span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">       server &#123;</span><br><span class="line">            listen       8888;</span><br><span class="line">            server_name  localhost;</span><br><span class="line">            location ~/group[0-9]/ &#123;</span><br><span class="line">                ngx_fastdfs_module;</span><br><span class="line">            &#125;</span><br><span class="line">            error_page   500 502 503 504  /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;fastdfs-nginx-module安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="tool" scheme="https://zixujing.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch 集群安装</title>
    <link href="https://zixujing.github.io/2019/05/05/bigdata/elasticsearch%20%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/05/05/bigdata/elasticsearch 集群安装/</id>
    <published>2019-05-04T18:00:00.000Z</published>
    <updated>2019-06-26T04:55:22.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>elasticsearch 集群安装</p></blockquote><a id="more"></a><h2 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h2><blockquote><p>与ELK文档一致<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ groupadd elk</span><br><span class="line">$ useradd -g elk -m elk</span><br><span class="line">$ passwd elk</span><br><span class="line">$ vi /etc/security/limits.conf</span><br><span class="line"> * soft nofile 65536</span><br><span class="line"> * hard nofile 131072</span><br><span class="line"> * soft nproc 2048</span><br><span class="line"> * hard nproc 4096</span><br><span class="line"> * soft memlock unlimited </span><br><span class="line"> * hard memlock unlimited </span><br><span class="line">$ vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line">* soft nproc 4096</span><br><span class="line">$ vi /etc/sysctl.conf</span><br><span class="line">vm.max_map_count=655360</span><br><span class="line">$ sysctl -p</span><br><span class="line">##java jdk</span><br><span class="line">$ #以下是elk用户下</span><br><span class="line">$ tar -xzvf jdk-8u192-linux-x64.tar.gz </span><br><span class="line">$ mv jdk1.8.0_192/ jdk</span><br><span class="line">$ vi ~/.bash_profile</span><br><span class="line">export JAVA_HOME=/home/elk/soft/jdk</span><br><span class="line">PATH=$PATH:$HOME/.local/bin:$HOME/bin:/home/elk/soft/jdk/bin</span><br><span class="line">$ source .bash_profile</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="elasticsearch集群配置安装"><a href="#elasticsearch集群配置安装" class="headerlink" title="elasticsearch集群配置安装"></a>elasticsearch集群配置安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xzvf elasticsearch-6.6.2.tar.gz</span><br><span class="line">$ mkdir /home/elk/soft/elasticsearch-6.6.2/data</span><br><span class="line">##$ mkdir /home/elk/soft/elasticsearch-6.6.2/logs</span><br><span class="line">$ cd elasticsearch-6.6.2/config/</span><br><span class="line">$ vi elasticsearch.yml </span><br><span class="line"></span><br><span class="line">#集群的名称</span><br><span class="line">cluster.name: ythtest</span><br><span class="line">#节点名称,其余两个节点分别为node15 和node16</span><br><span class="line">node.name: node14</span><br><span class="line">#指定该节点是否有资格被选举成为master节点，默认是true，es是默认集群中的第一台机器为master，如果这台机挂了就会重新选举master</span><br><span class="line">node.master: true</span><br><span class="line">#允许该节点存储数据(默认开启)</span><br><span class="line">node.data: true</span><br><span class="line">#索引数据的存储路径</span><br><span class="line">path.data: /home/elk/soft/elasticsearch-6.6.2/data</span><br><span class="line">#日志文件的存储路径</span><br><span class="line">path.logs: /home/elk/soft/elasticsearch-6.6.2/logs</span><br><span class="line">#设置为true来锁住内存。因为内存交换到磁盘对服务器性能来说是致命的，当jvm开始swapping时es的效率会降低，所以要保证它不swap</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">#绑定的ip地址</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">#设置对外服务的http端口，默认为9200</span><br><span class="line">http.port: 9200</span><br><span class="line"># 设置节点间交互的tcp端口,默认是9300 </span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">#Elasticsearch将绑定到可用的环回地址，并将扫描端口9300到9305以尝试连接到运行在同一台服务器上的其他节点。</span><br><span class="line">#这提供了自动集群体验，而无需进行任何配置。数组设置或逗号分隔的设置。每个值的形式应该是host:port或host</span><br><span class="line">#（如果没有设置，port默认设置会transport.profiles.default.port 回落到transport.tcp.port）。</span><br><span class="line">#请注意，IPv6主机必须放在括号内。默认为127.0.0.1, [::1]</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;192.168.11.14:9300&quot;, &quot;192.168.11.15:9300&quot;, &quot;192.168.11.16:9300&quot;]</span><br><span class="line">#如果没有这种设置,遭受网络故障的集群就有可能将集群分成两个独立的集群 - 分裂的大脑 - 这将导致数据丢失</span><br><span class="line">discovery.zen.minimum_master_nodes: 3</span><br><span class="line">#一个集群中的N个节点启动后,才允许进行数据恢复处理，默认是1</span><br><span class="line">gateway.recover_after_nodes: 2</span><br><span class="line"></span><br><span class="line">##启动elasticsearch</span><br><span class="line">$ /home/elk/soft/elasticsearch-6.6.2/bin/elasticsearch -d</span><br></pre></td></tr></table></figure><h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;persistent&quot; : &#123;</span><br><span class="line">        &quot;indices.store.throttle.max_bytes_per_sec&quot; : &quot;100mb&quot;#普通磁盘建议64mb</span><br><span class="line">        &quot;indices.store.throttle.type&quot; : &quot;none&quot; #不限制磁盘流量</span><br><span class="line">        index.merge.scheduler.max_thread_count: 1</span><br><span class="line">        index.refresh_interval: 30s</span><br><span class="line">        index.number_of_replicas: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /_all/_settings </span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.unassigned.node_left.delayed_timeout&quot;: &quot;5m&quot; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;transient&quot; : &#123;</span><br><span class="line">        &quot;cluster.routing.allocation.enable&quot; : &quot;none&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;transient&quot; : &#123;</span><br><span class="line">        &quot;cluster.routing.allocation.enable&quot; : &quot;all&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;persistent&quot;: &#123;</span><br><span class="line">        &quot;action.auto_create_index&quot;: &quot;true&quot; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//设置为可以更新</span><br><span class="line">curl -XPUT -H &quot;Content-Type: application/json&quot; http://127.0.0.1:9200/tb_personnelidmismatch/_settings -d &apos;&#123;&quot;index.blocks.read_only_allow_delete&quot;: null&#125;&apos;</span><br></pre></td></tr></table></figure><h2 id="配置总结"><a href="#配置总结" class="headerlink" title="配置总结"></a>配置总结</h2><ul><li>cluster.name:<br>集群名字</li><li>node.name:<br>结点名称</li><li>path.data: /path/to/data1,/path/to/data2<br>数据目录；多个数据路径只是帮助如果你有许多索引／分片在单个节点上</li><li><p>path.logs: /path/to/logs<br>Path to log files</p></li><li><p>path.plugins: /path/to/plugins<br>Path to where plugins are installed</p></li><li><p>discovery.zen.minimum_master_nodes: 2<br>这个配置就是告诉 Elasticsearch 当没有足够 master 候选节点的时候，就不要进行 master 节点选举，等 master 候选节点足够了才进行选举。<br>此设置应该始终被配置为 master 候选节点的法定个数（大多数个）。法定个数就是 ( master 候选节点个数 / 2) + 1 。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;persistent&quot; : &#123;</span><br><span class="line">        &quot;discovery.zen.minimum_master_nodes&quot; : 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>gateway.recover_after_nodes: 8<br>这意味着至少要有 8 个节点，该集群才可用。</p></li><li>gateway.expected_nodes: 10</li><li><p>gateway.recover_after_time: 5m<br>结合上一条配置，说明：等待集群至少存在 8 个节点;等待 5 分钟，或者10 个节点上线后，才进行数据恢复，这取决于哪个条件先达到。</p></li><li><p>discovery.zen.ping.unicast.hosts: [“host1”, “host2:port”]<br>使用单播，你可以为 Elasticsearch 提供一些它应该去尝试连接的节点列表。 当一个节点联系到单播列表中的成员时，它就会得到整个集群所有节点的状态，然后它会联系 master 节点，并加入集群。这意味着你的单播列表不需要包含你的集群中的所有节点， 它只是需要足够的节点，当一个新节点联系上其中一个并且说上话就可以了。如果你使用 master 候选节点作为单播列表，你只要列出三个就可以了</p></li><li><p>export ES_HEAP_SIZE=10g</p></li><li>./bin/elasticsearch -Xmx10g -Xms10g<br>设置内存为机器内存的一般，但不能超过32G，超过32G的话jvm会使用64位的指针，这样会浪费大量的内存。</li><li>sudo swapoff -a<br>暂时禁用swap</li><li>vm.swappiness = 1<br>swappiness 设置为 1 比设置为 0 要好，因为在一些内核版本 swappiness 设置为 0 会触发系统 OOM-killer（注：Linux 内核的 Out of Memory（OOM）killer 机制）。</li><li>bootstrap.mlockall: true<br>如果上面的方法都不合适，你需要打开配置文件中的 mlockall 开关。 它的作用就是允许 JVM 锁住内存，禁止操作系统交换出去。在你的 elasticsearch.yml 文件中设置。</li><li>sysctl -w vm.max_map_count=262144<br>在 /etc/sysctl.conf 通过修改 vm.max_map_count 永久设置它</li><li><p>PUT /my_index/_settings<br>{<br>  “index.search.slowlog.threshold.query.warn” : “10s”,<br>  “index.search.slowlog.threshold.fetch.debug”: “500ms”,<br>  “index.indexing.slowlog.threshold.index.info”: “5s”<br>}<br>查询慢于 10 秒输出一个 WARN 日志。<br>获取慢于 500 毫秒输出一个 DEBUG 日志。<br>索引慢于 5 秒输出一个 INFO 日志。</p></li><li><p>PUT /_cluster/settings<br>{<br>  “persistent” : {</p><pre><code>&quot;indices.store.throttle.max_bytes_per_sec&quot; : &quot;100mb&quot;#机械磁盘可以设置60mb</code></pre><p>  }<br>}<br>“indices.store.throttle.type” : “none” ：关闭限流</p></li><li><p>index.merge.scheduler.max_thread_count: 1<br>机械磁盘在并发 I/O 支持方面比较差，所以我们需要降低每个索引并发访问磁盘的线程数。这个设置允许 max_thread_count + 2 个线程同时进行磁盘操作，也就是设置为 1 允许三个线程。</p></li><li>如果你的搜索结果不需要近实时的准确度，考虑把每个索引的 index.refresh_interval 改到 30s</li><li>如果你在做大批量导入，考虑通过设置 index.number_of_replicas: 0关闭副本。</li><li>PUT /_all/_settings<br>{<br>“settings”: {<br>  “index.unassigned.node_left.delayed_timeout”: “5m”<br>}<br>}<br>通过使用 _all 索引名，我们可以为集群里面的所有的索引使用这个参数<br>默认时间被修改成了 5 分钟<br>默认情况，集群会等待一分钟来查看节点是否会重新加入，如果这个节点在此期间重新加入，重新加入的节点会保持其现有的分片数据，不会触发新的分片分配。</li><li>滚动重启<br>1.可能的话，停止索引新的数据。虽然不是每次都能真的做到，但是这一步可以帮助提高恢复速度。<br>2.禁止分片分配。这一步阻止 Elasticsearch 再平衡缺失的分片，直到你告诉它可以进行了。如果你知道维护窗口会很短，这个主意棒极了。你可以像下面这样禁止分配：<br>PUT /_cluster/settings<br>{<br>  “transient” : {<pre><code>&quot;cluster.routing.allocation.enable&quot; : &quot;none&quot;</code></pre>  }<br>}<br>3.关闭单个节点。<br>4.执行维护/升级。<br>5.重启节点，然后确认它加入到集群了。<br>6.用如下命令重启分片分配：<br>PUT /_cluster/settings<br>{<br>  “transient” : {<pre><code>&quot;cluster.routing.allocation.enable&quot; : &quot;all&quot;</code></pre>  }<br>}<br>分片再平衡会花一些时间。一直等到集群变成 绿色 状态后再继续。<br>7.重复第 2 到 6 步操作剩余节点。<br>8.到这步你可以安全的恢复索引了（如果你之前停止了的话），不过等待集群完全均衡后再恢复索引，也会有助于提高处理速度。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;elasticsearch 集群安装&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="elasticsearch" scheme="https://zixujing.github.io/tags/elasticsearch/"/>
    
  </entry>
  
</feed>
