<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冯凯&#39;blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zixujing.github.io/"/>
  <updated>2019-01-15T13:20:59.977Z</updated>
  <id>https://zixujing.github.io/</id>
  
  <author>
    <name>冯_凯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>sqlserver 2012内存管理</title>
    <link href="https://zixujing.github.io/2019/01/15/db/mssql/sqlserver%202012%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://zixujing.github.io/2019/01/15/db/mssql/sqlserver 2012内存管理/</id>
    <published>2019-01-14T17:00:00.000Z</published>
    <updated>2019-01-15T13:20:59.977Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management/" target="_blank" rel="noopener">原文地址：https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management</a><br><a id="more"></a></p></blockquote><h2 id="内存分配器的变化"><a href="#内存分配器的变化" class="headerlink" title="内存分配器的变化"></a>内存分配器的变化</h2><blockquote><p>SQL Server 2012以前的版本，比如SQL Server 2008 R2等，有<strong>single page allocator</strong>和<strong>multi page allocator</strong>。 也就是说， 如果申请的内存是8k以内的，就会有单页分配器分配，而大于8kb的内存请求，使用multi page 分配器来管理。所以，如果你运行DBCC MemoryStatus，你会发现这两个分配器分配的内存情况。</p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/6607.1.png" alt="dbcc memorystatus"></center><blockquote><p>如果你查询<strong>memory clerk</strong>，也会发现single pages 和multi pages 两列：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from sys.dm_os_memory_clerks</span><br></pre></td></tr></table></figure><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/4812.2.png" alt=""></center><blockquote><p>而2012里面就不一样了，你会发现single page 和multi page字样消失了，只剩下pages 字样：</p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/5482.3.png" alt=""></center><blockquote><p>而下面的语句的输出也是不一样的：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> sys.dm_os_memory_clerks</span><br></pre></td></tr></table></figure><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/2577.4.png" alt=""></center><blockquote><p>那么为什么会有这样的变化呢？原因就是SQL Server 2012里面不再有single page allocator 和multi page allocator，而是把它们统一起来了，叫做 any size page allocator。 下面的两张图可以看到这样的变化：</p></blockquote><pre><code>SQL Server 2008 R2：</code></pre><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/5074.5.png" alt=""></center><pre><code>SQL Server 2012：</code></pre><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/20190115/7041.6.png" alt=""></center><ul><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2012/ms175019&#40;v=sql.110&#41;" target="_blank" rel="noopener">参考:https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2012/ms175019(v=sql.110)</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原文地址：https://blogs.msdn.microsoft.com/apgcdsd/2013/07/10/sql-server-2012-memory-management&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="sqlserver" scheme="https://zixujing.github.io/tags/sqlserver/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 内存管理</title>
    <link href="https://zixujing.github.io/2019/01/15/db/mysql/mysql%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>https://zixujing.github.io/2019/01/15/db/mysql/mysql内存管理/</id>
    <published>2019-01-14T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.060Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>分析mysql内存结构<br><a id="more"></a></p></blockquote><h2 id="内存结构图"><a href="#内存结构图" class="headerlink" title="内存结构图"></a>内存结构图</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/mysql%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.jpg" alt="mysql内存结构描述"></p><ol><li><p>全局缓存包括</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; global buffer(全局内存分配总和) =</span><br><span class="line">&gt; innodb_buffer_pool_size --InnoDB高速缓冲，行数据、索引缓冲，以及事务锁、自适应哈希等</span><br><span class="line">&gt; +innodb_additional_mem_pool_size  --InnoDB数据字典额外内存，缓存所有表数据字典</span><br><span class="line">&gt; +innodb_log_buffer_size -- InnoDB REDO日志缓冲，提高REDO日志写入效率</span><br><span class="line">&gt; +key_buffer_size -- MyISAM表索引高速缓冲，提高MyISAM表索引读写效率</span><br><span class="line">&gt; +query_cache_size --查询高速缓存，缓存查询结果，提高反复查询返回效率</span><br><span class="line">&gt; +thread_cache_size --Thread_Cache 中存放的最大连接线程数</span><br><span class="line">&gt; +table_cahce -- 表空间文件描述符缓存，提高数据表打开效率</span><br><span class="line">&gt; +table_definition_cache -- 表定义文件描述符缓存，提高数据表打开效率</span><br></pre></td></tr></table></figure></li><li><p>会话缓存包括</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; total_thread_buffers= max_connections*(</span><br><span class="line">&gt;  read_buffer_size-- 顺序读缓冲，提高顺序读效率</span><br><span class="line">&gt; +read_rnd_buffer_size-- 随机读缓冲，提高随机读效率</span><br><span class="line">&gt; +sort_buffer_size-- 排序缓冲，提高排序效率</span><br><span class="line">&gt; +join_buffer_size-- 表连接缓冲，提高表连接效率</span><br><span class="line">&gt; +binlog_cache_size-- 二进制日志缓冲，提高二进制日志写入效率</span><br><span class="line">&gt; +tmp_table_size -- 内存临时表，提高临时表存储效率</span><br><span class="line">&gt; +thread_stack-- 线程堆栈，暂时寄存SQL语句/存储过程</span><br><span class="line">&gt; +thread_cache_size-- 线程缓存，降低多次反复打开线程开销，模拟连接池</span><br><span class="line">&gt; )</span><br></pre></td></tr></table></figure></li></ol><h2 id="查看Mysql全局占用内存大小"><a href="#查看Mysql全局占用内存大小" class="headerlink" title="查看Mysql全局占用内存大小"></a>查看Mysql全局占用内存大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;select (@@innodb_buffer_pool_size+@@innodb_log_buffer_size+@@key_buffer_size)/1024/1024 as g_buffer;</span><br></pre></td></tr></table></figure><h2 id="performance-schema占用多少内存"><a href="#performance-schema占用多少内存" class="headerlink" title="performance_schema占用多少内存"></a>performance_schema占用多少内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SELECT SUBSTRING_INDEX(event_name,&apos;/&apos;,2) AS  </span><br><span class="line">         code_area, sys.format_bytes(SUM(current_alloc))  </span><br><span class="line">         AS current_alloc  </span><br><span class="line">         FROM sys.x$memory_global_by_current_bytes  </span><br><span class="line">         GROUP BY SUBSTRING_INDEX(event_name,&apos;/&apos;,2)  </span><br><span class="line">         ORDER BY SUM(current_alloc) DESC;</span><br></pre></td></tr></table></figure><h2 id="每个线程占用多少内存"><a href="#每个线程占用多少内存" class="headerlink" title="每个线程占用多少内存"></a>每个线程占用多少内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SELECT ( ( @@read_buffer_size  </span><br><span class="line">   + @@read_rnd_buffer_size  </span><br><span class="line">   + @@sort_buffer_size  </span><br><span class="line">   + @@join_buffer_size  </span><br><span class="line">   + @@binlog_cache_size  </span><br><span class="line">   + @@thread_stack  </span><br><span class="line">   + @@max_allowed_packet  </span><br><span class="line">   + @@net_buffer_length )  </span><br><span class="line">   ) / (1024*1024) AS MEMORY_MB;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;分析mysql内存结构&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ADAM采集器用户手册</title>
    <link href="https://zixujing.github.io/2019/01/14/db/postgresql/oracle_to_ppas/"/>
    <id>https://zixujing.github.io/2019/01/14/db/postgresql/oracle_to_ppas/</id>
    <published>2019-01-13T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.066Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ADAM采集器简介"><a href="#ADAM采集器简介" class="headerlink" title="ADAM采集器简介"></a>ADAM采集器简介</h2><p>  采集器是ADAM整个产品的非常关键的部分，采集的信息的正确性、完整性、及时有效性，直接影响整个迁移过程。<br><a id="more"></a></p><h2 id="主要步骤"><a href="#主要步骤" class="headerlink" title="主要步骤"></a>主要步骤</h2><ol><li>下载 ADAM 客户端<ul><li>登录阿里云,如果已有账号，可直接登录，否则请先注册后，在登录。</li><li>进入到 数据库和应用服务 ADAM 界面，目前产品处于公测阶段，可以先申请公测资格，免费使用该产品。</li><li>进入 ADAM 管理控制台， 在左侧导航栏中单击客户端下载。可以根据自己的运行环境，下载相应的客户端版本 Windows 64 位、 Linux 64 位，不要在32 位操作系统上运行以上版本。</li></ul></li><li>环境要求<ul><li>网络：需要可以连接到采集的数据库（通过tnsnames的方式进行采集）</li><li>机器：<ul><li>CPU: 2C+</li><li>内存： 8g+</li><li>磁盘空间： 20g+</li><li>网路带宽： 千兆网+</li></ul></li></ul></li><li>操作系统：<ul><li>CentOS6.x+， RedHat6.x+， Oracle Linux6.x+等</li><li>Windows XP， 7， 8， 10+， Windows Server 2003+等</li></ul></li><li><p>数据库环境：</p><ul><li><p>开启归档</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; archive log list</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line"><span class="comment">-- 启动数据库 mount 状态</span></span><br><span class="line">SQL&gt; startup mount</span><br><span class="line"><span class="comment">-- 打开归档</span></span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line"><span class="comment">-- 检查归档开启,Enabled 表示开启</span></span><br><span class="line">SQL&gt; archive log list;</span><br><span class="line"><span class="comment">-- 打开数据库</span></span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line"><span class="comment">-- 切换归档</span></span><br><span class="line">SQL&gt; alter system switch logfile</span><br></pre></td></tr></table></figure></li><li><p>开启最小补充日志</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查最小补充日志是否开启,NO 表示未开启</span></span><br><span class="line">SQL&gt; select supplemental_log_data_min from v$database;</span><br><span class="line"><span class="comment">-- 开启最小补充日志</span></span><br><span class="line">SQL&gt; alter database add supplemental log data;</span><br><span class="line"><span class="comment">-- 验证已经开启,YES 表示已经开启</span></span><br><span class="line">SQL&gt; select supplemental_log_data_min from v$database;</span><br></pre></td></tr></table></figure></li><li><p>创建采集账号</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建采集用户 eoa_user, 并设置密码为 eoaPASSW0RD</span></span><br><span class="line">SQL&gt; create user eoa_user identified by "eoaPASSW0RD" default tablespace users;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予查询权限</span></span><br><span class="line">SQL&gt; grant connect,resource,select_catalog_role,select any dictionary to eoa_user;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予执行 DBMS_LOGMNR 权限</span></span><br><span class="line"><span class="comment">-- (版本 10g 数据库需先执行: CREATE OR REPLACE PUBLIC SYNONYM dbms_logmnr FOR sys.dbms_logmnr)</span></span><br><span class="line">SQL&gt; grant execute on DBMS_LOGMNR to eoa_user;</span><br><span class="line"><span class="comment">--为 eoa_user 用户赋予执行 DBMS_METADATA 权限，查询数据对象 DDL 语句</span></span><br><span class="line">SQL&gt; grant execute on dbms_metadata to eoa_user;</span><br><span class="line"><span class="comment">-- 为 eoa_user 用户赋予查询事务权限</span></span><br><span class="line">SQL&gt; grant select any transaction to eoa_user;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="采集数据"><a href="#采集数据" class="headerlink" title="采集数据"></a>采集数据</h2><ol><li><p>解压采集包:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf rainmeter-linux64.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> rainmeter</span></span><br></pre></td></tr></table></figure></li><li><p>采集方式：</p><ul><li><p>单次性采集<br>只采集一次全量数据，采集完进程就退出。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sh onekeyCollect.sh -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt;</span><br><span class="line">$#sh onekeyCollect.sh -h192.168.106.174 -ueoa_user -p eoaPASSW0RD -dorcl -P1521</span><br></pre></td></tr></table></figure></li><li><p>周期性采集（最好采集1周以上）</p><ul><li><p>第一次采集全量数据，后面定时增量收集 SQL 相关数据直到执行取消命令（ctrl +c）。 或者直接进行周期性采集（包含1次全量采集）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh asynCollect.sh -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt; -P&lt;port&gt;</span><br></pre></td></tr></table></figure></li><li><p>采集结果打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh asynExport[.sh|.bat] -h&lt;ip&gt; -u&lt;username&gt; -p&lt;password&gt; -d&lt;service_name|sid&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>清理采集账号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; drop user eoa_user cascade;</span><br></pre></td></tr></table></figure></li></ol><h2 id="上传采集数据包"><a href="#上传采集数据包" class="headerlink" title="上传采集数据包"></a>上传采集数据包</h2><ol><li>登录 阿里云 ADAM 控制台(<a href="https://rainbow-console.aliyun.com/studio.htm?spm=a2c4g.11186623.2.10.41c05d6egD44MV)，项目管理，新建项目" target="_blank" rel="noopener">https://rainbow-console.aliyun.com/studio.htm?spm=a2c4g.11186623.2.10.41c05d6egD44MV)，项目管理，新建项目</a>.</li><li>点击进入项目，上传数据包（数据包务必是 ZIP 压缩包）。点击分析。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ADAM采集器简介&quot;&gt;&lt;a href=&quot;#ADAM采集器简介&quot; class=&quot;headerlink&quot; title=&quot;ADAM采集器简介&quot;&gt;&lt;/a&gt;ADAM采集器简介&lt;/h2&gt;&lt;p&gt;  采集器是ADAM整个产品的非常关键的部分，采集的信息的正确性、完整性、及时有效性，直接影响整个迁移过程。&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql主从搭建</title>
    <link href="https://zixujing.github.io/2019/01/11/db/mysql/mysql%E5%A4%8D%E5%88%B6%E6%90%AD%E5%BB%BA/"/>
    <id>https://zixujing.github.io/2019/01/11/db/mysql/mysql复制搭建/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.060Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>mysql复制搭建过程<br><a id="more"></a></p></blockquote><h2 id="关键配置参数"><a href="#关键配置参数" class="headerlink" title="关键配置参数"></a>关键配置参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---master----</span><br><span class="line">server-id=1</span><br><span class="line">log-bin=master-bin</span><br><span class="line">---slaver----</span><br><span class="line">server-id=2</span><br><span class="line">log-bin=slavera-bin</span><br></pre></td></tr></table></figure><h2 id="备份master"><a href="#备份master" class="headerlink" title="备份master"></a>备份master</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">innobackupex --user=root --password=root --slaver-info</span><br><span class="line">--database=dataprocessno1_bigdata /root/bak</span><br></pre></td></tr></table></figure><h2 id="打包备份"><a href="#打包备份" class="headerlink" title="打包备份"></a>打包备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf bak.tar.gz bak</span><br></pre></td></tr></table></figure><h2 id="备份拷贝到目标机器"><a href="#备份拷贝到目标机器" class="headerlink" title="备份拷贝到目标机器"></a>备份拷贝到目标机器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp bak.tar.gz 192.168.106.174:/root/bak</span><br></pre></td></tr></table></figure><h2 id="Slaver还原"><a href="#Slaver还原" class="headerlink" title="Slaver还原"></a>Slaver还原</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf bak.tar.gz</span><br><span class="line">cd bak</span><br><span class="line">mv * ../</span><br><span class="line">innobackupex --user=root --apply-log /root/bak/2018-01-10_16-09-46</span><br><span class="line">innobackupex --user=root --copy-back /root/bak/2018-01-10_16-09-46</span><br><span class="line">chown mysql:mysql -R /usr/local/mysql/data</span><br></pre></td></tr></table></figure><h2 id="Master创建复制帐号"><a href="#Master创建复制帐号" class="headerlink" title="Master创建复制帐号"></a>Master创建复制帐号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to repl@&apos;192.168.106.%&apos; identified by</span><br><span class="line">&apos;repl&apos;;</span><br></pre></td></tr></table></figure><h2 id="启动slaver并指向master"><a href="#启动slaver并指向master" class="headerlink" title="启动slaver并指向master"></a>启动slaver并指向master</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle 2018-01-10_16-09-46]# cat xtrabackup_binlog_info</span><br><span class="line">master-bin.000001 154</span><br><span class="line">mysql&gt;change master to</span><br><span class="line">master_host=&apos;192.168.106.234&apos;,master_user=&apos;repl&apos;,master_password=&apos;repl&apos;,master_log_file=&apos;master-bin.000001&apos;,master_log_pos=154;</span><br><span class="line">mysql&gt;start slave;</span><br><span class="line">mysql&gt;show slave status\G</span><br><span class="line">Slave_IO_State: Waiting for master to send event</span><br><span class="line">Master_Host: 192.168.106.234</span><br><span class="line">Master_User: repl</span><br><span class="line">Master_Port: 3306</span><br><span class="line">Connect_Retry: 60</span><br><span class="line">Master_Log_File: master-bin.000001</span><br><span class="line">Read_Master_Log_Pos: 593</span><br><span class="line">Relay_Log_File: oracle-relay-bin.000002</span><br><span class="line">Relay_Log_Pos: 760</span><br><span class="line">Relay_Master_Log_File: master-bin.000001</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line">Replicate_Do_DB:</span><br><span class="line">Replicate_Ignore_DB:</span><br><span class="line">Replicate_Do_Table:</span><br><span class="line">Replicate_Ignore_Table:</span><br><span class="line">Replicate_Wild_Do_Table:</span><br><span class="line">Replicate_Wild_Ignore_Table:</span><br><span class="line">Last_Errno: 0</span><br><span class="line">Last_Error:</span><br><span class="line">Skip_Counter: 0</span><br><span class="line">Exec_Master_Log_Pos: 593</span><br><span class="line">Relay_Log_Space: 968</span><br><span class="line">Until_Condition: None</span><br><span class="line">Until_Log_File:</span><br><span class="line">Until_Log_Pos: 0</span><br><span class="line">Master_SSL_Allowed: No</span><br><span class="line">Master_SSL_CA_File:</span><br><span class="line">Master_SSL_CA_Path:</span><br><span class="line">Master_SSL_Cert:</span><br><span class="line">Master_SSL_Cipher:</span><br><span class="line">Master_SSL_Key:</span><br><span class="line">Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">Last_IO_Errno: 0</span><br><span class="line">Last_IO_Error:</span><br><span class="line">Last_SQL_Errno: 0</span><br><span class="line">Last_SQL_Error:</span><br><span class="line">Replicate_Ignore_Server_Ids:</span><br><span class="line">Master_Server_Id: 1</span><br><span class="line">Master_UUID: a34d437a-f5da-11e7-a514-000c298fe627</span><br><span class="line">Master_Info_File: /usr/local/mysql/data/master.info</span><br><span class="line">SQL_Delay: 0</span><br><span class="line">SQL_Remaining_Delay: NULL</span><br><span class="line">Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">Master_Retry_Count: 86400</span><br><span class="line">Master_Bind:</span><br><span class="line">Last_IO_Error_Timestamp:</span><br><span class="line">Last_SQL_Error_Timestamp:</span><br><span class="line">Master_SSL_Crl:</span><br><span class="line">Master_SSL_Crlpath:</span><br><span class="line">Retrieved_Gtid_Set:</span><br><span class="line">Executed_Gtid_Set:</span><br><span class="line">Auto_Position: 0</span><br><span class="line">Replicate_Rewrite_DB:</span><br><span class="line">Channel_Name:</span><br><span class="line">Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>检查Slave_IO_Running: Yes，Slave_SQL_Running: Yes证明搭建成功</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;mysql复制搭建过程&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="https://zixujing.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Ogg-monitor--server-and-agent12.2.1-安装</title>
    <link href="https://zixujing.github.io/2019/01/11/ogg/Ogg-monitor--server-and-agent12.2.1-%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/01/11/ogg/Ogg-monitor--server-and-agent12.2.1-安装/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.073Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>监控ogg<br><a id="more"></a></p></blockquote><blockquote><p>文档下载</p></blockquote><table><thead><tr><th>文档名</th><th>下载  </th></tr></thead><tbody><tr><td>Ogg-monitor–server-and-agent12.2.1-安装.docx</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/Ogg-monitor--server-and-agent12.2.1-安装.docx" target="_blank" rel="noopener">点</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;监控ogg&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>MSSQL for linux 安装</title>
    <link href="https://zixujing.github.io/2019/01/11/db/mssql/mssql_for_linux/"/>
    <id>https://zixujing.github.io/2019/01/11/db/mssql/mssql_for_linux/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.056Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://packages.microsoft.com/config/rhel/7/" target="_blank" rel="noopener">https://packages.microsoft.com/config/rhel/7/</a><br>mssql地址<br><a id="more"></a></p><ul><li>获取yum源</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# curl https://packages.microsoft.com/config/rhel/7/mssql-server-2017.repo &gt;/etc/yum.repos.d/mssql-server.repo</span><br></pre></td></tr></table></figure><ul><li>安装MSSQL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# yum install mssql-server</span><br><span class="line">[root@yth-test bin]# cd /opt/mssql/bin</span><br><span class="line">[root@yth-test bin]# ./mysql-conf setup</span><br></pre></td></tr></table></figure><ul><li>查看服务状态</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mssql</span><br></pre></td></tr></table></figure><ul><li>安装工具</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yth-test bin]# curl https://packages.microsoft.com/config/rhel/7/prod.repo &gt; /etc/yum.repos.d/prod.repo</span><br><span class="line">[root@yth-test bin]# yum install mssql-tools</span><br><span class="line">[root@yth-test bin]# pwd</span><br><span class="line">/opt/mssql-tools/bin</span><br><span class="line">[root@yth-test bin]# ./sqlcmd -S localhost -U sa</span><br></pre></td></tr></table></figure><ul><li>win安装SSMS<blockquote><p><a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=8961" target="_blank" rel="noopener">https://www.microsoft.com/zh-cn/download/details.aspx?id=8961</a></p></blockquote></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://packages.microsoft.com/config/rhel/7/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://packages.microsoft.com/config/rhel/7/&lt;/a&gt;&lt;br&gt;mssql地址&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="mssql" scheme="https://zixujing.github.io/tags/mssql/"/>
    
  </entry>
  
  <entry>
    <title>Oracle RAC搭建过程</title>
    <link href="https://zixujing.github.io/2019/01/11/db/oracle/oracle_rac/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2019/01/11/db/oracle/oracle_rac/数据库集群搭建文档/</id>
    <published>2019-01-10T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.065Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>oracle rac环境搭建<br><a id="more"></a></p></blockquote><h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><h3 id="网络环境"><a href="#网络环境" class="headerlink" title="网络环境"></a>网络环境</h3><table><thead><tr><th><strong>节点</strong></th><th><strong>IP</strong></th></tr></thead><tbody><tr><td>节点一</td><td>public ip</td></tr><tr><td>节点一</td><td>private ip</td></tr><tr><td>节点二</td><td>public ip</td></tr><tr><td>节点二</td><td>private ip</td></tr><tr><td>虚拟IP</td><td>vip1</td></tr><tr><td>虚拟IP</td><td>vip2</td></tr><tr><td>SCAN IP</td><td>sip1</td></tr><tr><td>SCAN IP</td><td>sip2</td></tr><tr><td>SCAN IP</td><td>sip3</td></tr></tbody></table><h3 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h3><p>Oracle版本是11.2.0.4</p><h3 id="主机系统环境（所有节点均设置）"><a href="#主机系统环境（所有节点均设置）" class="headerlink" title="主机系统环境（所有节点均设置）"></a>主机系统环境（所有节点均设置）</h3><h4 id="修改OS系统标识"><a href="#修改OS系统标识" class="headerlink" title="修改OS系统标识"></a>修改OS系统标识</h4><blockquote><p>Oracle默认不支持CentOS系统安装,我们需要将系统标识修改为Redhat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;Red Hat Enterprise Linux Server release 7.0 (Maipo)&quot; &gt;/etc/redhat-release</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><blockquote><p>节点一<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname ol7-112-rac1.localdomain</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>节点二<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname ol7-112-rac2.localdomain</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="修改系统内核参数"><a href="#修改系统内核参数" class="headerlink" title="修改系统内核参数"></a>修改系统内核参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;</span><br><span class="line">fs.aio-max-nr = 1048576</span><br><span class="line">fs.file-max = 6815744</span><br><span class="line">kernel.shmall = 7864320</span><br><span class="line">kernel.shmmax = 132212254720</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">#semaphores: semmsl, semmns, semopm, semmni</span><br><span class="line">kernel.sem = 250 32000 100 128</span><br><span class="line">net.core.rmem_default=262144</span><br><span class="line">net.core.rmem_max=16777216</span><br><span class="line">net.core.wmem_default=262144</span><br><span class="line">net.core.wmem_max=16777216</span><br><span class="line">net.core.somaxconn=4096</span><br><span class="line">net.core.netdev_max_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_syn_backlog=262144</span><br><span class="line">net.ipv4.tcp_max_tw_buckets=10000</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 3600</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">vm.swappiness = 0</span><br><span class="line">vm.panic_on_oom = 1</span><br><span class="line">kernel.randomize_va_space=0&quot; &gt;&gt;/etc/sysctl.conf</span><br><span class="line">#让修改后的内核参数生效</span><br><span class="line">[root@localhost ~]# sysctl –p</span><br></pre></td></tr></table></figure><h4 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;#Public</span><br><span class="line">22.203.144.3 ol7-112-rac1.localdomain ol7-112-rac1</span><br><span class="line">22.203.144.5 ol7-112-rac2.localdomain ol7-112-rac2</span><br><span class="line">#Private</span><br><span class="line">192.168.1.111 ol7-112-rac1-priv.localdomain ol7-112-rac1-priv</span><br><span class="line">192.168.1.112 ol7-112-rac2-priv.localdomain ol7-112-rac2-priv</span><br><span class="line">#Virtual</span><br><span class="line">22.203.144.240 ol7-112-rac1-vip.localdomain ol7-112-rac1-vip</span><br><span class="line">22.203.144.241 ol7-112-rac2-vip.localdomain ol7-112-rac2-vip</span><br><span class="line">#SCAN</span><br><span class="line">22.203.144.242 ol7-112-scan.localdomain ol7-112-scan</span><br><span class="line">22.203.144.243 ol7-112-scan.localdomain ol7-112-scan</span><br><span class="line">22.203.144.244 ol7-112-scan.localdomain ol7-112-scan</span><br><span class="line">&quot; &gt;&gt;/etc/hosts</span><br></pre></td></tr></table></figure><h4 id="修改操作系统资源限制"><a href="#修改操作系统资源限制" class="headerlink" title="修改操作系统资源限制"></a>修改操作系统资源限制</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;#ORACLE</span><br><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 4096</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240&quot; &gt;&gt;/etc/security/limits.conf</span><br><span class="line">[root@localhost ~]# echo &quot;#GRID</span><br><span class="line">grid soft nproc 2047</span><br><span class="line">grid hard nproc 16384</span><br><span class="line">grid soft nofile 4096</span><br><span class="line">grid hard nofile 65536</span><br><span class="line">grid soft stack 10240&quot; &gt;&gt;/etc/security/limits.conf</span><br><span class="line">echo &quot;session required pam_limits.so&quot; &gt;&gt;/etc/pam.d/login</span><br><span class="line">[root@localhost ~]# vi /etc/security/limits.d/20-nproc.conf</span><br><span class="line">#修改参数</span><br><span class="line">* soft nproc 1024</span><br><span class="line">#为</span><br><span class="line">* - nproc 16384</span><br></pre></td></tr></table></figure><h4 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# groupadd -g 54321 oinstall</span><br><span class="line">[root@localhost ~]# groupadd -g 54322 dba</span><br><span class="line">[root@localhost ~]# groupadd -g 54323 oper</span><br><span class="line">[root@localhost ~]# groupadd -g 54327 asmdba</span><br><span class="line">[root@localhost ~]# groupadd -g 54328 asmoper</span><br><span class="line">[root@localhost ~]# groupadd -g 54329 asmadmin</span><br><span class="line">[root@localhost ~]# useradd -u 54321 -g oinstall -G dba,asmadmin,asmdba,asmoper grid</span><br><span class="line">[root@localhost ~]# useradd -u 54322 -g oinstall -G dba,oper,asmadmin,asmdba oracle</span><br></pre></td></tr></table></figure><h4 id="分别为grid和oracle用户设置密码"><a href="#分别为grid和oracle用户设置密码" class="headerlink" title="分别为grid和oracle用户设置密码"></a>分别为grid和oracle用户设置密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# passwd grid</span><br><span class="line">[root@localhost ~]# passwd oracle</span><br></pre></td></tr></table></figure><h4 id="修改oracle用户环境变量"><a href="#修改oracle用户环境变量" class="headerlink" title="修改oracle用户环境变量"></a>修改oracle用户环境变量</h4><blockquote><p>节点一：在/home/oracle/.bash_profile末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#Oracle Settings</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=$TMP</span><br><span class="line">export ORACLE_HOSTNAME=ol7-112-rac1.localdomain</span><br><span class="line">export ORACLE_UNQNAME=ORCL</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0.1/db_1</span><br><span class="line">export ORACLE_SID=ORCL1</span><br><span class="line">export ORACLE_TERM=xterm</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>节点二：在/home/oracle/.bash_profile末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#Oracle Settings</span><br><span class="line">export TMP=/tmp</span><br><span class="line">export TMPDIR=$TMP</span><br><span class="line">export ORACLE_HOSTNAME=ol7-112-rac2.localdomain</span><br><span class="line">export ORACLE_UNQNAME=ORCL</span><br><span class="line">export ORACLE_BASE=/u01/app/oracle</span><br><span class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0.1/db_1</span><br><span class="line">export ORACLE_SID=ORCL2</span><br><span class="line">export ORACLE_TERM=xterm</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="修改grid用户环境变量"><a href="#修改grid用户环境变量" class="headerlink" title="修改grid用户环境变量"></a>修改grid用户环境变量</h4><blockquote><p>节点一：在/home/grid/.bash_profile末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Grid Settings</span><br><span class="line">export ORACLE_SID=+ASM1</span><br><span class="line">export ORACLE_BASE=/u01/app/grid</span><br><span class="line">export ORACLE_HOME=/u01/app/11.2.0.1/grid</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=\$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>节点二：在/home/grid/.bash_profile末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Grid Settings</span><br><span class="line">export ORACLE_SID=+ASM2</span><br><span class="line">export ORACLE_BASE=/u01/app/grid</span><br><span class="line">export ORACLE_HOME=/u01/app/11.2.0.1/grid</span><br><span class="line">export BASE_PATH=/usr/sbin:$PATH</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$BASE_PATH</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</span><br><span class="line">export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="创建目录及授权"><a href="#创建目录及授权" class="headerlink" title="创建目录及授权"></a>创建目录及授权</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir -p /u01/app/grid</span><br><span class="line">[root@localhost ~]# mkdir -p /u01/app/11.2.0.1/grid</span><br><span class="line">[root@localhost ~]# chown -R grid:oinstall /u01/app/grid</span><br><span class="line">[root@localhost ~]# chown -R grid:oinstall /u01/app/11.2.0.1</span><br><span class="line">[root@localhost ~]# mkdir -p /u01/app/oracle</span><br><span class="line">[root@localhost ~]# mkdir -p /u01/app/oracle/product/11.2.0.1/db_1</span><br><span class="line">[root@localhost ~]# chown oracle:oinstall /u01/app</span><br><span class="line">[root@localhost ~]# chown -R oracle:oinstall /u01/app/oracle</span><br><span class="line">[root@localhost ~]# chown -R oracle:oinstall /u01/app/oracle/product/11.2.0.1/db_1</span><br><span class="line">[root@localhost ~]# chmod -R 0775 /u01</span><br></pre></td></tr></table></figure><h4 id="安装grid与oracle所需的软件环境"><a href="#安装grid与oracle所需的软件环境" class="headerlink" title="安装grid与oracle所需的软件环境"></a>安装grid与oracle所需的软件环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#根据实际情况变动</span><br><span class="line">[root@localhost ~]# rpm -Uvh compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh ksh-20120801-137.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh unixODBC-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh unixODBC-devel-2.3.1-11.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh zlib-devel-1.2.7-17.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh elfutils-libelf-devel-0.170-4.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXmu-1.1.2-2.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh libXaw-1.0.13-4.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh xterm-295-3.el7.x86_64.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh perl-Switch-2.16-7.el7.noarch.rpm</span><br><span class="line">#以下可以不安装</span><br><span class="line">[root@localhost ~]# rpm -ivh nss-softokn-freebl-3.34.0-2.el7.i686.rpm glibc-2.17-222.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh glibc-devel-2.17-222.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libgcc-4.8.5-28.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libstdc++-4.8.5-28.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libstdc++-devel-4.8.5-28.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libaio-0.3.109-13.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libaio-devel-0.3.109-13.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -Uvh compat-libstdc++-33-3.2.3-72.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXau-1.0.8-2.1.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libxcb-1.12-1.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libX11-1.6.5-1.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXext-1.3.3-3.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXi-1.7.9-1.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXtst-1.2.3-1.el7.i686.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh libXp-1.0.2-2.1.el7.x86_64.rpm</span><br><span class="line">#在grid目录下</span><br><span class="line">[root@localhost ~]# rpm -ivh cvuqdisk-1.0.9-1.rpm</span><br></pre></td></tr></table></figure><h4 id="设置selinux并使之生效"><a href="#设置selinux并使之生效" class="headerlink" title="设置selinux并使之生效"></a>设置selinux并使之生效</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed -i &apos;/SELINUX=enforcing/s/enforcing/permissive/g&apos; /etc/selinux/config</span><br><span class="line">[root@localhost ~]# setenforce Permissive</span><br></pre></td></tr></table></figure><h4 id="关闭防火墙并取消开机启动"><a href="#关闭防火墙并取消开机启动" class="headerlink" title="关闭防火墙并取消开机启动"></a>关闭防火墙并取消开机启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld</span><br><span class="line">[root@localhost ~]# systemctl disable firewalld</span><br></pre></td></tr></table></figure><h4 id="设置NTP时钟"><a href="#设置NTP时钟" class="headerlink" title="设置NTP时钟"></a>设置NTP时钟</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop ntpd</span><br><span class="line">[root@localhost ~]# systemctl disable ntpd</span><br><span class="line">[root@localhost ~]# mv /etc/ntp.conf /etc/ntp.conf.orig</span><br></pre></td></tr></table></figure><h3 id="存储配置-在所有节点均要操作"><a href="#存储配置-在所有节点均要操作" class="headerlink" title="存储配置(在所有节点均要操作)"></a>存储配置(在所有节点均要操作)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;KERNEL==\&quot;sd?\&quot;, SUBSYSTEM==\&quot;block\&quot;, PROGRAM=\&quot;/lib/udev/scsi_id --whitelisted --replace-whitespace /dev/\$name\&quot;,RESULT==\&quot;`/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/mapper/Data01`\&quot;, RUN+=\&quot;/bin/sh -c &apos;mknod /dev/asm-disk1 b \$major \$minor;chown grid:asmadmin /dev/asm-disk1;chmod 0660 /dev/asm-disk1&apos;\&quot;&quot; &gt;&gt;/etc/udev/rules.d/99-oracle-asmdevices.rules</span><br></pre></td></tr></table></figure><blockquote><p>执行如下（重启），让磁盘绑定生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# udevadm control --reload-rules</span><br><span class="line">[root@localhost ~]# udevadm trigger</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>查看磁盘绑定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -al /dev/asm\*</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="安装Grid-Infrastructure"><a href="#安装Grid-Infrastructure" class="headerlink" title="安装Grid Infrastructure"></a>安装Grid Infrastructure</h2><p>根据图示步骤安装<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/18306532ebcaf56b496608d996455d55.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c08970072aa686f091d91530f752a29b.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/6cc8ace9845bfe4a1ea20d4794392ba0.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/cfc52fc756e97d45bc6fcde283e8f174.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/67999ce6a98e779832ff05cadbd6ecd4.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/9260bb676028aac8e84c56bd14194535.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/0ef825cafb9ad1f1ac7d60e92328fba8.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c7e320dcd5314f1bca712f3b1943703c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/43b606760374161e5bba7d82460d2e6f.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/f63631f8f981ac63e62cbbb427fc1ecb.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c54cfbc038777d2af0de3c1cff544005.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/1552623de48bb70dbf31e2c3e05636c3.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/3eba50867863d1922d8d40916299230c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/ffdbab777d8fbfcd09c30fa0039687d5.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/15097b2b5446318ffd31198ba423c129.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/5a05b8cdad5a1a059516af2aedae2a0c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/1fca619471abf215217798165c2087ae.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/44581c5310e13733a9e281fa2392c972.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/66d20393352a3cd260ca3511f6d7eb77.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/0f6b6993b03c3271d18cad23e9545aed.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/39bbc205ab43536f9bdf540d026f1f8c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/ed922ef6cebd27498de58394025eb84a.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c437d687240a3b118760e2afcdf72f83.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/3c505d4c7a9e77557c33535261d4315b.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/afb403402f5d2eb0f38b6b34d1afb051.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/5945d70b55fffd8531ca206f684207d6.png" alt=""></p><blockquote><p>使用root用户在节点1上执行orainstRoot.sh如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/32e274d7b5279e958ff20646cbe2ceae.png" alt=""><br>使用root用户在节点2上执行orainstRoot.sh如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/eae23ec058d9537d0cb70edd99938854.png" alt=""><br>使用root用户在节点1上执行root.sh如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/a707c515a6220722d9a231b08939a8dd.png" alt=""><br>等待提示“Creating /etc/oratab file……”时，新打开一个会话执行如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo &quot;[Unit]</span><br><span class="line">Description=Oracle Hight Availability Services</span><br><span class="line">After=syslog.target</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/etc/init.d/init.ohasd run &gt; /dev/null 2&gt;&amp;1 Type=simple</span><br><span class="line">Restart=always</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target&quot; &gt; /usr/lib/systemd/system/ohas.service</span><br><span class="line">#systemctl deamon-reload</span><br><span class="line">1.  systemctl enable ohas</span><br><span class="line">2.  systemctl start ohas</span><br><span class="line">3.  systemctl restart ohas</span><br><span class="line">4.  等待提示“Configure Oracle Grid Infrastructure for a Cluster</span><br><span class="line">    succeeded”表示在节点1上运行完成并无错误</span><br></pre></td></tr></table></figure></p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/1dca44773722a8f026287bf550dd1fac.png" alt=""></p><blockquote><p>使用root用户在节点2上执行root.sh如下图<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/68205f805fe45aedcf6e2139661498ba.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/04b23cc84e099b88774e4900b9b810eb.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c532593a112fb9849932bb7d3870e934.png" alt=""></p></blockquote><h2 id="安装oracle数据库软件"><a href="#安装oracle数据库软件" class="headerlink" title="安装oracle数据库软件"></a>安装oracle数据库软件</h2><p>根据图示安装<br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/e2535c0fe99c1ef93409f6ea24e63dae.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/05b377dffa8f5638416a0963fac4de47.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/9fa73cef5e3e22383bc781b44555649d.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/a5487dadcce7d54b1be395648391a4a6.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/2b880b7368d13bd3c15da3595279b795.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/63fea69d5ab14f89c5fd043870f4aa72.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/a78288efb4925077aaaf74628701fac2.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/edd06f0fca0e3b10ae6d8e8723fe24e2.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/2ea69a971033871fc7799c73bc3e4d4e.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/dd3201d2fd08842dab4432210cd416e6.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/8108653d2ad7e3763189192b2056255c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/710740ba4beaf04f98b162752aa144cd.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/e01e4f21b03740a3545107945a4ec5aa.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/6369e6e07bd3c1e3486910005e62dfcb.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/e7c404ebb8b9fe4f617e5364b2ef425e.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/c04c9167cdd9eafaebf2dbbefa2ed1b3.png" alt=""></p><h2 id="安装oracle数据库"><a href="#安装oracle数据库" class="headerlink" title="安装oracle数据库"></a>安装oracle数据库</h2><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/a7c6215f7e1fc5aa9668a21373807f9c.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/9dc560b68b6744ddafca42a063610b56.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/41b7edef0c5f42543dfcc81e5c054293.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/af292d26d5e5feadc0232eef8e3d4019.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/f930f1ec9cc605b50670c71dcbe18165.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/0494212357c509c405a54f9783be159b.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/62b40e1efdc8ee9d837382885c765e32.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/014f9b2aec5d1ec4622fc23c546f060f.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/e1e4dca5ddb4be46bfc1175d6bdf82fc.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/7468b265dcb23f30de7b295f23e59c99.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/2554850788198198a470ad1cf31b76cd.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/493d416c4c465a251eb6389650fea77f.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/493d416c4c465a251eb6389650fea77f.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/6af9ee42e0414c0abade4388b68c6d2d.png" alt=""><br><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/55dc51d61878a35c10b45717b60e011e.png" alt=""></p><blockquote><p>遇到编译错误，修改以下参数解决：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi $ORACLE_HOME/sysman/lib/ins_emagent.mk</span><br><span class="line">#Search for the line</span><br><span class="line">$(MK_EMAGENT_NMECTL)</span><br><span class="line">#Change it to:</span><br><span class="line">$(MK_EMAGENT_NMECTL) -lnnz11</span><br></pre></td></tr></table></figure></p></blockquote><p><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/ora_rac/561558e50661509279a4ab8e070f4948.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;oracle rac环境搭建&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>oracle cdc</title>
    <link href="https://zixujing.github.io/2019/01/08/db/oracle/oracle_cdc/oracle_cdc/"/>
    <id>https://zixujing.github.io/2019/01/08/db/oracle/oracle_cdc/oracle_cdc/</id>
    <published>2019-01-07T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.063Z</updated>
    
    <content type="html"><![CDATA[<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><blockquote><p>oracle也具有cdc的功能，原理如下。<br><a id="more"></a></p></blockquote><h1 id="Oracle-CDC-简介"><a href="#Oracle-CDC-简介" class="headerlink" title="Oracle CDC 简介"></a>Oracle CDC 简介</h1><p>   很多人都认为，只要是涉及到数据库数据复制和增量数据抽取，都是需要购买收费软件的。实际上，我们通过Oracle提供的CDC和LogMiner等免费工具也能实现数据库数据复制和增量数据抽取，各种数据复制软件只是使得获取增量数据更加便捷，或者是可以支持更多的扩展功能（例如：异构数据库之间的同步，ETL过程的数据清洗、装换），但实际Oracle本身是支持CDC机制，只是很少有人关注，操作起来也有些复杂，而且据传言并不稳定，常常见到论坛上爆出一些莫名其妙的问题。</p><h2 id="Synchronous-Change-Data-Capture-Configuration（同步复制）"><a href="#Synchronous-Change-Data-Capture-Configuration（同步复制）" class="headerlink" title="Synchronous Change Data Capture Configuration（同步复制）"></a>Synchronous Change Data Capture Configuration（同步复制）</h2><p>   <img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1068207-20170526192306372-1819930635.png" alt=""></p><p>   原理很简单，原表、目标表必须是同一个库，采用触发器的机制（设置同步CDC后，并看不到触发器，但实际运行机理还是触发器的机制）将原表内容复制到另一个目标表。这个机制就不多说了，和自己给表建触发器没什么太大差别。</p><h2 id="Asynchronous-HotLog-Configuration（异步在线日志CDC）"><a href="#Asynchronous-HotLog-Configuration（异步在线日志CDC）" class="headerlink" title="Asynchronous HotLog Configuration（异步在线日志CDC）"></a>Asynchronous HotLog Configuration（异步在线日志CDC）</h2><p>  <img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1068207-20170526192327279-376093983.png" alt=""></p><p>   这个过程已经没有触发器了，而是使用Redo Log，但是使用在线日志，并不是归档日志。并且原表、目标表仍然必须是同一个库。这种模式是相对简单的，同时这种模式是在Oracle 10以上才产生的，9i是没有这个机制的。</p><h2 id="Asynchronous-Distributed-HotLog-Configuration（异步分布式CDC）"><a href="#Asynchronous-Distributed-HotLog-Configuration（异步分布式CDC）" class="headerlink" title="Asynchronous Distributed HotLog Configuration（异步分布式CDC）"></a>Asynchronous Distributed HotLog Configuration（异步分布式CDC）</h2><p>  <img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1068207-20170526192342669-1522054385.png" alt=""><br>  实际这个模式是对异步在线日志CDC的一种优化，也比较容易理解，就是加入了DB-LINK机制，使原表、目标表不在同一个数据库。实际是和异步在线日志CDC没有什么本质区别。</p><h2 id="Asynchronous-Autolog-Online-Change-Data-Capture-Configuration（异步在线日志复制CDC）"><a href="#Asynchronous-Autolog-Online-Change-Data-Capture-Configuration（异步在线日志复制CDC）" class="headerlink" title="Asynchronous Autolog Online Change Data Capture Configuration（异步在线日志复制CDC）"></a>Asynchronous Autolog Online Change Data Capture Configuration（异步在线日志复制CDC）</h2><p>  <img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1068207-20170526192358513-964979174.png" alt=""><br>  异步在线日志复制CDC模式就要高级很多了，使用Standby Redo Log（热备数据库日志），实际就是使用Oracle的热备机制，将日志写入了热备数据库，目标表就可以建立在热备库上，这对主数据库性能影响就进一步降低。</p><h2 id="Asynchronous-AutoLog-Archive-Change-Data-Capture-Configuration（归档日志CDC）"><a href="#Asynchronous-AutoLog-Archive-Change-Data-Capture-Configuration（归档日志CDC）" class="headerlink" title="Asynchronous AutoLog Archive Change Data Capture Configuration（归档日志CDC）"></a>Asynchronous AutoLog Archive Change Data Capture Configuration（归档日志CDC）</h2><p>  <img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1068207-20170526192417247-198841881.png" alt=""><br>  归档日志CDC模式是最完美的模式，但是需要有机制可以获取归档日志（并行文件系统技术），然后在目标端分析归档日志进行变化数据处理，这种模式理论上来讲，几乎可以完全不影响原数据库的性能。<br>  坦白来说，我对Oracle理解并不深，只是为了解决特定的几个问题多看了一点，在现实工作中遇到类似问题需要解决的，或对技术痴狂的同学可以研究一下，我贴上了4种模式具体的设置步骤，虽然是英文的，但是还是非常明确的。（我比较推荐使用第二种，因为设置比较简单，性能上也属于中规中矩，如果没有什么特别要求，可以采用异步在线日志CDC。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;oracle也具有cdc的功能，原理如下。&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>SSH隧道</title>
    <link href="https://zixujing.github.io/2019/01/07/linux/linux%E9%9A%A7%E9%81%93/ssh%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/"/>
    <id>https://zixujing.github.io/2019/01/07/linux/linux隧道/ssh隧道技术/</id>
    <published>2019-01-06T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.071Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ssh</strong>具备隧道功能，windows使用putty。下载putty后有个plink文件<br><a id="more"></a></p></blockquote><h2 id="L正向隧道"><a href="#L正向隧道" class="headerlink" title="-L正向隧道"></a>-L正向隧道</h2><ul><li>forwindows<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plink -L 65534:192.168.106.213:22 root@192.168.106.213</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>-L的含义:中间机器为192.168.106.213.被冒号分隔的三个部分是，本地端口65534通过中间机器192.168.106.213连接到192.168.106.213的22端口。<strong>其中本地地址是ssh客户端，192.168.106.213是ssh的服务端</strong>。</p></blockquote><ul><li>forlinux<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -CfNg -L 65534:192.168.106.213:22 root@192.168.106.213</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>-f:后台yunxing<br>-N：不执行远程命令，专门转发。<br>-g：允许远程主机连接到建立的转发的端口，如果不加这个参数，只允许本地主机建立连接<br>-C：压缩数据传输<br>-T：不占用shell</p></blockquote><hr><h2 id="R反向隧道"><a href="#R反向隧道" class="headerlink" title="-R反向隧道"></a>-R反向隧道</h2><ul><li>forlinux<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -CfNg -R 192.168.106.237:65534:192.168.106.213:2222 root@192.168.106.237</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>含义：192.168.106.237是中间服务器，把192.168.106.237的65534端口数据发送到192.168.106.213的2222端口。<strong>其中192.168.106.237是ssh服务端，192.168.106.213是ssh的客户端</strong>。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ssh&lt;/strong&gt;具备隧道功能，windows使用putty。下载putty后有个plink文件&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="ssh" scheme="https://zixujing.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>oracle dg4odbc 搭建</title>
    <link href="https://zixujing.github.io/2019/01/06/db/oracle/dg4odbc_for_oracle/"/>
    <id>https://zixujing.github.io/2019/01/06/db/oracle/dg4odbc_for_oracle/</id>
    <published>2019-01-05T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.061Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>oracle创建dblink连接mysql。<br><a id="more"></a><br><a href="https://raw.githubusercontent.com/zixujing/book1/master/oracle dg4odbc for mysql.pdf" target="_blank" rel="noopener">pdf</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;oracle创建dblink连接mysql。&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="oracle" scheme="https://zixujing.github.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>postgresql绿色安装</title>
    <link href="https://zixujing.github.io/2019/01/06/db/postgresql/postgres%E7%BB%BF%E8%89%B2%E5%AE%89%E8%A3%85/"/>
    <id>https://zixujing.github.io/2019/01/06/db/postgresql/postgres绿色安装/</id>
    <published>2019-01-05T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.067Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>postgresql绿色程序在linux系统中安装。<br><a id="more"></a></p></blockquote><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PGDATA=/home/postgres/pgdata</span><br><span class="line">export PGUSER=postgres</span><br><span class="line">export PGPORT=5432</span><br><span class="line">export PATH=/home/postgres/pgsql/bin:$PATH</span><br></pre></td></tr></table></figure><h1 id="初始化数据目录"><a href="#初始化数据目录" class="headerlink" title="初始化数据目录"></a>初始化数据目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initdb -D /home/postgres/pgdata -E UTF8</span><br></pre></td></tr></table></figure><h1 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi pgdata/postgresql.conf</span><br><span class="line">llisten_addresses=&apos;*&apos;</span><br><span class="line"></span><br><span class="line">vi pgdata/pg_hba.conf</span><br><span class="line">hostallall0.0.0.0/0trust</span><br></pre></td></tr></table></figure><h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl -D /home/postgres/pgdata -l logfile.log start</span><br><span class="line">psql -d postgres</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;postgresql绿色程序在linux系统中安装。&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="https://zixujing.github.io/categories/db/"/>
    
    
      <category term="postgresql" scheme="https://zixujing.github.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>OGG测试手册</title>
    <link href="https://zixujing.github.io/2019/01/03/ogg/ogg%E6%B5%8B%E8%AF%95%E6%89%8B%E5%86%8C/"/>
    <id>https://zixujing.github.io/2019/01/03/ogg/ogg测试手册/</id>
    <published>2019-01-02T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.075Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ogg测试环境搭建<br><a id="more"></a><br><!-- toc --></p></blockquote><h1 id="源端数据库配置"><a href="#源端数据库配置" class="headerlink" title="源端数据库配置"></a>源端数据库配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">﻿sql&gt; alter database archivelog;</span><br><span class="line">sql&gt; alter database add supplemental log data;</span><br><span class="line">sql&gt; create user ogg identified by ogg;</span><br><span class="line">sql&gt; grant connect,resource to ogg;</span><br><span class="line">sql&gt; grant execute on utl_file to ogg;</span><br><span class="line">sql&gt; grant select any dictionary,select any table to ogg;</span><br><span class="line">sql&gt; grant alter any table to ogg;</span><br><span class="line">sql&gt; grant flashback any table to ogg;</span><br><span class="line">sql&gt; grant execute on DBMS_FLASHBACK to ogg;</span><br><span class="line">#直接赋dba权限即可，上面可以不用赋</span><br><span class="line">sql&gt; **grant dba to ogg;**</span><br></pre></td></tr></table></figure><h1 id="源端ogg配置"><a href="#源端ogg配置" class="headerlink" title="源端ogg配置"></a>源端ogg配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ogg&gt; dblogin userid ogg password ogg</span><br><span class="line">ogg&gt;  add trandata smartecap_numone_xj.*</span><br><span class="line">ogg&gt;  create subdirs</span><br><span class="line">ogg&gt;  edit params mgr</span><br><span class="line">PORT 7809</span><br><span class="line">ogg&gt; add trandata smartecap_numone_xj.*</span><br><span class="line">ogg&gt; info trandata smartecap_numone_xj.*</span><br><span class="line">#也可以同步schema信息</span><br><span class="line">ogg&gt; add extract exts,tranlog ,begin now</span><br><span class="line">ogg&gt; info all</span><br><span class="line">ogg&gt; add exttrail ./dirdat/st,extract exts,megabytes 100</span><br><span class="line">ogg&gt; edit params exts</span><br><span class="line"></span><br><span class="line">EXTRACT exts</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.UTF8&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">DISCARDFILE ./dirrpt/exts.dsc,APPEND,MEGABYTES 1024</span><br><span class="line">DBOPTIONS  ALLOWUNUSEDCOLUMN</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 350s</span><br><span class="line">EXTTRAIL ./dirdat/st</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">TRANLOGOPTIONS  CONVERTUCS2CLOBS</span><br><span class="line">IGNOREDELETES</span><br><span class="line">TABLE smartecap_numone_xj.*;</span><br><span class="line"></span><br><span class="line">ogg&gt;  add extract dpend,exttrailsource ./dirdat/st</span><br><span class="line">ogg&gt;  add rmttrail /home/oracle/app/oracle/ogg/dirdat/st ,extract dpend</span><br><span class="line">ogg&gt;  edit params dpend</span><br><span class="line">EXTRACT dpend</span><br><span class="line">SETENV (NLS_LANG = AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">PASSTHRU</span><br><span class="line">RMTHOST 192.168.106.213, MGRPORT 7809, compress</span><br><span class="line">RMTTRAIL /home/oracle/app/oracle/ogg/dirdat/st</span><br><span class="line">TABLE smartecap_numone_xj.*;</span><br></pre></td></tr></table></figure><h1 id="EXTRACT进程参数配置说明："><a href="#EXTRACT进程参数配置说明：" class="headerlink" title="EXTRACT进程参数配置说明："></a>EXTRACT进程参数配置说明：</h1><ol><li>SETENV：配置系统环境变量</li><li>USERID/ PASSWORD：指定OGG连接数据库的用户名和密码，这里使用3.4部分中创建的数据库用户OGG;</li><li>COMMENT：注释行，也可以用–来代替;</li><li>TABLE：定义需复制的表，后面需以;结尾</li><li>TABLEEXCLUDE：定义需要排除的表，如果在TABLE参数中使用了通配符，可以使用该参数指定排除掉得表。</li><li>GETUPDATEAFTERS|IGNOREUPDATEAFTERS：是否在队列中写入后影像，缺省复制</li><li>GETUPDATEBEFORES| IGNOREUPDATEBEFORES：是否在队列中写入前影像，缺省不复制</li><li>GETUPDATES|IGNOREUPDATES：是否复制UPDATE操作，缺省复制</li><li>GETDELETES|IGNOREDELETES：是否复制DELETE操作，缺省复制</li><li>GETINSERTS|IGNOREINSERTS：是否复制INSERT操作，缺省复制</li><li>GETTRUNCATES|IGNORETRUNDATES：是否复制TRUNCATE操作，缺省不复制；</li><li>RMTHOST：指定目标系统及其GoldengateManager进程的端口号，还用于定义是否使用压缩进行传输，本例中的compress为压缩传输；</li><li>RMTTRAIL：指定写入到目标断的哪个队列；</li><li>EXTTRAIL：指定写入到本地的哪个队列；</li><li>SQLEXEC：在extract进程运行时首先运行一个SQL语句；</li><li>PASSTHRU：禁止extract进程与数据库交互，适用于Data Pump传输进程；</li><li>REPORT：定义自动定时报告；</li><li>STATOPTIONS：定义每次使用stat时统计数字是否需要重置；</li><li>REPORTCOUNT：报告已经处理的记录条数统计数字；</li><li>TLTRACE：打开对于数据库日志的跟踪日志；</li><li>DISCARDFILE：定义discardfile文件位置，如果处理中油记录出错会写入到此文件中；</li><li>DBOPTIONS：指定对于某种特定数据库所需要的特殊参数；</li><li>TRANLOGOPTIONS：指定在解析数据库日志时所需要的特殊参数，例如：对于裸设备，可能需要加入以下参数 rawdeviceoggset 0</li><li>WARNLONGTRANS：指定对于超过一定时间的长交易可以在gsserr.log里面写入警告信息，本处配置为每隔3分钟检查一次场交易，对于超过2小时的进行警告；</li></ol><h1 id="目标端配置"><a href="#目标端配置" class="headerlink" title="目标端配置"></a>目标端配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ogg&gt; create subdirs</span><br><span class="line">ogg&gt; dblogin userid ogg,password ogg</span><br><span class="line">#需要checkpoint时 需指定。</span><br><span class="line">ogg&gt; add checkpointtable ogg.checkpoint</span><br><span class="line">ogg&gt; add replicat repnd,exttrail ./dirdat/st,checkpointtable ogg.checkpoint</span><br><span class="line">ogg&gt; edit param repnd</span><br><span class="line">REPLICAT repnd</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.UTF8&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">HANDLECOLLISIONS</span><br><span class="line">ASSUMETARGETDEFS</span><br><span class="line">ddloptions report</span><br><span class="line">MAP smartecap_numone_xj.*, TARGET smartecap_numone.*;</span><br><span class="line">--DISCARDFILE /u01/app/oracle/ogg/discards.dsc, append, megabytes 1024</span><br><span class="line">--TABLEEXCLUDE pdbjk.new_jk.SYS_EXPORT_SCHEMA*</span><br></pre></td></tr></table></figure><h1 id="ogg用户最简配置示例"><a href="#ogg用户最简配置示例" class="headerlink" title="ogg用户最简配置示例"></a>ogg用户最简配置示例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; create user tt identified by tt;</span><br><span class="line">sql&gt; grant connect,resource,dba to tt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ogg测试环境搭建&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
  </entry>
  
  <entry>
    <title>Linux+dircolors</title>
    <link href="https://zixujing.github.io/2019/01/03/linux/linux%E5%91%BD%E4%BB%A4/linux+dircolors/"/>
    <id>https://zixujing.github.io/2019/01/03/linux/linux命令/linux+dircolors/</id>
    <published>2019-01-02T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.070Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>设置自定义的shell颜色<br><a id="more"></a></p></blockquote><h1 id="把以下代码粘贴到-bash-profile中后source即可，点击下载"><a href="#把以下代码粘贴到-bash-profile中后source即可，点击下载" class="headerlink" title="把以下代码粘贴到.bash_profile中后source即可，点击下载"></a>把以下代码粘贴到.bash_profile中后source即可，点击下载</h1><blockquote><p>256dark<br>ansi-universal<br><a href="https://raw.githubusercontent.com/zixujing/book1/master/code/dircolor_code.txt" target="_blank" rel="noopener">代码</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;设置自定义的shell颜色&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://zixujing.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>kafka手册</title>
    <link href="https://zixujing.github.io/2019/01/03/bigdata/kafka%E6%89%8B%E5%86%8C/"/>
    <id>https://zixujing.github.io/2019/01/03/bigdata/kafka手册/</id>
    <published>2019-01-02T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.055Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>以下以2.0.0为例，0.11.0.3类似<br><a id="more"></a></p></blockquote><h2 id="kafka安装"><a href="#kafka安装" class="headerlink" title="kafka安装"></a>kafka安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf kafka_2.11-2.0.0.tar.gz -C /usr/<span class="built_in">local</span>/elk/</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/config</span><br><span class="line">$ vim zookeeper.properties</span><br><span class="line"><span class="comment"># zookeeper的data路径</span></span><br><span class="line">dataDir=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/zookeeper/data</span><br><span class="line"><span class="comment"># zookeeper的log路径</span></span><br><span class="line">dataLogDir=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/zookeeper/logs</span><br><span class="line"><span class="comment"># zookeeper的端口号</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># zookeeper的客户端连接数，设置成0为无限制连接。</span></span><br><span class="line">maxClientCnxns=0</span><br><span class="line">$ <span class="comment">#配置server.properties文件，修改该配置文件中的以下参数：</span></span><br><span class="line">$ vim server.properties</span><br><span class="line"><span class="comment">#服务端口，默认9092</span></span><br><span class="line">port=9092</span><br><span class="line"><span class="comment">#监听地址</span></span><br><span class="line">host.name=192.168.106.xxx</span><br><span class="line"><span class="comment">#日志文件存储路径</span></span><br><span class="line">log.dirs=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/kafka/logs</span><br><span class="line"><span class="comment">#Zookeeper quorum设置，如果有多个使用逗号分割。</span></span><br><span class="line">zookeeper.connect=192.168.106.226:2181</span><br><span class="line">$ <span class="comment">#启动zookeeper</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/zookeeper-server-start.sh  config/zookeeper.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">$ <span class="comment">#启动kafka</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-server-start.sh  config/server.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">$ <span class="comment">#停止zookeeper</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/zookeeper-server-stop.sh  config/zookeeper.properties</span><br><span class="line">$ <span class="comment">#停止kafka</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-server-stop.sh  config/server.properties</span><br></pre></td></tr></table></figure><h2 id="kafka测试"><a href="#kafka测试" class="headerlink" title="kafka测试"></a>kafka测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment">#执行下面的命令创建一个topic，名称为“testTopic”：</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-topics.sh --create --zookeeper 192.168.0.xxx:2181 --replication-factor 1 --partitions 1 --topic testTopic</span><br><span class="line">$ <span class="comment">#执行下面的命令查看topic：</span></span><br><span class="line">$ bin/kafka-topics.sh --list --zookeeper 192.168.0.xxx:2181</span><br><span class="line">$ <span class="comment">#执行下面的命令测试生产消息</span></span><br><span class="line">$ bin/kafka-console-producer.sh --broker-list 192.168.0.xxx:9092 --topic testTopic</span><br><span class="line">this is <span class="built_in">test</span></span><br><span class="line">$ <span class="comment">#执行下面的命令测试消费消息</span></span><br><span class="line">$ bin/kafka-console-consumer.sh --bootstrap-server 192.168.0.xxx:9092 --topic testTopic --from-beginning</span><br></pre></td></tr></table></figure><h1 id="broker配置"><a href="#broker配置" class="headerlink" title="broker配置"></a>broker配置</h1><ul><li>broker.id: 默认值是0，也可以被设置成其他任意整数。这个值在整个kafka集群里必须是唯一的。</li><li>port：默认9092</li><li>zookeeper.connect:指定zookeeper地址</li><li>log.dirs：kafka把所有的消息都保存在磁盘上，存放这些日志片段的目录是通过log.dirs指定的。它是一组用逗号分隔的本地文件系统路径。</li><li>num.recovery.threads.per.data.dir:如果num.recovery.threads.per.data.dir设置8，并且log.dir指定了3个路径，那么总共需要24个线程。</li><li>auto.create.topics.enable:建议设置为false，因为很多情况是非预期的<h1 id="主题的默认配置"><a href="#主题的默认配置" class="headerlink" title="主题的默认配置"></a>主题的默认配置</h1></li><li>num.partitions：指定了新创建的主题将包含多少个分区。</li><li>log.retention.ms：根据时间决定数据可以被保留多久。</li><li>log.retention.bytes：保留消息字节数来判断消息是否过期。如果log.retention.bytes被设置为1GB，主题有8个分区。那么最多可以保留8GB数据。</li><li>log.segment.bytes:当日志片段大小达到log.segment.bytes指定的上限（默认是1GB）时，当前日志片段就会被关闭，一个新的日志片段被打开。如果一个主题每天只接受100MB的消息，而log.segment.bytes使用的默认设置，那么需要10天时间才能填满一个日志片段。因为日志片段关闭之前消息是不会过期的，所以如果log.retention.ms被设置为604800000（也就是1周），那么日志片段最多需要17天才会过期。</li><li>log.segment.ms:默认没值。与log.segment.bytes哪个首先满足哪个先触发。</li><li>message.max.bytes:限制单个消息的大小，默认是1M</li></ul><h1 id="linux系统配置"><a href="#linux系统配置" class="headerlink" title="linux系统配置"></a>linux系统配置</h1><h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><ul><li>vm.swappiness：值0在高版本的linux中明确表示，永远不产生交换。最合适的值是1.</li><li>vm.dirty_background_ratio：设置小于10，一般设置为5.该值指的是系统内存的百分比。设置系统何时刷脏页到磁盘。</li><li>vm.dirty_ratio：可以增加被内核进程刷新到磁盘之前的脏页数量，可以将它设置为大于20的值。60~80比较合理。</li><li>脏页数量如何查看。cat /proc/vmstat | egrep “dirty|writeback”<br>nr_dirty 3875<br>nr_writeback 29<br>nr_writeback_temp 0<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2></li><li>net.core.wmen_default,net.core.rmem_default:合理的值是131072（128k）</li><li>net.core.wmen_max,net.core.rmen_max：合理的值是2097152（2M）</li><li>net.ipv4.tcp_wmen,net.ipv4.tcp_rmen:tcp socket的读写缓冲区，由3个整数组成，用空格分隔，分别表示最小值、默认值和最大值。最大值不能超过net.core.wmen_max和net.core.rmen_max.例如4096 65536 2048000</li><li>net.ipv4.tcp_window_scaling:1</li><li>net.ipv4.tcp_max_syn_backlog:大于1024</li><li>net.core.netdev_max_baxklog:大于1000</li></ul><hr>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;以下以2.0.0为例，0.11.0.3类似&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
      <category term="kafka" scheme="https://zixujing.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>ogg for bigdata + elasticsearch 5.2.2</title>
    <link href="https://zixujing.github.io/2019/01/02/ogg/ogg_for_bigdata_elasticsearch522/"/>
    <id>https://zixujing.github.io/2019/01/02/ogg/ogg_for_bigdata_elasticsearch522/</id>
    <published>2019-01-01T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.075Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>elasticsearch 5.2.2是ogg for bigdata支持的最高版本<br>elasticsearch 5.2.2 安装略<br><a id="more"></a></p></blockquote><ol><li>源数据库配置</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ogg&gt; add trandata smartecap_data.*</span><br><span class="line">ogg&gt; add extract ext_data,tranlog ,begin now</span><br><span class="line">ogg&gt; add exttrail ./dirdat/st,extract ext_data,megabytes 100</span><br><span class="line">ogg&gt; edit params ext_data</span><br><span class="line">EXTRACT ext_data</span><br><span class="line">SETENV (NLS_LANG = &quot;AMERICAN_AMERICA.ZHS16GBK&quot;)</span><br><span class="line">SETENV (ORACLE_HOME = &quot;/home/oracle/app/oracle/product/11.2.0/dbhome_1&quot;)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">--DISCARDFILE ./dirrpt/ext_data.dsc,APPEND,MEGABYTES 1024</span><br><span class="line">DBOPTIONS  ALLOWUNUSEDCOLUMN</span><br><span class="line">WARNLONGTRANS 2h,CHECKINTERVAL 350s</span><br><span class="line">EXTTRAIL ./dirdat/dt</span><br><span class="line">FETCHOPTIONS NOUSESNAPSHOT</span><br><span class="line">--TRANLOGOPTIONS CONVERTUCS2CLOBS</span><br><span class="line">--IGNOREDELETES</span><br><span class="line">TABLE smartecap_data.dt*;</span><br><span class="line">ogg&gt; start ext_data</span><br><span class="line">ogg&gt; add extract PUMP_DT,exttrailsource ./dirdat/dt</span><br><span class="line">ogg&gt; add rmttrail ./dirdat/dt ,extract PUMP_DT</span><br><span class="line">ogg&gt; edit params PUMP_DT</span><br><span class="line">EXTRACT pump_dt</span><br><span class="line">SETENV (NLS_LANG = AMERICAN_AMERICA.UTF8)</span><br><span class="line">USERID ogg, PASSWORD ogg</span><br><span class="line">PASSTHRU</span><br><span class="line">RMTHOST 192.168.106.213, MGRPORT 7801, compress</span><br><span class="line">RMTTRAIL ./dirdat/dt</span><br><span class="line">TABLE smartecap_data.*;</span><br><span class="line">ogg&gt; start pump_dt</span><br></pre></td></tr></table></figure><ol start="2"><li>目标ogg for bigdata配置</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ cat elastic.properties</span><br><span class="line">gg.handlerlist=elasticsearch</span><br><span class="line">gg.handler.elasticsearch.type=elasticsearch</span><br><span class="line">## Handler properties for Elasticsearch 6.x</span><br><span class="line">gg.handler.elasticsearch.ServerAddressList=192.168.106.213:9300</span><br><span class="line">gg.handler.elasticsearch.clientSettingsFile=client6.properties</span><br><span class="line">gg.handler.elasticsearch.version=5.x</span><br><span class="line">#gg.handler.elasticsearch.bulkWrite=true</span><br><span class="line">gg.classpath=./dirprm*:/home/es/elasticsearch-5.2.2/lib/*:/home/es/elasticsearch-5.2.2/modules/transport-netty3/*:/home/es/elasticsearch-5.2.2/modules/transport-netty4/*:/home/es/elasticsearch-5.2.2/modules/reindex/*</span><br><span class="line">goldengate.userexit.writers=javawriter</span><br><span class="line">javawriter.stats.display=TRUE</span><br><span class="line">javawriter.stats.full=TRUE</span><br><span class="line">gg.log=log4j</span><br><span class="line">gg.log.level=INFO</span><br><span class="line">gg.report.time=30sec</span><br><span class="line">javawriter.bootoptions=-Xmx512m -Xms32m -Djava.class.path=.:ggjava/ggjava.jar:./dirprm</span><br><span class="line">$ cat client6.properties</span><br><span class="line">cluster.name=oggtest</span><br><span class="line">#xpack.security.user=&lt;x-pack user name&gt;:&lt;x-pack password&gt;</span><br><span class="line"></span><br><span class="line">ogg&gt; add replicat ELASTIC,exttrail ./dirdat/dt</span><br><span class="line">ogg&gt; edit param ELASTIC</span><br><span class="line">REPLICAT elastic</span><br><span class="line">TARGETDB LIBFILE libggjava.so SET property=./dirprm/elastic.properties</span><br><span class="line">MAP smartecap_data.*, TARGET smartecap_data.*;</span><br><span class="line">#java的配置，java需要jdk1.8</span><br><span class="line">$ cat .bash_profile</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">PATH=$PATH:$HOME/bin:/usr/local/jdk/bin</span><br><span class="line">export PATH</span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/jdk/jre/lib/amd64/server:$LD_LIBRARY_PATH</span><br><span class="line">#elasticsearch 客户端jar 需要下载放到dirprm中，需要下载的jar如下</span><br><span class="line">$ ls *.jar</span><br><span class="line">lang-mustache-client-5.2.2.jar  percolator-client-5.2.2.jar  transport-5.2.2.jar  x-pack-transport-5.2.2.jar</span><br><span class="line"></span><br><span class="line">ogg&gt; start ELASTIC</span><br></pre></td></tr></table></figure><blockquote><p>jar文件下载</p></blockquote><table><thead><tr><th>jar文件名</th><th>下载  </th></tr></thead><tbody><tr><td>lang-mustache-client-5.2.2.jar</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/code/lang-mustache-client-5.2.2.jar" target="_blank" rel="noopener">点</a></td></tr><tr><td>percolator-client-5.2.2.jar</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/code/percolator-client-5.2.2.jar" target="_blank" rel="noopener">点</a></td></tr><tr><td>transport-5.2.2.jar</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/code/transport-5.2.2.jar" target="_blank" rel="noopener">点</a>   </td></tr><tr><td>x-pack-transport-5.2.2.jar</td><td><a href="https://raw.githubusercontent.com/zixujing/book1/master/code/x-pack-transport-5.2.2.jar" target="_blank" rel="noopener">点</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;elasticsearch 5.2.2是ogg for bigdata支持的最高版本&lt;br&gt;elasticsearch 5.2.2 安装略&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="ogg" scheme="https://zixujing.github.io/tags/ogg/"/>
    
      <category term="elasticsearch" scheme="https://zixujing.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>添加elasticsearch结点||关闭elasticsearch集群</title>
    <link href="https://zixujing.github.io/2018/12/30/bigdata/elasticsearch%E9%9B%86%E7%BE%A4%E6%B7%BB%E5%8A%A0%E7%BB%93%E7%82%B9/"/>
    <id>https://zixujing.github.io/2018/12/30/bigdata/elasticsearch集群添加结点/</id>
    <published>2018-12-29T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.054Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>elasticsearch 集群使用<br><a id="more"></a></p><ol><li>配置linux的elasticsearch环境</li><li>copy集群中的一个elasticsearch软件，作为新节点的elasticsearch软件</li><li>修改elasticsearch.yaml,修改集群的配置包含新添加的结点。如<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[els@localhost</span> <span class="string">elasticsearch-6.5.4]$</span> <span class="string">sed</span> <span class="bullet">-n</span> <span class="string">'/^[^#]/p'</span> <span class="string">config/elasticsearch.yml</span>  </span><br><span class="line"><span class="string">cluster.name:</span> <span class="string">logdig</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">node4</span></span><br><span class="line"><span class="string">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br><span class="line"><span class="string">network.host:</span> <span class="number">192.168</span><span class="number">.106</span><span class="number">.237</span></span><br><span class="line"><span class="string">discovery.zen.ping.unicast.hosts:</span> <span class="string">["192.168.106.213",</span> <span class="string">"192.168.106.178"</span><span class="string">,"192.168.106.219","192.168.106.237"]</span></span><br><span class="line"><span class="string">discovery.zen.minimum_master_nodes:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li></ol></blockquote><ol start="4"><li>关闭集群<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[els@localhost elasticsearch-6.5.4]$ curl -XPUT http://192.168.106.213:9200/_cluster/settings -d &apos;&#123;</span><br><span class="line">&quot;persistent&quot;:&#123;</span><br><span class="line">&quot;cluster.routing.allocation.enable&quot;:&quot;none&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>关闭集群的所有结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kill -15 elspid</span><br></pre></td></tr></table></figure></p></blockquote><ol start="5"><li>启动集群包括新添加的结点<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[es@localhost elasticsearch-6.5.3]$ bin/elasticsearch -d</span><br><span class="line">[els@localhost elasticsearch-6.5.4]$ curl -XPUT http://192.168.106.213:9200/_cluster/settings -d &apos;&#123;</span><br><span class="line">&quot;persistent&quot;:&#123;</span><br><span class="line">&quot;cluster.routing.allocation.enable&quot;:&quot;all&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;elasticsearch 集群使用&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="elasticsearch" scheme="https://zixujing.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>ELK安装配置文档</title>
    <link href="https://zixujing.github.io/2018/12/26/bigdata/ELK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"/>
    <id>https://zixujing.github.io/2018/12/26/bigdata/ELK安装配置文档/</id>
    <published>2018-12-25T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.052Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ELK 安装配置文档<br><a id="more"></a><br><!-- toc --></p></blockquote><h1 id="elasticsearch-安装"><a href="#elasticsearch-安装" class="headerlink" title="elasticsearch 安装"></a>elasticsearch 安装</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="linux环境配置"><a href="#linux环境配置" class="headerlink" title="linux环境配置"></a>linux环境配置</h3><h4 id="创建elk用户并设置elk用户的密码"><a href="#创建elk用户并设置elk用户的密码" class="headerlink" title="创建elk用户并设置elk用户的密码"></a>创建elk用户并设置elk用户的密码</h4><blockquote><p>elasticsearch默认不能在root用户下运行，所以需新创建一个elk用户，具体操作如下。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ groupadd elk</span><br><span class="line">$ useradd -g elk -m elk</span><br><span class="line">$ passwd elk</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="设置linux环境参数"><a href="#设置linux环境参数" class="headerlink" title="设置linux环境参数"></a>设置linux环境参数</h4><ol><li><p>修改limits.conf配置文件</p><blockquote><p>limits.conf是会话级别，退出会话重新登录需改即可生效。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/security/limits.conf</span><br><span class="line"> * soft nofile 65536</span><br><span class="line"> * hard nofile 131072</span><br><span class="line"> * soft nproc 2048</span><br><span class="line"> * hard nproc 4096</span><br></pre></td></tr></table></figure></blockquote></li><li><p>修改20-nproc.conf配置文件</p><blockquote><p>某些版本的linux的max user processes配置来源是20-nproc.conf，还需修改20-nproc.conf（centos6 是90-nproc.conf）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/security/limits.d/20-nproc.conf</span><br><span class="line">* soft nproc 4096</span><br></pre></td></tr></table></figure></blockquote></li><li><p>设置sysctl.conf配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/sysctl.conf</span><br><span class="line">vm.max_map_count=655360</span><br><span class="line">$ sysctl -p</span><br></pre></td></tr></table></figure></li></ol><h3 id="java环境配置"><a href="#java环境配置" class="headerlink" title="java环境配置"></a>java环境配置</h3><blockquote><p>elasticsearch 6.5.*需要jdk版本1.8，如果系统中没有jdk或者是jdk版本不符合要求，那么需要安装jdk，以下是在elk用户下安装jdk的示例。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment">#以下是elk用户下</span></span><br><span class="line">$ tar -xzvf jdk-8u192-linux-x64.tar.gz </span><br><span class="line">$ mv jdk1.8.0_192/ jdk</span><br><span class="line">$ vi ~/.bash_profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/home/elk/soft/jdk</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/.<span class="built_in">local</span>/bin:<span class="variable">$HOME</span>/bin:/home/elk/soft/jdk/bin</span><br><span class="line">$ <span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="elasticsearch安装"><a href="#elasticsearch安装" class="headerlink" title="elasticsearch安装"></a>elasticsearch安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xzvf elasticsearch-6.5.2.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> elasticsearch-6.5.2/config</span><br><span class="line">$ vi elasticsearch.yml </span><br><span class="line">cluster.name: <span class="built_in">log</span>-dig</span><br><span class="line">node.name: node1</span><br><span class="line"><span class="comment">#elasticsearch数据的存储路径</span></span><br><span class="line">path.data: /xxx/data</span><br><span class="line"><span class="comment">#elasticsearch日志路径</span></span><br><span class="line">path.logs: /xxx/logs</span><br><span class="line"><span class="comment">#绑定监听IP</span></span><br><span class="line">network.host: 192.168.0.xxx</span><br><span class="line"><span class="comment">#设置对外服务的http端口,默认为9200</span></span><br><span class="line">http.port: 9200</span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br><span class="line">$ bin/elasticsearch -d</span><br><span class="line">$ <span class="comment">#测试安装是否成功</span></span><br><span class="line">$ curl 192.168.0.xxx:9200</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"node1"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"log-dig"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"EFpju3lYSeOL3Vs5bLM81A"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"6.5.3"</span>,</span><br><span class="line">    <span class="string">"build_flavor"</span> : <span class="string">"default"</span>,</span><br><span class="line">    <span class="string">"build_type"</span> : <span class="string">"tar"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"159a78a"</span>,</span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2018-12-06T20:11:28.826501Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"7.5.0"</span>,</span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"5.6.0"</span>,</span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"5.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br><span class="line">$ <span class="comment">#启动elasticsearch</span></span><br><span class="line">$ bin/elasticsearch -d</span><br><span class="line">$ <span class="comment">#停止elasticsearch</span></span><br><span class="line">$ jps</span><br><span class="line">28410 Elasticsearch</span><br><span class="line">$ <span class="built_in">kill</span> -15 28410</span><br></pre></td></tr></table></figure><hr><h1 id="kibana安装"><a href="#kibana安装" class="headerlink" title="kibana安装"></a>kibana安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xzvf kibana-6.5.2-linux-x86_64.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> kibana-6.5.3-linux-x86_64/</span><br><span class="line">$ vi config/kibana.yml </span><br><span class="line">server.name: <span class="string">"namefordisplay"</span></span><br><span class="line"><span class="comment">#kinaba绑定ip设置</span></span><br><span class="line">server.host: <span class="string">"192.168.0.xxx"</span></span><br><span class="line">server.port: 5601</span><br><span class="line">elasticsearch.url: <span class="string">"http://192.168.0.xxx:9200"</span></span><br><span class="line">$ screen bin/kibana -c config/kibana.yml</span><br><span class="line">CTRL+a d</span><br><span class="line">$ <span class="comment">#停止kibana</span></span><br><span class="line">$ ps -ef | grep node</span><br><span class="line">els        9514     1  1 Dec21 ?        01:30:02 ./../node/bin/node --no-warnings ./../src/cli</span><br><span class="line">els       14516  9514  0 Dec21 ?        00:00:13 /home/es/kibana-6.5.3-linux-x86_64/node/bin/node --no-warnings /home/es/kibana-6.5.3-linux-x86_64/node_modules/x-pack/plugins/canvas/server/lib/route_expression/thread/babeled.js</span><br><span class="line">$ <span class="built_in">kill</span> -15 9514</span><br></pre></td></tr></table></figure><blockquote><p>验证kibana是否安装成功，<a href="http://192.168.0.xxx:5601" target="_blank" rel="noopener">http://192.168.0.xxx:5601</a></p></blockquote><center><img src="https://raw.githubusercontent.com/zixujing/book1.github.io/master/image/1545789425109.png" alt="Alt text"></center><hr><h1 id="kibana汉化"><a href="#kibana汉化" class="headerlink" title="kibana汉化"></a>kibana汉化</h1><blockquote><p>Kibana_Hanization汉化需要python2.7环境，一般安装linux都会自带python2.7环境<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ unzip Kibana_Hanization-master.zip</span><br><span class="line">$ <span class="comment">#执行下面命令汉化kibana</span></span><br><span class="line">$ <span class="built_in">cd</span> Kibana_Hanization-master/</span><br><span class="line">$ python main.py /path_for_kibana/kibana-6.5.2-linux-x86_64/</span><br></pre></td></tr></table></figure></p></blockquote><hr><h1 id="kafka的搭建"><a href="#kafka的搭建" class="headerlink" title="kafka的搭建"></a>kafka的搭建</h1><h2 id="kafka安装"><a href="#kafka安装" class="headerlink" title="kafka安装"></a>kafka安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf kafka_2.11-2.0.0.tar.gz -C /usr/<span class="built_in">local</span>/elk/</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/config </span><br><span class="line">$ vim zookeeper.properties</span><br><span class="line"><span class="comment"># zookeeper的data路径</span></span><br><span class="line">dataDir=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/zookeeper/data</span><br><span class="line"><span class="comment"># zookeeper的log路径</span></span><br><span class="line">dataLogDir=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/zookeeper/logs</span><br><span class="line"><span class="comment"># zookeeper的端口号</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># zookeeper的客户端连接数，设置成0为无限制连接。</span></span><br><span class="line">maxClientCnxns=0</span><br><span class="line">$ <span class="comment">#配置server.properties文件，修改该配置文件中的以下参数：</span></span><br><span class="line">$ vim server.properties</span><br><span class="line"><span class="comment">#服务端口，默认9092</span></span><br><span class="line">port=9092</span><br><span class="line"><span class="comment">#监听地址</span></span><br><span class="line">host.name=192.168.106.xxx</span><br><span class="line"><span class="comment">#日志文件存储路径</span></span><br><span class="line">log.dirs=/usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0/kafka/logs</span><br><span class="line"><span class="comment">#Zookeeper quorum设置，如果有多个使用逗号分割。</span></span><br><span class="line">zookeeper.connect=192.168.106.226:2181</span><br><span class="line">$ <span class="comment">#启动zookeeper</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/zookeeper-server-start.sh  config/zookeeper.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">$ <span class="comment">#启动kafka</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-server-start.sh  config/server.properties 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">$ <span class="comment">#停止zookeeper</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/zookeeper-server-stop.sh  config/zookeeper.properties</span><br><span class="line">$ <span class="comment">#停止kafka</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-server-stop.sh  config/server.properties</span><br></pre></td></tr></table></figure><h2 id="kafka测试"><a href="#kafka测试" class="headerlink" title="kafka测试"></a>kafka测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment">#执行下面的命令创建一个topic，名称为“testTopic”：</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/kafka_2.11-2.0.0</span><br><span class="line">$ bin/kafka-topics.sh --create --zookeeper 192.168.0.xxx:2181 --replication-factor 1 --partitions 1 --topic testTopic</span><br><span class="line">$ <span class="comment">#执行下面的命令查看topic：</span></span><br><span class="line">$ bin/kafka-topics.sh --list --zookeeper 192.168.0.xxx:2181</span><br><span class="line">$ <span class="comment">#执行下面的命令测试生产消息</span></span><br><span class="line">$ bin/kafka-console-producer.sh --broker-list 192.168.0.xxx:9092 --topic testTopic</span><br><span class="line">this is <span class="built_in">test</span></span><br><span class="line">$ <span class="comment">#执行下面的命令测试消费消息</span></span><br><span class="line">$ bin/kafka-console-consumer.sh --bootstrap-server 192.168.0.xxx:9092 --topic testTopic --from-beginning</span><br></pre></td></tr></table></figure><hr><h1 id="logstash安装"><a href="#logstash安装" class="headerlink" title="logstash安装"></a>logstash安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf logstash-6.5.2.tar.gz -C /usr/<span class="built_in">local</span>/elk/</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/logstash-6.5.2/config</span><br><span class="line">$ vim logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">        kafka &#123;</span><br><span class="line">                codec =&gt; <span class="string">"json"</span></span><br><span class="line">                topics_pattern =&gt; <span class="string">"government_.*"</span></span><br><span class="line">                bootstrap_servers =&gt; <span class="string">"192.168.0.xxx:9092"</span></span><br><span class="line">                auto_offset_reset =&gt; <span class="string">"latest"</span></span><br><span class="line">                group_id =&gt; <span class="string">"government"</span></span><br><span class="line">               &#125;</span><br><span class="line">     &#125;</span><br><span class="line">output &#123;</span><br><span class="line">        <span class="comment">#file &#123;</span></span><br><span class="line">        <span class="comment">#       path =&gt; "/home/soft/elk/logstash-6.5.3/logstash.output"</span></span><br><span class="line">        <span class="comment">#     &#125;</span></span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">                        hosts =&gt;[<span class="string">"192.168.0.xxx:9200"</span>]</span><br><span class="line">                        index =&gt; <span class="string">"%&#123;[fields][log_topics]&#125;"</span></span><br><span class="line">                      &#125;</span><br><span class="line">        <span class="comment">#stdout &#123; codec =&gt; rubydebug &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line">$ <span class="comment">#后台启动logstash</span></span><br><span class="line">$ nohup bin/logstash -f /usr/<span class="built_in">local</span>/elk/logstash-6.5.2/configlogstash.conf &amp;</span><br><span class="line">$ <span class="comment">#停止logstash</span></span><br><span class="line">$ jps</span><br><span class="line">30997 Jps</span><br><span class="line">32026 Logstash</span><br><span class="line">$ <span class="built_in">kill</span> -15 32026</span><br></pre></td></tr></table></figure><hr><h1 id="filebeat安装"><a href="#filebeat安装" class="headerlink" title="filebeat安装"></a>filebeat安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf filebeat-6.5.3-linux-x86_64.tar.gz -C /usr/<span class="built_in">local</span>/elk/</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/filebeat-6.5.3-linux-x86_64</span><br><span class="line">$ vim filebeat.yml</span><br><span class="line">filebeat.prospectors:</span><br><span class="line"><span class="comment">#government_debug日志</span></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /usr/<span class="built_in">local</span>/apache-tomcat-8.5.31/government_sllogs/debug.log</span><br><span class="line">  fields:</span><br><span class="line">    log_topics: government_debug</span><br><span class="line"></span><br><span class="line"><span class="comment">#government_info日志</span></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /usr/<span class="built_in">local</span>/apache-tomcat-8.5.31/government_sllogs/info.log</span><br><span class="line">  fields:</span><br><span class="line">    log_topics: government_info</span><br><span class="line"></span><br><span class="line"><span class="comment">#government_warn日志</span></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /usr/<span class="built_in">local</span>/apache-tomcat-8.5.31/government_sllogs/warn.log</span><br><span class="line">  fields:</span><br><span class="line">    log_topics: government_warn</span><br><span class="line"></span><br><span class="line"><span class="comment">#government_error日志</span></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">- /usr/<span class="built_in">local</span>/apache-tomcat-8.5.31/government_sllogs/error.log</span><br><span class="line">  fields:</span><br><span class="line">    log_topics: government_error</span><br><span class="line"><span class="comment">#多行日志合并</span></span><br><span class="line">  multiline:</span><br><span class="line">       pattern: <span class="string">'^\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s&#123;1,5&#125;[0-2][0-9]:[0-5][0-9]:[0-5][0-9]'</span></span><br><span class="line">       negate:  <span class="literal">true</span></span><br><span class="line">       match:   after</span><br><span class="line">       max_lines: 500</span><br><span class="line">       timeout: 10s</span><br><span class="line">  tail_files: <span class="literal">true</span></span><br><span class="line"><span class="comment">#日志输出到kafka</span></span><br><span class="line">output.kafka:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  hosts: [<span class="string">"192.168.0.xxx:9092"</span>]</span><br><span class="line">  topic: <span class="string">'%&#123;[fields][log_topics]&#125;'</span></span><br><span class="line">$ <span class="comment">#启动filebeat</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elk/filebeat-6.5.3-linux-x86_64</span><br><span class="line">$ nohup ./filebeat -e -c filebeat.yml &gt; filebeat.log &amp;</span><br><span class="line">$ <span class="comment">#停止filebeat</span></span><br><span class="line">$ ps -ef |grep filebeat</span><br><span class="line">$ <span class="built_in">kill</span> -15 pid</span><br></pre></td></tr></table></figure><hr><h1 id="logstash-配置示例"><a href="#logstash-配置示例" class="headerlink" title="logstash 配置示例"></a>logstash 配置示例</h1><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">input </span>&#123;</span><br><span class="line">   <span class="comment">#filebeat配置</span></span><br><span class="line">   <span class="comment">#filebeats配置</span></span><br><span class="line">   <span class="string">beats </span>&#123;</span><br><span class="line">      <span class="string">port </span>=&gt; <span class="string">5044</span></span><br><span class="line"><span class="string"> </span>  &#125;</span><br><span class="line">   <span class="comment">#tcp网络数据传输，回车是一行</span></span><br><span class="line">   <span class="string">tcp </span>&#123;</span><br><span class="line">  <span class="string">port </span>=&gt; <span class="string">5045</span></span><br><span class="line"><span class="string"></span>  <span class="string">type </span>=&gt; <span class="string">"tcp"</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">#文件读取配置</span></span><br><span class="line">   <span class="string">file </span>&#123;</span><br><span class="line">        <span class="string">path </span>=&gt; <span class="string">"/var/log/messages"</span></span><br><span class="line">        <span class="string">type </span>=&gt; <span class="string">"system"</span></span><br><span class="line">        <span class="string">start_position </span>=&gt; <span class="string">"beginning"</span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="string">file </span>&#123;</span><br><span class="line">        <span class="string">path </span>=&gt; <span class="string">"/var/log/secure"</span></span><br><span class="line">        <span class="string">type </span>=&gt; <span class="string">"secure"</span></span><br><span class="line">        <span class="string">start_position </span>=&gt; <span class="string">"beginning"</span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="string">file </span>&#123;</span><br><span class="line">        <span class="string">path </span>=&gt; <span class="string">"/var/log/httpd/access_log"</span></span><br><span class="line">        <span class="string">type </span>=&gt; <span class="string">"http"</span></span><br><span class="line">        <span class="string">start_position </span>=&gt; <span class="string">"beginning"</span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="string">file </span>&#123;</span><br><span class="line">        <span class="string">path </span>=&gt; <span class="string">"/usr/local/nginx/logs/elk.access.log"</span></span><br><span class="line">        <span class="string">type </span>=&gt; <span class="string">"nginx"</span></span><br><span class="line">        <span class="string">start_position </span>=&gt; <span class="string">"beginning"</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="string">filter </span>&#123;</span><br><span class="line">   <span class="comment">#如果字段logIndex的值为"nginx"</span></span><br><span class="line">   <span class="string">if </span>[<span class="string">fields]</span>[<span class="string">logIndex]</span> == <span class="string">"nginx"</span> &#123;</span><br><span class="line">      <span class="string">grok </span>&#123;</span><br><span class="line">         <span class="string">match </span>=&gt; &#123;</span><br><span class="line">            <span class="comment">#grok 正则匹配</span></span><br><span class="line">            <span class="string">grok </span>&#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;IPORHOST:addre&#125; - - \[%&#123;HTTPDATE:log_timestamp&#125;\] \"</span>%&#123;<span class="string">WORD:verb&#125;</span> %&#123;<span class="string">URIPATHPARAM:request&#125;</span> <span class="string">HTTP/</span>%&#123;<span class="string">NUMBER:httpversion&#125;</span>\<span class="string">" %&#123;INT:status&#125; %&#123;INT:body_bytes_sent&#125; \"</span>%&#123;<span class="string">GREEDYDATA:http_referrer&#125;</span>\<span class="string">" \"</span>%&#123;<span class="string">GREEDYDATA:message&#125;</span>\<span class="string">""</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">urldecode </span>&#123;</span><br><span class="line">         <span class="string">charset </span>=&gt; <span class="string">"UTF-8"</span></span><br><span class="line">         <span class="string">field </span>=&gt; <span class="string">"url"</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">if </span>[<span class="string">upstreamtime]</span> == <span class="string">""</span> <span class="string">or </span>[<span class="string">upstreamtime]</span> == <span class="string">"null"</span> &#123;</span><br><span class="line">         <span class="string">mutate </span>&#123;</span><br><span class="line">            <span class="string">update </span>=&gt; &#123; <span class="string">"upstreamtime"</span> =&gt; <span class="string">"0"</span> &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">date </span>&#123;</span><br><span class="line">         <span class="string">match </span>=&gt; [<span class="string">"logtime"</span>, <span class="string">"dd/MMM/yyyy:HH:mm:ss Z"</span>]</span><br><span class="line">         <span class="string">target </span>=&gt; <span class="string">"@timestamp"</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">mutate </span>&#123;</span><br><span class="line">         <span class="string">convert </span>=&gt; &#123; </span><br><span class="line">            <span class="string">"responsetime"</span> =&gt; <span class="string">"float"</span></span><br><span class="line">            <span class="string">"upstreamtime"</span> =&gt; <span class="string">"float"</span></span><br><span class="line">            <span class="string">"size"</span> =&gt; <span class="string">"integer"</span></span><br><span class="line">         &#125; </span><br><span class="line">         <span class="string">remove_field </span> =&gt; [<span class="string">"port"</span>,<span class="string">"logtime"</span>,<span class="string">"message"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">output </span>&#123;</span><br><span class="line">  <span class="string">if </span>[<span class="string">type]</span> == <span class="string">"system"</span> &#123; </span><br><span class="line"></span><br><span class="line">        <span class="string">elasticsearch </span>&#123;</span><br><span class="line">            <span class="string">hosts </span>=&gt; [<span class="string">"192.168.1.202:9200"</span>]</span><br><span class="line">            <span class="string">index </span>=&gt; <span class="string">"nagios-system-%&#123;+YYYY.MM.dd&#125;"</span></span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="string">if </span>[<span class="string">type]</span> == <span class="string">"secure"</span> &#123;</span><br><span class="line">        <span class="string">elasticsearch </span>&#123;</span><br><span class="line">            <span class="string">hosts </span>=&gt; [<span class="string">"192.168.1.202:9200"</span>]</span><br><span class="line">            <span class="string">index </span>=&gt; <span class="string">"nagios-secure-%&#123;+YYYY.MM.dd&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">if </span>[<span class="string">type]</span> == <span class="string">"http"</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="string">elasticsearch </span>&#123;</span><br><span class="line">            <span class="string">hosts </span>=&gt; [<span class="string">"192.168.1.202:9200"</span>]</span><br><span class="line">            <span class="string">index </span>=&gt; <span class="string">"nagios-http-%&#123;+YYYY.MM.dd&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">if </span>[<span class="string">type]</span> == <span class="string">"nginx"</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="string">elasticsearch </span>&#123;</span><br><span class="line">            <span class="string">hosts </span>=&gt; [<span class="string">"192.168.1.202:9200"</span>]</span><br><span class="line">            <span class="string">index </span>=&gt; <span class="string">"nagios-nginx-%&#123;+YYYY.MM.dd&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="elasticsearch-集群配置"><a href="#elasticsearch-集群配置" class="headerlink" title="elasticsearch 集群配置"></a>elasticsearch 集群配置</h1><blockquote><p>elasticsearch.yml文件配置示例<br><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ======================== Elasticsearch Configuration =========================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> Elasticsearch comes with reasonable defaults for most settings.</span></span><br><span class="line"><span class="comment">#       Before you set out to tweak and tune the configuration, make sure you</span></span><br><span class="line"><span class="comment">#       understand what are you trying to accomplish and the consequences.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The primary way of configuring a node is via this file. This template lists</span></span><br><span class="line"><span class="comment"># the most important settings you may want to configure for a production cluster.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please consult the documentation for further information on configuration options:</span></span><br><span class="line"><span class="comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use a descriptive name for your cluster:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">cluster.name: logdig</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use a descriptive name for the node:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">node.name: node3</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Add custom attributes to the node:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#node.attr.rack: r1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to log files:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Lock the memory on startup:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Make sure that the heap size is set to about half the memory available</span></span><br><span class="line"><span class="comment"># on the system and that the owner of the process is allowed to use this</span></span><br><span class="line"><span class="comment"># limit.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Elasticsearch performs poorly when the system is swapping the memory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">network.host: 192.168.106.178</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set a custom port for HTTP:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#http.port: 9200</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the network module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># --------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Pass an initial list of hosts to perform discovery when new node is started:</span></span><br><span class="line"><span class="comment"># The default list of hosts is ["127.0.0.1", "[::1]"]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">discovery.zen.ping.unicast.hosts: ["192.168.106.xxx", "192.168.106.yyy","192.168.106.zzz"]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Prevent the "split brain" by configuring the majority of nodes (total number of master-eligible nodes / 2 + 1):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the zen discovery module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Gateway -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Block initial recovery after a full cluster restart until N nodes are started:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#gateway.recover_after_nodes: 3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, consult the gateway module documentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Various -----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Require explicit names when deleting indices:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#action.destructive_requires_name: true</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>在这3台服务器分别启动，命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/elasticsearch -d</span><br></pre></td></tr></table></figure></p></blockquote><h1 id="elasticsearch使用示例【集群模式下】"><a href="#elasticsearch使用示例【集群模式下】" class="headerlink" title="elasticsearch使用示例【集群模式下】"></a>elasticsearch使用示例【集群模式下】</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">$ curl 192.168.106.xxx:9200/_cat/shards</span><br><span class="line">$ curl 192.168.106.xxx:9200/_cluster/stats?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_nodes"</span> : &#123;</span><br><span class="line">    <span class="string">"total"</span> : 3,</span><br><span class="line">    <span class="string">"successful"</span> : 3,</span><br><span class="line">    <span class="string">"failed"</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"logdig"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"EFpju3lYSeOL3Vs5bLM81A"</span>,</span><br><span class="line">  <span class="string">"timestamp"</span> : 1545803198329,</span><br><span class="line">  <span class="string">"status"</span> : <span class="string">"green"</span>,</span><br><span class="line">  <span class="string">"indices"</span> : &#123;</span><br><span class="line">    <span class="string">"count"</span> : 15,</span><br><span class="line">    <span class="string">"shards"</span> : &#123;</span><br><span class="line">      <span class="string">"total"</span> : 36,</span><br><span class="line">      <span class="string">"primaries"</span> : 23,</span><br><span class="line">      <span class="string">"replication"</span> : 0.5652173913043478,</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"shards"</span> : &#123;</span><br><span class="line">          <span class="string">"min"</span> : 2,</span><br><span class="line">          <span class="string">"max"</span> : 5,</span><br><span class="line">          <span class="string">"avg"</span> : 2.4</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"primaries"</span> : &#123;</span><br><span class="line">          <span class="string">"min"</span> : 1,</span><br><span class="line">          <span class="string">"max"</span> : 5,</span><br><span class="line">          <span class="string">"avg"</span> : 1.5333333333333334</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"replication"</span> : &#123;</span><br><span class="line">          <span class="string">"min"</span> : 0.0,</span><br><span class="line">          <span class="string">"max"</span> : 1.0,</span><br><span class="line">          <span class="string">"avg"</span> : 0.8666666666666667</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"docs"</span> : &#123;</span><br><span class="line">      <span class="string">"count"</span> : 991540,</span><br><span class="line">      <span class="string">"deleted"</span> : 634</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"store"</span> : &#123;</span><br><span class="line">      <span class="string">"size_in_bytes"</span> : 594606668</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"fielddata"</span> : &#123;</span><br><span class="line">      <span class="string">"memory_size_in_bytes"</span> : 1920,</span><br><span class="line">      <span class="string">"evictions"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"query_cache"</span> : &#123;</span><br><span class="line">      <span class="string">"memory_size_in_bytes"</span> : 0,</span><br><span class="line">      <span class="string">"total_count"</span> : 0,</span><br><span class="line">      <span class="string">"hit_count"</span> : 0,</span><br><span class="line">      <span class="string">"miss_count"</span> : 0,</span><br><span class="line">      <span class="string">"cache_size"</span> : 0,</span><br><span class="line">      <span class="string">"cache_count"</span> : 0,</span><br><span class="line">      <span class="string">"evictions"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"completion"</span> : &#123;</span><br><span class="line">      <span class="string">"size_in_bytes"</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"segments"</span> : &#123;</span><br><span class="line">      <span class="string">"count"</span> : 232,</span><br><span class="line">      <span class="string">"memory_in_bytes"</span> : 2724556,</span><br><span class="line">      <span class="string">"terms_memory_in_bytes"</span> : 1517004,</span><br><span class="line">      <span class="string">"stored_fields_memory_in_bytes"</span> : 217952,</span><br><span class="line">      <span class="string">"term_vectors_memory_in_bytes"</span> : 0,</span><br><span class="line">      <span class="string">"norms_memory_in_bytes"</span> : 22784,</span><br><span class="line">      <span class="string">"points_memory_in_bytes"</span> : 308688,</span><br><span class="line">      <span class="string">"doc_values_memory_in_bytes"</span> : 658128,</span><br><span class="line">      <span class="string">"index_writer_memory_in_bytes"</span> : 0,</span><br><span class="line">      <span class="string">"version_map_memory_in_bytes"</span> : 0,</span><br><span class="line">      <span class="string">"fixed_bit_set_memory_in_bytes"</span> : 147152,</span><br><span class="line">      <span class="string">"max_unsafe_auto_id_timestamp"</span> : 1545800638659,</span><br><span class="line">      <span class="string">"file_sizes"</span> : &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"nodes"</span> : &#123;</span><br><span class="line">    <span class="string">"count"</span> : &#123;</span><br><span class="line">      <span class="string">"total"</span> : 3,</span><br><span class="line">      <span class="string">"data"</span> : 3,</span><br><span class="line">      <span class="string">"coordinating_only"</span> : 0,</span><br><span class="line">      <span class="string">"master"</span> : 3,</span><br><span class="line">      <span class="string">"ingest"</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"versions"</span> : [</span><br><span class="line">      <span class="string">"6.5.3"</span>,</span><br><span class="line">      <span class="string">"6.5.4"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"os"</span> : &#123;</span><br><span class="line">      <span class="string">"available_processors"</span> : 4,</span><br><span class="line">      <span class="string">"allocated_processors"</span> : 4,</span><br><span class="line">      <span class="string">"names"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span> : <span class="string">"Linux"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 3</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"mem"</span> : &#123;</span><br><span class="line">        <span class="string">"total_in_bytes"</span> : 5866811392,</span><br><span class="line">        <span class="string">"free_in_bytes"</span> : 209567744,</span><br><span class="line">        <span class="string">"used_in_bytes"</span> : 5657243648,</span><br><span class="line">        <span class="string">"free_percent"</span> : 4,</span><br><span class="line">        <span class="string">"used_percent"</span> : 96</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"process"</span> : &#123;</span><br><span class="line">      <span class="string">"cpu"</span> : &#123;</span><br><span class="line">        <span class="string">"percent"</span> : 18</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"open_file_descriptors"</span> : &#123;</span><br><span class="line">        <span class="string">"min"</span> : 252,</span><br><span class="line">        <span class="string">"max"</span> : 331,</span><br><span class="line">        <span class="string">"avg"</span> : 301</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"jvm"</span> : &#123;</span><br><span class="line">      <span class="string">"max_uptime_in_millis"</span> : 3270812,</span><br><span class="line">      <span class="string">"versions"</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"version"</span> : <span class="string">"1.8.0_191"</span>,</span><br><span class="line">          <span class="string">"vm_name"</span> : <span class="string">"Java HotSpot(TM) 64-Bit Server VM"</span>,</span><br><span class="line">          <span class="string">"vm_version"</span> : <span class="string">"25.191-b12"</span>,</span><br><span class="line">          <span class="string">"vm_vendor"</span> : <span class="string">"Oracle Corporation"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"version"</span> : <span class="string">"1.8.0_161"</span>,</span><br><span class="line">          <span class="string">"vm_name"</span> : <span class="string">"Java HotSpot(TM) 64-Bit Server VM"</span>,</span><br><span class="line">          <span class="string">"vm_version"</span> : <span class="string">"25.161-b12"</span>,</span><br><span class="line">          <span class="string">"vm_vendor"</span> : <span class="string">"Oracle Corporation"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"version"</span> : <span class="string">"1.8.0_171"</span>,</span><br><span class="line">          <span class="string">"vm_name"</span> : <span class="string">"Java HotSpot(TM) 64-Bit Server VM"</span>,</span><br><span class="line">          <span class="string">"vm_version"</span> : <span class="string">"25.171-b11"</span>,</span><br><span class="line">          <span class="string">"vm_vendor"</span> : <span class="string">"Oracle Corporation"</span>,</span><br><span class="line">          <span class="string">"count"</span> : 1</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"mem"</span> : &#123;</span><br><span class="line">        <span class="string">"heap_used_in_bytes"</span> : 925867600,</span><br><span class="line">        <span class="string">"heap_max_in_bytes"</span> : 3186360320</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"threads"</span> : 115</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"fs"</span> : &#123;</span><br><span class="line">      <span class="string">"total_in_bytes"</span> : 127439097856,</span><br><span class="line">      <span class="string">"free_in_bytes"</span> : 37985562624,</span><br><span class="line">      <span class="string">"available_in_bytes"</span> : 33092489216</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"plugins"</span> : [ ],</span><br><span class="line">    <span class="string">"network_types"</span> : &#123;</span><br><span class="line">      <span class="string">"transport_types"</span> : &#123;</span><br><span class="line">        <span class="string">"security4"</span> : 3</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"http_types"</span> : &#123;</span><br><span class="line">        <span class="string">"security4"</span> : 3</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ curl 192.168.106.213:9200/_cluster/settings?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"persistent"</span> : &#123;</span><br><span class="line">    <span class="string">"xpack"</span> : &#123;</span><br><span class="line">      <span class="string">"monitoring"</span> : &#123;</span><br><span class="line">        <span class="string">"collection"</span> : &#123;</span><br><span class="line">          <span class="string">"enabled"</span> : <span class="string">"true"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"transient"</span> : &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ELK 安装配置文档&lt;br&gt;
    
    </summary>
    
      <category term="tool" scheme="https://zixujing.github.io/categories/tool/"/>
    
    
      <category term="elasticsearch" scheme="https://zixujing.github.io/tags/elasticsearch/"/>
    
      <category term="logstash" scheme="https://zixujing.github.io/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>Linux Bash /dev/tcp/HOST/PORT</title>
    <link href="https://zixujing.github.io/2018/12/25/linux/linux%E5%91%BD%E4%BB%A4/dev_tcp/"/>
    <id>https://zixujing.github.io/2018/12/25/linux/linux命令/dev_tcp/</id>
    <published>2018-12-24T16:00:00.000Z</published>
    <updated>2019-01-15T13:11:08.069Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>bash中的特殊命令<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exec 8&lt;&gt;/dev/tcp/192.168.106.213/9200</span><br><span class="line">echo -e &quot;GET _cat/indices HTTP/1.1\r\nhost: http://127.0.0.1\r\nConnection: close\r\n\r\n&quot; &gt;&amp;8</span><br><span class="line">cat &lt;&amp;8</span><br><span class="line">exec 8&lt;&amp;-</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;bash中的特殊命令&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://zixujing.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://zixujing.github.io/tags/linux/"/>
    
  </entry>
  
</feed>
